# Comparing `tmp/odoo14_addon_base_url-14.0.1.0.1.dev1-py3-none-any.whl.zip` & `tmp/odoo14_addon_base_url-14.0.1.0.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,19 +1,19 @@
-Zip file size: 13269 bytes, number of entries: 17
--rw-r--r--  2.0 unx      781 b- defN 21-Mar-21 21:03 odoo/addons/base_url/README.rst
--rw-r--r--  2.0 unx       21 b- defN 21-Mar-21 21:03 odoo/addons/base_url/__init__.py
--rw-r--r--  2.0 unx      748 b- defN 21-Mar-21 21:03 odoo/addons/base_url/__manifest__.py
--rw-r--r--  2.0 unx     5075 b- defN 21-Mar-21 21:03 odoo/addons/base_url/i18n/base_url.pot
--rw-r--r--  2.0 unx       49 b- defN 21-Mar-21 21:03 odoo/addons/base_url/models/__init__.py
--rw-r--r--  2.0 unx     9310 b- defN 21-Mar-21 21:03 odoo/addons/base_url/models/abstract_url.py
--rw-r--r--  2.0 unx     1870 b- defN 21-Mar-21 21:03 odoo/addons/base_url/models/url_url.py
--rw-r--r--  2.0 unx      130 b- defN 21-Mar-21 21:03 odoo/addons/base_url/security/ir.model.access.csv
--rw-r--r--  2.0 unx       32 b- defN 21-Mar-21 21:03 odoo/addons/base_url/tests/__init__.py
--rw-r--r--  2.0 unx      943 b- defN 21-Mar-21 21:03 odoo/addons/base_url/tests/models.py
--rw-r--r--  2.0 unx     3862 b- defN 21-Mar-21 21:03 odoo/addons/base_url/tests/models_mixin.py
--rw-r--r--  2.0 unx     4742 b- defN 21-Mar-21 21:03 odoo/addons/base_url/tests/test_abstract_url.py
--rw-r--r--  2.0 unx     1400 b- defN 21-Mar-21 21:03 odoo/addons/base_url/views/url_view.xml
--rw-r--r--  2.0 unx     1279 b- defN 21-Mar-21 21:03 odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 21-Mar-21 21:03 odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 21-Mar-21 21:03 odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1632 b- defN 21-Mar-21 21:03 odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/RECORD
-17 files, 31971 bytes uncompressed, 10491 bytes compressed:  67.2%
+Zip file size: 13056 bytes, number of entries: 17
+-rw-r--r--  2.0 unx      781 b- defN 23-Apr-18 07:25 odoo/addons/base_url/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Apr-18 07:25 odoo/addons/base_url/__init__.py
+-rw-r--r--  2.0 unx      748 b- defN 23-Apr-18 07:25 odoo/addons/base_url/__manifest__.py
+-rw-r--r--  2.0 unx     4920 b- defN 23-Apr-18 07:25 odoo/addons/base_url/i18n/base_url.pot
+-rw-r--r--  2.0 unx       49 b- defN 23-Apr-18 07:25 odoo/addons/base_url/models/__init__.py
+-rw-r--r--  2.0 unx     8258 b- defN 23-Apr-18 07:25 odoo/addons/base_url/models/abstract_url.py
+-rw-r--r--  2.0 unx     1890 b- defN 23-Apr-18 07:25 odoo/addons/base_url/models/url_url.py
+-rw-r--r--  2.0 unx      130 b- defN 23-Apr-18 07:25 odoo/addons/base_url/security/ir.model.access.csv
+-rw-r--r--  2.0 unx       32 b- defN 23-Apr-18 07:25 odoo/addons/base_url/tests/__init__.py
+-rw-r--r--  2.0 unx      943 b- defN 23-Apr-18 07:25 odoo/addons/base_url/tests/models.py
+-rw-r--r--  2.0 unx     3862 b- defN 23-Apr-18 07:25 odoo/addons/base_url/tests/models_mixin.py
+-rw-r--r--  2.0 unx     5191 b- defN 23-Apr-18 07:25 odoo/addons/base_url/tests/test_abstract_url.py
+-rw-r--r--  2.0 unx     1400 b- defN 23-Apr-18 07:25 odoo/addons/base_url/views/url_view.xml
+-rw-r--r--  2.0 unx     1312 b- defN 23-Apr-18 07:25 odoo14_addon_base_url-14.0.1.0.2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-18 07:25 odoo14_addon_base_url-14.0.1.0.2.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Apr-18 07:25 odoo14_addon_base_url-14.0.1.0.2.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     1612 b- defN 23-Apr-18 07:25 odoo14_addon_base_url-14.0.1.0.2.dist-info/RECORD
+17 files, 31246 bytes uncompressed, 10318 bytes compressed:  67.0%
```

## zipnote {}

```diff
@@ -33,20 +33,20 @@
 
 Filename: odoo/addons/base_url/tests/test_abstract_url.py
 Comment: 
 
 Filename: odoo/addons/base_url/views/url_view.xml
 Comment: 
 
-Filename: odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/METADATA
+Filename: odoo14_addon_base_url-14.0.1.0.2.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/WHEEL
+Filename: odoo14_addon_base_url-14.0.1.0.2.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/top_level.txt
+Filename: odoo14_addon_base_url-14.0.1.0.2.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/RECORD
+Filename: odoo14_addon_base_url-14.0.1.0.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/base_url/__manifest__.py

```diff
@@ -1,15 +1,15 @@
 #    Rewrite url Base module for OpenERP
 #    Copyright (C) 2013 Akretion (http://www.akretion.com)
 #    @author EBII MonsieurB <monsieurb@saaslys.com>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "Base Url",
-    "version": "14.0.1.0.0",
+    "version": "14.0.1.0.2",
     "category": "tools",
     "license": "AGPL-3",
     "summary": "keep history of url for products & categories  ",
     "author": "Akretion, ACSONE SA/NV",
     "website": "https://github.com/shopinvader/odoo-shopinvader",
     # any module necessary for this one to work correctly
     "depends": ["base"],
```

## odoo/addons/base_url/i18n/base_url.pot

```diff
@@ -72,19 +72,14 @@
 
 #. module: base_url
 #: model:ir.model.fields,help:base_url.field_url_url__redirect
 msgid "If tick this url is a redirection to the new url"
 msgstr ""
 
 #. module: base_url
-#: model:ir.model.fields,field_description:base_url.field_abstract_url__is_urls_sync_required
-msgid "Is Urls Sync Required"
-msgstr ""
-
-#. module: base_url
 #: model:ir.model.fields,field_description:base_url.field_abstract_url__lang_id
 #: model:ir.model.fields,field_description:base_url.field_url_url__lang_id
 msgid "Lang"
 msgstr ""
 
 #. module: base_url
 #: model:ir.model.fields,field_description:base_url.field_abstract_url____last_update
```

## odoo/addons/base_url/models/abstract_url.py

```diff
@@ -33,17 +33,14 @@
     url_url_ids = fields.One2many(
         compute="_compute_url_url_ids", comodel_name="url.url"
     )
     redirect_url_url_ids = fields.One2many(
         compute="_compute_redirect_url_url_ids", comodel_name="url.url"
     )
     lang_id = fields.Many2one("res.lang", string="Lang", required=True)
-    is_urls_sync_required = fields.Boolean(
-        compute="_compute_is_urls_sync_required", store=True
-    )
     active = fields.Boolean(string="Active", default=True)
 
     @api.constrains("url_builder", "manual_url_key")
     def _check_manual_url_key(self):
         for rec in self:
             if rec.url_builder == "manual" and not rec.manual_url_key:
                 raise ValidationError(
@@ -60,19 +57,14 @@
                 return {
                     "warning": {
                         "title": "Adapt text rules",
                         "message": "it will be adapted to %s" % url,
                     }
                 }
 
-    @api.depends("url_key")
-    def _compute_is_urls_sync_required(self):
-        for record in self:
-            record.is_urls_sync_required = True
-
     def _get_url_keywords(self):
         """This method return a list of keyword that will be concatenated
         with '-' to generate the url
         Ex: if you return ['foo', '42'] the url will be foo-42
 
         Note the self already include in the context the lang of the record
         """
@@ -120,31 +112,38 @@
         )
 
     @api.depends("manual_url_key", "automatic_url_key", "url_builder", "active")
     def _compute_url_key(self):
         for record in self:
             if not record.active:
                 record.url_key = ""
+                record._redirect_existing_url()
             else:
                 if record.url_builder == "manual":
                     new_url = record.manual_url_key
                 else:
                     new_url = record.automatic_url_key
-                record.url_key = new_url
+                if record.url_key != new_url:
+                    record.url_key = new_url
+                    record.set_url(record.url_key)
 
+    @api.depends("url_key")
     def _compute_redirect_url_url_ids(self):
+        self.flush()
         for record in self:
             record.redirect_url_url_ids = record.env["url.url"].search(
                 [
                     ("model_id", "=", get_model_ref(record)),
                     ("redirect", "=", True),
                 ]
             )
 
+    @api.depends("url_key")
     def _compute_url_url_ids(self):
+        self.flush()
         for record in self:
             record.url_url_ids = record.env["url.url"].search(
                 [("model_id", "=", get_model_ref(record))]
             )
 
     @api.model
     def _prepare_url(self, url_key):
@@ -216,44 +215,14 @@
     def _redirect_existing_url(self):
         """
         This method is called when the record is deactivated to give a chance
         to the concrete model to implement a redirect strategy
         """
         return True
 
-    def _sync_urls(self):
-        """
-        This method is in charge of syncing the url.url object related to
-        the current model
-        """
-        records = self.filtered("is_urls_sync_required")
-        for record in records:
-            if not record.active:
-                record._redirect_existing_url()
-            else:
-                record.set_url(record.url_key)
-        return records
-
-    @api.model
-    def create(self, value):
-        res = super(AbstractUrl, self).create(value)
-        # without this flush we have cases where the url_key is not stored
-        self.flush()
-        synced = res._sync_urls()
-        super(AbstractUrl, synced).write({"is_urls_sync_required": False})
-        return res
-
-    def write(self, value):
-        res = super(AbstractUrl, self).write(value)
-        # without this flush we have cases where the url_key is not stored
-        self.flush()
-        synced = self._sync_urls()
-        super(AbstractUrl, synced).write({"is_urls_sync_required": False})
-        return res
-
     def unlink(self):
         for record in self:
             # TODO we should propose to redirect the old url
             urls = record.env["url.url"].search(
                 [("model_id", "=", get_model_ref(record))]
             )
             urls.unlink()
```

## odoo/addons/base_url/models/url_url.py

```diff
@@ -19,14 +19,15 @@
     url_key = fields.Char(required=True)
     model_id = fields.Reference(
         selection="_selection_target_model",
         help="The id of content linked to the url.",
         readonly=True,
         string="Model",
         required=True,
+        index=True,
     )
     redirect = fields.Boolean(help="If tick this url is a redirection to the new url")
     backend_id = fields.Reference(
         selection="_selection_target_model",
         compute="_compute_related_fields",
         store=True,
         help="Backend linked to this URL",
```

## odoo/addons/base_url/tests/test_abstract_url.py

```diff
@@ -39,15 +39,14 @@
             "backend_id": self.url_backend.id,
         }
 
     def _create_auto(self):
         return self.ResPartnerAddressable.create(self._get_default_partner_value())
 
     def _check_url_key(self, partner_addressable, key_name):
-        self.assertFalse(partner_addressable.is_urls_sync_required)
         self.assertEqual(partner_addressable.url_key, key_name)
         self.assertEqual(len(partner_addressable.url_url_ids), 1)
         url_url = partner_addressable.url_url_ids
         self.assertEqual(url_url.url_key, key_name)
         self.assertEqual(url_url.lang_id, self.lang)
         self.assertEqual(url_url.model_id, partner_addressable)
 
@@ -82,33 +81,43 @@
 
     def test_write_url_builder(self):
         # tests that a new url is created we update the url builder
         my_partner = self._create_auto()
         self._check_url_key(my_partner, "partner-name")
         manual_url_key = "manual-url key"
         my_partner.write({"url_builder": "manual", "manual_url_key": manual_url_key})
-        my_partner.refresh()
         url_keys = set(my_partner.mapped("url_url_ids.url_key"))
         self.assertSetEqual(url_keys, {manual_url_key, self.auto_key})
         # if we reset the auto key, no new url.url should be created
         my_partner.write({"url_builder": "auto"})
-        my_partner.refresh()
         self.assertEqual(2, len(my_partner.url_url_ids))
         url_keys = set(my_partner.mapped("url_url_ids.url_key"))
         self.assertSetEqual(url_keys, {manual_url_key, self.auto_key})
 
     def test_write_launching_automatic_url_key(self):
         my_partner = self._create_auto()
+        # call flush to force to apply the recompute
+        my_partner.flush()
         my_partner.name = "my new name"
-        my_partner.refresh()
+        self.assertEqual(2, len(my_partner.url_url_ids))
+        url_keys = set(my_partner.mapped("url_url_ids.url_key"))
+        self.assertSetEqual(url_keys, {"my-new-name", self.auto_key})
+
+    def test_write_on_related_record_launching_automatic_url_key(self):
+        my_partner = self._create_auto()
+        # call flush to force to apply the recompute
+        my_partner.flush()
+        my_partner.record_id.name = "my new name"
         self.assertEqual(2, len(my_partner.url_url_ids))
         url_keys = set(my_partner.mapped("url_url_ids.url_key"))
         self.assertSetEqual(url_keys, {"my-new-name", self.auto_key})
 
     def test_write_inactive(self):
         my_partner = self._create_auto()
         # when we deactivate a record, the redirect method should be called
         with mock.patch.object(
             self.ResPartnerAddressable.__class__, "_redirect_existing_url"
         ) as mocked_redirect:
             my_partner.active = False
+            # call flush to force to apply the recompute
+            my_partner.flush()
             mocked_redirect.assert_called_once()
```

## Comparing `odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/METADATA` & `odoo14_addon_base_url-14.0.1.0.2.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,17 +1,18 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-base-url
-Version: 14.0.1.0.1.dev1
+Version: 14.0.1.0.2
 Summary: keep history of url for products & categories
 Home-page: https://github.com/shopinvader/odoo-shopinvader
 Author: Akretion, ACSONE SA/NV
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
+Classifier: Framework :: Odoo :: 14.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
 Requires-Python: >=3.6
 Requires-Dist: odoo (<14.1dev,>=14.0a)
 Requires-Dist: python-slugify
 
 .. image:: https://img.shields.io/badge/licence-AGPL--3-blue.svg
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
```

## Comparing `odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/RECORD` & `odoo14_addon_base_url-14.0.1.0.2.dist-info/RECORD`

 * *Files 19% similar despite different names*

```diff
@@ -1,17 +1,17 @@
 odoo/addons/base_url/README.rst,sha256=f6zWfqvEHExTh6w058T2fXNWTPXnbriJTQmDceimz-4,781
 odoo/addons/base_url/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/base_url/__manifest__.py,sha256=1PSbcvfJ6kvjJZkKAVbPaxeYZufTGWuSRA7exDYgPGQ,748
-odoo/addons/base_url/i18n/base_url.pot,sha256=logmInQF85ASUoXESmZEtkfT2CXeboJReYKpkVmq8Ec,5075
+odoo/addons/base_url/__manifest__.py,sha256=MhFSqH0KrPZDh9e2v3ToNalkqKbBfgB0nd2bIn8fUpE,748
+odoo/addons/base_url/i18n/base_url.pot,sha256=tuzTYAFFSoMRRwc7oHlbBdWTgWmrCIBGHYZ-WISaZx8,4920
 odoo/addons/base_url/models/__init__.py,sha256=D8dit_0UbhHMY8esDYpeNZJIHPZ9tDIYvvTqT9ZbSNo,49
-odoo/addons/base_url/models/abstract_url.py,sha256=cPHYhuZdaEmslF3_ev9t7F4u8-vJl532RnK9RV-d-vY,9310
-odoo/addons/base_url/models/url_url.py,sha256=eIDdVO4G2kJiX5ONd_d7Zx1jwwA34V94FROqm43JC1k,1870
+odoo/addons/base_url/models/abstract_url.py,sha256=_MtDM6llkcMIe3gWp5HBktQC5bT543tfUIBGbp44oPM,8258
+odoo/addons/base_url/models/url_url.py,sha256=vSOuxQBi0hQ4DDDMXT2lbL8pG2XQklVkFIfkeExkLRE,1890
 odoo/addons/base_url/security/ir.model.access.csv,sha256=c7FnskAJ052LYbvRp25unMKRuKpH1huHFnqAyq5xMAg,130
 odoo/addons/base_url/tests/__init__.py,sha256=Xs9lDcvoneTauSYWQYjdCAlmQ3B950Avz3lLS_wFzFE,32
 odoo/addons/base_url/tests/models.py,sha256=TefVGh7vfAjJDA0OvdTUYGVREamKpNE2QcbU5u_pCDk,943
 odoo/addons/base_url/tests/models_mixin.py,sha256=fLVuopXB16d45HDrvc-fj6bw4h2eSx_GzmyfaJRFCEY,3862
-odoo/addons/base_url/tests/test_abstract_url.py,sha256=kHGiHjJqXc8SFDtwah1fYcuEYg85fgsNHNMS01PSOio,4742
+odoo/addons/base_url/tests/test_abstract_url.py,sha256=B9TdyBsZHtXzeQZe6xIG_Ej_tV4WMbsdcp8xl34DNcE,5191
 odoo/addons/base_url/views/url_view.xml,sha256=dqRwjGZU8w9BSZG7AJhMADom-SE7AIr6Gwep8gosGdQ,1400
-odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/METADATA,sha256=6iv0SlJu7KF9ep3UbZXWdZlXVXOcgTmSj5PTW0uLGw4,1279
-odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
-odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_base_url-14.0.1.0.1.dev1.dist-info/RECORD,,
+odoo14_addon_base_url-14.0.1.0.2.dist-info/METADATA,sha256=6h7SO5mSf7HbernHvp1uXNEMIsYmkI_wkvETmTc5KyY,1312
+odoo14_addon_base_url-14.0.1.0.2.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
+odoo14_addon_base_url-14.0.1.0.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_base_url-14.0.1.0.2.dist-info/RECORD,,
```

