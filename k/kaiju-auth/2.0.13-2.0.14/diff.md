# Comparing `tmp/kaiju_auth-2.0.13-py3-none-any.whl.zip` & `tmp/kaiju_auth-2.0.14-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,21 +1,21 @@
-Zip file size: 23482 bytes, number of entries: 19
--rw-r--r--  2.0 unx       84 b- defN 23-Apr-18 12:43 kaiju_auth/__init__.py
--rw-r--r--  2.0 unx       77 b- defN 23-Apr-18 12:43 kaiju_auth/etc.py
--rw-r--r--  2.0 unx     3765 b- defN 23-Apr-18 12:43 kaiju_auth/fixtures.py
--rw-r--r--  2.0 unx     5848 b- defN 23-Apr-18 12:43 kaiju_auth/http.py
--rw-r--r--  2.0 unx     7627 b- defN 23-Apr-18 12:43 kaiju_auth/login.py
--rw-r--r--  2.0 unx      320 b- defN 23-Apr-18 12:43 kaiju_auth/services.py
--rw-r--r--  2.0 unx     1811 b- defN 23-Apr-18 12:43 kaiju_auth/sessions.py
--rw-r--r--  2.0 unx     2892 b- defN 23-Apr-18 12:43 kaiju_auth/tables.py
--rw-r--r--  2.0 unx    11513 b- defN 23-Apr-18 12:43 kaiju_auth/tokens.py
--rw-r--r--  2.0 unx    27693 b- defN 23-Apr-18 12:43 kaiju_auth/users.py
--rw-r--r--  2.0 unx       55 b- defN 23-Apr-18 12:43 kaiju_auth/permissions_gui/__init__.py
--rw-r--r--  2.0 unx     3051 b- defN 23-Apr-18 12:43 kaiju_auth/permissions_gui/models.py
--rw-r--r--  2.0 unx    17380 b- defN 23-Apr-18 12:43 kaiju_auth/permissions_gui/service.py
--rw-r--r--  2.0 unx     1151 b- defN 23-Apr-18 12:43 kaiju_auth/permissions_gui/validators.py
--rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-18 12:44 kaiju_auth-2.0.13.dist-info/LICENSE
--rw-r--r--  2.0 unx     2900 b- defN 23-Apr-18 12:44 kaiju_auth-2.0.13.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-18 12:44 kaiju_auth-2.0.13.dist-info/WHEEL
--rw-r--r--  2.0 unx       11 b- defN 23-Apr-18 12:44 kaiju_auth-2.0.13.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1551 b- defN 23-Apr-18 12:44 kaiju_auth-2.0.13.dist-info/RECORD
-19 files, 88431 bytes uncompressed, 20954 bytes compressed:  76.3%
+Zip file size: 23479 bytes, number of entries: 19
+-rw-r--r--  2.0 unx       84 b- defN 23-Apr-18 15:23 kaiju_auth/__init__.py
+-rw-r--r--  2.0 unx       60 b- defN 23-Apr-18 15:23 kaiju_auth/etc.py
+-rw-r--r--  2.0 unx     3765 b- defN 23-Apr-18 15:23 kaiju_auth/fixtures.py
+-rw-r--r--  2.0 unx     5848 b- defN 23-Apr-18 15:23 kaiju_auth/http.py
+-rw-r--r--  2.0 unx     7646 b- defN 23-Apr-18 15:23 kaiju_auth/login.py
+-rw-r--r--  2.0 unx      320 b- defN 23-Apr-18 15:23 kaiju_auth/services.py
+-rw-r--r--  2.0 unx     1811 b- defN 23-Apr-18 15:23 kaiju_auth/sessions.py
+-rw-r--r--  2.0 unx     2892 b- defN 23-Apr-18 15:23 kaiju_auth/tables.py
+-rw-r--r--  2.0 unx    11541 b- defN 23-Apr-18 15:23 kaiju_auth/tokens.py
+-rw-r--r--  2.0 unx    27759 b- defN 23-Apr-18 15:23 kaiju_auth/users.py
+-rw-r--r--  2.0 unx       55 b- defN 23-Apr-18 15:23 kaiju_auth/permissions_gui/__init__.py
+-rw-r--r--  2.0 unx     3051 b- defN 23-Apr-18 15:23 kaiju_auth/permissions_gui/models.py
+-rw-r--r--  2.0 unx    17380 b- defN 23-Apr-18 15:23 kaiju_auth/permissions_gui/service.py
+-rw-r--r--  2.0 unx     1151 b- defN 23-Apr-18 15:23 kaiju_auth/permissions_gui/validators.py
+-rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-18 15:23 kaiju_auth-2.0.14.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2900 b- defN 23-Apr-18 15:23 kaiju_auth-2.0.14.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-18 15:23 kaiju_auth-2.0.14.dist-info/WHEEL
+-rw-r--r--  2.0 unx       11 b- defN 23-Apr-18 15:23 kaiju_auth-2.0.14.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1551 b- defN 23-Apr-18 15:23 kaiju_auth-2.0.14.dist-info/RECORD
+19 files, 88527 bytes uncompressed, 20951 bytes compressed:  76.3%
```

## zipnote {}

```diff
@@ -36,23 +36,23 @@
 
 Filename: kaiju_auth/permissions_gui/service.py
 Comment: 
 
 Filename: kaiju_auth/permissions_gui/validators.py
 Comment: 
 
-Filename: kaiju_auth-2.0.13.dist-info/LICENSE
+Filename: kaiju_auth-2.0.14.dist-info/LICENSE
 Comment: 
 
-Filename: kaiju_auth-2.0.13.dist-info/METADATA
+Filename: kaiju_auth-2.0.14.dist-info/METADATA
 Comment: 
 
-Filename: kaiju_auth-2.0.13.dist-info/WHEEL
+Filename: kaiju_auth-2.0.14.dist-info/WHEEL
 Comment: 
 
-Filename: kaiju_auth-2.0.13.dist-info/top_level.txt
+Filename: kaiju_auth-2.0.14.dist-info/top_level.txt
 Comment: 
 
-Filename: kaiju_auth-2.0.13.dist-info/RECORD
+Filename: kaiju_auth-2.0.14.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kaiju_auth/__init__.py

```diff
@@ -1,4 +1,4 @@
 from .services import *
 
-__version__ = '2.0.13'
+__version__ = '2.0.14'
 __author__ = 'antonnidhoggr@me.com'
```

## kaiju_auth/etc.py

```diff
@@ -1,7 +1,4 @@
-import pathlib
-
-
 __all__ = ['WEAK_PASSWORDS']
 
 
 WEAK_PASSWORDS = frozenset()
```

## kaiju_auth/login.py

```diff
@@ -103,15 +103,15 @@
 
         :raises AuthenticationFailed:
         """
         username, password = self._parse_auth_str(auth_string)
         user = await self._users.auth(username=username, password=password, columns=None)
         session = self._sessions.get_new_session({})
         self._update_session(session, user, AuthType.BASIC)
-        self.logger.info('Login completed: %s / user_id=%s', AuthType.BASIC.value, user['id'])
+        self.logger.info('login completed', auth_type=AuthType.BASIC.value, user_id=user['id'])
         return session
 
     @staticmethod
     def _parse_auth_str(auth_str: str) -> Tuple[str, str]:
         """Parse basic auth string (both b64 and not b64 encoded)."""
         if ':' not in auth_str:
             try:
@@ -135,30 +135,30 @@
         if session and session.user_id:
             await self.logout()
         user = await self._users.auth(username=username, password=password, columns=None)
         new_session = self._sessions.get_new_session({}, user_agent=session.h_agent if session else '')
         self._update_session(new_session, user, AuthType.PASSWORD)
         ctx['session_id'] = new_session.id
         REQUEST_SESSION.set(new_session)
-        self.logger.info('Login completed: %s / user_id=%s', AuthType.PASSWORD.value, user['id'])
+        self.logger.info('login completed', auth_type=AuthType.PASSWORD.value, user_id=user['id'])
         return new_session
 
     async def get_token(self, username: str, password: str) -> TokenInfo:
         """Authenticate and get a new token pair."""
         if not self._tokens or not self.enable_token_auth:
             raise MethodNotAllowed('Token auth is disabled.')
         user = await self._users.auth(username=username, password=password, columns=None)
         session = self._sessions.get_new_session({})
         self._update_session(session, user, AuthType.TOKEN)
         access, refresh = await self._tokens.generate_token_pair(
             data={'permissions': session.permissions, 'id': session.user_id}
         )
         return TokenInfo(access=access.serialize(), refresh=refresh.serialize())
 
-    async def refresh_token(self, access: str, refresh: str) -> TokenInfo:
+    async def refresh_token(self, access: str, refresh: str) -> TokenInfo:  # noqa
         """Refresh token pair."""
         if not self._tokens or not self.enable_token_auth:
             raise MethodNotAllowed('Token auth is disabled.')
         access, refresh = await self._tokens.refresh_token(refresh)
         return TokenInfo(access=access.serialize(), refresh=refresh.serialize())
 
     async def logout(self) -> None:
@@ -166,31 +166,32 @@
         if not ctx:
             raise NotImplementedError('Not implemented for non-context calls.')
         session = self.get_session()
         if session:
             session = cast(Session, session)
             if session.loaded:
                 await self._sessions.delete_session(session)
-            self.logger.info('Logged out: user_id=%s', session.user_id)
+            self.logger.info('logged out', user_id=session.user_id)
             new_session = self._sessions.get_new_session({}, user_agent=session.h_agent)
             ctx['session_id'] = new_session.id
             REQUEST_SESSION.set(new_session)
 
     async def token_auth(self, token: str) -> Session:
         """Try token auth (JWT or similar).
 
         :raises AuthenticationFailed:
         """
         token = await self._tokens.verify_token(token)
         user: UserType = token.claims_data['data']
         session = self._sessions.get_new_session({})
         self._update_session(session, user, AuthType.TOKEN)
-        self.logger.info('Login completed: %s / user_id=%s', AuthType.TOKEN.value, user['id'])
+        self.logger.info('login completed', auth_type=AuthType.TOKEN.value, user_id=user['id'])
         return session
 
-    def _update_session(self, session: Session, user: UserType, auth_type: AuthType) -> None:
+    @staticmethod
+    def _update_session(session: Session, user: UserType, auth_type: AuthType) -> None:
         """Store user data in a provided session."""
         if session and user:
             session.user_id = user['id']
             session.permissions = user['permissions']
             session._changed = True
             session._stored = auth_type == AuthType.PASSWORD
```

## kaiju_auth/tokens.py

```diff
@@ -1,15 +1,15 @@
 from __future__ import annotations
 
 import asyncio
 import time
 import uuid
 from typing import Union, Optional
 
-from jwcrypto import jwk, jwt
+from jwcrypto import jwk, jwt  # noqa ?
 
 from kaiju_tools.cache import BaseCacheService
 from kaiju_tools.exceptions import NotAuthorized
 from kaiju_tools.serialization import dumps, loads
 from kaiju_tools.services import ContextableService
 
 __all__ = ['KeystoreService', 'JWTService', 'JWT']
@@ -129,15 +129,15 @@
         self._encryption_key_ttl = max(self.MIN_KEY_TTL, int(encryption_key_ttl))
         self._kid = None
         self._key = None
         self._pkey = None
         self._pkey_data = None
         self._deadline = None
         self._cache_service_name = cache_service
-        self._cache: BaseCacheService = None
+        self._cache: Optional[BaseCacheService] = None
         self._closed = True
         self._task = None
         self._daemon_sleep_interval = 60
 
     async def init(self):
         self._cache = self._cache = self.discover_service(self._cache_service_name, cls=self.cache_service_class)
         await self._generate_encryption_key()
@@ -182,15 +182,15 @@
         try:
             pkey = await self._cache.get(cache_kid)
             if pkey:
                 pkey = loads(pkey)
                 pkey = jwk.JWK(**pkey)
                 return pkey
         except Exception as exc:
-            self.logger.error('Cache service is not available: %s.', exc)
+            self.logger.error('Cache service is not available', exc_info=exc)
 
     async def _generate_encryption_key(self):
         """Generate and set a new key pair and key deadline and push the public key to the shared store (cache)."""
         if self.key_present:
             return
         kid = str(uuid.uuid4())
         key = jwk.JWK.generate(kty=self.ENC_ALGORITHM, size=self.ENC_KEY_SIZE)
@@ -202,15 +202,15 @@
         await self._update_key()
 
     async def _update_key(self):
         cache_kid = self.cache_key_format.format(kid=self._kid)
         try:
             await self._cache.set(cache_kid, self._pkey_data, ttl=self._encryption_key_ttl)
         except Exception as exc:
-            self.logger.error('Cache service is not available: %s.', exc)
+            self.logger.error('Cache service is not available', exc_info=exc)
         self._deadline = time.time() + self._encryption_key_ttl
 
     async def _loop(self):
         while not self._closed:
             await asyncio.sleep(self._daemon_sleep_interval)
             if self.deadline - time.time() < 300:
                 await self._update_key()
```

## kaiju_auth/users.py

```diff
@@ -521,15 +521,15 @@
             _permissions = set().union(*(_group['permissions'] for _group in _permissions))
             _permissions = frozenset(_permissions)
         else:
             _permissions = frozenset()
 
         return {'id': id, 'permissions': _permissions}
 
-    async def register(self, username: str, email: str, password: str, columns='*', **settings):
+    async def register(self, username: str, email: str, password: str, columns='*', settings: dict = None):
         """Add a new user. Used by administrators or user managers."""
         self.validate_username(username)
         self.validate_email(email)
         password = self.validate_password(password)
 
         sql = self.table.select().where(sa.or_(self.table.c.username == username, self.table.c.email == email))
 
@@ -537,14 +537,16 @@
 
         if data is not None:
             raise Conflict(
                 'User or e-mail address is already registered.', key=username, code=self.ErrorCodes.USER_EXISTS
             )
 
         salt, password = self._hash_password(username, password)
+        if settings is None:
+            settings = {}
         settings['username'] = username
         settings['email'] = email
         settings['password'] = password
         settings['salt'] = salt
         settings['id'] = uuid.uuid4()
         sql = self.table.insert().values(settings)
         await self._db.execute(sql)
```

## Comparing `kaiju_auth-2.0.13.dist-info/LICENSE` & `kaiju_auth-2.0.14.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kaiju_auth-2.0.13.dist-info/METADATA` & `kaiju_auth-2.0.14.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kaiju-auth
-Version: 2.0.13
+Version: 2.0.14
 Summary: Authentication services.
 Home-page: https://gitlab.com/kaiju-python/kaiju-auth
 Author: antonnidhoggr@me.com
 Author-email: antonnidhoggr@me.com
 License: Apache Software License 2.0
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: Apache Software License
```

## Comparing `kaiju_auth-2.0.13.dist-info/RECORD` & `kaiju_auth-2.0.14.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -1,19 +1,19 @@
-kaiju_auth/__init__.py,sha256=NFk09bEI8eG_yKJsQpVNcvBHBWsZ1UmkDCgMAzwgtCY,84
-kaiju_auth/etc.py,sha256=d-9zBsa4xfW3Np9C1KzJiOUMo6lW_hGaGBb3adi33MI,77
+kaiju_auth/__init__.py,sha256=1GFbc4R28rvIXNaczIha8H_w2A82FArK8XiHCOlKWkA,84
+kaiju_auth/etc.py,sha256=8tXWzg4xXs8L0vth8Ymd77Q8fdzXgaxxSOKT15QP8w0,60
 kaiju_auth/fixtures.py,sha256=TMjpAIkY1sKNXLYEDvJnDdjvZ3njVed9Jt5BdLcEkB4,3765
 kaiju_auth/http.py,sha256=TwlOoRR_XoBTLftDJh-k10UQtnathsNueuDY_-IDOIE,5848
-kaiju_auth/login.py,sha256=ovX3exjL_X3qDAjuAPymsykt40TPDCCZJrGjRdlco84,7627
+kaiju_auth/login.py,sha256=586kkKBF0wgozmoDK-a-xFmB1T6hiH3Xx2gviZ92Z4Y,7646
 kaiju_auth/services.py,sha256=RP60nokV5seeBJ4y5PdwfIvenv3luwm1qx-azxZUldA,320
 kaiju_auth/sessions.py,sha256=mU7REiotvYgGy_9V26Np5hx50kDedEYNIs5GfNa4K7A,1811
 kaiju_auth/tables.py,sha256=mmvxRS-VJLvEjVFSnpBuCJra-lCow8RovLy0tYrKee0,2892
-kaiju_auth/tokens.py,sha256=cslBnKm2OAoPCRvXaiwK0xuYJlwKipHYpAW0KTNen20,11513
-kaiju_auth/users.py,sha256=mVDXqrT5pDxh2y68eaTKi4VQ5GskBV38xl6OEHvzPz4,27693
+kaiju_auth/tokens.py,sha256=eSj5sE-lFZDFzjF1DGwhMHHF6VhlDxeSSjroNEsutC8,11541
+kaiju_auth/users.py,sha256=wWKN3KOZ8dlrVPEcAuUHhwjY9RxTy00h-A6najBgbKg,27759
 kaiju_auth/permissions_gui/__init__.py,sha256=8Bxbwkjqk5QjDlZyXQ7R8dWLajhggp8of-yeZPz_pN0,55
 kaiju_auth/permissions_gui/models.py,sha256=gaUtybeEmDwbFjRTm8fnlq2MqG4ZIoSFK-aiICIp7i8,3051
 kaiju_auth/permissions_gui/service.py,sha256=iRGcpW-JERQF_8ehec6yqy12SSmq0Fr9Uk0LcNeiChY,17380
 kaiju_auth/permissions_gui/validators.py,sha256=bywyt8DXP3nnEU9d9JGxLOXdI5xl2qlbzz4SU3MoaTo,1151
-kaiju_auth-2.0.13.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
-kaiju_auth-2.0.13.dist-info/METADATA,sha256=nS_2M8LJgNzdnwNBJkhGmQ5YUF8DI_tr3SzA_QOY4zA,2900
-kaiju_auth-2.0.13.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-kaiju_auth-2.0.13.dist-info/top_level.txt,sha256=5F9g7EZLuzcI4ioeLmgI2Pp_r2yuzykkUc5L7lcUl2I,11
-kaiju_auth-2.0.13.dist-info/RECORD,,
+kaiju_auth-2.0.14.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
+kaiju_auth-2.0.14.dist-info/METADATA,sha256=ixybGQlH-4B5r_FLHUej1jnMF7V8UVsaTQs6YSsfxmk,2900
+kaiju_auth-2.0.14.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+kaiju_auth-2.0.14.dist-info/top_level.txt,sha256=5F9g7EZLuzcI4ioeLmgI2Pp_r2yuzykkUc5L7lcUl2I,11
+kaiju_auth-2.0.14.dist-info/RECORD,,
```

