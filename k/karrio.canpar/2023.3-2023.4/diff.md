# Comparing `tmp/karrio.canpar-2023.3-py3-none-any.whl.zip` & `tmp/karrio.canpar-2023.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,25 @@
-Zip file size: 17819 bytes, number of entries: 23
+Zip file size: 17808 bytes, number of entries: 23
 -rw-rw-r--  2.0 unx      348 b- defN 22-Nov-15 19:21 karrio/mappers/canpar/__init__.py
--rw-rw-r--  2.0 unx     4052 b- defN 22-Nov-15 19:21 karrio/mappers/canpar/mapper.py
--rw-rw-r--  2.0 unx     4486 b- defN 22-Nov-15 19:21 karrio/mappers/canpar/proxy.py
--rw-rw-r--  2.0 unx      410 b- defN 22-Nov-15 19:21 karrio/mappers/canpar/settings.py
+-rw-rw-r--  2.0 unx     3875 b- defN 23-Apr-01 13:34 karrio/mappers/canpar/mapper.py
+-rw-rw-r--  2.0 unx     4327 b- defN 23-Apr-01 13:41 karrio/mappers/canpar/proxy.py
+-rw-rw-r--  2.0 unx      432 b- defN 23-Apr-15 06:44 karrio/mappers/canpar/settings.py
 -rw-rw-r--  2.0 unx      725 b- defN 22-Nov-15 19:21 karrio/providers/canpar/__init__.py
--rw-rw-r--  2.0 unx     2583 b- defN 23-Mar-25 14:23 karrio/providers/canpar/address.py
--rw-rw-r--  2.0 unx      662 b- defN 22-Nov-15 19:21 karrio/providers/canpar/error.py
--rw-rw-r--  2.0 unx     7046 b- defN 23-Mar-25 14:23 karrio/providers/canpar/rate.py
--rw-rw-r--  2.0 unx     3320 b- defN 23-Mar-23 19:14 karrio/providers/canpar/tracking.py
+-rw-rw-r--  2.0 unx     2566 b- defN 23-Apr-01 15:38 karrio/providers/canpar/address.py
+-rw-rw-r--  2.0 unx      605 b- defN 23-Apr-01 15:37 karrio/providers/canpar/error.py
+-rw-rw-r--  2.0 unx     7234 b- defN 23-Apr-01 15:18 karrio/providers/canpar/rate.py
+-rw-rw-r--  2.0 unx     3324 b- defN 23-Apr-01 15:18 karrio/providers/canpar/tracking.py
 -rw-rw-r--  2.0 unx     2699 b- defN 23-Jan-11 18:22 karrio/providers/canpar/units.py
--rw-rw-r--  2.0 unx     1744 b- defN 23-Mar-25 12:53 karrio/providers/canpar/utils.py
+-rw-rw-r--  2.0 unx     1744 b- defN 23-Apr-15 02:55 karrio/providers/canpar/utils.py
 -rw-rw-r--  2.0 unx      292 b- defN 22-Nov-15 19:21 karrio/providers/canpar/pickup/__init__.py
--rw-rw-r--  2.0 unx     1373 b- defN 22-Nov-15 19:21 karrio/providers/canpar/pickup/cancel.py
--rw-rw-r--  2.0 unx     3376 b- defN 23-Mar-25 15:27 karrio/providers/canpar/pickup/create.py
--rw-rw-r--  2.0 unx     1892 b- defN 22-Nov-15 19:21 karrio/providers/canpar/pickup/update.py
+-rw-rw-r--  2.0 unx     1442 b- defN 23-Apr-01 15:18 karrio/providers/canpar/pickup/cancel.py
+-rw-rw-r--  2.0 unx     3450 b- defN 23-Apr-01 15:18 karrio/providers/canpar/pickup/create.py
+-rw-rw-r--  2.0 unx     1849 b- defN 23-Apr-01 13:35 karrio/providers/canpar/pickup/update.py
 -rw-rw-r--  2.0 unx      202 b- defN 22-Nov-15 19:21 karrio/providers/canpar/shipment/__init__.py
--rw-rw-r--  2.0 unx     1390 b- defN 22-Nov-15 19:21 karrio/providers/canpar/shipment/cancel.py
--rw-rw-r--  2.0 unx     7692 b- defN 23-Mar-25 14:27 karrio/providers/canpar/shipment/create.py
--rw-rw-r--  2.0 unx      809 b- defN 22-Nov-15 19:21 karrio/providers/canpar/shipment/label.py
--rw-rw-r--  2.0 unx      980 b- defN 23-Mar-27 07:12 karrio.canpar-2023.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Mar-27 07:12 karrio.canpar-2023.3.dist-info/WHEEL
--rw-rw-r--  2.0 unx        7 b- defN 23-Mar-27 07:12 karrio.canpar-2023.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2089 b- defN 23-Mar-27 07:12 karrio.canpar-2023.3.dist-info/RECORD
-23 files, 48269 bytes uncompressed, 14359 bytes compressed:  70.3%
+-rw-rw-r--  2.0 unx     1450 b- defN 23-Apr-01 15:18 karrio/providers/canpar/shipment/cancel.py
+-rw-rw-r--  2.0 unx     7880 b- defN 23-Apr-01 15:18 karrio/providers/canpar/shipment/create.py
+-rw-rw-r--  2.0 unx      792 b- defN 23-Apr-01 13:36 karrio/providers/canpar/shipment/label.py
+-rw-rw-r--  2.0 unx      980 b- defN 23-Apr-18 07:09 karrio.canpar-2023.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-Apr-18 07:09 karrio.canpar-2023.4.dist-info/WHEEL
+-rw-rw-r--  2.0 unx        7 b- defN 23-Apr-18 07:09 karrio.canpar-2023.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2089 b- defN 23-Apr-18 07:09 karrio.canpar-2023.4.dist-info/RECORD
+23 files, 48404 bytes uncompressed, 14348 bytes compressed:  70.4%
```

## zipnote {}

```diff
@@ -51,20 +51,20 @@
 
 Filename: karrio/providers/canpar/shipment/create.py
 Comment: 
 
 Filename: karrio/providers/canpar/shipment/label.py
 Comment: 
 
-Filename: karrio.canpar-2023.3.dist-info/METADATA
+Filename: karrio.canpar-2023.4.dist-info/METADATA
 Comment: 
 
-Filename: karrio.canpar-2023.3.dist-info/WHEEL
+Filename: karrio.canpar-2023.4.dist-info/WHEEL
 Comment: 
 
-Filename: karrio.canpar-2023.3.dist-info/top_level.txt
+Filename: karrio.canpar-2023.4.dist-info/top_level.txt
 Comment: 
 
-Filename: karrio.canpar-2023.3.dist-info/RECORD
+Filename: karrio.canpar-2023.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## karrio/mappers/canpar/mapper.py

```diff
@@ -6,15 +6,14 @@
     ShipmentCancelRequest,
     PickupUpdateRequest,
     PickupCancelRequest,
     ShipmentRequest,
     TrackingRequest,
     PickupRequest,
     RateRequest,
-
     AddressValidationDetails,
     ConfirmationDetails,
     TrackingDetails,
     ShipmentDetails,
     PickupDetails,
     RateDetails,
     Message,
@@ -23,15 +22,14 @@
     parse_shipment_cancel_response,
     parse_pickup_update_response,
     parse_pickup_cancel_response,
     parse_shipment_response,
     parse_tracking_response,
     parse_pickup_response,
     parse_rate_response,
-
     parse_address_validation_response,
     address_validation_request,
     shipment_cancel_request,
     pickup_update_request,
     pickup_cancel_request,
     tracking_request,
     shipment_request,
@@ -40,82 +38,78 @@
 )
 from karrio.mappers.canpar.settings import Settings
 
 
 class Mapper(BaseMapper):
     settings: Settings
 
-    def create_address_validation_request(self, payload: AddressValidationRequest) -> Serializable:
+    def create_address_validation_request(
+        self, payload: AddressValidationRequest
+    ) -> Serializable:
         return address_validation_request(payload, self.settings)
 
-    def create_rate_request(
-        self, payload: RateRequest
-    ) -> Serializable:
+    def create_rate_request(self, payload: RateRequest) -> Serializable:
         return rate_request(payload, self.settings)
 
-    def create_tracking_request(
-        self, payload: TrackingRequest
-    ) -> Serializable:
+    def create_tracking_request(self, payload: TrackingRequest) -> Serializable:
         return tracking_request(payload, self.settings)
 
-    def create_shipment_request(
-        self, payload: ShipmentRequest
-    ) -> Serializable:
+    def create_shipment_request(self, payload: ShipmentRequest) -> Serializable:
         return shipment_request(payload, self.settings)
 
-    def create_pickup_request(
-        self, payload: PickupRequest
-    ) -> Serializable:
+    def create_pickup_request(self, payload: PickupRequest) -> Serializable:
         return pickup_request(payload, self.settings)
 
     def create_pickup_update_request(
         self, payload: PickupUpdateRequest
     ) -> Serializable:
         return pickup_update_request(payload, self.settings)
 
     def create_cancel_pickup_request(
         self, payload: PickupCancelRequest
     ) -> Serializable:
         return pickup_cancel_request(payload, self.settings)
 
-    def create_cancel_shipment_request(self, payload: ShipmentCancelRequest) -> Serializable[str]:
+    def create_cancel_shipment_request(
+        self, payload: ShipmentCancelRequest
+    ) -> Serializable:
         return shipment_cancel_request(payload, self.settings)
 
     def parse_address_validation_response(
         self, response: Deserializable
     ) -> Tuple[AddressValidationDetails, List[Message]]:
-        return parse_address_validation_response(response.deserialize(), self.settings)
+        return parse_address_validation_response(response, self.settings)
 
     def parse_cancel_pickup_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[ConfirmationDetails, List[Message]]:
-        return parse_pickup_cancel_response(response.deserialize(), self.settings)
+        return parse_pickup_cancel_response(response, self.settings)
 
     def parse_cancel_shipment_response(
         self, response: Deserializable
     ) -> Tuple[ConfirmationDetails, List[Message]]:
-        return parse_shipment_cancel_response(response.deserialize(), self.settings)
+        return parse_shipment_cancel_response(response, self.settings)
 
     def parse_pickup_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[PickupDetails, List[Message]]:
-        return parse_pickup_response(response.deserialize(), self.settings)
+        return parse_pickup_response(response, self.settings)
 
     def parse_pickup_update_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[PickupDetails, List[Message]]:
-        return parse_pickup_update_response(response.deserialize(), self.settings)
+        return parse_pickup_update_response(response, self.settings)
 
     def parse_rate_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[List[RateDetails], List[Message]]:
-        return parse_rate_response(response.deserialize(), self.settings)
+        return parse_rate_response(response, self.settings)
 
     def parse_shipment_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[ShipmentDetails, List[Message]]:
-        return parse_shipment_response(response.deserialize(), self.settings)
+        return parse_shipment_response(response, self.settings)
 
     def parse_tracking_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[List[TrackingDetails], List[Message]]:
-        return parse_tracking_response(response.deserialize(), self.settings)
+        return parse_tracking_response(response, self.settings)
```

## karrio/mappers/canpar/proxy.py

```diff
@@ -12,49 +12,45 @@
 from karrio.mappers.canpar.settings import Settings
 from karrio.api.proxy import Proxy as BaseProxy
 
 
 class Proxy(BaseProxy):
     settings: Settings
 
-    def _send_request(
-        self, path: str, soapaction: str, request: Serializable[Any]
-    ) -> str:
+    def _send_request(self, path: str, soapaction: str, request: Serializable) -> str:
         return http(
             url=f"{self.settings.server_url}{path}",
             data=request.serialize(),
             trace=self.trace_as("xml"),
             method="POST",
             headers={
                 "Content-Type": "text/xml; charset=utf-8",
                 "soapaction": soapaction,
             },
         )
 
-    def validate_address(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def validate_address(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/CanparRatingService.CanparRatingServiceHttpSoap12Endpoint/",
             soapaction="urn:searchCanadaPost",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def get_rates(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def get_rates(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/CanparRatingService.CanparRatingServiceHttpSoap12Endpoint/",
             soapaction="urn:rateShipment",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def get_tracking(
-        self, request: Serializable[List[Envelope]]
-    ) -> Deserializable[str]:
+    def get_tracking(self, request: Serializable) -> Deserializable:
         """
         get_tracking make parallel request for each TrackRequest
         """
 
         def get_tracking(track_request: str):
             return self._send_request(
                 path="/CanparAddonsService.CanparAddonsServiceHttpSoap12Endpoint/",
@@ -62,15 +58,15 @@
                 request=Serializable(track_request),
             )
 
         response: List[str] = exec_parrallel(get_tracking, request.serialize())
 
         return Deserializable(XP.bundle_xml(xml_strings=response), XP.to_xml)
 
-    def create_shipment(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def create_shipment(self, request: Serializable) -> Deserializable:
         def process(job: Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request(
                 path="/CanshipBusinessService.CanshipBusinessServiceHttpSoap12Endpoint/",
                 request=job.data,
@@ -81,33 +77,33 @@
             )
 
         pipeline: Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return Deserializable(XP.bundle_xml(response), XP.to_xml)
 
-    def cancel_shipment(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def cancel_shipment(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/CanshipBusinessService.CanshipBusinessServiceHttpSoap12Endpoint/",
             soapaction="urn:voidShipment",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def schedule_pickup(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def schedule_pickup(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/CanparAddonsService.CanparAddonsServiceHttpSoap12Endpoint/",
             soapaction="urn:schedulePickupV2",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def modify_pickup(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def modify_pickup(self, request: Serializable) -> Deserializable:
         def process(job: Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request(
                 path="/CanparAddonsService.CanparAddonsServiceHttpSoap12Endpoint/",
                 request=job.data,
@@ -118,15 +114,15 @@
             )
 
         pipeline: Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return Deserializable(XP.bundle_xml(response), XP.to_xml)
 
-    def cancel_pickup(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def cancel_pickup(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/CanparAddonsService.CanparAddonsServiceHttpSoap12Endpoint/",
             soapaction="urn:cancelPickup",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
```

## karrio/mappers/canpar/settings.py

```diff
@@ -13,7 +13,8 @@
     language: str = "en"
 
     id: str = None
     test_mode: bool = False
     carrier_id: str = "canpar"
     account_country_code: str = "CA"
     metadata: dict = {}
+    config: dict = {}
```

## karrio/providers/canpar/address.py

```diff
@@ -1,7 +1,8 @@
+import karrio.lib as lib
 from typing import List, Tuple
 from canpar_lib.CanparRatingService import (
     searchCanadaPost,
     SearchCanadaPostRq,
     Address as CanparAddress,
 )
 import karrio.lib as lib
@@ -10,31 +11,30 @@
     AddressValidationRequest,
     Message,
     Address,
 )
 from karrio.core.utils import (
     create_envelope,
     Element,
-    Envelope,
     Serializable,
     SF,
     XP,
 )
 from karrio.providers.canpar.error import parse_error_response
 from karrio.providers.canpar.utils import Settings
 
 
 def parse_address_validation_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[AddressValidationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
-    address_node = next(
-        iter(response.xpath(".//*[local-name() = $name]", name="address")), None
-    )
-    address = XP.to_object(CanparAddress, address_node)
+    address = lib.find_element("address", response, CanparAddress, first=True)
+
     success = len(errors) == 0
     validation_details = (
         AddressValidationDetails(
             carrier_id=settings.carrier_id,
             carrier_name=settings.carrier_name,
             success=success,
             complete_address=Address(
@@ -55,16 +55,17 @@
         else None
     )
 
     return validation_details, errors
 
 
 def address_validation_request(
-    payload: AddressValidationRequest, settings: Settings
-) -> Serializable[Envelope]:
+    payload: AddressValidationRequest,
+    settings: Settings,
+) -> Serializable:
     address = lib.to_address(payload.address)
 
     request = create_envelope(
         body_content=searchCanadaPost(
             request=SearchCanadaPostRq(
                 city=payload.address.city or "",
                 password=settings.password,
```

## karrio/providers/canpar/error.py

```diff
@@ -1,20 +1,22 @@
 from typing import List
 from karrio.core.models import Message
 from karrio.core.utils import Element, extract_fault
 from karrio.providers.canpar.utils import Settings
+import karrio.lib as lib
 
 
-def parse_error_response(response: Element, settings: Settings) -> List[Message]:
-    errors: List[Element] = response.xpath(".//*[local-name() = $name]", name="error")
-    return (
-        extract_fault(response, settings) +
-        [
-            Message(
-                carrier_id=settings.carrier_id,
-                carrier_name=settings.carrier_name,
-                message=error.text,
-            )
-            for error in errors
-            if error.text is not None
-        ]
-    )
+def parse_error_response(
+    response: Element,
+    settings: Settings,
+) -> List[Message]:
+    errors = lib.find_element("error", response)
+
+    return extract_fault(response, settings) + [
+        Message(
+            carrier_id=settings.carrier_id,
+            carrier_name=settings.carrier_name,
+            message=error.text,
+        )
+        for error in errors
+        if error.text is not None
+    ]
```

## karrio/providers/canpar/rate.py

```diff
@@ -12,16 +12,18 @@
 import karrio.core.models as models
 import karrio.providers.canpar.error as provider_error
 import karrio.providers.canpar.units as provider_units
 import karrio.providers.canpar.utils as provider_utils
 
 
 def parse_rate_response(
-    response: lib.Element, settings: provider_utils.Settings
+    _response: lib.Deserializable[lib.Element],
+    settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.RateDetails], typing.List[models.Message]]:
+    response = _response.deserialize()
     shipment_nodes = lib.find_element("shipment", response)
     rates: typing.List[models.RateDetails] = [
         _extract_rate_details(node, settings) for node in shipment_nodes
     ]
     return rates, provider_error.parse_error_response(response, settings)
 
 
@@ -63,15 +65,15 @@
         extra_charges=(surcharges + taxes),
         meta=dict(service_name=(service.name or shipment.service_type)),
     )
 
 
 def rate_request(
     payload: models.RateRequest, settings: provider_utils.Settings
-) -> lib.Serializable[lib.Envelope]:
+) -> lib.Serializable:
     packages = lib.to_packages(payload.parcels)
     service_type = lib.to_services(payload.services, provider_units.Service).first
     options = lib.to_shipping_options(
         payload.options,
         package_options=packages.options,
         initializer=provider_units.shipping_options_initializer,
     )
@@ -88,15 +90,18 @@
                 apply_association_discount=False,
                 apply_individual_discount=False,
                 apply_invoice_discount=False,
                 password=settings.password,
                 shipment=Shipment(
                     cod_type=options.canpar_cash_on_delivery.state,
                     delivery_address=Address(
-                        address_line_1=lib.text(payload.recipient.street_number, payload.recipient.address_line1),
+                        address_line_1=lib.text(
+                            payload.recipient.street_number,
+                            payload.recipient.address_line1,
+                        ),
                         address_line_2=payload.recipient.address_line2,
                         address_line_3=None,
                         attention=payload.recipient.person_name,
                         city=payload.recipient.city,
                         country=payload.recipient.country_code,
                         email=payload.recipient.email,
                         extension=None,
@@ -127,15 +132,17 @@
                             store_num=None,
                             width=pkg.width.CM,
                             xc=options.canpar_extra_care.state,
                         )
                         for pkg in packages
                     ],
                     pickup_address=Address(
-                        address_line_1=lib.text(payload.shipper.street_number, payload.shipper.address_line1),
+                        address_line_1=lib.text(
+                            payload.shipper.street_number, payload.shipper.address_line1
+                        ),
                         address_line_2=payload.shipper.address_line2,
                         address_line_3=None,
                         attention=payload.shipper.person_name,
                         city=payload.shipper.city,
                         country=payload.shipper.country_code,
                         email=payload.shipper.email,
                         extension=None,
```

## karrio/providers/canpar/tracking.py

```diff
@@ -3,18 +3,19 @@
 import karrio.lib as lib
 import karrio.core.models as models
 import karrio.providers.canpar.error as error
 import karrio.providers.canpar.utils as provider_utils
 
 
 def parse_tracking_response(
-    response: lib.Element,
+    _response: lib.Deserializable[lib.Element],
     settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.TrackingDetails], typing.List[models.Message]]:
-    results = response.xpath(".//*[local-name() = $name]", name="result")
+    response = _response.deserialize()
+    results = lib.find_element("result", response)
     details: typing.List[models.TrackingDetails] = [
         _extract_tracking_details(result, settings) for result in results
     ]
 
     return details, error.parse_error_response(response, settings)
 
 
@@ -51,15 +52,15 @@
         carrier_name=settings.carrier_name,
         carrier_id=settings.carrier_id,
         tracking_number=result.barcode,
         estimated_delivery=estimated_delivery,
         delivered=delivered,
         events=events,
         info=models.TrackingInfo(
-            shipment_destication_country=result.consignee_address.country,
+            shipment_destination_country=result.consignee_address.country,
             shipment_destination_postal_code=result.consignee_address.postal_code,
             shipping_date=lib.fdate(result.shipping_date, current_format="%Y%m%d"),
             carrier_tracking_link=(
                 result.tracking_url_en if is_en else result.tracking_url_fr
             ),
             shipment_service=(
                 result.service_description_en
@@ -67,17 +68,15 @@
                 else result.service_description_fr
             ),
             signed_by=result.signed_by,
         ),
     )
 
 
-def tracking_request(
-    payload: models.TrackingRequest, _
-) -> lib.Serializable[typing.List[lib.Envelope]]:
+def tracking_request(payload: models.TrackingRequest, _) -> lib.Serializable:
     request = [
         lib.create_envelope(
             body_content=canpar.trackByBarcodeV2(
                 request=canpar.TrackByBarcodeV2Rq(
                     barcode=barcode, filter=None, track_shipment=True
                 )
             )
```

## karrio/providers/canpar/pickup/cancel.py

```diff
@@ -1,25 +1,28 @@
+import karrio.lib as lib
 from typing import List, Tuple
 from canpar_lib.CanparAddonsService import (
     cancelPickup,
     CancelPickupRq,
 )
 from karrio.core.models import (
     PickupCancelRequest,
     ConfirmationDetails,
     Message,
 )
-from karrio.core.utils import create_envelope, Envelope, Element, Serializable
+from karrio.core.utils import create_envelope, Element, Serializable
 from karrio.providers.canpar.error import parse_error_response
 from karrio.providers.canpar.utils import Settings
 
 
 def parse_pickup_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
     success = len(errors) == 0
     confirmation: ConfirmationDetails = (
         ConfirmationDetails(
             carrier_id=settings.carrier_id,
             carrier_name=settings.carrier_name,
             success=success,
@@ -30,16 +33,15 @@
     )
 
     return confirmation, errors
 
 
 def pickup_cancel_request(
     payload: PickupCancelRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+) -> Serializable:
     request = create_envelope(
         body_content=cancelPickup(
             request=CancelPickupRq(
                 id=int(payload.confirmation_number),
                 password=settings.password,
                 user_id=settings.username,
             )
```

## karrio/providers/canpar/pickup/create.py

```diff
@@ -4,56 +4,57 @@
     schedulePickupV2,
     SchedulePickupV2Rq,
     PickupV2,
     Address,
 )
 import karrio.lib as lib
 from karrio.core.models import PickupRequest, PickupDetails, Message
-from karrio.core.utils import Envelope, Element, create_envelope, Serializable, DF, XP
+from karrio.core.utils import Element, create_envelope, Serializable, DF, XP
 from karrio.core.units import Packages
 from karrio.providers.canpar.error import parse_error_response
 from karrio.providers.canpar.utils import Settings
 from karrio.providers.canpar.units import WeightUnit
 
 
 def parse_pickup_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[PickupDetails, List[Message]]:
-    pickup_node = next(
-        iter(response.xpath(".//*[local-name() = $name]", name="pickup")), None
-    )
+    response = _response.deserialize()
+    pickup_node = lib.find_element("pickup", response, first=True)
     pickup = XP.to_object(PickupV2, pickup_node)
     details: PickupDetails = PickupDetails(
         carrier_id=settings.carrier_id,
         carrier_name=settings.carrier_name,
         confirmation_number=str(pickup.id),
         pickup_date=DF.fdatetime(pickup.pickup_date, "%Y-%m-%dT%H:%M:%S"),
     )
 
     return details, parse_error_response(response, settings)
 
 
-def pickup_request(
-    payload: PickupRequest, settings: Settings
-) -> Serializable[Envelope]:
+def pickup_request(payload: PickupRequest, settings: Settings) -> Serializable:
     packages = Packages(payload.parcels)
     weight = packages.weight.value
     weight_unit = WeightUnit[packages.weight.unit].value if weight is not None else None
     address = lib.to_address(payload.address)
 
     request = create_envelope(
         body_content=schedulePickupV2(
             request=SchedulePickupV2Rq(
                 password=settings.password,
                 pickup=PickupV2(
                     collect=None,
                     comments=payload.instruction,
                     created_by=address.person_name,
                     pickup_address=Address(
-                        address_line_1=lib.text(address.street_number, address.address_line1) or "",
+                        address_line_1=lib.text(
+                            address.street_number, address.address_line1
+                        )
+                        or "",
                         address_line_2=address.address_line2,
                         address_line_3=None,
                         attention=address.person_name,
                         city=address.city,
                         country=address.country_code,
                         email=address.email,
                         extension=None,
```

## karrio/providers/canpar/pickup/update.py

```diff
@@ -1,59 +1,54 @@
 from typing import Optional
 from functools import partial
-from karrio.core.models import (
-    PickupRequest,
-    PickupUpdateRequest,
-    PickupCancelRequest
-)
-from karrio.core.utils import (
-    Pipeline,
-    Job,
-    Serializable,
-    XP
-)
+from karrio.core.models import PickupRequest, PickupUpdateRequest, PickupCancelRequest
+from karrio.core.utils import Pipeline, Job, Serializable, XP
 from karrio.providers.canpar.utils import Settings
 from karrio.providers.canpar.error import parse_error_response
 from karrio.providers.canpar.pickup.cancel import pickup_cancel_request
 from karrio.providers.canpar.pickup.create import pickup_request, parse_pickup_response
 
 parse_pickup_update_response = parse_pickup_response
 
 
-def pickup_update_request(payload: PickupUpdateRequest, settings: Settings) -> Serializable[Pipeline]:
+def pickup_update_request(
+    payload: PickupUpdateRequest, settings: Settings
+) -> Serializable:
     """
     Modify a pickup request
     Steps
         1 - cancel former pickup
         2 - create a new one
     :param payload: PickupUpdateRequest
     :param settings: Settings
-    :return: Serializable[Pipeline]
+    :return: Serializable
     """
     request: Pipeline = Pipeline(
         cancel=lambda *_: _cancel_pickup(payload, settings),
-        schedule=partial(_create_pickup, payload=payload, settings=settings)
+        schedule=partial(_create_pickup, payload=payload, settings=settings),
     )
 
     return Serializable(request)
 
 
 def _cancel_pickup(payload: PickupUpdateRequest, settings: Settings) -> Job:
     data = PickupCancelRequest(
         confirmation_number=payload.confirmation_number,
         address=payload.address,
         pickup_date=payload.pickup_date,
-        reason='change pickup',
+        reason="change pickup",
     )
 
-    return Job(id='cancel', data=pickup_cancel_request(data, settings))
+    return Job(id="cancel", data=pickup_cancel_request(data, settings))
 
 
-def _create_pickup(cancel_response: str, payload: PickupUpdateRequest, settings: Settings) -> Job:
+def _create_pickup(
+    cancel_response: str, payload: PickupUpdateRequest, settings: Settings
+) -> Job:
     errors = parse_error_response(XP.to_xml(cancel_response), settings)
     canceled = len(errors) == 0
     data: Optional[PickupRequest] = (
         pickup_request(payload, settings) if canceled else None
     )
-    fallback: Optional[str] = None if canceled else ''
+    fallback: Optional[str] = None if canceled else ""
 
-    return Job(id='schedule', data=data, fallback=fallback)
+    return Job(id="schedule", data=data, fallback=fallback)
```

## karrio/providers/canpar/shipment/cancel.py

```diff
@@ -1,26 +1,27 @@
+import karrio.lib as lib
 from typing import List, Tuple
 from canpar_lib.CanshipBusinessService import (
     voidShipment,
     VoidShipmentRq,
 )
 from karrio.core.models import ShipmentCancelRequest, ConfirmationDetails, Message
 from karrio.core.utils import (
     create_envelope,
-    Envelope,
     Element,
     Serializable,
 )
 from karrio.providers.canpar.error import parse_error_response
 from karrio.providers.canpar.utils import Settings
 
 
 def parse_shipment_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
     success = len(errors) == 0
     confirmation: ConfirmationDetails = (
         ConfirmationDetails(
             carrier_id=settings.carrier_id,
             carrier_name=settings.carrier_name,
             success=success,
@@ -31,16 +32,15 @@
     )
 
     return confirmation, errors
 
 
 def shipment_cancel_request(
     payload: ShipmentCancelRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+) -> Serializable:
     request = create_envelope(
         body_content=voidShipment(
             request=VoidShipmentRq(
                 id=int(payload.shipment_identifier),
                 password=settings.password,
                 user_id=settings.username,
             )
```

## karrio/providers/canpar/shipment/create.py

```diff
@@ -15,19 +15,21 @@
 import karrio.providers.canpar.units as provider_units
 import karrio.providers.canpar.utils as provider_utils
 import karrio.providers.canpar.shipment.label as label
 import karrio.providers.canpar.rate as rate
 
 
 def parse_shipment_response(
-    response: lib.Element, settings: provider_utils.Settings
+    _response: lib.Deserializable[lib.Element],
+    settings: provider_utils.Settings,
 ) -> typing.Tuple[models.ShipmentDetails, typing.List[models.Message]]:
+    response = _response.deserialize()
     shipment = lib.to_object(
         Shipment,
-        lib.find_element("shipment", response, first=True)
+        lib.find_element("shipment", response, first=True),
     )
     success = shipment is not None and shipment.id is not None
     shipment_details = _extract_details(response, settings) if success else None
 
     return shipment_details, provider_error.parse_error_response(response, settings)
 
 
@@ -50,16 +52,15 @@
             carrier_tracking_link=settings.tracking_url.format(tracking_number),
         ),
     )
 
 
 def shipment_request(
     payload: models.ShipmentRequest, settings: provider_utils.Settings
-) -> lib.Serializable[lib.Pipeline]:
-
+) -> lib.Serializable:
     request: lib.Pipeline = lib.Pipeline(
         process=lambda *_: _process_shipment(payload, settings),
         get_label=partial(_get_label, settings=settings),
     )
 
     return lib.Serializable(request)
 
@@ -84,15 +85,18 @@
     request = lib.create_envelope(
         body_content=processShipment(
             request=ProcessShipmentRq(
                 password=settings.password,
                 shipment=Shipment(
                     cod_type=options.canpar_cash_on_delivery.state,
                     delivery_address=Address(
-                        address_line_1=lib.text(payload.recipient.street_number, payload.recipient.address_line1),
+                        address_line_1=lib.text(
+                            payload.recipient.street_number,
+                            payload.recipient.address_line1,
+                        ),
                         address_line_2=payload.recipient.address_line2,
                         address_line_3=None,
                         attention=payload.recipient.person_name,
                         city=payload.recipient.city,
                         country=payload.recipient.country_code,
                         email=payload.recipient.email,
                         extension=None,
@@ -126,15 +130,17 @@
                             store_num=None,
                             width=pkg.width.CM,
                             xc=("canpar_extra_care" in options) or None,
                         )
                         for pkg in packages
                     ],
                     pickup_address=Address(
-                        address_line_1=lib.text(payload.shipper.street_number, payload.shipper.address_line1),
+                        address_line_1=lib.text(
+                            payload.shipper.street_number, payload.shipper.address_line1
+                        ),
                         address_line_2=payload.shipper.address_line2,
                         address_line_3=None,
                         attention=payload.shipper.person_name,
                         city=payload.shipper.city,
                         country=payload.shipper.country_code,
                         email=payload.shipper.email,
                         extension=None,
```

## karrio/providers/canpar/shipment/label.py

```diff
@@ -6,18 +6,15 @@
 
 @struct
 class LabelRequest:
     shipment_id: str
     thermal: bool = False
 
 
-def get_label_request(
-    payload: LabelRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+def get_label_request(payload: LabelRequest, settings: Settings) -> Serializable:
     request = create_envelope(
         body_content=getLabelsAdvanced(
             request=GetLabelsAdvancedRq(
                 horizontal=False,
                 id=payload.shipment_id,
                 password=settings.password,
                 thermal=payload.thermal,
```

## Comparing `karrio.canpar-2023.3.dist-info/METADATA` & `karrio.canpar-2023.4.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: karrio.canpar
-Version: 2023.3
+Version: 2023.4
 Summary: Karrio - Canpar Shipping Extension
 Home-page: https://github.com/karrioapi/karrio
 Author: karrio
 Author-email: hello@karrio.io
 License: Apache-2.0
 Platform: UNKNOWN
 Classifier: Intended Audience :: Developers
```

## Comparing `karrio.canpar-2023.3.dist-info/RECORD` & `karrio.canpar-2023.4.dist-info/RECORD`

 * *Files 21% similar despite different names*

```diff
@@ -1,23 +1,23 @@
 karrio/mappers/canpar/__init__.py,sha256=6-65tRkLw3qrNdyDT7TgrBloFmZQ4fCrdo1UcPSabuo,348
-karrio/mappers/canpar/mapper.py,sha256=MYbick8tohaLmoAPu5RfXCv5zOSyv3EVNiJT2DQjFFA,4052
-karrio/mappers/canpar/proxy.py,sha256=AAfusr0B4h0qucewd5bmXpOU5iJZDvhJ1Tqtn7ve7lw,4486
-karrio/mappers/canpar/settings.py,sha256=F6hZOMqzKToYmZGVjjB37WLDBYEvWFYSwUSVbGtmb50,410
+karrio/mappers/canpar/mapper.py,sha256=5yOyRKwW41w-pFPABYIh-SLPa7YYjJh4fNG6YClfl_8,3875
+karrio/mappers/canpar/proxy.py,sha256=wLFP3g1O4Pkr0rdvbpW-xAY73Ev4lOUeEfKdSZ-K92g,4327
+karrio/mappers/canpar/settings.py,sha256=m6OkqHvK8KEY5ZpiYNYT5LthxrUncsSI0y8uqiZCPIU,432
 karrio/providers/canpar/__init__.py,sha256=c4f74hxIKu-26maem-GeC5NFjEOmKRzayOQ-EsBkmr0,725
-karrio/providers/canpar/address.py,sha256=FOHjjUKC7xWUrH-ulFnrWt63sgM7sJ6cRipdqJwMJJQ,2583
-karrio/providers/canpar/error.py,sha256=NbOSI_91l1jC1H8cMz6PX2krZsKpYx_pU5c3uHa8KFM,662
-karrio/providers/canpar/rate.py,sha256=PxFsw4OKeZQ0wkiShA0IhrotXmEW5VPg8Jk_EF3AE5A,7046
-karrio/providers/canpar/tracking.py,sha256=QJILNSCiajSiDp8uPxqNMEGqI_cHpcmZBExoAc7tkCg,3320
+karrio/providers/canpar/address.py,sha256=LIudKWELKqEX6-0pObJTIz2H3_bLApRZmamx1624bzs,2566
+karrio/providers/canpar/error.py,sha256=TJuCJuJ2aXKm7t_sO7hDJAla0KeVJWYjoaB9NHVyFT4,605
+karrio/providers/canpar/rate.py,sha256=OPAh87V1VHkXw8kjPuKpgAo14bXoMKWJL8A3tjoeaqM,7234
+karrio/providers/canpar/tracking.py,sha256=Wcx8r58vPxRgyLrpy7ujCNSihLVN00Ab3Q_ASj3ykhU,3324
 karrio/providers/canpar/units.py,sha256=5EQUil9PCq3UadW5yY_BqniYEZZbUKBpAKMyQQkUgvI,2699
 karrio/providers/canpar/utils.py,sha256=qtwUDu0Pl8wAIhjJXc9e3fV7EX0pnN-rbZdP7UwLnT4,1744
 karrio/providers/canpar/pickup/__init__.py,sha256=CIzOKde1K4E13-Rjr4TujciNLmooURWV_enhBLdvP5w,292
-karrio/providers/canpar/pickup/cancel.py,sha256=RyPGxSCzQWGLO77NqFYoFhib9UfYExm6wpoA1bUd24U,1373
-karrio/providers/canpar/pickup/create.py,sha256=z1atIYqCXQm5J2GtCTJA68I-2CcFK93_O3emFVgNc5Y,3376
-karrio/providers/canpar/pickup/update.py,sha256=CzIkE6abEbJ9gvudun0jKt7Nwm8r9F8PIOZ5R2Sh228,1892
+karrio/providers/canpar/pickup/cancel.py,sha256=MF4P6ErLOM8VBFCTPce4LKFYxN5-1ESn3Dh3rWkTAC4,1442
+karrio/providers/canpar/pickup/create.py,sha256=OE3sQL-zfSsPgImV-tWfyVEnb8tqhzCy5S9X3mSWii0,3450
+karrio/providers/canpar/pickup/update.py,sha256=ILVYCdFrLI5aNF85Xe0hdm2RdiFbAure0i1LWKfy0vU,1849
 karrio/providers/canpar/shipment/__init__.py,sha256=cOKWCNWLmsXGflMSnru50LHufgfcQeXY4km-9c4gZDQ,202
-karrio/providers/canpar/shipment/cancel.py,sha256=UFVozYkdd_2SXC09q8AZA4wU5vuZWxt0-cJhrqJd3Rw,1390
-karrio/providers/canpar/shipment/create.py,sha256=jcgU4zufScA7Z5A5rKdoK4OR3EqhNVkbjERVT3K5RxU,7692
-karrio/providers/canpar/shipment/label.py,sha256=jPFK_ZC4Wqy-g1r_w9DmVzqQOgs6LsOPgCZ6oxQyHNw,809
-karrio.canpar-2023.3.dist-info/METADATA,sha256=lBFGS4WJUga547DhI904w_Lqy9sZk6VyEAa9yZhyXmQ,980
-karrio.canpar-2023.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-karrio.canpar-2023.3.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
-karrio.canpar-2023.3.dist-info/RECORD,,
+karrio/providers/canpar/shipment/cancel.py,sha256=cg9rBFJMmSHDAM6HVGTOjp_kRwFLk3wODAzh44TSK1E,1450
+karrio/providers/canpar/shipment/create.py,sha256=jW9kT5ZikZJdr8BeaJWkOGio-trMBMG5H-3dNf5Q5hY,7880
+karrio/providers/canpar/shipment/label.py,sha256=-RLPlZ7tcmzoiLo5HpktbIFx1x6iP5ppl0KNdFzG6zM,792
+karrio.canpar-2023.4.dist-info/METADATA,sha256=6NWwg3pz-z0kEi7SK8hJAsgF6dLaEAawNyFnqTZEfTQ,980
+karrio.canpar-2023.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+karrio.canpar-2023.4.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
+karrio.canpar-2023.4.dist-info/RECORD,,
```

