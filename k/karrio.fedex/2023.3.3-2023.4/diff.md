# Comparing `tmp/karrio.fedex-2023.3.3-py3-none-any.whl.zip` & `tmp/karrio.fedex-2023.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 31968 bytes, number of entries: 24
+Zip file size: 32022 bytes, number of entries: 24
 -rw-rw-r--  2.0 unx      535 b- defN 22-Nov-15 19:21 karrio/mappers/fedex/__init__.py
--rw-rw-r--  2.0 unx     4267 b- defN 22-Nov-15 19:21 karrio/mappers/fedex/mapper.py
--rw-rw-r--  2.0 unx     3807 b- defN 23-Mar-03 13:50 karrio/mappers/fedex/proxy.py
--rw-rw-r--  2.0 unx      581 b- defN 22-Nov-15 19:21 karrio/mappers/fedex/settings.py
+-rw-rw-r--  2.0 unx     3996 b- defN 23-Apr-01 13:34 karrio/mappers/fedex/mapper.py
+-rw-rw-r--  2.0 unx     3556 b- defN 23-Apr-04 13:56 karrio/mappers/fedex/proxy.py
+-rw-rw-r--  2.0 unx      603 b- defN 23-Apr-15 06:44 karrio/mappers/fedex/settings.py
 -rw-rw-r--  2.0 unx      833 b- defN 22-Nov-15 19:21 karrio/providers/fedex/__init__.py
--rw-rw-r--  2.0 unx     4625 b- defN 23-Mar-27 07:55 karrio/providers/fedex/address.py
--rw-rw-r--  2.0 unx     4338 b- defN 23-Mar-18 11:05 karrio/providers/fedex/document.py
+-rw-rw-r--  2.0 unx     4558 b- defN 23-Apr-01 15:18 karrio/providers/fedex/address.py
+-rw-rw-r--  2.0 unx     4414 b- defN 23-Apr-01 15:18 karrio/providers/fedex/document.py
 -rw-rw-r--  2.0 unx     1074 b- defN 22-Nov-15 19:21 karrio/providers/fedex/error.py
--rw-rw-r--  2.0 unx    12201 b- defN 23-Jan-11 18:22 karrio/providers/fedex/rate.py
--rw-rw-r--  2.0 unx     6201 b- defN 23-Mar-27 21:51 karrio/providers/fedex/tracking.py
+-rw-rw-r--  2.0 unx    12452 b- defN 23-Apr-04 13:57 karrio/providers/fedex/rate.py
+-rw-rw-r--  2.0 unx     6241 b- defN 23-Apr-01 15:18 karrio/providers/fedex/tracking.py
 -rw-rw-r--  2.0 unx    19457 b- defN 23-Mar-27 07:55 karrio/providers/fedex/units.py
--rw-rw-r--  2.0 unx     1753 b- defN 23-Mar-27 07:55 karrio/providers/fedex/utils.py
+-rw-rw-r--  2.0 unx     1753 b- defN 23-Apr-15 02:55 karrio/providers/fedex/utils.py
 -rw-rw-r--  2.0 unx      289 b- defN 22-Nov-15 19:21 karrio/providers/fedex/pickup/__init__.py
--rw-rw-r--  2.0 unx     2666 b- defN 23-Mar-27 07:55 karrio/providers/fedex/pickup/availability.py
--rw-rw-r--  2.0 unx     2663 b- defN 22-Nov-15 19:21 karrio/providers/fedex/pickup/cancel.py
--rw-rw-r--  2.0 unx     6212 b- defN 22-Nov-15 19:21 karrio/providers/fedex/pickup/create.py
--rw-rw-r--  2.0 unx     2077 b- defN 22-Nov-15 19:21 karrio/providers/fedex/pickup/update.py
+-rw-rw-r--  2.0 unx     2639 b- defN 23-Apr-01 13:46 karrio/providers/fedex/pickup/availability.py
+-rw-rw-r--  2.0 unx     2637 b- defN 23-Apr-01 15:18 karrio/providers/fedex/pickup/cancel.py
+-rw-rw-r--  2.0 unx     6150 b- defN 23-Apr-01 15:18 karrio/providers/fedex/pickup/create.py
+-rw-rw-r--  2.0 unx     2057 b- defN 23-Apr-01 13:35 karrio/providers/fedex/pickup/update.py
 -rw-rw-r--  2.0 unx      226 b- defN 22-Nov-15 19:21 karrio/providers/fedex/shipment/__init__.py
--rw-rw-r--  2.0 unx     2291 b- defN 22-Nov-15 19:21 karrio/providers/fedex/shipment/cancel.py
--rw-rw-r--  2.0 unx    31254 b- defN 23-Mar-27 21:49 karrio/providers/fedex/shipment/create.py
--rw-rw-r--  2.0 unx      969 b- defN 23-Mar-27 22:04 karrio.fedex-2023.3.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Mar-27 22:04 karrio.fedex-2023.3.3.dist-info/WHEEL
--rw-rw-r--  2.0 unx        7 b- defN 23-Mar-27 22:04 karrio.fedex-2023.3.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2175 b- defN 23-Mar-27 22:04 karrio.fedex-2023.3.3.dist-info/RECORD
-24 files, 110593 bytes uncompressed, 28384 bytes compressed:  74.3%
+-rw-rw-r--  2.0 unx     2357 b- defN 23-Apr-01 15:18 karrio/providers/fedex/shipment/cancel.py
+-rw-rw-r--  2.0 unx    31290 b- defN 23-Apr-01 15:18 karrio/providers/fedex/shipment/create.py
+-rw-rw-r--  2.0 unx      967 b- defN 23-Apr-18 07:09 karrio.fedex-2023.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-Apr-18 07:09 karrio.fedex-2023.4.dist-info/WHEEL
+-rw-rw-r--  2.0 unx        7 b- defN 23-Apr-18 07:09 karrio.fedex-2023.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2167 b- defN 23-Apr-18 07:09 karrio.fedex-2023.4.dist-info/RECORD
+24 files, 110350 bytes uncompressed, 28454 bytes compressed:  74.2%
```

## zipnote {}

```diff
@@ -54,20 +54,20 @@
 
 Filename: karrio/providers/fedex/shipment/cancel.py
 Comment: 
 
 Filename: karrio/providers/fedex/shipment/create.py
 Comment: 
 
-Filename: karrio.fedex-2023.3.3.dist-info/METADATA
+Filename: karrio.fedex-2023.4.dist-info/METADATA
 Comment: 
 
-Filename: karrio.fedex-2023.3.3.dist-info/WHEEL
+Filename: karrio.fedex-2023.4.dist-info/WHEEL
 Comment: 
 
-Filename: karrio.fedex-2023.3.3.dist-info/top_level.txt
+Filename: karrio.fedex-2023.4.dist-info/top_level.txt
 Comment: 
 
-Filename: karrio.fedex-2023.3.3.dist-info/RECORD
+Filename: karrio.fedex-2023.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## karrio/mappers/fedex/mapper.py

```diff
@@ -38,70 +38,60 @@
     def create_cancel_pickup_request(
         self, payload: models.PickupCancelRequest
     ) -> lib.Serializable:
         return provider.pickup_cancel_request(payload, self.settings)
 
     def create_cancel_shipment_request(
         self, payload: models.ShipmentCancelRequest
-    ) -> lib.Serializable[str]:
+    ) -> lib.Serializable:
         return provider.shipment_cancel_request(payload, self.settings)
 
     def create_document_upload_request(
         self, payload: models.DocumentUploadRequest
     ) -> lib.Serializable:
         return provider.document_upload_request(payload, self.settings)
 
     def parse_address_validation_response(
         self, response: lib.Deserializable
     ) -> typing.Tuple[models.AddressValidationDetails, typing.List[models.Message]]:
-        return provider.parse_address_validation_response(
-            response.deserialize(), self.settings
-        )
+        return provider.parse_address_validation_response(response, self.settings)
 
     def parse_cancel_pickup_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[models.ConfirmationDetails, typing.List[models.Message]]:
-        return provider.parse_pickup_cancel_response(
-            response.deserialize(), self.settings
-        )
+        return provider.parse_pickup_cancel_response(response, self.settings)
 
     def parse_cancel_shipment_response(
         self, response: lib.Deserializable
     ) -> typing.Tuple[models.ConfirmationDetails, typing.List[models.Message]]:
-        return provider.parse_shipment_cancel_response(
-            response.deserialize(), self.settings
-        )
+        return provider.parse_shipment_cancel_response(response, self.settings)
 
     def parse_pickup_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[models.PickupDetails, typing.List[models.Message]]:
-        return provider.parse_pickup_response(response.deserialize(), self.settings)
+        return provider.parse_pickup_response(response, self.settings)
 
     def parse_pickup_update_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[models.PickupDetails, typing.List[models.Message]]:
-        return provider.parse_pickup_update_response(
-            response.deserialize(), self.settings
-        )
+        return provider.parse_pickup_update_response(response, self.settings)
 
     def parse_rate_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[typing.List[models.RateDetails], typing.List[models.Message]]:
-        return provider.parse_rate_response(response.deserialize(), self.settings)
+        return provider.parse_rate_response(response, self.settings)
 
     def parse_shipment_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[models.ShipmentDetails, typing.List[models.Message]]:
-        return provider.parse_shipment_response(response.deserialize(), self.settings)
+        return provider.parse_shipment_response(response, self.settings)
 
     def parse_tracking_response(
-        self, response: lib.Deserializable[str]
+        self, response: lib.Deserializable
     ) -> typing.Tuple[typing.List[models.TrackingDetails], typing.List[models.Message]]:
-        return provider.parse_tracking_response(response.deserialize(), self.settings)
+        return provider.parse_tracking_response(response, self.settings)
 
     def parse_document_upload_response(
         self,
         response: lib.Deserializable,
     ) -> typing.Tuple[models.DocumentUploadDetails, typing.List[models.Message]]:
-        return provider.parse_document_upload_response(
-            response.deserialize(), self.settings
-        )
+        return provider.parse_document_upload_response(response, self.settings)
```

## karrio/mappers/fedex/proxy.py

```diff
@@ -13,38 +13,30 @@
             url=f"{self.settings.server_url}{path}",
             data=request.serialize(),
             trace=self.trace_as("xml"),
             method="POST",
             headers={"Content-Type": "application/xml"},
         )
 
-    def validate_address(
-        self, request: lib.Serializable[lib.Envelope]
-    ) -> lib.Deserializable[str]:
+    def validate_address(self, request: lib.Serializable) -> lib.Deserializable:
         response = self._send_request("/addressvalidation", request)
 
         return lib.Deserializable(response, lib.to_element)
 
-    def get_rates(
-        self, request: lib.Serializable[lib.Envelope]
-    ) -> lib.Deserializable[str]:
+    def get_rates(self, request: lib.Serializable) -> lib.Deserializable:
         response = self._send_request("/rate", request)
 
-        return lib.Deserializable(response, lib.to_element)
+        return lib.Deserializable(response, lib.to_element, request.ctx)
 
-    def get_tracking(
-        self, request: lib.Serializable[lib.Envelope]
-    ) -> lib.Deserializable[str]:
+    def get_tracking(self, request: lib.Serializable) -> lib.Deserializable:
         response = self._send_request("/track", request)
 
         return lib.Deserializable(response, lib.to_element)
 
-    def create_shipment(
-        self, request: lib.Serializable[lib.Envelope]
-    ) -> lib.Deserializable[str]:
+    def create_shipment(self, request: lib.Serializable) -> lib.Deserializable:
         requests = request.serialize()
         response = self._send_request("/ship", lib.Serializable(requests[0]))
         master_id = lib.find_element(
             "MasterTrackingId", lib.to_element(response), TrackingId, first=True
         )
 
         if len(requests) > 1 and master_id is not None:
@@ -59,57 +51,51 @@
                 )
                 for request in requests[1:]
             ]
             return lib.Deserializable([response, *responses], lib.to_element)
 
         return lib.Deserializable(response, lib.to_element)
 
-    def cancel_shipment(
-        self, request: lib.Serializable[lib.Envelope]
-    ) -> lib.Deserializable[str]:
+    def cancel_shipment(self, request: lib.Serializable) -> lib.Deserializable:
         response = self._send_request("/ship", request)
 
         return lib.Deserializable(response, lib.to_element)
 
-    def schedule_pickup(
-        self, request: lib.Serializable[lib.Pipeline]
-    ) -> lib.Deserializable[str]:
+    def schedule_pickup(self, request: lib.Serializable) -> lib.Deserializable:
         def process(job: lib.Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request("/pickup", job.data)
 
         pipeline: lib.Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return lib.Deserializable(response, lib.to_element)
 
-    def modify_pickup(
-        self, request: lib.Serializable[lib.Pipeline]
-    ) -> lib.Deserializable[str]:
+    def modify_pickup(self, request: lib.Serializable) -> lib.Deserializable:
         def process(job: lib.Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request("/pickup", job.data)
 
         pipeline: lib.Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return lib.Deserializable(response, lib.to_element)
 
     def cancel_pickup(
         self,
-        request: lib.Serializable[lib.Envelope],
-    ) -> lib.Deserializable[str]:
+        request: lib.Serializable,
+    ) -> lib.Deserializable:
         response = self._send_request("/pickup", request)
 
         return lib.Deserializable(response, lib.to_element)
 
     def upload_document(
         self,
-        request: lib.Serializable[lib.Envelope],
+        request: lib.Serializable,
     ) -> lib.Deserializable:
         response = self._send_request("/uploaddocument", request)
 
         return lib.Deserializable(response, lib.to_element)
```

## karrio/mappers/fedex/settings.py

```diff
@@ -15,11 +15,12 @@
     language_code: str = "en"
     account_country_code: str = None
 
     id: str = None
     test_mode: bool = False
     carrier_id: str = "fedex"
     metadata: dict = {}
+    config: dict = {}
 
     @property
     def carrier_name(self):
         return "fedex"
```

## karrio/providers/fedex/address.py

```diff
@@ -6,38 +6,33 @@
     Address as FedexAddress,
     Contact,
     TransactionDetail,
     VersionId,
     NotificationSeverityType,
 )
 import karrio.lib as lib
-from karrio.core.utils import create_envelope, Serializable, Element, Envelope, SF, XP
+from karrio.core.utils import create_envelope, Serializable, Element, SF, XP
 from karrio.core.models import (
     AddressValidationRequest,
     Message,
     AddressValidationDetails,
     Address,
 )
 from karrio.providers.fedex.utils import Settings, default_request_serializer
 from karrio.providers.fedex.error import parse_error_response
+import karrio.lib as lib
 
 
 def parse_address_validation_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[AddressValidationDetails, List[Message]]:
+    response = _response.deserialize()
     reply = XP.to_object(
         AddressValidationReply,
-        next(
-            iter(
-                response.xpath(
-                    ".//*[local-name() = $name]", name="AddressValidationReply"
-                )
-            ),
-            None,
-        ),
+        lib.find_element("AddressValidationReply", response, first=True),
     )
     address: FedexAddress = next(
         (result.EffectiveAddress for result in reply.AddressResults), None
     )
     success = reply.HighestSeverity == NotificationSeverityType.SUCCESS.value
     _, lines = (
         address.StreetLines
@@ -65,15 +60,15 @@
     )
 
     return validation_details, parse_error_response(response, settings)
 
 
 def address_validation_request(
     payload: AddressValidationRequest, settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     address = lib.to_address(payload.address)
 
     request = create_envelope(
         body_content=FedexAddressValidationRequest(
             WebAuthenticationDetail=settings.webAuthenticationDetail,
             ClientDetail=settings.clientDetail,
             TransactionDetail=TransactionDetail(
```

## karrio/providers/fedex/document.py

```diff
@@ -5,17 +5,18 @@
 import karrio.core.models as models
 import karrio.providers.fedex.error as provider_error
 import karrio.providers.fedex.units as provider_units
 import karrio.providers.fedex.utils as provider_utils
 
 
 def parse_document_upload_response(
-    response: lib.Element,
+    _response: lib.Deserializable[lib.Element],
     settings: provider_utils.Settings,
 ) -> typing.Tuple[models.DocumentUploadDetails, typing.List[models.Message]]:
+    response = _response.deserialize()
     errors = provider_error.parse_error_response(response, settings)
     document_statuses = lib.find_element(
         "DocumentStatuses", response, fedex.UploadDocumentStatusDetail
     )
 
     details = (
         _extract_details(document_statuses, settings)
@@ -44,15 +45,15 @@
         meta=dict(),
     )
 
 
 def document_upload_request(
     payload: models.DocumentUploadRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[lib.Envelope]:
+) -> lib.Serializable:
     document_files = lib.to_document_files(payload.document_files)
     options = lib.to_upload_options(
         payload.options,
         provider_units.DocumentUploadOption,
     )
 
     request = lib.create_envelope(
@@ -106,12 +107,14 @@
             ],
         )
     )
 
     return lib.Serializable(
         request,
         lambda _: (
-            provider_utils.default_request_serializer("v19", 'xmlns:v19="http://fedex.com/ws/uploaddocument/v19"')(_)
+            provider_utils.default_request_serializer(
+                "v19", 'xmlns:v19="http://fedex.com/ws/uploaddocument/v19"'
+            )(_)
             .replace("<v19:DocumentContent>b'", "<v19:DocumentContent>")
             .replace("'</v19:DocumentContent>", "</v19:DocumentContent>")
         ),
     )
```

## karrio/providers/fedex/rate.py

```diff
@@ -24,27 +24,29 @@
 import karrio.core.models as models
 import karrio.providers.fedex.error as provider_error
 import karrio.providers.fedex.units as provider_units
 import karrio.providers.fedex.utils as provider_utils
 
 
 def parse_rate_response(
-    response: lib.Element,
+    _response: lib.Deserializable[lib.Element],
     settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.RateDetails], typing.List[models.Message]]:
+    response = _response.deserialize()
     replys = lib.find_element("RateReplyDetails", response)
     rates: typing.List[models.RateDetails] = [
-        _extract_rate(detail_node, settings) for detail_node in replys
+        _extract_details(detail_node, settings, _response.ctx) for detail_node in replys
     ]
     return rates, provider_error.parse_error_response(response, settings)
 
 
-def _extract_rate(
+def _extract_details(
     detail_node: lib.Element,
     settings: provider_utils.Settings,
+    ctx: dict,
 ) -> typing.Optional[models.RateDetails]:
     rate: RateReplyDetail = lib.to_object(RateReplyDetail, detail_node)
     service = provider_units.ServiceType.map(rate.ServiceType)
     rate_type = rate.ActualRateType
     applied_options = rate.AppliedOptions
 
     shipment_rate, shipment_discount = typing.cast(
@@ -65,16 +67,17 @@
         ("Discount", getattr(shipment_discount, "Amount", None)),
         *(
             (s.Description, s.Amount.Amount)
             for s in shipment_rate.Surcharges + shipment_rate.Taxes
         ),
     ]
     estimated_delivery = lib.to_date(rate.DeliveryTimestamp)
+    shipping_date = lib.to_date(ctx.get("shipment_date") or datetime.now())
     transit = (
-        ((estimated_delivery.date() - datetime.today().date()).days or None)
+        ((estimated_delivery.date() - shipping_date.date()).days or None)
         if estimated_delivery is not None
         else None
     )
     applied_options = (
         dict(applied_options=applied_options)
         if (applied_options is not None and len(applied_options) > 0)
         else {}
@@ -101,15 +104,15 @@
         meta=dict(service_name=service.name_or_key, **applied_options),
     )
 
 
 def rate_request(
     payload: models.RateRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[FedexRateRequest]:
+) -> lib.Serializable:
     shipper = lib.to_address(payload.shipper)
     recipient = lib.to_address(payload.recipient)
     packages = lib.to_packages(
         payload.parcels,
         provider_units.PackagePresets,
         required=["weight"],
     )
@@ -117,14 +120,15 @@
     options = lib.to_shipping_options(
         payload.options,
         package_options=packages.options,
         option_type=provider_units.RatingOption,
         initializer=provider_units.shipping_options_initializer,
     )
     request_types = ["LIST"] + ([] if "currency" not in options else ["PREFERRED"])
+    shipment_date = lib.to_date(options.shipment_date.state or datetime.now())
 
     request = FedexRateRequest(
         WebAuthenticationDetail=settings.webAuthenticationDetail,
         ClientDetail=settings.clientDetail,
         TransactionDetail=TransactionDetail(CustomerTransactionId="FTC"),
         Version=VersionId(ServiceId="crs", Major=28, Intermediate=0, Minor=0),
         ReturnTransitAndCommit=True,
@@ -132,15 +136,15 @@
         VariableOptions=(
             [option.code for _, option in options.items()]
             if any(options.items())
             else None
         ),
         ConsolidationKey=None,
         RequestedShipment=RequestedShipment(
-            ShipTimestamp=lib.to_date(options.shipment_date.state or datetime.now()),
+            ShipTimestamp=shipment_date,
             DropoffType="REGULAR_PICKUP",
             ServiceType=(service.value if service is not None else None),
             PackagingType=provider_units.PackagingType.map(
                 packages.package_type or "your_packaging"
             ).value,
             VariationOptions=None,
             TotalWeight=FedexWeight(
@@ -295,15 +299,19 @@
                     ContentRecords=None,
                 )
                 for index, package in enumerate(packages, 1)
             ],
         ),
     )
 
-    return lib.Serializable(request, _request_serializer)
+    return lib.Serializable(
+        request,
+        _request_serializer,
+        dict(shipment_date=shipment_date),
+    )
 
 
 def _request_serializer(request: FedexRateRequest) -> str:
     namespacedef_ = (
         'xmlns:tns="http://schemas.xmlsoap.org/soap/envelope/"'
         ' xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"'
         ' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'
```

## karrio/providers/fedex/tracking.py

```diff
@@ -9,17 +9,18 @@
 estimated_date_formats = [
     "%Y-%m-%dT%H:%M:%S%z",
     "%Y-%m-%dT%H:%M:%S",
 ]
 
 
 def parse_tracking_response(
-    response: lib.Element,
+    _response: lib.Deserializable[lib.Element],
     settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.TrackingDetails], typing.List[models.Message]]:
+    response = _response.deserialize()
     track_details = response.xpath(".//*[local-name() = $name]", name="TrackDetails")
     tracking_details = [
         _extract_tracking(track_detail_node, settings)
         for track_detail_node in track_details
     ]
     return (
         [details for details in tracking_details if details is not None],
@@ -87,15 +88,15 @@
                 track_detail.TrackingNumber
             ),
             shipment_service=getattr(track_detail.Service, "Description", None),
             package_weight_unit=getattr(track_detail.PackageWeight, "Units", None),
             package_weight=lib.to_decimal(
                 getattr(track_detail.PackageWeight, "Value", None)
             ),
-            shipment_destication_country=getattr(
+            shipment_destination_country=getattr(
                 track_detail.ShipperAddress, "CountryCode", None
             ),
             shipment_origin_country=getattr(
                 track_detail.DestinationAddress, "CountryCode", None
             ),
         ),
     )
@@ -115,15 +116,15 @@
         None,
     )
 
 
 def tracking_request(
     payload: models.TrackingRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[fedex.TrackRequest]:
+) -> lib.Serializable:
     options = lib.units.Options(payload.options or {})
 
     request = fedex.TrackRequest(
         WebAuthenticationDetail=settings.webAuthenticationDetail,
         ClientDetail=settings.clientDetail,
         TransactionDetail=fedex.TransactionDetail(
             CustomerTransactionId="Track By Number_v18",
```

## karrio/providers/fedex/pickup/availability.py

```diff
@@ -21,15 +21,15 @@
     DF,
 )
 from karrio.providers.fedex.utils import Settings
 
 
 def pickup_availability_request(
     payload: PickupRequest, settings: Settings
-) -> Serializable[PickupAvailabilityRequest]:
+) -> Serializable:
     same_day = DF.date(payload.pickup_date).date() == datetime.today().date()
     address = lib.to_address(payload.address)
 
     request = PickupAvailabilityRequest(
         WebAuthenticationDetail=settings.webAuthenticationDetail,
         ClientDetail=settings.clientDetail,
         TransactionDetail=TransactionDetail(CustomerTransactionId="FTC"),
```

## karrio/providers/fedex/pickup/cancel.py

```diff
@@ -18,42 +18,39 @@
     apply_namespaceprefix,
     Envelope,
     Element,
     XP,
 )
 from karrio.providers.fedex.error import parse_error_response
 from karrio.providers.fedex.utils import Settings
+import karrio.lib as lib
 
 
 def parse_pickup_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     reply = XP.to_object(
         CancelPickupReply,
-        next(
-            iter(
-                response.xpath(".//*[local-name() = $name]", name="CancelPickupReply")
-            ),
-            None,
-        ),
+        lib.find_element("CancelPickupReply", response, first=True),
     )
     cancellation = ConfirmationDetails(
         carrier_id=settings.carrier_id,
         carrier_name=settings.carrier_name,
         success=reply.HighestSeverity == NotificationSeverityType.SUCCESS.value,
         operation="Cancel Pickup",
     )
 
     return cancellation, parse_error_response(response, settings)
 
 
 def pickup_cancel_request(
     payload: PickupCancelRequest, settings: Settings
-) -> Serializable[CancelPickupRequest]:
-
+) -> Serializable:
     request = CancelPickupRequest(
         WebAuthenticationDetail=settings.webAuthenticationDetail,
         ClientDetail=settings.clientDetail,
         TransactionDetail=TransactionDetail(CustomerTransactionId="FTC"),
         Version=VersionId(ServiceId="disp", Major=22, Intermediate=0, Minor=0),
         CarrierCode=CarrierCodeType.FDXE.value,
         PickupConfirmationNumber=payload.confirmation_number,
```

## karrio/providers/fedex/pickup/create.py

```diff
@@ -33,27 +33,24 @@
     DF,
     XP,
 )
 from karrio.providers.fedex.pickup.availability import pickup_availability_request
 from karrio.providers.fedex.utils import Settings
 from karrio.providers.fedex.units import PackagePresets
 from karrio.providers.fedex.error import parse_error_response
+import karrio.lib as lib
 
 
 def parse_pickup_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[PickupDetails, List[Message]]:
+    response = _response.deserialize()
     reply = XP.to_object(
         CreatePickupReply,
-        next(
-            iter(
-                response.xpath(".//*[local-name() = $name]", name="CreatePickupReply")
-            ),
-            None,
-        ),
+        lib.find_element("CreatePickupReply", response, first=True),
     )
     pickup = (
         _extract_pickup_details(reply, settings)
         if reply.HighestSeverity == NotificationSeverityType.SUCCESS.value
         else None
     )
     return pickup, parse_error_response(response, settings)
@@ -65,38 +62,34 @@
     return PickupDetails(
         carrier_id=settings.carrier_id,
         carrier_name=settings.carrier_name,
         confirmation_number=reply.PickupConfirmationNumber,
     )
 
 
-def pickup_request(
-    payload: PickupRequest, settings: Settings
-) -> Serializable[Pipeline]:
+def pickup_request(payload: PickupRequest, settings: Settings) -> Serializable:
     """
     Create a pickup request
     Steps
         1 - get availability
         2 - create pickup
     :param payload: PickupRequest
     :param settings: Settings
-    :return: Serializable[Pipeline]
+    :return: Serializable
     """
     request: Pipeline = Pipeline(
         get_availability=lambda *_: _get_availability(
             payload=payload, settings=settings
         ),
         create_pickup=partial(_create_pickup, payload=payload, settings=settings),
     )
     return Serializable(request)
 
 
-def _pickup_request(
-    payload: PickupRequest, settings: Settings
-) -> Serializable[CreatePickupRequest]:
+def _pickup_request(payload: PickupRequest, settings: Settings) -> Serializable:
     same_day = DF.date(payload.pickup_date).date() == datetime.today().date()
     packages = Packages(payload.parcels, PackagePresets, required=["weight"])
 
     request = CreatePickupRequest(
         WebAuthenticationDetail=settings.webAuthenticationDetail,
         ClientDetail=settings.clientDetail,
         TransactionDetail=TransactionDetail(CustomerTransactionId="FTC"),
```

## karrio/providers/fedex/pickup/update.py

```diff
@@ -20,24 +20,24 @@
 
 
 parse_pickup_update_response = parse_pickup_response
 
 
 def pickup_update_request(
     payload: PickupUpdateRequest, settings: Settings
-) -> Serializable[Pipeline]:
+) -> Serializable:
     """
     Create a pickup request
     Steps
         1 - get availability
         2 - create pickup
         3 - cancel old pickup
     :param payload: PickupUpdateRequest
     :param settings: Settings
-    :return: Serializable[Pipeline]
+    :return: Serializable
     """
     request: Pipeline = Pipeline(
         get_availability=lambda *_: _get_availability(
             payload=cast(PickupRequest, payload), settings=settings
         ),
         create_pickup=partial(_create_pickup, payload=payload, settings=settings),
         cancel_pickup=partial(
```

## karrio/providers/fedex/shipment/cancel.py

```diff
@@ -5,26 +5,28 @@
     TransactionDetail,
     VersionId,
     DeletionControlType,
     TrackingIdType,
 )
 from karrio.core.models import ShipmentCancelRequest, ConfirmationDetails, Message
 from karrio.core.utils import (
-    Envelope,
     Element,
     Serializable,
     create_envelope,
 )
 from karrio.providers.fedex.error import parse_error_response
 from karrio.providers.fedex.utils import Settings, default_request_serializer
+import karrio.lib as lib
 
 
 def parse_shipment_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
     success = len(errors) == 0
     confirmation: ConfirmationDetails = (
         ConfirmationDetails(
             carrier_id=settings.carrier_id,
             carrier_name=settings.carrier_name,
             success=success,
@@ -35,15 +37,15 @@
     )
 
     return confirmation, errors
 
 
 def shipment_cancel_request(
     payload: ShipmentCancelRequest, settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     tracking_type = next(
         (t for t in list(TrackingIdType) if t.name.lower() in payload.service),
         TrackingIdType.EXPRESS,
     ).value
     deletion_type = DeletionControlType[
         payload.options.get("deletion_type", "DELETE_ALL_PACKAGES")
     ].value
```

## karrio/providers/fedex/shipment/create.py

```diff
@@ -16,16 +16,18 @@
     "ON_EXCEPTION",
     "ON_SHIPMENT",
     "ON_TENDER",
 ]
 
 
 def parse_shipment_response(
-    response: lib.Element, settings: provider_utils.Settings
+    _response: lib.Deserializable[lib.Element],
+    settings: provider_utils.Settings,
 ) -> typing.Tuple[models.ShipmentDetails, typing.List[models.Message]]:
+    response = _response.deserialize()
     details = lib.find_element("CompletedPackageDetails", response)
     documents = lib.find_element("ShipmentDocuments", response)
 
     shipment = (
         _extract_details((details, documents), settings) if len(details) > 0 else None
     )
     return shipment, provider_error.parse_error_response(response, settings)
@@ -72,23 +74,23 @@
         shipment_identifier=master_id,
         docs=models.Documents(
             label=label,
             **({"invoice": invoice} if invoice else {}),
         ),
         meta=dict(
             carrier_tracking_link=settings.tracking_url.format(master_id),
-            tracking_numbers=tracking_numbers
+            tracking_numbers=tracking_numbers,
         ),
     )
 
 
 def shipment_request(
     payload: models.ShipmentRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[fedex.ProcessShipmentRequest]:
+) -> lib.Serializable:
     shipper = lib.to_address(payload.shipper)
     recipient = lib.to_address(payload.recipient)
     packages = lib.to_packages(
         payload.parcels,
         provider_units.PackagePresets,
         required=["weight"],
         package_option_type=provider_units.ShippingOption,
```

## Comparing `karrio.fedex-2023.3.3.dist-info/METADATA` & `karrio.fedex-2023.4.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: karrio.fedex
-Version: 2023.3.3
+Version: 2023.4
 Summary: Karrio - Fedex Shipping extension
 Home-page: https://github.com/karrioapi/karrio
 Author: karrio
 Author-email: hello@karrio.io
 License: Apache-2.0
 Platform: UNKNOWN
 Classifier: Intended Audience :: Developers
```

## Comparing `karrio.fedex-2023.3.3.dist-info/RECORD` & `karrio.fedex-2023.4.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 karrio/mappers/fedex/__init__.py,sha256=0eqxh-VThbuWAXivLzFlSftlInTo5fQ5aMReu4OKZ78,535
-karrio/mappers/fedex/mapper.py,sha256=nRPGSDViu3zxroXb0BAUDOC6-8J_a2Sj3uTjL2kEuwc,4267
-karrio/mappers/fedex/proxy.py,sha256=gDK-QVUxmNVx9RTJ8R3U-i8Z7luY7EaxWEjFV4HRsac,3807
-karrio/mappers/fedex/settings.py,sha256=wZV0Uqjb0_4Nu8koPyn-l7TL0Nv6CBllKMN5Rulwcpg,581
+karrio/mappers/fedex/mapper.py,sha256=LIOzi69-boBNKYcqURKrv1lLeCoG_cuq0Jx6mdaA-_I,3996
+karrio/mappers/fedex/proxy.py,sha256=08bxmfJH-Wg3_76LKfZDCF-qxtfba2PJDiOCeGtdAjA,3556
+karrio/mappers/fedex/settings.py,sha256=GDhqnw6z-DkT1s3-ytYT3IYAyt-mDYAr0SuOpnMq0S0,603
 karrio/providers/fedex/__init__.py,sha256=jdHaTk7oqsmI6C8_19mv5vwDGgvisBXaP87o-SnEMB0,833
-karrio/providers/fedex/address.py,sha256=HbgCxWRqPy-xMwiC9jNxp91Khapp9RBhITvFwTzl0R8,4625
-karrio/providers/fedex/document.py,sha256=Pt6Y04aoeGSdUUH4BgIcZ19wyTJUnCXpfW8GPpX-JRo,4338
+karrio/providers/fedex/address.py,sha256=6HcOOA6k6-wX-cCueDLCrz90cm0ebLgrvmcMGo0Tyw0,4558
+karrio/providers/fedex/document.py,sha256=sdwV3DfMXdIj8kLzHX65jwetrha-C2JVNi1UDRNQXgo,4414
 karrio/providers/fedex/error.py,sha256=ilLswzwO1GktrRylZZl7sfxzlXinjOmHrrx35tfrU8I,1074
-karrio/providers/fedex/rate.py,sha256=WJNBuF9s6qDqEN7HqY85bAljq4QoD_MUi4h-LKWIleM,12201
-karrio/providers/fedex/tracking.py,sha256=AjMAxLREPvl1BVkgSqOIGqHcT48wuzdJk990ouVQngc,6201
+karrio/providers/fedex/rate.py,sha256=Pkl_YVQDQKQH9KdYMUzEKFWUb6h0AmF66jGYG3UcbnI,12452
+karrio/providers/fedex/tracking.py,sha256=3XHpIyPVbD7aGWNWKGvKxOQG2a3DDNdcoJT1Ygz8r8w,6241
 karrio/providers/fedex/units.py,sha256=zb9WOvF-DJhKnj_yqTDz-mUpVmzKOkDzvfAmRN_dSRo,19457
 karrio/providers/fedex/utils.py,sha256=lzhiOwr0Wlwd2bv_aJ9joyYRVp3JiK5izloAbgL_XSU,1753
 karrio/providers/fedex/pickup/__init__.py,sha256=zYavrB_GHWEjNyebHSBjqI4gRMOhd2BYr67ivmxxK4o,289
-karrio/providers/fedex/pickup/availability.py,sha256=4s2hjQoYIODrcgqFA1V4KGbr8JffAoNRzNgYzIUlySc,2666
-karrio/providers/fedex/pickup/cancel.py,sha256=Vu0ykz2rk1tm-_mPuruYUIZtsy-37Ms9qeCUDJP54Uc,2663
-karrio/providers/fedex/pickup/create.py,sha256=bMhhe5da3SyYHtwrgySSLiCZ5wWVMFr6SYgp-UPp-yM,6212
-karrio/providers/fedex/pickup/update.py,sha256=gR5YkC9QZksCeGlBh_i0E2yoEZOMtWJWCLkPUdM2IN4,2077
+karrio/providers/fedex/pickup/availability.py,sha256=7iXhL2jaojeJqS7A0JhawgtgifkIuk0szcHxemB5HEI,2639
+karrio/providers/fedex/pickup/cancel.py,sha256=QV9913sqGSGHjNUVzwDNp_LhhtHZjxWhEObgoqwNN14,2637
+karrio/providers/fedex/pickup/create.py,sha256=KYif9AooxuOd9VmPfSJHNdSiRWVNve-YSx3fMmteHPc,6150
+karrio/providers/fedex/pickup/update.py,sha256=bJFvCYLFKNCBFZVgrfiOj_Zeines-VrdTxt2UtSbIHA,2057
 karrio/providers/fedex/shipment/__init__.py,sha256=dBO2yZUpISVe-H4Cvf8WZmOuPgxZlGsW4u145ly5gpA,226
-karrio/providers/fedex/shipment/cancel.py,sha256=JKAY5cxmpS1o_t5vMd89_t5jb4S2xh4fM697asMSEqA,2291
-karrio/providers/fedex/shipment/create.py,sha256=chTeG9K8tyZ3BErj-LxhlpXnSK6KyRWiP3eFy6n45LE,31254
-karrio.fedex-2023.3.3.dist-info/METADATA,sha256=TQXuHOX4b0-3ua003SU4IOgfoBqo66vFPrBj6_dmUZ4,969
-karrio.fedex-2023.3.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-karrio.fedex-2023.3.3.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
-karrio.fedex-2023.3.3.dist-info/RECORD,,
+karrio/providers/fedex/shipment/cancel.py,sha256=pjO0oiljqS9_icV4S9GXfarKRfS6VyWXaThdJhw2_bc,2357
+karrio/providers/fedex/shipment/create.py,sha256=r-DwMwwjmpt3j9dXYtIQP06TEmsG2JvHIgdo68rpZUE,31290
+karrio.fedex-2023.4.dist-info/METADATA,sha256=QXg6DDpC1vFoGBJhiN_WQpwwjclPFiyWT_VX_RZbsiA,967
+karrio.fedex-2023.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+karrio.fedex-2023.4.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
+karrio.fedex-2023.4.dist-info/RECORD,,
```

