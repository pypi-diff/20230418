# Comparing `tmp/karrio.purolator-2023.3-py3-none-any.whl.zip` & `tmp/karrio.purolator-2023.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 24469 bytes, number of entries: 24
+Zip file size: 24527 bytes, number of entries: 24
 -rw-rw-r--  2.0 unx      563 b- defN 22-Nov-15 19:21 karrio/mappers/purolator/__init__.py
--rw-rw-r--  2.0 unx     4066 b- defN 22-Nov-15 19:21 karrio/mappers/purolator/mapper.py
--rw-rw-r--  2.0 unx     4982 b- defN 22-Nov-15 19:21 karrio/mappers/purolator/proxy.py
--rw-rw-r--  2.0 unx      482 b- defN 22-Nov-15 19:21 karrio/mappers/purolator/settings.py
+-rw-rw-r--  2.0 unx     3881 b- defN 23-Apr-01 13:34 karrio/mappers/purolator/mapper.py
+-rw-rw-r--  2.0 unx     4858 b- defN 23-Apr-01 13:38 karrio/mappers/purolator/proxy.py
+-rw-rw-r--  2.0 unx      504 b- defN 23-Apr-15 06:44 karrio/mappers/purolator/settings.py
 -rw-rw-r--  2.0 unx      689 b- defN 22-Nov-15 19:21 karrio/providers/purolator/__init__.py
--rw-rw-r--  2.0 unx     2713 b- defN 22-Nov-15 19:21 karrio/providers/purolator/address.py
+-rw-rw-r--  2.0 unx     2624 b- defN 23-Apr-01 15:18 karrio/providers/purolator/address.py
 -rw-rw-r--  2.0 unx      940 b- defN 22-Nov-15 19:21 karrio/providers/purolator/error.py
--rw-rw-r--  2.0 unx    12662 b- defN 23-Mar-25 14:43 karrio/providers/purolator/rate.py
--rw-rw-r--  2.0 unx     3098 b- defN 23-Mar-25 11:42 karrio/providers/purolator/tracking.py
--rw-rw-r--  2.0 unx     8863 b- defN 23-Mar-25 13:59 karrio/providers/purolator/units.py
--rw-rw-r--  2.0 unx     1532 b- defN 23-Mar-25 12:48 karrio/providers/purolator/utils.py
+-rw-rw-r--  2.0 unx    12666 b- defN 23-Apr-01 15:18 karrio/providers/purolator/rate.py
+-rw-rw-r--  2.0 unx     3145 b- defN 23-Apr-01 15:18 karrio/providers/purolator/tracking.py
+-rw-rw-r--  2.0 unx     8863 b- defN 23-Mar-27 07:55 karrio/providers/purolator/units.py
+-rw-rw-r--  2.0 unx     1532 b- defN 23-Apr-15 02:55 karrio/providers/purolator/utils.py
 -rw-rw-r--  2.0 unx      301 b- defN 22-Nov-15 19:21 karrio/providers/purolator/pickup/__init__.py
--rw-rw-r--  2.0 unx     1530 b- defN 22-Nov-15 19:21 karrio/providers/purolator/pickup/cancel.py
--rw-rw-r--  2.0 unx     5777 b- defN 23-Mar-25 14:45 karrio/providers/purolator/pickup/create.py
--rw-rw-r--  2.0 unx     3347 b- defN 22-Nov-15 19:21 karrio/providers/purolator/pickup/update.py
--rw-rw-r--  2.0 unx     3714 b- defN 23-Mar-25 14:47 karrio/providers/purolator/pickup/validate.py
+-rw-rw-r--  2.0 unx     1599 b- defN 23-Apr-01 15:18 karrio/providers/purolator/pickup/cancel.py
+-rw-rw-r--  2.0 unx     5763 b- defN 23-Apr-01 15:18 karrio/providers/purolator/pickup/create.py
+-rw-rw-r--  2.0 unx     3387 b- defN 23-Apr-01 15:18 karrio/providers/purolator/pickup/update.py
+-rw-rw-r--  2.0 unx     3659 b- defN 23-Apr-01 13:47 karrio/providers/purolator/pickup/validate.py
 -rw-rw-r--  2.0 unx      208 b- defN 22-Nov-15 19:21 karrio/providers/purolator/shipment/__init__.py
--rw-rw-r--  2.0 unx     1653 b- defN 22-Nov-15 19:21 karrio/providers/purolator/shipment/cancel.py
--rw-rw-r--  2.0 unx    17181 b- defN 23-Mar-25 14:49 karrio/providers/purolator/shipment/create.py
--rw-rw-r--  2.0 unx     2374 b- defN 22-Nov-18 03:17 karrio/providers/purolator/shipment/documents.py
--rw-rw-r--  2.0 unx     1004 b- defN 23-Mar-27 07:12 karrio.purolator-2023.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Mar-27 07:12 karrio.purolator-2023.3.dist-info/WHEEL
--rw-rw-r--  2.0 unx        7 b- defN 23-Mar-27 07:12 karrio.purolator-2023.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2268 b- defN 23-Mar-27 07:12 karrio.purolator-2023.3.dist-info/RECORD
-24 files, 80046 bytes uncompressed, 20697 bytes compressed:  74.1%
+-rw-rw-r--  2.0 unx     1717 b- defN 23-Apr-01 15:18 karrio/providers/purolator/shipment/cancel.py
+-rw-rw-r--  2.0 unx    17069 b- defN 23-Apr-01 15:18 karrio/providers/purolator/shipment/create.py
+-rw-rw-r--  2.0 unx     2402 b- defN 23-Apr-01 13:36 karrio/providers/purolator/shipment/documents.py
+-rw-rw-r--  2.0 unx     1004 b- defN 23-Apr-18 07:10 karrio.purolator-2023.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-Apr-18 07:10 karrio.purolator-2023.4.dist-info/WHEEL
+-rw-rw-r--  2.0 unx        7 b- defN 23-Apr-18 07:10 karrio.purolator-2023.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2268 b- defN 23-Apr-18 07:10 karrio.purolator-2023.4.dist-info/RECORD
+24 files, 79741 bytes uncompressed, 20755 bytes compressed:  74.0%
```

## zipnote {}

```diff
@@ -54,20 +54,20 @@
 
 Filename: karrio/providers/purolator/shipment/create.py
 Comment: 
 
 Filename: karrio/providers/purolator/shipment/documents.py
 Comment: 
 
-Filename: karrio.purolator-2023.3.dist-info/METADATA
+Filename: karrio.purolator-2023.4.dist-info/METADATA
 Comment: 
 
-Filename: karrio.purolator-2023.3.dist-info/WHEEL
+Filename: karrio.purolator-2023.4.dist-info/WHEEL
 Comment: 
 
-Filename: karrio.purolator-2023.3.dist-info/top_level.txt
+Filename: karrio.purolator-2023.4.dist-info/top_level.txt
 Comment: 
 
-Filename: karrio.purolator-2023.3.dist-info/RECORD
+Filename: karrio.purolator-2023.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## karrio/mappers/purolator/mapper.py

```diff
@@ -6,15 +6,14 @@
     ShipmentCancelRequest,
     PickupUpdateRequest,
     PickupCancelRequest,
     ShipmentRequest,
     TrackingRequest,
     PickupRequest,
     RateRequest,
-
     AddressValidationDetails,
     ConfirmationDetails,
     TrackingDetails,
     ShipmentDetails,
     PickupDetails,
     RateDetails,
     Message,
@@ -24,15 +23,14 @@
     parse_pickup_update_response,
     parse_pickup_cancel_response,
     parse_tracking_response,
     parse_pickup_response,
     parse_shipment_cancel_response,
     parse_shipment_response,
     parse_rate_response,
-
     address_validation_request,
     pickup_update_request,
     pickup_cancel_request,
     tracking_request,
     pickup_request,
     shipment_cancel_request,
     shipment_request,
@@ -40,86 +38,78 @@
 )
 from karrio.mappers.purolator.settings import Settings
 
 
 class Mapper(BaseMapper):
     settings: Settings
 
-    def create_address_validation_request(self, payload: AddressValidationRequest) -> Serializable:
+    def create_address_validation_request(
+        self, payload: AddressValidationRequest
+    ) -> Serializable:
         return address_validation_request(payload, self.settings)
 
-    def create_rate_request(
-        self, payload: RateRequest
-    ) -> Serializable:
+    def create_rate_request(self, payload: RateRequest) -> Serializable:
         return rate_request(payload, self.settings)
 
-    def create_tracking_request(
-        self, payload: TrackingRequest
-    ) -> Serializable:
+    def create_tracking_request(self, payload: TrackingRequest) -> Serializable:
         return tracking_request(payload, self.settings)
 
-    def create_shipment_request(
-        self, payload: ShipmentRequest
-    ) -> Serializable:
+    def create_shipment_request(self, payload: ShipmentRequest) -> Serializable:
         return shipment_request(payload, self.settings)
 
-    def create_pickup_request(
-        self, payload: PickupRequest
-    ) -> Serializable:
+    def create_pickup_request(self, payload: PickupRequest) -> Serializable:
         return pickup_request(payload, self.settings)
 
     def create_pickup_update_request(
         self, payload: PickupUpdateRequest
     ) -> Serializable:
         return pickup_update_request(payload, self.settings)
 
     def create_cancel_pickup_request(
         self, payload: PickupCancelRequest
     ) -> Serializable:
         return pickup_cancel_request(payload, self.settings)
 
-    def create_cancel_shipment_request(self, payload: ShipmentCancelRequest) -> Serializable[str]:
+    def create_cancel_shipment_request(
+        self, payload: ShipmentCancelRequest
+    ) -> Serializable:
         return shipment_cancel_request(payload, self.settings)
 
-    
-
-
     def parse_address_validation_response(
         self, response: Deserializable
     ) -> Tuple[AddressValidationDetails, List[Message]]:
-        return parse_address_validation_response(response.deserialize(), self.settings)
+        return parse_address_validation_response(response, self.settings)
 
     def parse_cancel_pickup_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[ConfirmationDetails, List[Message]]:
-        return parse_pickup_cancel_response(response.deserialize(), self.settings)
+        return parse_pickup_cancel_response(response, self.settings)
 
     def parse_cancel_shipment_response(
         self, response: Deserializable
     ) -> Tuple[ConfirmationDetails, List[Message]]:
-        return parse_shipment_cancel_response(response.deserialize(), self.settings)
+        return parse_shipment_cancel_response(response, self.settings)
 
     def parse_pickup_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[PickupDetails, List[Message]]:
-        return parse_pickup_response(response.deserialize(), self.settings)
+        return parse_pickup_response(response, self.settings)
 
     def parse_pickup_update_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[PickupDetails, List[Message]]:
-        return parse_pickup_update_response(response.deserialize(), self.settings)
+        return parse_pickup_update_response(response, self.settings)
 
     def parse_rate_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[List[RateDetails], List[Message]]:
-        return parse_rate_response(response.deserialize(), self.settings)
+        return parse_rate_response(response, self.settings)
 
     def parse_shipment_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[ShipmentDetails, List[Message]]:
-        return parse_shipment_response(response.deserialize(), self.settings)
+        return parse_shipment_response(response, self.settings)
 
     def parse_tracking_response(
-        self, response: Deserializable[str]
+        self, response: Deserializable
     ) -> Tuple[List[TrackingDetails], List[Message]]:
-        return parse_tracking_response(response.deserialize(), self.settings)
-
+        return parse_tracking_response(response, self.settings)
```

## karrio/mappers/purolator/proxy.py

```diff
@@ -8,57 +8,55 @@
 
 logger = logging.getLogger(__name__)
 
 
 class Proxy(BaseProxy):
     settings: Settings
 
-    def _send_request(
-        self, path: str, soapaction: str, request: Serializable[Any]
-    ) -> str:
+    def _send_request(self, path: str, soapaction: str, request: Serializable) -> str:
         return http(
             url=f"{self.settings.server_url}{path}",
             data=request.serialize(),
             trace=self.trace_as("xml"),
             method="POST",
             headers={
                 "Content-Type": "text/xml; charset=utf-8",
                 "soapaction": soapaction,
                 "Authorization": f"Basic {self.settings.authorization}",
             },
         )
 
-    def validate_address(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def validate_address(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/EWS/V2/ServiceAvailability/ServiceAvailabilityService.asmx",
             soapaction="http://purolator.com/pws/service/v2/ValidateCityPostalCodeZip",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def get_rates(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def get_rates(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/EWS/V2/Estimating/EstimatingService.asmx",
             soapaction="http://purolator.com/pws/service/v2/GetFullEstimate",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def get_tracking(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def get_tracking(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/PWS/V1/Tracking/TrackingService.asmx",
             soapaction="http://purolator.com/pws/service/v1/TrackPackagesByPin",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def create_shipment(self, request: Serializable[Pipeline]) -> Deserializable[str]:
+    def create_shipment(self, request: Serializable) -> Deserializable:
         def process(job: Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request(
                 request=job.data,
                 path=dict(
@@ -80,15 +78,15 @@
             path="/EWS/V2/Shipping/ShippingService.asmx",
             soapaction="http://purolator.com/pws/service/v2/VoidShipment",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
 
-    def schedule_pickup(self, request: Serializable[Pipeline]) -> Deserializable[str]:
+    def schedule_pickup(self, request: Serializable) -> Deserializable:
         def process(job: Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request(
                 path="/EWS/V1/PickUp/PickUpService.asmx",
                 request=job.data,
@@ -99,15 +97,15 @@
             )
 
         pipeline: Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return Deserializable(XP.bundle_xml(response), XP.to_xml)
 
-    def modify_pickup(self, request: Serializable[Pipeline]) -> Deserializable[str]:
+    def modify_pickup(self, request: Serializable) -> Deserializable:
         def process(job: Job):
             if job.data is None:
                 return job.fallback
 
             return self._send_request(
                 path="/EWS/V1/PickUp/PickUpService.asmx",
                 request=job.data,
@@ -118,15 +116,15 @@
             )
 
         pipeline: Pipeline = request.serialize()
         response = pipeline.apply(process)
 
         return Deserializable(XP.bundle_xml(response), XP.to_xml)
 
-    def cancel_pickup(self, request: Serializable[Envelope]) -> Deserializable[str]:
+    def cancel_pickup(self, request: Serializable) -> Deserializable:
         response = self._send_request(
             path="/EWS/V1/PickUp/PickUpService.asmx",
             soapaction="http://purolator.com/pws/service/v1/VoidPickUp",
             request=request,
         )
 
         return Deserializable(response, XP.to_xml)
```

## karrio/mappers/purolator/settings.py

```diff
@@ -14,7 +14,8 @@
     user_token: str = None
 
     id: str = None
     test_mode: bool = False
     carrier_id: str = "purolator"
     account_country_code: str = "CA"
     metadata: dict = {}
+    config: dict = {}
```

## karrio/providers/purolator/address.py

```diff
@@ -2,40 +2,34 @@
 from purolator_lib.service_availability_service_2_0_2 import (
     ValidateCityPostalCodeZipRequest,
     ValidateCityPostalCodeZipResponse,
     ArrayOfShortAddress,
     ShortAddress,
     RequestContext,
 )
-from karrio.core.utils import Serializable, Element, create_envelope, Envelope, XP
+from karrio.core.utils import Serializable, Element, create_envelope, XP
 from karrio.core.models import (
     AddressValidationRequest,
     Message,
     AddressValidationDetails,
     Address,
 )
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
 from karrio.providers.purolator.error import parse_error_response
+import karrio.lib as lib
 
 
 def parse_address_validation_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[AddressValidationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
     reply = XP.to_object(
         ValidateCityPostalCodeZipResponse,
-        next(
-            iter(
-                response.xpath(
-                    ".//*[local-name() = $name]",
-                    name="ValidateCityPostalCodeZipResponse",
-                )
-            ),
-            None,
-        ),
+        lib.find_element("ValidateCityPostalCodeZipResponse", response, first=True),
     )
     address: ShortAddress = next(
         (result.Address for result in reply.SuggestedAddresses.SuggestedAddress), None
     )
     success = len(errors) == 0
     validation_details = (
         AddressValidationDetails(
@@ -56,16 +50,15 @@
     )
 
     return validation_details, errors
 
 
 def address_validation_request(
     payload: AddressValidationRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+) -> Serializable:
     request = create_envelope(
         header_content=RequestContext(
             Version="2.1",
             Language=settings.language,
             GroupID="",
             RequestReference="",
             UserToken=settings.user_token,
```

## karrio/providers/purolator/rate.py

```diff
@@ -17,32 +17,32 @@
     TotalWeight,
     ShipmentEstimate,
     PickupType,
     PhoneNumber,
     PaymentInformation,
     PaymentType,
     InternationalInformation,
-    DutyInformation,
-    BusinessRelationship,
     ArrayOfOptionIDValuePair,
     OptionIDValuePair,
 )
 
 import typing
 import karrio.lib as lib
 import karrio.core.units as units
 import karrio.core.models as models
 import karrio.providers.purolator.error as provider_error
 import karrio.providers.purolator.units as provider_units
 import karrio.providers.purolator.utils as provider_utils
 
 
 def parse_rate_response(
-    response: lib.Element, settings: provider_utils.Settings
+    _response: lib.Deserializable[lib.Element],
+    settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.RateDetails], typing.List[models.Message]]:
+    response = _response.deserialize()
     estimates = lib.find_element("ShipmentEstimate", response)
     return (
         [_extract_rate(node, settings) for node in estimates],
         provider_error.parse_error_response(response, settings),
     )
 
 
@@ -84,15 +84,15 @@
         meta=dict(service_name=service.name_or_key),
     )
 
 
 def rate_request(
     payload: models.RateRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[lib.Envelope]:
+) -> lib.Serializable:
     shipper = lib.to_address(payload.shipper)
     recipient = lib.to_address(payload.recipient)
     packages = lib.to_packages(
         payload.parcels,
         provider_units.PackagePresets,
         required=["weight"],
     )
```

## karrio/providers/purolator/tracking.py

```diff
@@ -4,17 +4,18 @@
 import karrio.core.models as models
 import karrio.providers.purolator.error as error
 import karrio.providers.purolator.utils as provider_utils
 import karrio.providers.purolator.units as provider_units
 
 
 def parse_tracking_response(
-    response: lib.Element,
+    _response: lib.Deserializable[lib.Element],
     settings: provider_utils.Settings,
 ) -> typing.Tuple[typing.List[models.TrackingDetails], typing.List[models.Message]]:
+    response = _response.deserialize()
     track_infos = lib.find_element("TrackingInformation", response)
     return (
         [_extract_details(node, settings) for node in track_infos],
         error.parse_error_response(response, settings),
     )
 
 
@@ -47,22 +48,22 @@
                 location=scan.Depot.Name,
                 code=scan.ScanType,
             )
             for scan in track.Scans.Scan
         ],
         info=models.TrackingInfo(
             carrier_tracking_link=settings.tracking_url.format(track.PIN.Value)
-        )
+        ),
     )
 
 
 def tracking_request(
     payload: models.TrackingRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[lib.Envelope]:
+) -> lib.Serializable:
     request = lib.Envelope(
         Header=lib.Header(
             purolator.RequestContext(
                 Version="1.2",
                 Language=settings.language,
                 GroupID="",
                 RequestReference="",
```

## karrio/providers/purolator/pickup/cancel.py

```diff
@@ -5,22 +5,25 @@
     RequestContext,
 )
 from karrio.core.models import (
     PickupCancelRequest,
     ConfirmationDetails,
     Message,
 )
-from karrio.core.utils import Serializable, create_envelope, Envelope, Element
+from karrio.core.utils import Serializable, create_envelope, Element
 from karrio.providers.purolator.error import parse_error_response
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
+import karrio.lib as lib
 
 
 def parse_pickup_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     errors = parse_error_response(response, settings)
     cancellation = (
         ConfirmationDetails(
             carrier_id=settings.carrier_id,
             carrier_name=settings.carrier_name,
             success=True,
             operation="Cancel Pickup",
@@ -30,16 +33,15 @@
     )
 
     return cancellation, errors
 
 
 def pickup_cancel_request(
     payload: PickupCancelRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+) -> Serializable:
     request = create_envelope(
         header_content=RequestContext(
             Version="1.2",
             Language=settings.language,
             GroupID="",
             RequestReference="",
             UserToken=settings.user_token,
```

## karrio/providers/purolator/pickup/create.py

```diff
@@ -18,30 +18,31 @@
     PickupRequest,
     PickupDetails,
     Message,
 )
 from karrio.core.utils import (
     Serializable,
     create_envelope,
-    Envelope,
     Element,
     Pipeline,
     Job,
-    SF,
     XP,
 )
 from karrio.providers.purolator.pickup.validate import validate_pickup_request
 from karrio.providers.purolator.error import parse_error_response
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
 from karrio.providers.purolator.units import PackagePresets
+import karrio.lib as lib
 
 
 def parse_pickup_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element],
+    settings: Settings,
 ) -> Tuple[PickupDetails, List[Message]]:
+    response = _response.deserialize()
     reply = XP.find(
         "SchedulePickUpResponse", response, SchedulePickUpResponse, first=True
     )
     pickup = (
         _extract_pickup_details(reply, settings)
         if reply is not None and reply.PickUpConfirmationNumber is not None
         else None
@@ -49,55 +50,52 @@
 
     return pickup, parse_error_response(response, settings)
 
 
 def _extract_pickup_details(
     reply: SchedulePickUpResponse, settings: Settings
 ) -> PickupDetails:
-
     return PickupDetails(
         carrier_id=settings.carrier_id,
         carrier_name=settings.carrier_name,
         confirmation_number=reply.PickUpConfirmationNumber,
     )
 
 
-def pickup_request(
-    payload: PickupRequest, settings: Settings
-) -> Serializable[Pipeline]:
+def pickup_request(payload: PickupRequest, settings: Settings) -> Serializable:
     """
     Create a pickup request
     Steps
         1 - validate
         2 - create pickup
     :param payload: PickupRequest
     :param settings: Settings
-    :return: Serializable[Pipeline]
+    :return: Serializable
     """
     request: Pipeline = Pipeline(
         validate=lambda *_: _validate_pickup(payload=payload, settings=settings),
         schedule=partial(_schedule_pickup, payload=payload, settings=settings),
     )
 
     return Serializable(request)
 
 
 def _schedule_pickup_request(
     payload: Union[PickupRequest, PickupUpdateRequest], settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     """
     Create a serializable typed Envelope containing a SchedulePickUpRequest
 
     Options:
         - LoadingDockAvailable
         - TrailerAccessible
 
     :param payload: PickupRequest
     :param settings: Settings
-    :return: Serializable[PickupRequest]
+    :return: Serializable
     """
     address = lib.to_address(payload.address)
     packages = Packages(payload.parcels, PackagePresets, required=["weight"])
     phone = Phone(address.phone_number, address.country_code or "CA")
     request = create_envelope(
         header_content=RequestContext(
             Version="1.2",
@@ -148,17 +146,15 @@
                     AreaCode=phone.area_code or "0",
                     Phone=phone.phone or "0",
                     Extension=None,
                 ),
                 FaxNumber=None,
             ),
             ShipmentSummary=None,
-            NotificationEmails=NotificationEmails(
-                NotificationEmail=[address.email]
-            ),
+            NotificationEmails=NotificationEmails(NotificationEmail=[address.email]),
         ),
     )
 
     return Serializable(request, partial(standard_request_serializer, version="v1"))
 
 
 def _validate_pickup(
```

## karrio/providers/purolator/pickup/update.py

```diff
@@ -6,72 +6,72 @@
     ModifyPickUpResponse,
     RequestContext,
 )
 from karrio.core.models import PickupUpdateRequest, PickupDetails, Message
 from karrio.core.utils import (
     Serializable,
     create_envelope,
-    Envelope,
+    Pipeline,
     Element,
     XP,
-    Pipeline,
     Job,
 )
 from karrio.providers.purolator.pickup.create import _validate_pickup
 from karrio.providers.purolator.error import parse_error_response
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
+import karrio.lib as lib
 
 
 def parse_pickup_update_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[PickupDetails, List[Message]]:
+    response = _response.deserialize()
     reply = XP.find("ModifyPickUpResponse", response, ModifyPickUpResponse, first=True)
     pickup = (
         _extract_pickup_details(reply, settings)
         if reply is not None and reply.PickUpConfirmationNumber is not None
         else None
     )
 
     return pickup, parse_error_response(response, settings)
 
 
 def _extract_pickup_details(
     reply: ModifyPickUpResponse, settings: Settings
 ) -> PickupDetails:
-
     return PickupDetails(
         carrier_id=settings.carrier_id,
         carrier_name=settings.carrier_name,
         confirmation_number=reply.PickUpConfirmationNumber,
     )
 
 
 def pickup_update_request(
     payload: PickupUpdateRequest, settings: Settings
-) -> Serializable[Pipeline]:
+) -> Serializable:
     """
     Modify a pickup request
     Steps
         1 - validate
         2 - modify pickup
     :param payload: PickupUpdateRequest
     :param settings: Settings
-    :return: Serializable[Pipeline]
+    :return: Serializable
     """
     request: Pipeline = Pipeline(
         validate=lambda *_: _validate_pickup(payload=payload, settings=settings),
         modify=partial(_modify_pickup, payload=payload, settings=settings),
     )
 
     return Serializable(request)
 
 
 def _modify_pickup_request(
     payload: PickupUpdateRequest, settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     request = create_envelope(
         header_content=RequestContext(
             Version="1.2",
             Language=settings.language,
             GroupID="",
             RequestReference="",
             UserToken=settings.user_token,
```

## karrio/providers/purolator/pickup/validate.py

```diff
@@ -16,25 +16,25 @@
 from karrio.core.utils import Serializable, create_envelope, Envelope, SF
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
 from karrio.providers.purolator.units import PackagePresets
 
 
 def validate_pickup_request(
     payload: Union[PickupRequest, PickupUpdateRequest], settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     """
     Create a serializable typed Envelope containing a ValidatePickUpRequest
 
     Options:
         - LoadingDockAvailable
         - TrailerAccessible
 
     :param payload: PickupRequest
     :param settings: Settings
-    :return: Serializable[PickupRequest]
+    :return: Serializable
     """
     address = lib.to_address(payload.address)
     packages = Packages(payload.parcels, PackagePresets, required=["weight"])
     phone = Phone(address.phone_number, address.country_code or "CA")
     request = create_envelope(
         header_content=RequestContext(
             Version="1.2",
@@ -85,14 +85,12 @@
                     AreaCode=phone.area_code or "0",
                     Phone=phone.phone or "0",
                     Extension=None,
                 ),
                 FaxNumber=None,
             ),
             ShipmentSummary=None,
-            NotificationEmails=NotificationEmails(
-                NotificationEmail=[address.email]
-            ),
+            NotificationEmails=NotificationEmails(NotificationEmail=[address.email]),
         ),
     )
 
     return Serializable(request, partial(standard_request_serializer, version="v1"))
```

## karrio/providers/purolator/shipment/cancel.py

```diff
@@ -6,22 +6,24 @@
     PIN,
 )
 from karrio.core.models import (
     ShipmentCancelRequest,
     ConfirmationDetails,
     Message,
 )
-from karrio.core.utils import Serializable, create_envelope, Envelope, Element, XP
+from karrio.core.utils import Serializable, create_envelope, Element, XP
 from karrio.providers.purolator.error import parse_error_response
 from karrio.providers.purolator.utils import Settings, standard_request_serializer
+import karrio.lib as lib
 
 
 def parse_shipment_cancel_response(
-    response: Element, settings: Settings
+    _response: lib.Deserializable[Element], settings: Settings
 ) -> Tuple[ConfirmationDetails, List[Message]]:
+    response = _response.deserialize()
     void_response = XP.find(
         "VoidShipmentResponse", response, VoidShipmentResponse, first=True
     )
     voided = void_response is not None and void_response.ShipmentVoided
     cancellation = (
         ConfirmationDetails(
             carrier_id=settings.carrier_id,
@@ -34,16 +36,15 @@
     )
 
     return cancellation, parse_error_response(response, settings)
 
 
 def shipment_cancel_request(
     payload: ShipmentCancelRequest, settings: Settings
-) -> Serializable[Envelope]:
-
+) -> Serializable:
     request = create_envelope(
         header_content=RequestContext(
             Version="2.0",
             Language=settings.language,
             GroupID="",
             RequestReference="",
             UserToken=settings.user_token,
```

## karrio/providers/purolator/shipment/create.py

```diff
@@ -39,16 +39,17 @@
 import karrio.providers.purolator.error as provider_error
 import karrio.providers.purolator.units as provider_units
 import karrio.providers.purolator.utils as provider_utils
 import karrio.providers.purolator.shipment.documents as documents
 
 
 def parse_shipment_response(
-    response: lib.Element, settings: provider_utils.Settings
+    _response: lib.Deserializable[lib.Element], settings: provider_utils.Settings
 ) -> typing.Tuple[models.ShipmentDetails, typing.List[models.Message]]:
+    response = _response.deserialize()
     pin = lib.find_element("ShipmentPIN", response, PIN, first=True)
     shipment = (
         _extract_shipment(response, settings)
         if (getattr(pin, "Value", None) is not None)
         else None
     )
 
@@ -81,30 +82,30 @@
         ),
     )
 
 
 def shipment_request(
     payload: models.ShipmentRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[lib.Pipeline]:
+) -> lib.Serializable:
     requests: lib.Pipeline = lib.Pipeline(
         create=lambda *_: functools.partial(
             _create_shipment, payload=payload, settings=settings
         )(),
         document=functools.partial(
             _get_shipment_label, payload=payload, settings=settings
         ),
     )
     return lib.Serializable(requests)
 
 
 def _shipment_request(
     payload: models.ShipmentRequest,
     settings: provider_utils.Settings,
-) -> lib.Serializable[lib.Envelope]:
+) -> lib.Serializable:
     shipper = lib.to_address(payload.shipper)
     recipient = lib.to_address(payload.recipient)
     packages = lib.to_packages(
         payload.parcels,
         provider_units.PackagePresets,
         required=["weight"],
     )
@@ -186,18 +187,15 @@
                             CountryCode=recipient_phone_number.country_code or "0",
                             AreaCode=recipient_phone_number.area_code or "0",
                             Phone=recipient_phone_number.phone or "0",
                             Extension=None,
                         ),
                         FaxNumber=None,
                     ),
-                    TaxNumber=(
-                        recipient.federal_tax_id
-                        or recipient.state_tax_id
-                    ),
+                    TaxNumber=(recipient.federal_tax_id or recipient.state_tax_id),
                 ),
                 FromOnLabelIndicator=None,
                 FromOnLabelInformation=None,
                 ShipmentDate=options.shipment_date.state,
                 PackageInformation=PackageInformation(
                     ServiceID=service,
                     Description=(
@@ -350,22 +348,19 @@
                 ),
                 PickupInformation=PickupInformation(
                     PickupType=PickupType.DROP_OFF.value
                 ),
                 NotificationInformation=(
                     NotificationInformation(
                         ConfirmationEmailAddress=(
-                            options.email_notification_to.state
-                            or recipient.email
+                            options.email_notification_to.state or recipient.email
                         )
                     )
                     if options.email_notification.state
-                    and any(
-                        [options.email_notification_to.state, recipient.email]
-                    )
+                    and any([options.email_notification_to.state, recipient.email])
                     else None
                 ),
                 TrackingReferenceInformation=(
                     TrackingReferenceInformation(Reference1=payload.reference)
                     if any(payload.reference or "")
                     else None
                 ),
```

## karrio/providers/purolator/shipment/documents.py

```diff
@@ -11,24 +11,26 @@
 from karrio.core.utils import Serializable, XP, SF
 from karrio.providers.purolator.units import PrintType
 from karrio.providers.purolator.utils import Settings
 
 
 def get_shipping_documents_request(
     pin: str, payload: ShipmentRequest, settings: Settings
-) -> Serializable[Envelope]:
+) -> Serializable:
     is_international = payload.shipper.country_code != payload.recipient.country_code
     label_type = PrintType.map(payload.label_type or "PDF").name
-    documents = [SF.concat_str(
-        ("International" if is_international else "Domestic"),
-        "BillOfLading",
-        ("Thermal" if label_type == "ZPL" else ""),
-        separator="",
-        join=True,
-    )]
+    documents = [
+        SF.concat_str(
+            ("International" if is_international else "Domestic"),
+            "BillOfLading",
+            ("Thermal" if label_type == "ZPL" else ""),
+            separator="",
+            join=True,
+        )
+    ]
 
     # TODO: Find what is missing to get customs invoice.
     # if is_international:
     #     documents.append("CustomsInvoice")
 
     request = create_envelope(
         header_content=RequestContext(
```

## Comparing `karrio.purolator-2023.3.dist-info/METADATA` & `karrio.purolator-2023.4.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: karrio.purolator
-Version: 2023.3
+Version: 2023.4
 Summary: Karrio - Purolator Shipping extension
 Home-page: https://github.com/karrioapi/karrio
 Author: karrio
 Author-email: hello@karrio.io
 License: Apache-2.0
 Platform: UNKNOWN
 Classifier: Intended Audience :: Developers
```

## Comparing `karrio.purolator-2023.3.dist-info/RECORD` & `karrio.purolator-2023.4.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 karrio/mappers/purolator/__init__.py,sha256=Nai38qD-xWkfkypooj9vt9WSyDHDwbp1vIPtM59qM98,563
-karrio/mappers/purolator/mapper.py,sha256=LnDvbgJNrtKic1AYf2DV6FT-vur4G3Aso8cJxHcQJBU,4066
-karrio/mappers/purolator/proxy.py,sha256=rZcBRVYaPcDivaXGeXNN_B1QAHSGCyN1WSyKA1wApR4,4982
-karrio/mappers/purolator/settings.py,sha256=t3iDr2PqwONJMD6SzYbb6DH9eP6zf6NLeclDxvs7WM0,482
+karrio/mappers/purolator/mapper.py,sha256=b3zlFQEuaEQtAcfcgzXJ45m3OEfYvA7Wlfez0zKf8BY,3881
+karrio/mappers/purolator/proxy.py,sha256=WWDYGRDrCCFY8dltT30wjJqh0P8QVI1aBhy5eT6efCY,4858
+karrio/mappers/purolator/settings.py,sha256=bvfDvH1X3N93WJqXgxiCJAWO3fcehL4aZZMKCyqI1ec,504
 karrio/providers/purolator/__init__.py,sha256=ckl0YK7FAPHitTAj0wSr6F5htMJBM5wSsG1eXX18_4o,689
-karrio/providers/purolator/address.py,sha256=Fei8Nihh2aEOKnGj_8GDqGgKIb4PRQ5wHst_9HrWYzE,2713
+karrio/providers/purolator/address.py,sha256=S54wf_7P2WCVwSsDwSnk3xh7U0dGLOe30nEKgwf4gc0,2624
 karrio/providers/purolator/error.py,sha256=Ye_D8Oykmmzj046S6tAZCmj4TNBo7H6KIpvuiGTefZQ,940
-karrio/providers/purolator/rate.py,sha256=kTNoH22gRSPE1i7x-FfgVpXqdDT8dkbf-g89BmN-Mcw,12662
-karrio/providers/purolator/tracking.py,sha256=oT5We9SuT3OSVtmuzR7Fn7pGs-GRvnC2j6dvqtHtisE,3098
+karrio/providers/purolator/rate.py,sha256=dDeAFD0bR8JDC5H4sbtEPg_yuype_EFMU-t4Fp8Pvkw,12666
+karrio/providers/purolator/tracking.py,sha256=bGmpKEERpVpUv_APzyQoID4Ebhy39UVRHI01otEYqdI,3145
 karrio/providers/purolator/units.py,sha256=RPniIF8ySaxlBtf8FzPtGZmeDZBJcWiw1Y5hHgCXMzE,8863
 karrio/providers/purolator/utils.py,sha256=PS7enagga2Ce1GuQyGgvUGtUeqA2i7AzEwXkFBUZBR8,1532
 karrio/providers/purolator/pickup/__init__.py,sha256=DWs7ZWJ2LZVSyhKrF8d3Z4693bqGCuMcIm4oKyHVXNg,301
-karrio/providers/purolator/pickup/cancel.py,sha256=gZ-luY57vnXe6X6Q5f-g_rmE9VU-tnh7WRfsmbLlQSs,1530
-karrio/providers/purolator/pickup/create.py,sha256=7TX5RnGnswzJQhc2x5z--AdLr4wd36w8-lNmJ13o_lU,5777
-karrio/providers/purolator/pickup/update.py,sha256=PfvEa-WC_uD_zRf5EGPTjzsSf_J5KAkBV_gKFgS6cco,3347
-karrio/providers/purolator/pickup/validate.py,sha256=1QzqHv6SJ5XRCIQHKJvHqeGS4yUiMfCmWEd6SbM8l5g,3714
+karrio/providers/purolator/pickup/cancel.py,sha256=4KisH7rRzqvna1yGf-RpMNzSdLgJefxwr-EAbxUdVoc,1599
+karrio/providers/purolator/pickup/create.py,sha256=a0hNzcS8-2axSWkV-hwx-YGwFjZEuBmLKiT9P-a1lwY,5763
+karrio/providers/purolator/pickup/update.py,sha256=Zn5uwLqlerZyATO3dJWeYBWAihk3TGr0mQQ8qHLO6Ro,3387
+karrio/providers/purolator/pickup/validate.py,sha256=gJac_hyB1Oj6k2iFQQvLCJdYqt3AFlTdWv5mfpS2bsA,3659
 karrio/providers/purolator/shipment/__init__.py,sha256=_ufm2_XqVg2yJFiGhpT99p4sOX9FxasXmPTDAwUfFZM,208
-karrio/providers/purolator/shipment/cancel.py,sha256=dhz-P2kgj2kWt7ZKIqgeF7VtTbj5qW3s9rQfNgI9toI,1653
-karrio/providers/purolator/shipment/create.py,sha256=jAuANEAjxDuVIbUrjfJqut0Po52NhSOASEdXMLf41pI,17181
-karrio/providers/purolator/shipment/documents.py,sha256=hEn2R9MTHpH8NKGHeWX7PQragw43lXPS-vpv13MZilc,2374
-karrio.purolator-2023.3.dist-info/METADATA,sha256=PTuYwPykDBp-dvhb6f6iR6YS5cVMN0NWjJYMQoA_DSI,1004
-karrio.purolator-2023.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-karrio.purolator-2023.3.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
-karrio.purolator-2023.3.dist-info/RECORD,,
+karrio/providers/purolator/shipment/cancel.py,sha256=KGvUdIDK7J1fvp9GFpXTcqrt3_DIYCNfpRFx-lzh0hQ,1717
+karrio/providers/purolator/shipment/create.py,sha256=Alt6uAwbDXg7niZKFdOhu5m0XnUlNg6J7Iel49CIw6E,17069
+karrio/providers/purolator/shipment/documents.py,sha256=GPFYfuW-4dzAPSPNGN5BWFsaZQz2FA4H9dL8xYv90hE,2402
+karrio.purolator-2023.4.dist-info/METADATA,sha256=tALWlgMd5P7gRT5cZOZh5pThm3gpZvGziErmXYbGPj8,1004
+karrio.purolator-2023.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+karrio.purolator-2023.4.dist-info/top_level.txt,sha256=mfkVZXzNuVRmA7NRlck_Ub-C8Zgtqxbx3gX1Rq_W-i0,7
+karrio.purolator-2023.4.dist-info/RECORD,,
```

