# Comparing `tmp/hagrid-0.2.99.tar.gz` & `tmp/hagrid-0.3.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "hagrid-0.2.99.tar", last modified: Mon Sep 19 12:55:01 2022, max compression
+gzip compressed data, was "hagrid-0.3.1.tar", last modified: Tue Apr 18 05:38:12 2023, max compression
```

## Comparing `hagrid-0.2.99.tar` & `hagrid-0.3.1.tar`

### file list

```diff
@@ -1,43 +1,45 @@
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-19 12:55:01.715931 hagrid-0.2.99/
--rw-r--r--   0 runner    (1001) docker     (121)      233 2022-09-19 12:55:01.715931 hagrid-0.2.99/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)     7377 2022-09-19 12:51:31.000000 hagrid-0.2.99/README.md
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-19 12:55:01.715931 hagrid-0.2.99/hagrid/
--rw-r--r--   0 runner    (1001) docker     (121)      947 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)     4330 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/art.py
--rw-r--r--   0 runner    (1001) docker     (121)      617 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/auth.py
--rw-r--r--   0 runner    (1001) docker     (121)     1797 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/azure.py
--rw-r--r--   0 runner    (1001) docker     (121)     1856 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/cache.py
--rw-r--r--   0 runner    (1001) docker     (121)    97407 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/cli.py
--rw-r--r--   0 runner    (1001) docker     (121)    25135 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/deps.py
--rw-r--r--   0 runner    (1001) docker     (121)       45 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/exceptions.py
--rw-r--r--   0 runner    (1001) docker     (121)      180 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/file.py
--rw-r--r--   0 runner    (1001) docker     (121)    12208 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/grammar.py
--rw-r--r--   0 runner    (1001) docker     (121)     1504 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/land.py
--rw-r--r--   0 runner    (1001) docker     (121)     3038 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/launch.py
--rw-r--r--   0 runner    (1001) docker     (121)    10670 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/lib.py
--rw-r--r--   0 runner    (1001) docker     (121)      885 2022-09-19 12:51:46.000000 hagrid-0.2.99/hagrid/manifest_template.yml
--rw-r--r--   0 runner    (1001) docker     (121)      960 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/mode.py
--rw-r--r--   0 runner    (1001) docker     (121)     2825 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/names.py
--rw-r--r--   0 runner    (1001) docker     (121)      393 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/nb_output.py
--rw-r--r--   0 runner    (1001) docker     (121)     6040 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/parse_template.py
--rw-r--r--   0 runner    (1001) docker     (121)     7849 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/quickstart_ui.py
--rw-r--r--   0 runner    (1001) docker     (121)     2819 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/rand_sec.py
--rw-r--r--   0 runner    (1001) docker     (121)     1429 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/style.py
--rw-r--r--   0 runner    (1001) docker     (121)      365 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/util.py
--rw-r--r--   0 runner    (1001) docker     (121)      114 2022-09-19 12:51:46.000000 hagrid-0.2.99/hagrid/version.py
--rw-r--r--   0 runner    (1001) docker     (121)     7951 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/win_bootstrap.py
--rw-r--r--   0 runner    (1001) docker     (121)     1744 2022-09-19 12:51:31.000000 hagrid-0.2.99/hagrid/wizard_ui.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-19 12:55:01.715931 hagrid-0.2.99/hagrid.egg-info/
--rw-r--r--   0 runner    (1001) docker     (121)      233 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)      718 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (121)        1 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (121)       42 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (121)      189 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (121)       13 2022-09-19 12:55:01.000000 hagrid-0.2.99/hagrid.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (121)       38 2022-09-19 12:55:01.715931 hagrid-0.2.99/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (121)     1189 2022-09-19 12:51:46.000000 hagrid-0.2.99/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-19 12:55:01.715931 hagrid-0.2.99/tests/
--rw-r--r--   0 runner    (1001) docker     (121)        0 2022-09-19 12:51:31.000000 hagrid-0.2.99/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-19 12:55:01.715931 hagrid-0.2.99/tests/hagrid/
--rw-r--r--   0 runner    (1001) docker     (121)        0 2022-09-19 12:51:31.000000 hagrid-0.2.99/tests/hagrid/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)     6393 2022-09-19 12:51:31.000000 hagrid-0.2.99/tests/hagrid/cli_test.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-18 05:38:12.228451 hagrid-0.3.1/
+-rw-r--r--   0 runner    (1001) docker     (123)      232 2023-04-18 05:38:12.228451 hagrid-0.3.1/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     7377 2023-04-18 05:35:57.000000 hagrid-0.3.1/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-18 05:38:12.228451 hagrid-0.3.1/hagrid/
+-rw-r--r--   0 runner    (1001) docker     (123)     1094 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5882 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/art.py
+-rw-r--r--   0 runner    (1001) docker     (123)      617 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/auth.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1796 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/azure.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2159 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)   134699 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30059 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/deps.py
+-rw-r--r--   0 runner    (1001) docker     (123)       45 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/exceptions.py
+-rw-r--r--   0 runner    (1001) docker     (123)      180 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/file.py
+-rw-r--r--   0 runner    (1001) docker     (123)      365 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/git_check.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12046 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/grammar.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1504 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/land.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3079 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/launch.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13857 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/lib.py
+-rw-r--r--   0 runner    (1001) docker     (123)      882 2023-04-18 05:36:12.000000 hagrid-0.3.1/hagrid/manifest_template.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      960 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/mode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2825 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/names.py
+-rw-r--r--   0 runner    (1001) docker     (123)      393 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/nb_output.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7866 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/orchestra.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6043 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/parse_template.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10203 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/quickstart_ui.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2819 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/rand_sec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1429 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/style.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1714 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/util.py
+-rw-r--r--   0 runner    (1001) docker     (123)      113 2023-04-18 05:36:12.000000 hagrid-0.3.1/hagrid/version.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7950 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/win_bootstrap.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2008 2023-04-18 05:35:57.000000 hagrid-0.3.1/hagrid/wizard_ui.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-18 05:38:12.228451 hagrid-0.3.1/hagrid.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)      232 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)      758 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       42 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      210 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       13 2023-04-18 05:38:12.000000 hagrid-0.3.1/hagrid.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-18 05:38:12.228451 hagrid-0.3.1/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     1216 2023-04-18 05:36:12.000000 hagrid-0.3.1/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-18 05:38:12.228451 hagrid-0.3.1/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-18 05:35:57.000000 hagrid-0.3.1/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-18 05:38:12.228451 hagrid-0.3.1/tests/hagrid/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-18 05:35:57.000000 hagrid-0.3.1/tests/hagrid/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6784 2023-04-18 05:35:57.000000 hagrid-0.3.1/tests/hagrid/cli_test.py
```

### Comparing `hagrid-0.2.99/README.md` & `hagrid-0.3.1/README.md`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/__init__.py` & `hagrid-0.3.1/hagrid/__init__.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,17 +1,21 @@
-from .util import verify_git_installation  # noqa
+from .git_check import verify_git_installation  # noqa
 
 # stdlib
 import sys
 from typing import Any
 
 # relative
+from .cli import check_status as check  # noqa: F401
 from .quickstart_ui import QuickstartUI
+from .version import __version__  # noqa: F401
 from .wizard_ui import WizardUI
 
+from .orchestra import Orchestra  # noqa
+
 
 def module_property(func: Any) -> None:
     """Decorator to turn module functions into properties.
     Function names must be prefixed with an underscore."""
     module = sys.modules[func.__module__]
 
     def base_getattr(name: str) -> None:
```

### Comparing `hagrid-0.2.99/hagrid/auth.py` & `hagrid-0.3.1/hagrid/auth.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/azure.py` & `hagrid-0.3.1/hagrid/azure.py`

 * *Files 0% similar despite different names*

```diff
@@ -26,15 +26,14 @@
     except AzureException as e:
         print(e)
 
     return False
 
 
 def login_azure() -> bool:
-
     cmd = "az login"
     try:
         subprocess.check_call(cmd, shell=True, stdout=subprocess.DEVNULL)  # nosec
         return True
     except Exception:  # nosec
         pass
     return False
```

### Comparing `hagrid-0.2.99/hagrid/cache.py` & `hagrid-0.3.1/hagrid/cache.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 # stdlib
 import json
 import os
 from typing import Any
 
 STABLE_BRANCH = "0.6.0"
-DEFAULT_BRANCH = "dev"
+DEFAULT_BRANCH = "0.7.0"
 RENDERED_DIR = "rendered"
 DEFAULT_REPO = "OpenMined/PySyft"
 
 arg_defaults = {
     "repo": DEFAULT_REPO,
     "branch": STABLE_BRANCH,
     "username": "root",
@@ -25,41 +25,46 @@
     "gcp_machine_type": "e2-standard-4",
     "gcp_project_id": "",
     "gcp_username": "",
     "gcp_key_path": "~/.ssh/google_compute_engine",
     "gcp_repo": DEFAULT_REPO,
     "gcp_branch": STABLE_BRANCH,
     "install_wizard_complete": False,
+    "aws_region": "us-east-1",
+    "aws_security_group_name": "openmined_sg",
+    "aws_security_group_cidr": "0.0.0.0/0",
+    "aws_image_id": "ami-09cd747c78a9add63",  # Ubuntu Server 20.04 LTS (HVM), SSD Volume Type
+    "aws_ec2_instance_type": "t2.xlarge",
+    "aws_ec2_instance_username": "ubuntu",  # For Ubuntu AMI, the default user name is ubuntu
+    "aws_repo": DEFAULT_REPO,
+    "aws_branch": STABLE_BRANCH,
 }
 
 
 class ArgCache:
     @staticmethod
     def cache_file_path() -> str:
         dir_path = os.path.expanduser("~/.hagrid")
         os.makedirs(dir_path, exist_ok=True)
         return f"{dir_path}/cache.json"
 
     def __init__(self) -> None:
-        cache = {}
         try:
             with open(ArgCache.cache_file_path(), "r") as f:
-                cache = json.loads(f.read())
+                self.__cache = json.loads(f.read())
         except Exception:  # nosec
-            pass
-        self.__dict__ = cache
+            self.__cache = {}
 
-    def __setattr__(self, key: str, value: Any) -> None:
-        super(ArgCache, self).__setattr__(key, value)
-        if not key.startswith("__"):
-            with open(ArgCache.cache_file_path(), "w") as f:
-                f.write(json.dumps(self.__dict__))
-
-    def __getattr__(self, key: str) -> Any:
-        if key not in self.__dict__ and key in arg_defaults:
+    def __setitem__(self, key: str, value: Any) -> None:
+        self.__cache[key] = value
+        with open(ArgCache.cache_file_path(), "w") as f:
+            f.write(json.dumps(self.__cache))
+
+    def __getitem__(self, key: str) -> Any:
+        if key in self.__cache:
+            return self.__cache[key]
+        elif key in arg_defaults:
             return arg_defaults[key]
-        else:
-            print(f"Can't find key {key} in ArgCache")
-            super().__getattr__(key)  # type: ignore
+        raise KeyError(f"Can't find key {key} in ArgCache")
 
 
 arg_cache = ArgCache()
```

### Comparing `hagrid-0.2.99/hagrid/cli.py` & `hagrid-0.3.1/hagrid/cli.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,6088 +1,8419 @@
-00000000: 2320 7374 646c 6962 0a69 6d70 6f72 7420  # stdlib.import 
-00000010: 6a73 6f6e 0a69 6d70 6f72 7420 6f73 0a66  json.import os.f
-00000020: 726f 6d20 7061 7468 6c69 6220 696d 706f  rom pathlib impo
-00000030: 7274 2050 6174 680a 6672 6f6d 2071 7565  rt Path.from que
-00000040: 7565 2069 6d70 6f72 7420 5175 6575 650a  ue import Queue.
-00000050: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
-00000060: 2073 6875 7469 6c0a 696d 706f 7274 2073   shutil.import s
-00000070: 6f63 6b65 740a 696d 706f 7274 2073 7461  ocket.import sta
-00000080: 740a 696d 706f 7274 2073 7562 7072 6f63  t.import subproc
-00000090: 6573 7320 2023 206e 6f73 6563 0a69 6d70  ess  # nosec.imp
-000000a0: 6f72 7420 7379 730a 696d 706f 7274 2074  ort sys.import t
-000000b0: 656d 7066 696c 650a 6672 6f6d 2074 6872  empfile.from thr
-000000c0: 6561 6469 6e67 2069 6d70 6f72 7420 5468  eading import Th
-000000d0: 7265 6164 0a69 6d70 6f72 7420 7469 6d65  read.import time
-000000e0: 0a66 726f 6d20 7479 7069 6e67 2069 6d70  .from typing imp
-000000f0: 6f72 7420 416e 790a 6672 6f6d 2074 7970  ort Any.from typ
-00000100: 696e 6720 696d 706f 7274 2043 616c 6c61  ing import Calla
-00000110: 626c 650a 6672 6f6d 2074 7970 696e 6720  ble.from typing 
-00000120: 696d 706f 7274 2044 6963 7420 6173 2054  import Dict as T
-00000130: 7970 6544 6963 740a 6672 6f6d 2074 7970  ypeDict.from typ
-00000140: 696e 6720 696d 706f 7274 204c 6973 7420  ing import List 
-00000150: 6173 2054 7970 654c 6973 740a 6672 6f6d  as TypeList.from
-00000160: 2074 7970 696e 6720 696d 706f 7274 204f   typing import O
-00000170: 7074 696f 6e61 6c0a 6672 6f6d 2074 7970  ptional.from typ
-00000180: 696e 6720 696d 706f 7274 2054 7570 6c65  ing import Tuple
-00000190: 0a66 726f 6d20 7479 7069 6e67 2069 6d70  .from typing imp
-000001a0: 6f72 7420 5475 706c 6520 6173 2054 7970  ort Tuple as Typ
-000001b0: 6554 7570 6c65 0a66 726f 6d20 7479 7069  eTuple.from typi
-000001c0: 6e67 2069 6d70 6f72 7420 556e 696f 6e0a  ng import Union.
-000001d0: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
-000001e0: 7274 2063 6173 740a 6672 6f6d 2075 726c  rt cast.from url
-000001f0: 6c69 622e 7061 7273 6520 696d 706f 7274  lib.parse import
-00000200: 2075 726c 7061 7273 650a 0a23 2074 6869   urlparse..# thi
-00000210: 7264 2070 6172 7479 0a69 6d70 6f72 7420  rd party.import 
-00000220: 636c 6963 6b0a 696d 706f 7274 2072 6571  click.import req
-00000230: 7565 7374 730a 696d 706f 7274 2072 6963  uests.import ric
-00000240: 680a 6672 6f6d 2072 6963 682e 6c69 7665  h.from rich.live
-00000250: 2069 6d70 6f72 7420 4c69 7665 0a66 726f   import Live.fro
-00000260: 6d20 7669 7274 7561 6c65 6e76 6170 692e  m virtualenvapi.
-00000270: 6d61 6e61 6765 2069 6d70 6f72 7420 5669  manage import Vi
-00000280: 7274 7561 6c45 6e76 6972 6f6e 6d65 6e74  rtualEnvironment
-00000290: 0a0a 2320 7265 6c61 7469 7665 0a66 726f  ..# relative.fro
-000002a0: 6d20 2e61 7274 2069 6d70 6f72 7420 6861  m .art import ha
-000002b0: 6772 6964 0a66 726f 6d20 2e61 7574 6820  grid.from .auth 
-000002c0: 696d 706f 7274 2041 7574 6843 7265 6465  import AuthCrede
-000002d0: 6e74 6961 6c73 0a66 726f 6d20 2e63 6163  ntials.from .cac
-000002e0: 6865 2069 6d70 6f72 7420 4445 4641 554c  he import DEFAUL
-000002f0: 545f 4252 414e 4348 0a66 726f 6d20 2e63  T_BRANCH.from .c
-00000300: 6163 6865 2069 6d70 6f72 7420 4445 4641  ache import DEFA
-00000310: 554c 545f 5245 504f 0a66 726f 6d20 2e63  ULT_REPO.from .c
-00000320: 6163 6865 2069 6d70 6f72 7420 5245 4e44  ache import REND
-00000330: 4552 4544 5f44 4952 0a66 726f 6d20 2e63  ERED_DIR.from .c
-00000340: 6163 6865 2069 6d70 6f72 7420 6172 675f  ache import arg_
-00000350: 6361 6368 650a 6672 6f6d 202e 6465 7073  cache.from .deps
-00000360: 2069 6d70 6f72 7420 4445 5045 4e44 454e   import DEPENDEN
-00000370: 4349 4553 0a66 726f 6d20 2e64 6570 7320  CIES.from .deps 
-00000380: 696d 706f 7274 2061 6c6c 6f77 6564 5f68  import allowed_h
-00000390: 6f73 7473 0a66 726f 6d20 2e64 6570 7320  osts.from .deps 
-000003a0: 696d 706f 7274 2063 6865 636b 5f64 6f63  import check_doc
-000003b0: 6b65 725f 7665 7273 696f 6e0a 6672 6f6d  ker_version.from
-000003c0: 202e 6465 7073 2069 6d70 6f72 7420 6761   .deps import ga
-000003d0: 7468 6572 5f64 6562 7567 0a66 726f 6d20  ther_debug.from 
-000003e0: 2e64 6570 7320 696d 706f 7274 2069 735f  .deps import is_
-000003f0: 7769 6e64 6f77 730a 6672 6f6d 202e 6578  windows.from .ex
-00000400: 6365 7074 696f 6e73 2069 6d70 6f72 7420  ceptions import 
-00000410: 4d69 7373 696e 6744 6570 656e 6465 6e63  MissingDependenc
-00000420: 790a 6672 6f6d 202e 6772 616d 6d61 7220  y.from .grammar 
-00000430: 696d 706f 7274 2042 6164 4772 616d 6d61  import BadGramma
-00000440: 720a 6672 6f6d 202e 6772 616d 6d61 7220  r.from .grammar 
-00000450: 696d 706f 7274 2047 7261 6d6d 6172 5665  import GrammarVe
-00000460: 7262 0a66 726f 6d20 2e67 7261 6d6d 6172  rb.from .grammar
-00000470: 2069 6d70 6f72 7420 7061 7273 655f 6772   import parse_gr
-00000480: 616d 6d61 720a 6672 6f6d 202e 6c61 6e64  ammar.from .land
-00000490: 2069 6d70 6f72 7420 6765 745f 6c61 6e64   import get_land
-000004a0: 5f76 6572 620a 6672 6f6d 202e 6c61 756e  _verb.from .laun
-000004b0: 6368 2069 6d70 6f72 7420 6765 745f 6c61  ch import get_la
-000004c0: 756e 6368 5f76 6572 620a 6672 6f6d 202e  unch_verb.from .
-000004d0: 6c69 6220 696d 706f 7274 2047 4954 5f52  lib import GIT_R
-000004e0: 4550 4f0a 6672 6f6d 202e 6c69 6220 696d  EPO.from .lib im
-000004f0: 706f 7274 2047 5249 445f 5352 435f 5041  port GRID_SRC_PA
-00000500: 5448 0a66 726f 6d20 2e6c 6962 2069 6d70  TH.from .lib imp
-00000510: 6f72 7420 4752 4944 5f53 5243 5f56 4552  ort GRID_SRC_VER
-00000520: 5349 4f4e 0a66 726f 6d20 2e6c 6962 2069  SION.from .lib i
-00000530: 6d70 6f72 7420 6368 6563 6b5f 6170 695f  mport check_api_
-00000540: 6d65 7461 6461 7461 0a66 726f 6d20 2e6c  metadata.from .l
-00000550: 6962 2069 6d70 6f72 7420 6368 6563 6b5f  ib import check_
-00000560: 686f 7374 0a66 726f 6d20 2e6c 6962 2069  host.from .lib i
-00000570: 6d70 6f72 7420 6368 6563 6b5f 6a75 7079  mport check_jupy
-00000580: 7465 725f 7365 7276 6572 0a66 726f 6d20  ter_server.from 
-00000590: 2e6c 6962 2069 6d70 6f72 7420 6368 6563  .lib import chec
-000005a0: 6b5f 6c6f 6769 6e5f 7061 6765 0a66 726f  k_login_page.fro
-000005b0: 6d20 2e6c 6962 2069 6d70 6f72 7420 646f  m .lib import do
-000005c0: 636b 6572 5f64 6573 6b74 6f70 5f6d 656d  cker_desktop_mem
-000005d0: 6f72 790a 6672 6f6d 202e 6c69 6220 696d  ory.from .lib im
-000005e0: 706f 7274 2067 656e 6572 6174 655f 7072  port generate_pr
-000005f0: 6f63 6573 735f 7374 6174 7573 5f74 6162  ocess_status_tab
-00000600: 6c65 0a66 726f 6d20 2e6c 6962 2069 6d70  le.from .lib imp
-00000610: 6f72 7420 6765 6e65 7261 7465 5f75 7365  ort generate_use
-00000620: 725f 7461 626c 650a 6672 6f6d 202e 6c69  r_table.from .li
-00000630: 6220 696d 706f 7274 2067 6974 706f 645f  b import gitpod_
-00000640: 7572 6c0a 6672 6f6d 202e 6c69 6220 696d  url.from .lib im
-00000650: 706f 7274 2068 6167 7269 645f 726f 6f74  port hagrid_root
-00000660: 0a66 726f 6d20 2e6c 6962 2069 6d70 6f72  .from .lib impor
-00000670: 7420 6973 5f67 6974 706f 640a 6672 6f6d  t is_gitpod.from
-00000680: 202e 6c69 6220 696d 706f 7274 206e 616d   .lib import nam
-00000690: 655f 7461 670a 6672 6f6d 202e 6c69 6220  e_tag.from .lib 
-000006a0: 696d 706f 7274 2073 6176 655f 766d 5f64  import save_vm_d
-000006b0: 6574 6169 6c73 5f61 735f 6a73 6f6e 0a66  etails_as_json.f
-000006c0: 726f 6d20 2e6c 6962 2069 6d70 6f72 7420  rom .lib import 
-000006d0: 7570 6461 7465 5f72 6570 6f0a 6672 6f6d  update_repo.from
-000006e0: 202e 6c69 6220 696d 706f 7274 2075 7365   .lib import use
-000006f0: 5f62 7261 6e63 680a 6672 6f6d 202e 6d6f  _branch.from .mo
-00000700: 6465 2069 6d70 6f72 7420 4544 4954 4142  de import EDITAB
-00000710: 4c45 5f4d 4f44 450a 6672 6f6d 202e 7061  LE_MODE.from .pa
-00000720: 7273 655f 7465 6d70 6c61 7465 2069 6d70  rse_template imp
-00000730: 6f72 7420 7265 6e64 6572 5f74 656d 706c  ort render_templ
-00000740: 6174 6573 0a66 726f 6d20 2e70 6172 7365  ates.from .parse
-00000750: 5f74 656d 706c 6174 6520 696d 706f 7274  _template import
-00000760: 2073 6574 7570 5f66 726f 6d5f 6d61 6e69   setup_from_mani
-00000770: 6665 7374 5f74 656d 706c 6174 650a 6672  fest_template.fr
-00000780: 6f6d 202e 7175 6963 6b73 7461 7274 5f75  om .quickstart_u
-00000790: 6920 696d 706f 7274 2066 6574 6368 5f6e  i import fetch_n
-000007a0: 6f74 6562 6f6f 6b73 5f66 6f72 5f75 726c  otebooks_for_url
-000007b0: 0a66 726f 6d20 2e71 7569 636b 7374 6172  .from .quickstar
-000007c0: 745f 7569 2069 6d70 6f72 7420 7175 6963  t_ui import quic
-000007d0: 6b73 7461 7274 5f64 6f77 6e6c 6f61 645f  kstart_download_
-000007e0: 6e6f 7465 626f 6f6b 0a66 726f 6d20 2e72  notebook.from .r
-000007f0: 616e 645f 7365 6320 696d 706f 7274 2067  and_sec import g
-00000800: 656e 6572 6174 655f 7365 635f 7261 6e64  enerate_sec_rand
-00000810: 6f6d 5f70 6173 7377 6f72 640a 6672 6f6d  om_password.from
-00000820: 202e 7374 796c 6520 696d 706f 7274 2052   .style import R
-00000830: 6963 6847 726f 7570 0a66 726f 6d20 2e76  ichGroup.from .v
-00000840: 6572 7369 6f6e 2069 6d70 6f72 7420 5f5f  ersion import __
-00000850: 7665 7273 696f 6e5f 5f0a 0a0a 6465 6620  version__...def 
-00000860: 6669 785f 7769 6e64 6f77 735f 7669 7274  fix_windows_virt
-00000870: 7561 6c65 6e76 5f61 7069 2863 6c73 3a20  ualenv_api(cls: 
-00000880: 7479 7065 2920 2d3e 204e 6f6e 653a 0a20  type) -> None:. 
-00000890: 2020 2023 2066 6978 2062 7567 2069 6e20     # fix bug in 
-000008a0: 7769 6e64 6f77 730a 2020 2020 6465 6620  windows.    def 
-000008b0: 5f70 7974 686f 6e5f 7270 6174 6828 7365  _python_rpath(se
-000008c0: 6c66 3a20 416e 7929 202d 3e20 7374 723a  lf: Any) -> str:
-000008d0: 0a20 2020 2020 2020 2022 2222 5468 6520  .        """The 
-000008e0: 7265 6c61 7469 7665 2070 6174 6820 2866  relative path (f
-000008f0: 726f 6d20 656e 7669 726f 6e6d 656e 7420  rom environment 
-00000900: 726f 6f74 2920 746f 2070 7974 686f 6e2e  root) to python.
-00000910: 2222 220a 2020 2020 2020 2020 2320 5769  """.        # Wi
-00000920: 6e64 6f77 7320 7669 7274 7561 6c65 6e76  ndows virtualenv
-00000930: 2069 6e73 7461 6c6c 6174 696f 6e20 696e   installation in
-00000940: 7374 616c 6c73 2070 6970 2074 6f20 7468  stalls pip to th
-00000950: 6520 5b53 735d 6372 6970 7473 0a20 2020  e [Ss]cripts.   
-00000960: 2020 2020 2023 2066 6f6c 6465 722e 2048       # folder. H
-00000970: 6572 6527 7320 6120 7369 6d70 6c65 2063  ere's a simple c
-00000980: 6865 636b 2074 6f20 7375 7070 6f72 743a  heck to support:
-00000990: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
-000009a0: 706c 6174 666f 726d 203d 3d20 2277 696e  platform == "win
-000009b0: 3332 223a 0a20 2020 2020 2020 2020 2020  32":.           
-000009c0: 2023 2066 6978 2068 6572 6520 6874 7470   # fix here http
-000009d0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f73  s://github.com/s
-000009e0: 6a6b 696e 676f 2f76 6972 7475 616c 656e  jkingo/virtualen
-000009f0: 762d 6170 692f 6973 7375 6573 2f34 370a  v-api/issues/47.
-00000a00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00000a10: 726e 206f 732e 7061 7468 2e6a 6f69 6e28  rn os.path.join(
-00000a20: 7365 6c66 2e70 6174 682c 2022 5363 7269  self.path, "Scri
-00000a30: 7074 7322 2c20 2270 7974 686f 6e2e 6578  pts", "python.ex
-00000a40: 6522 290a 2020 2020 2020 2020 7265 7475  e").        retu
-00000a50: 726e 206f 732e 7061 7468 2e6a 6f69 6e28  rn os.path.join(
-00000a60: 2262 696e 222c 2022 7079 7468 6f6e 2229  "bin", "python")
-00000a70: 0a0a 2020 2020 7365 7461 7474 7228 636c  ..    setattr(cl
-00000a80: 732c 2022 5f70 7974 686f 6e5f 7270 6174  s, "_python_rpat
-00000a90: 6822 2c20 7072 6f70 6572 7479 285f 7079  h", property(_py
-00000aa0: 7468 6f6e 5f72 7061 7468 2929 0a0a 0a23  thon_rpath))...#
-00000ab0: 2066 6978 2056 6972 7475 616c 456e 7669   fix VirtualEnvi
-00000ac0: 726f 6e6d 656e 7420 6275 6720 696e 2077  ronment bug in w
-00000ad0: 696e 646f 7773 0a66 6978 5f77 696e 646f  indows.fix_windo
-00000ae0: 7773 5f76 6972 7475 616c 656e 765f 6170  ws_virtualenv_ap
-00000af0: 6928 5669 7274 7561 6c45 6e76 6972 6f6e  i(VirtualEnviron
-00000b00: 6d65 6e74 290a 0a0a 6465 6620 6765 745f  ment)...def get_
-00000b10: 617a 7572 655f 696d 6167 6528 7368 6f72  azure_image(shor
-00000b20: 745f 6e61 6d65 3a20 7374 7229 202d 3e20  t_name: str) -> 
-00000b30: 7374 723a 0a20 2020 2070 7265 6275 696c  str:.    prebuil
-00000b40: 645f 3037 3020 3d20 280a 2020 2020 2020  d_070 = (.      
-00000b50: 2020 226d 6164 6861 7661 6a61 7931 3633    "madhavajay163
-00000b60: 3232 3639 3233 3230 3539 3a6f 7065 6e6d  2269232059:openm
-00000b70: 696e 6564 5f6d 6a5f 6772 6964 5f64 6f6d  ined_mj_grid_dom
-00000b80: 6169 6e5f 7562 756e 7475 5f31 3a64 6f6d  ain_ubuntu_1:dom
-00000b90: 6169 6e5f 3037 303a 6c61 7465 7374 220a  ain_070:latest".
-00000ba0: 2020 2020 290a 2020 2020 6672 6573 685f      ).    fresh_
-00000bb0: 7562 756e 7475 203d 2022 4361 6e6f 6e69  ubuntu = "Canoni
-00000bc0: 6361 6c3a 3030 3031 2d63 6f6d 2d75 6275  cal:0001-com-ubu
-00000bd0: 6e74 752d 7365 7276 6572 2d66 6f63 616c  ntu-server-focal
-00000be0: 3a32 305f 3034 2d6c 7473 3a6c 6174 6573  :20_04-lts:lates
-00000bf0: 7422 0a20 2020 2069 6620 7368 6f72 745f  t".    if short_
-00000c00: 6e61 6d65 203d 3d20 2264 6566 6175 6c74  name == "default
-00000c10: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
-00000c20: 6e20 6672 6573 685f 7562 756e 7475 0a20  n fresh_ubuntu. 
-00000c30: 2020 2065 6c69 6620 7368 6f72 745f 6e61     elif short_na
-00000c40: 6d65 203d 3d20 2264 6f6d 6169 6e5f 302e  me == "domain_0.
-00000c50: 372e 3022 3a0a 2020 2020 2020 2020 7265  7.0":.        re
-00000c60: 7475 726e 2070 7265 6275 696c 645f 3037  turn prebuild_07
-00000c70: 300a 2020 2020 7261 6973 6520 4578 6365  0.    raise Exce
-00000c80: 7074 696f 6e28 6622 496d 6167 6520 6e61  ption(f"Image na
-00000c90: 6d65 2064 6f65 736e 2774 2065 7869 7374  me doesn't exist
-00000ca0: 3a20 7b73 686f 7274 5f6e 616d 657d 2e20  : {short_name}. 
-00000cb0: 5472 793a 2064 6566 6175 6c74 206f 7220  Try: default or 
-00000cc0: 302e 372e 3022 290a 0a0a 4063 6c69 636b  0.7.0")...@click
-00000cd0: 2e67 726f 7570 2863 6c73 3d52 6963 6847  .group(cls=RichG
-00000ce0: 726f 7570 290a 6465 6620 636c 6928 2920  roup).def cli() 
-00000cf0: 2d3e 204e 6f6e 653a 0a20 2020 2070 6173  -> None:.    pas
-00000d00: 730a 0a0a 4063 6c69 636b 2e63 6f6d 6d61  s...@click.comma
-00000d10: 6e64 280a 2020 2020 6865 6c70 3d22 5265  nd(.    help="Re
-00000d20: 7374 6f72 6520 736f 6d65 2070 6172 7420  store some part 
-00000d30: 6f66 2074 6865 2068 6167 7269 6420 696e  of the hagrid in
-00000d40: 7374 616c 6c61 7469 6f6e 206f 7220 6465  stallation or de
-00000d50: 706c 6f79 6d65 6e74 2074 6f20 6974 7320  ployment to its 
-00000d60: 696e 6974 6961 6c2f 7374 6172 7469 6e67  initial/starting
-00000d70: 2073 7461 7465 2e22 0a29 0a40 636c 6963   state.".).@clic
-00000d80: 6b2e 6172 6775 6d65 6e74 2822 6c6f 6361  k.argument("loca
-00000d90: 7469 6f6e 222c 2074 7970 653d 7374 722c  tion", type=str,
-00000da0: 206e 6172 6773 3d31 290a 6465 6620 636c   nargs=1).def cl
-00000db0: 6561 6e28 6c6f 6361 7469 6f6e 3a20 7374  ean(location: st
-00000dc0: 7229 202d 3e20 4e6f 6e65 3a0a 0a20 2020  r) -> None:..   
-00000dd0: 2069 6620 6c6f 6361 7469 6f6e 203d 3d20   if location == 
-00000de0: 226c 6962 7261 7279 2220 6f72 206c 6f63  "library" or loc
-00000df0: 6174 696f 6e20 3d3d 2022 766f 6c75 6d65  ation == "volume
-00000e00: 7322 3a0a 2020 2020 2020 2020 7072 696e  s":.        prin
-00000e10: 7428 2244 656c 6574 696e 6720 616c 6c20  t("Deleting all 
-00000e20: 446f 636b 6572 2076 6f6c 756d 6573 2069  Docker volumes i
-00000e30: 6e20 3220 7365 6373 2028 4374 726c 2d43  n 2 secs (Ctrl-C
-00000e40: 2074 6f20 7374 6f70 2922 290a 2020 2020   to stop)").    
-00000e50: 2020 2020 7469 6d65 2e73 6c65 6570 2832      time.sleep(2
-00000e60: 290a 2020 2020 2020 2020 7375 6270 726f  ).        subpro
-00000e70: 6365 7373 2e63 616c 6c28 2264 6f63 6b65  cess.call("docke
-00000e80: 7220 766f 6c75 6d65 2072 6d20 2428 646f  r volume rm $(do
-00000e90: 636b 6572 2076 6f6c 756d 6520 6c73 202d  cker volume ls -
-00000ea0: 7129 222c 2073 6865 6c6c 3d54 7275 6529  q)", shell=True)
-00000eb0: 2020 2320 6e6f 7365 630a 0a20 2020 2069    # nosec..    i
-00000ec0: 6620 6c6f 6361 7469 6f6e 203d 3d20 2263  f location == "c
-00000ed0: 6f6e 7461 696e 6572 7322 206f 7220 6c6f  ontainers" or lo
-00000ee0: 6361 7469 6f6e 203d 3d20 2270 616e 7472  cation == "pantr
-00000ef0: 7922 3a0a 2020 2020 2020 2020 7072 696e  y":.        prin
-00000f00: 7428 2244 656c 6574 696e 6720 616c 6c20  t("Deleting all 
-00000f10: 446f 636b 6572 2063 6f6e 7461 696e 6572  Docker container
-00000f20: 7320 696e 2032 2073 6563 7320 2843 7472  s in 2 secs (Ctr
-00000f30: 6c2d 4320 746f 2073 746f 7029 2229 0a20  l-C to stop)"). 
-00000f40: 2020 2020 2020 2074 696d 652e 736c 6565         time.slee
-00000f50: 7028 3229 0a20 2020 2020 2020 2073 7562  p(2).        sub
-00000f60: 7072 6f63 6573 732e 6361 6c6c 2822 646f  process.call("do
-00000f70: 636b 6572 2072 6d20 2d66 2024 2864 6f63  cker rm -f $(doc
-00000f80: 6b65 7220 7073 202d 6120 2d71 2922 2c20  ker ps -a -q)", 
-00000f90: 7368 656c 6c3d 5472 7565 2920 2023 206e  shell=True)  # n
-00000fa0: 6f73 6563 0a0a 2020 2020 6966 206c 6f63  osec..    if loc
-00000fb0: 6174 696f 6e20 3d3d 2022 696d 6167 6573  ation == "images
-00000fc0: 223a 0a20 2020 2020 2020 2070 7269 6e74  ":.        print
-00000fd0: 2822 4465 6c65 7469 6e67 2061 6c6c 2044  ("Deleting all D
-00000fe0: 6f63 6b65 7220 696d 6167 6573 2069 6e20  ocker images in 
-00000ff0: 3220 7365 6373 2028 4374 726c 2d43 2074  2 secs (Ctrl-C t
-00001000: 6f20 7374 6f70 2922 290a 2020 2020 2020  o stop)").      
-00001010: 2020 7469 6d65 2e73 6c65 6570 2832 290a    time.sleep(2).
-00001020: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
-00001030: 7373 2e63 616c 6c28 2264 6f63 6b65 7220  ss.call("docker 
-00001040: 726d 6920 2428 646f 636b 6572 2069 6d61  rmi $(docker ima
-00001050: 6765 7320 2d71 2922 2c20 7368 656c 6c3d  ges -q)", shell=
-00001060: 5472 7565 2920 2023 206e 6f73 6563 0a0a  True)  # nosec..
-00001070: 0a40 636c 6963 6b2e 636f 6d6d 616e 6428  .@click.command(
-00001080: 6865 6c70 3d22 5374 6172 7420 6120 6e65  help="Start a ne
-00001090: 7720 5079 4772 6964 2064 6f6d 6169 6e2f  w PyGrid domain/
-000010a0: 6e65 7477 6f72 6b20 6e6f 6465 2122 290a  network node!").
-000010b0: 4063 6c69 636b 2e61 7267 756d 656e 7428  @click.argument(
-000010c0: 2261 7267 7322 2c20 7479 7065 3d73 7472  "args", type=str
-000010d0: 2c20 6e61 7267 733d 2d31 290a 4063 6c69  , nargs=-1).@cli
-000010e0: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-000010f0: 2d2d 7573 6572 6e61 6d65 222c 0a20 2020  --username",.   
-00001100: 2064 6566 6175 6c74 3d4e 6f6e 652c 0a20   default=None,. 
-00001110: 2020 2072 6571 7569 7265 643d 4661 6c73     required=Fals
-00001120: 652c 0a20 2020 2074 7970 653d 7374 722c  e,.    type=str,
-00001130: 0a20 2020 2068 656c 703d 224f 7074 696f  .    help="Optio
-00001140: 6e61 6c3a 2074 6865 2075 7365 726e 616d  nal: the usernam
-00001150: 6520 666f 7220 7072 6f76 6973 696f 6e69  e for provisioni
-00001160: 6e67 2074 6865 2072 656d 6f74 6520 686f  ng the remote ho
-00001170: 7374 222c 0a29 0a40 636c 6963 6b2e 6f70  st",.).@click.op
-00001180: 7469 6f6e 280a 2020 2020 222d 2d6b 6579  tion(.    "--key
-00001190: 5f70 6174 6822 2c0a 2020 2020 6465 6661  _path",.    defa
-000011a0: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
-000011b0: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
-000011c0: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
-000011d0: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-000011e0: 7468 6520 7061 7468 2074 6f20 7468 6520  the path to the 
-000011f0: 6b65 7920 6669 6c65 2066 6f72 2070 726f  key file for pro
-00001200: 7669 7369 6f6e 696e 6720 7468 6520 7265  visioning the re
-00001210: 6d6f 7465 2068 6f73 7422 2c0a 290a 4063  mote host",.).@c
-00001220: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
-00001230: 2022 2d2d 7061 7373 776f 7264 222c 0a20   "--password",. 
-00001240: 2020 2064 6566 6175 6c74 3d4e 6f6e 652c     default=None,
-00001250: 0a20 2020 2072 6571 7569 7265 643d 4661  .    required=Fa
-00001260: 6c73 652c 0a20 2020 2074 7970 653d 7374  lse,.    type=st
-00001270: 722c 0a20 2020 2068 656c 703d 224f 7074  r,.    help="Opt
-00001280: 696f 6e61 6c3a 2074 6865 2070 6173 7377  ional: the passw
-00001290: 6f72 6420 666f 7220 7072 6f76 6973 696f  ord for provisio
-000012a0: 6e69 6e67 2074 6865 2072 656d 6f74 6520  ning the remote 
-000012b0: 686f 7374 222c 0a29 0a40 636c 6963 6b2e  host",.).@click.
-000012c0: 6f70 7469 6f6e 280a 2020 2020 222d 2d72  option(.    "--r
-000012d0: 6570 6f22 2c0a 2020 2020 6465 6661 756c  epo",.    defaul
-000012e0: 743d 4e6f 6e65 2c0a 2020 2020 7265 7175  t=None,.    requ
-000012f0: 6972 6564 3d46 616c 7365 2c0a 2020 2020  ired=False,.    
-00001300: 7479 7065 3d73 7472 2c0a 2020 2020 6865  type=str,.    he
-00001310: 6c70 3d22 4f70 7469 6f6e 616c 3a20 7265  lp="Optional: re
-00001320: 706f 2074 6f20 6665 7463 6820 736f 7572  po to fetch sour
-00001330: 6365 2066 726f 6d22 2c0a 290a 4063 6c69  ce from",.).@cli
-00001340: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-00001350: 2d2d 6272 616e 6368 222c 0a20 2020 2064  --branch",.    d
-00001360: 6566 6175 6c74 3d4e 6f6e 652c 0a20 2020  efault=None,.   
-00001370: 2072 6571 7569 7265 643d 4661 6c73 652c   required=False,
-00001380: 0a20 2020 2074 7970 653d 7374 722c 0a20  .    type=str,. 
-00001390: 2020 2068 656c 703d 224f 7074 696f 6e61     help="Optiona
-000013a0: 6c3a 2062 7261 6e63 6820 746f 206d 6f6e  l: branch to mon
-000013b0: 6974 6f72 2066 6f72 2075 7064 6174 6573  itor for updates
-000013c0: 222c 0a29 0a40 636c 6963 6b2e 6f70 7469  ",.).@click.opti
-000013d0: 6f6e 280a 2020 2020 222d 2d74 6169 6c22  on(.    "--tail"
-000013e0: 2c0a 2020 2020 6465 6661 756c 743d 2274  ,.    default="t
-000013f0: 7275 6522 2c0a 2020 2020 7265 7175 6972  rue",.    requir
-00001400: 6564 3d46 616c 7365 2c0a 2020 2020 7479  ed=False,.    ty
-00001410: 7065 3d73 7472 2c0a 2020 2020 6865 6c70  pe=str,.    help
-00001420: 3d22 4f70 7469 6f6e 616c 3a20 646f 6e27  ="Optional: don'
-00001430: 7420 7461 696c 206c 6f67 7320 6f6e 206c  t tail logs on l
-00001440: 6175 6e63 6822 2c0a 290a 4063 6c69 636b  aunch",.).@click
-00001450: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
-00001460: 6865 6164 6c65 7373 222c 0a20 2020 2064  headless",.    d
-00001470: 6566 6175 6c74 3d22 6661 6c73 6522 2c0a  efault="false",.
-00001480: 2020 2020 7265 7175 6972 6564 3d46 616c      required=Fal
-00001490: 7365 2c0a 2020 2020 7479 7065 3d73 7472  se,.    type=str
-000014a0: 2c0a 2020 2020 6865 6c70 3d22 4f70 7469  ,.    help="Opti
-000014b0: 6f6e 616c 3a20 646f 6e27 7420 7374 6172  onal: don't star
-000014c0: 7420 7468 6520 6672 6f6e 7465 6e64 2063  t the frontend c
-000014d0: 6f6e 7461 696e 6572 222c 0a29 0a40 636c  ontainer",.).@cl
-000014e0: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-000014f0: 222d 2d63 6d64 222c 0a20 2020 2064 6566  "--cmd",.    def
-00001500: 6175 6c74 3d22 6661 6c73 6522 2c0a 2020  ault="false",.  
-00001510: 2020 7265 7175 6972 6564 3d46 616c 7365    required=False
-00001520: 2c0a 2020 2020 7479 7065 3d73 7472 2c0a  ,.    type=str,.
-00001530: 2020 2020 6865 6c70 3d22 4f70 7469 6f6e      help="Option
-00001540: 616c 3a20 7072 696e 7420 7468 6520 636d  al: print the cm
-00001550: 6420 7769 7468 6f75 7420 7275 6e6e 696e  d without runnin
-00001560: 6720 6974 222c 0a29 0a40 636c 6963 6b2e  g it",.).@click.
-00001570: 6f70 7469 6f6e 280a 2020 2020 222d 2d6a  option(.    "--j
-00001580: 7570 7974 6572 222c 0a20 2020 2069 735f  upyter",.    is_
-00001590: 666c 6167 3d54 7275 652c 0a20 2020 2068  flag=True,.    h
-000015a0: 656c 703d 224f 7074 696f 6e61 6c3a 2065  elp="Optional: e
-000015b0: 6e61 626c 6520 4a75 7079 7465 7220 4e6f  nable Jupyter No
-000015c0: 7465 626f 6f6b 7322 2c0a 290a 4063 6c69  tebooks",.).@cli
-000015d0: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-000015e0: 2d2d 6275 696c 6422 2c0a 2020 2020 6465  --build",.    de
-000015f0: 6661 756c 743d 4e6f 6e65 2c0a 2020 2020  fault=None,.    
-00001600: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
-00001610: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
-00001620: 2020 6865 6c70 3d22 4f70 7469 6f6e 616c    help="Optional
-00001630: 3a20 656e 6162 6c65 206f 7220 6469 7361  : enable or disa
-00001640: 626c 6520 666f 7263 696e 6720 7265 2d62  ble forcing re-b
-00001650: 7569 6c64 222c 0a29 0a40 636c 6963 6b2e  uild",.).@click.
-00001660: 6f70 7469 6f6e 280a 2020 2020 222d 2d70  option(.    "--p
-00001670: 726f 7669 7369 6f6e 222c 0a20 2020 2064  rovision",.    d
-00001680: 6566 6175 6c74 3d22 7472 7565 222c 0a20  efault="true",. 
-00001690: 2020 2072 6571 7569 7265 643d 4661 6c73     required=Fals
-000016a0: 652c 0a20 2020 2074 7970 653d 7374 722c  e,.    type=str,
-000016b0: 0a20 2020 2068 656c 703d 224f 7074 696f  .    help="Optio
-000016c0: 6e61 6c3a 2065 6e61 626c 6520 6f72 2064  nal: enable or d
-000016d0: 6973 6162 6c65 2070 726f 7669 7369 6f6e  isable provision
-000016e0: 696e 6720 564d 7322 2c0a 290a 4063 6c69  ing VMs",.).@cli
-000016f0: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-00001700: 2d2d 6e6f 6465 5f63 6f75 6e74 222c 0a20  --node_count",. 
-00001710: 2020 2064 6566 6175 6c74 3d31 2c0a 2020     default=1,.  
-00001720: 2020 7265 7175 6972 6564 3d46 616c 7365    required=False
-00001730: 2c0a 2020 2020 7479 7065 3d63 6c69 636b  ,.    type=click
-00001740: 2e49 6e74 5261 6e67 6528 312c 2032 3530  .IntRange(1, 250
-00001750: 292c 0a20 2020 2068 656c 703d 224f 7074  ),.    help="Opt
-00001760: 696f 6e61 6c3a 206e 756d 6265 7220 6f66  ional: number of
-00001770: 2069 6e64 6570 656e 6465 6e74 206e 6f64   independent nod
-00001780: 6573 2f56 4d73 2074 6f20 6c61 756e 6368  es/VMs to launch
-00001790: 222c 0a29 0a40 636c 6963 6b2e 6f70 7469  ",.).@click.opti
-000017a0: 6f6e 280a 2020 2020 222d 2d61 7574 685f  on(.    "--auth_
-000017b0: 7479 7065 222c 0a20 2020 2064 6566 6175  type",.    defau
-000017c0: 6c74 3d4e 6f6e 652c 0a20 2020 2074 7970  lt=None,.    typ
-000017d0: 653d 636c 6963 6b2e 4368 6f69 6365 285b  e=click.Choice([
-000017e0: 226b 6579 222c 2022 7061 7373 776f 7264  "key", "password
-000017f0: 225d 2c20 6361 7365 5f73 656e 7369 7469  "], case_sensiti
-00001800: 7665 3d46 616c 7365 292c 0a29 0a40 636c  ve=False),.).@cl
-00001810: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-00001820: 222d 2d61 6e73 6962 6c65 5f65 7874 7261  "--ansible_extra
-00001830: 7322 2c0a 2020 2020 6465 6661 756c 743d  s",.    default=
-00001840: 2222 2c0a 2020 2020 7479 7065 3d73 7472  "",.    type=str
-00001850: 2c0a 290a 4063 6c69 636b 2e6f 7074 696f  ,.).@click.optio
-00001860: 6e28 222d 2d74 6c73 222c 2069 735f 666c  n("--tls", is_fl
-00001870: 6167 3d54 7275 652c 2068 656c 703d 224c  ag=True, help="L
-00001880: 6175 6e63 6820 7769 7468 2054 4c53 2063  aunch with TLS c
-00001890: 6f6e 6669 6775 7261 7469 6f6e 2229 0a40  onfiguration").@
-000018a0: 636c 6963 6b2e 6f70 7469 6f6e 2822 2d2d  click.option("--
-000018b0: 7465 7374 222c 2069 735f 666c 6167 3d54  test", is_flag=T
-000018c0: 7275 652c 2068 656c 703d 224c 6175 6e63  rue, help="Launc
-000018d0: 6820 7769 7468 2074 6573 7420 636f 6e66  h with test conf
-000018e0: 6967 7572 6174 696f 6e22 290a 4063 6c69  iguration").@cli
-000018f0: 636b 2e6f 7074 696f 6e28 222d 2d64 6576  ck.option("--dev
-00001900: 222c 2069 735f 666c 6167 3d54 7275 652c  ", is_flag=True,
-00001910: 2068 656c 703d 2253 686f 7274 6375 7420   help="Shortcut 
-00001920: 666f 7220 6465 7665 6c6f 706d 656e 7420  for development 
-00001930: 7265 6c65 6173 6522 290a 4063 6c69 636b  release").@click
-00001940: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
-00001950: 7265 6c65 6173 6522 2c0a 2020 2020 6465  release",.    de
-00001960: 6661 756c 743d 2270 726f 6475 6374 696f  fault="productio
-00001970: 6e22 2c0a 2020 2020 7265 7175 6972 6564  n",.    required
-00001980: 3d46 616c 7365 2c0a 2020 2020 7479 7065  =False,.    type
-00001990: 3d63 6c69 636b 2e43 686f 6963 6528 5b22  =click.Choice(["
-000019a0: 7072 6f64 7563 7469 6f6e 222c 2022 6465  production", "de
-000019b0: 7665 6c6f 706d 656e 7422 5d2c 2063 6173  velopment"], cas
-000019c0: 655f 7365 6e73 6974 6976 653d 4661 6c73  e_sensitive=Fals
-000019d0: 6529 2c0a 2020 2020 6865 6c70 3d22 4f70  e),.    help="Op
-000019e0: 7469 6f6e 616c 3a20 6368 6f6f 7365 2062  tional: choose b
-000019f0: 6574 7765 656e 2070 726f 6475 6374 696f  etween productio
-00001a00: 6e20 616e 6420 6465 7665 6c6f 706d 656e  n and developmen
-00001a10: 7420 7265 6c65 6173 6522 2c0a 290a 4063  t release",.).@c
-00001a20: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
-00001a30: 2022 2d2d 6365 7274 5f73 746f 7265 5f70   "--cert_store_p
-00001a40: 6174 6822 2c0a 2020 2020 6465 6661 756c  ath",.    defaul
-00001a50: 743d 222f 686f 6d65 2f6f 6d2f 6365 7274  t="/home/om/cert
-00001a60: 7322 2c0a 2020 2020 7265 7175 6972 6564  s",.    required
-00001a70: 3d46 616c 7365 2c0a 2020 2020 7479 7065  =False,.    type
-00001a80: 3d73 7472 2c0a 2020 2020 6865 6c70 3d22  =str,.    help="
-00001a90: 4f70 7469 6f6e 616c 3a20 7265 6d6f 7465  Optional: remote
-00001aa0: 2070 6174 6820 746f 2073 746f 7265 2061   path to store a
-00001ab0: 6e64 206c 6f61 6420 544c 5320 6365 7274  nd load TLS cert
-00001ac0: 2061 6e64 206b 6579 222c 0a29 0a40 636c   and key",.).@cl
-00001ad0: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-00001ae0: 222d 2d75 706c 6f61 645f 746c 735f 6365  "--upload_tls_ce
-00001af0: 7274 222c 0a20 2020 2064 6566 6175 6c74  rt",.    default
-00001b00: 3d22 222c 0a20 2020 2072 6571 7569 7265  ="",.    require
-00001b10: 643d 4661 6c73 652c 0a20 2020 2074 7970  d=False,.    typ
-00001b20: 653d 7374 722c 0a20 2020 2068 656c 703d  e=str,.    help=
-00001b30: 224f 7074 696f 6e61 6c3a 206c 6f63 616c  "Optional: local
-00001b40: 2070 6174 6820 746f 2054 4c53 2063 6572   path to TLS cer
-00001b50: 7420 746f 2075 706c 6f61 6420 616e 6420  t to upload and 
-00001b60: 7374 6f72 6520 6174 202d 2d63 6572 745f  store at --cert_
-00001b70: 7374 6f72 655f 7061 7468 222c 0a29 0a40  store_path",.).@
-00001b80: 636c 6963 6b2e 6f70 7469 6f6e 280a 2020  click.option(.  
-00001b90: 2020 222d 2d75 706c 6f61 645f 746c 735f    "--upload_tls_
-00001ba0: 6b65 7922 2c0a 2020 2020 6465 6661 756c  key",.    defaul
-00001bb0: 743d 2222 2c0a 2020 2020 7265 7175 6972  t="",.    requir
-00001bc0: 6564 3d46 616c 7365 2c0a 2020 2020 7479  ed=False,.    ty
-00001bd0: 7065 3d73 7472 2c0a 2020 2020 6865 6c70  pe=str,.    help
-00001be0: 3d22 4f70 7469 6f6e 616c 3a20 6c6f 6361  ="Optional: loca
-00001bf0: 6c20 7061 7468 2074 6f20 544c 5320 7072  l path to TLS pr
-00001c00: 6976 6174 6520 6b65 7920 746f 2075 706c  ivate key to upl
-00001c10: 6f61 6420 616e 6420 7374 6f72 6520 6174  oad and store at
-00001c20: 202d 2d63 6572 745f 7374 6f72 655f 7061   --cert_store_pa
-00001c30: 7468 222c 0a29 0a40 636c 6963 6b2e 6f70  th",.).@click.op
-00001c40: 7469 6f6e 280a 2020 2020 222d 2d75 7365  tion(.    "--use
-00001c50: 5f62 6c6f 625f 7374 6f72 6167 6522 2c0a  _blob_storage",.
-00001c60: 2020 2020 6465 6661 756c 743d 4e6f 6e65      default=None
-00001c70: 2c0a 2020 2020 7265 7175 6972 6564 3d46  ,.    required=F
-00001c80: 616c 7365 2c0a 2020 2020 7479 7065 3d73  alse,.    type=s
-00001c90: 7472 2c0a 2020 2020 6865 6c70 3d22 4f70  tr,.    help="Op
-00001ca0: 7469 6f6e 616c 3a20 666c 6167 2074 6f20  tional: flag to 
-00001cb0: 7573 6520 626c 6f62 2073 746f 7261 6765  use blob storage
-00001cc0: 222c 0a29 0a40 636c 6963 6b2e 6f70 7469  ",.).@click.opti
-00001cd0: 6f6e 280a 2020 2020 222d 2d69 6d61 6765  on(.    "--image
-00001ce0: 5f6e 616d 6522 2c0a 2020 2020 6465 6661  _name",.    defa
-00001cf0: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
-00001d00: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
-00001d10: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
-00001d20: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-00001d30: 696d 6167 6520 746f 2075 7365 2066 6f72  image to use for
-00001d40: 2074 6865 2056 4d22 2c0a 290a 4063 6c69   the VM",.).@cli
-00001d50: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-00001d60: 2d2d 7461 6722 2c0a 2020 2020 6465 6661  --tag",.    defa
-00001d70: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
-00001d80: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
-00001d90: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
-00001da0: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-00001db0: 636f 6e74 6169 6e65 7220 696d 6167 6520  container image 
-00001dc0: 7461 6720 746f 2075 7365 222c 0a29 0a40  tag to use",.).@
-00001dd0: 636c 6963 6b2e 6f70 7469 6f6e 280a 2020  click.option(.  
-00001de0: 2020 222d 2d62 7569 6c64 5f73 7263 222c    "--build_src",
-00001df0: 0a20 2020 2064 6566 6175 6c74 3d44 4546  .    default=DEF
-00001e00: 4155 4c54 5f42 5241 4e43 482c 0a20 2020  AULT_BRANCH,.   
-00001e10: 2072 6571 7569 7265 643d 4661 6c73 652c   required=False,
-00001e20: 0a20 2020 2074 7970 653d 7374 722c 0a20  .    type=str,. 
-00001e30: 2020 2068 656c 703d 224f 7074 696f 6e61     help="Optiona
-00001e40: 6c3a 2067 6974 2062 7261 6e63 6820 746f  l: git branch to
-00001e50: 2075 7365 2066 6f72 206c 6175 6e63 6820   use for launch 
-00001e60: 2f20 6275 696c 6420 6f70 6572 6174 696f  / build operatio
-00001e70: 6e73 222c 0a29 0a40 636c 6963 6b2e 6f70  ns",.).@click.op
-00001e80: 7469 6f6e 280a 2020 2020 222d 2d70 6c61  tion(.    "--pla
-00001e90: 7466 6f72 6d22 2c0a 2020 2020 6465 6661  tform",.    defa
-00001ea0: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
-00001eb0: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
-00001ec0: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
-00001ed0: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-00001ee0: 7275 6e20 646f 636b 6572 2077 6974 6820  run docker with 
-00001ef0: 6120 6469 6666 6572 656e 7420 706c 6174  a different plat
-00001f00: 666f 726d 206c 696b 6520 6c69 6e75 782f  form like linux/
-00001f10: 6172 6d36 3422 2c0a 290a 4063 6c69 636b  arm64",.).@click
-00001f20: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
-00001f30: 7670 6e22 2c0a 2020 2020 6465 6661 756c  vpn",.    defaul
-00001f40: 743d 2274 7275 6522 2c0a 2020 2020 7265  t="true",.    re
-00001f50: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
-00001f60: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
-00001f70: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-00001f80: 7475 726e 2074 6169 6c73 6361 6c65 2076  turn tailscale v
-00001f90: 706e 2063 6f6e 7461 696e 6572 206f 6e20  pn container on 
-00001fa0: 6f72 206f 6666 222c 0a29 0a40 636c 6963  or off",.).@clic
-00001fb0: 6b2e 6f70 7469 6f6e 280a 2020 2020 222d  k.option(.    "-
-00001fc0: 2d73 696c 656e 7422 2c0a 2020 2020 6973  -silent",.    is
-00001fd0: 5f66 6c61 673d 5472 7565 2c0a 2020 2020  _flag=True,.    
-00001fe0: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
-00001ff0: 7072 6576 656e 7420 6c6f 7473 206f 6620  prevent lots of 
-00002000: 6c61 756e 6368 206f 7574 7075 7422 2c0a  launch output",.
-00002010: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
-00002020: 0a20 2020 2022 2d2d 6672 6f6d 5f74 656d  .    "--from_tem
-00002030: 706c 6174 6522 2c0a 2020 2020 6465 6661  plate",.    defa
-00002040: 756c 743d 2266 616c 7365 222c 0a20 2020  ult="false",.   
-00002050: 2072 6571 7569 7265 643d 4661 6c73 652c   required=False,
-00002060: 0a20 2020 2074 7970 653d 7374 722c 0a20  .    type=str,. 
-00002070: 2020 2068 656c 703d 224f 7074 696f 6e61     help="Optiona
-00002080: 6c3a 206c 6175 6e63 6820 6e6f 6465 2075  l: launch node u
-00002090: 7369 6e67 2074 6865 206d 616e 6966 6573  sing the manifes
-000020a0: 7420 7465 6d70 6c61 7465 222c 0a29 0a64  t template",.).d
-000020b0: 6566 206c 6175 6e63 6828 6172 6773 3a20  ef launch(args: 
-000020c0: 5479 7065 5475 706c 655b 7374 725d 2c20  TypeTuple[str], 
-000020d0: 2a2a 6b77 6172 6773 3a20 5479 7065 4469  **kwargs: TypeDi
-000020e0: 6374 5b73 7472 2c20 416e 795d 2920 2d3e  ct[str, Any]) ->
-000020f0: 204e 6f6e 653a 0a20 2020 2076 6572 6220   None:.    verb 
-00002100: 3d20 6765 745f 6c61 756e 6368 5f76 6572  = get_launch_ver
-00002110: 6228 290a 2020 2020 7472 793a 0a20 2020  b().    try:.   
-00002120: 2020 2020 2067 7261 6d6d 6172 203d 2070       grammar = p
-00002130: 6172 7365 5f67 7261 6d6d 6172 2861 7267  arse_grammar(arg
-00002140: 733d 6172 6773 2c20 7665 7262 3d76 6572  s=args, verb=ver
-00002150: 6229 0a20 2020 2020 2020 2076 6572 622e  b).        verb.
-00002160: 6c6f 6164 5f67 7261 6d6d 6172 2867 7261  load_grammar(gra
-00002170: 6d6d 6172 3d67 7261 6d6d 6172 290a 2020  mmar=grammar).  
-00002180: 2020 6578 6365 7074 2042 6164 4772 616d    except BadGram
-00002190: 6d61 7220 6173 2065 3a0a 2020 2020 2020  mar as e:.      
-000021a0: 2020 7072 696e 7428 6529 0a20 2020 2020    print(e).     
-000021b0: 2020 2072 6574 7572 6e0a 0a20 2020 2074     return..    t
-000021c0: 7279 3a0a 2020 2020 2020 2020 7570 6461  ry:.        upda
-000021d0: 7465 5f72 6570 6f28 7265 706f 3d47 4954  te_repo(repo=GIT
-000021e0: 5f52 4550 4f2c 2062 7261 6e63 683d 7374  _REPO, branch=st
-000021f0: 7228 6b77 6172 6773 5b22 6275 696c 645f  r(kwargs["build_
-00002200: 7372 6322 5d29 290a 2020 2020 6578 6365  src"])).    exce
-00002210: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00002220: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00002230: 2866 2246 6169 6c65 6420 746f 2075 7064  (f"Failed to upd
-00002240: 6174 6520 7265 706f 2e20 7b65 7d22 290a  ate repo. {e}").
-00002250: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002260: 2063 6d64 7320 3d20 6372 6561 7465 5f6c   cmds = create_l
-00002270: 6175 6e63 685f 636d 6428 7665 7262 3d76  aunch_cmd(verb=v
-00002280: 6572 622c 206b 7761 7267 733d 6b77 6172  erb, kwargs=kwar
-00002290: 6773 290a 2020 2020 2020 2020 636d 6473  gs).        cmds
-000022a0: 203d 205b 636d 6473 5d20 6966 2069 7369   = [cmds] if isi
-000022b0: 6e73 7461 6e63 6528 636d 6473 2c20 7374  nstance(cmds, st
-000022c0: 7229 2065 6c73 6520 636d 6473 0a20 2020  r) else cmds.   
-000022d0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000022e0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-000022f0: 7072 696e 7428 6622 4572 726f 723a 207b  print(f"Error: {
-00002300: 657d 5c6e 5c6e 2229 0a20 2020 2020 2020  e}\n\n").       
-00002310: 2072 6574 7572 6e0a 0a20 2020 2064 7279   return..    dry
-00002320: 5f72 756e 203d 2054 7275 650a 2020 2020  _run = True.    
-00002330: 6966 2022 636d 6422 206e 6f74 2069 6e20  if "cmd" not in 
-00002340: 6b77 6172 6773 206f 7220 7374 725f 746f  kwargs or str_to
-00002350: 5f62 6f6f 6c28 6361 7374 2873 7472 2c20  _bool(cast(str, 
-00002360: 6b77 6172 6773 5b22 636d 6422 5d29 2920  kwargs["cmd"])) 
-00002370: 6973 2046 616c 7365 3a0a 2020 2020 2020  is False:.      
-00002380: 2020 6472 795f 7275 6e20 3d20 4661 6c73    dry_run = Fals
-00002390: 650a 0a20 2020 2074 7279 3a0a 2020 2020  e..    try:.    
-000023a0: 2020 2020 7369 6c65 6e74 203d 2062 6f6f      silent = boo
-000023b0: 6c28 6b77 6172 6773 5b22 7369 6c65 6e74  l(kwargs["silent
-000023c0: 225d 2920 6966 2022 7369 6c65 6e74 2220  "]) if "silent" 
-000023d0: 696e 206b 7761 7267 7320 656c 7365 2046  in kwargs else F
-000023e0: 616c 7365 0a20 2020 2020 2020 2066 726f  alse.        fro
-000023f0: 6d5f 7265 6e64 6572 6564 5f64 6972 203d  m_rendered_dir =
-00002400: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-00002410: 7472 5f74 6f5f 626f 6f6c 2863 6173 7428  tr_to_bool(cast(
-00002420: 7374 722c 206b 7761 7267 735b 2266 726f  str, kwargs["fro
-00002430: 6d5f 7465 6d70 6c61 7465 225d 2929 2061  m_template"])) a
-00002440: 6e64 2045 4449 5441 424c 455f 4d4f 4445  nd EDITABLE_MODE
-00002450: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00002460: 2020 2020 6578 6563 7574 655f 636f 6d6d      execute_comm
-00002470: 616e 6473 280a 2020 2020 2020 2020 2020  ands(.          
-00002480: 2020 636d 6473 2c20 6472 795f 7275 6e3d    cmds, dry_run=
-00002490: 6472 795f 7275 6e2c 2073 696c 656e 743d  dry_run, silent=
-000024a0: 7369 6c65 6e74 2c20 6672 6f6d 5f72 656e  silent, from_ren
-000024b0: 6465 7265 645f 6469 723d 6672 6f6d 5f72  dered_dir=from_r
-000024c0: 656e 6465 7265 645f 6469 720a 2020 2020  endered_dir.    
-000024d0: 2020 2020 290a 2020 2020 2020 2020 7072      ).        pr
-000024e0: 696e 7428 2253 7563 6365 7373 215c 6e5c  int("Success!\n\
-000024f0: 6e22 290a 2020 2020 6578 6365 7074 2045  n").    except E
-00002500: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-00002510: 2020 2020 2020 2070 7269 6e74 2866 2245         print(f"E
-00002520: 7272 6f72 3a20 7b65 7d5c 6e5c 6e22 290a  rror: {e}\n\n").
-00002530: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00002540: 0a64 6566 2065 7865 6375 7465 5f63 6f6d  .def execute_com
-00002550: 6d61 6e64 7328 0a20 2020 2063 6d64 733a  mands(.    cmds:
-00002560: 2054 7970 654c 6973 742c 0a20 2020 2064   TypeList,.    d
-00002570: 7279 5f72 756e 3a20 626f 6f6c 203d 2046  ry_run: bool = F
-00002580: 616c 7365 2c0a 2020 2020 7369 6c65 6e74  alse,.    silent
-00002590: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-000025a0: 2020 2020 6672 6f6d 5f72 656e 6465 7265      from_rendere
-000025b0: 645f 6469 723a 2062 6f6f 6c20 3d20 4661  d_dir: bool = Fa
-000025c0: 6c73 652c 0a29 202d 3e20 4e6f 6e65 3a0a  lse,.) -> None:.
-000025d0: 2020 2020 2222 2245 7865 6375 7465 2074      """Execute t
-000025e0: 6865 206c 6175 6e63 6820 636f 6d6d 616e  he launch comman
-000025f0: 6473 2061 6e64 2064 6973 706c 6179 2074  ds and display t
-00002600: 6865 6972 2073 7461 7475 7320 696e 2072  heir status in r
-00002610: 6561 6c74 696d 652e 0a0a 2020 2020 4172  ealtime...    Ar
-00002620: 6773 3a0a 2020 2020 2020 2020 636d 6473  gs:.        cmds
-00002630: 2028 6c69 7374 293a 206c 6973 7420 6f66   (list): list of
-00002640: 2063 6f6d 6d61 6e64 7320 746f 2062 6520   commands to be 
-00002650: 6578 6563 7574 6564 0a20 2020 2020 2020  executed.       
-00002660: 2064 7279 5f72 756e 2028 626f 6f6c 2c20   dry_run (bool, 
-00002670: 6f70 7469 6f6e 616c 293a 2049 6620 6054  optional): If `T
-00002680: 7275 6560 206f 6e6c 7920 6469 7370 6c61  rue` only displa
-00002690: 7973 2063 6d64 7320 746f 2062 6520 6578  ys cmds to be ex
-000026a0: 6563 7574 6564 2e20 4465 6661 756c 7473  ecuted. Defaults
-000026b0: 2074 6f20 4661 6c73 652e 0a20 2020 2022   to False..    "
-000026c0: 2222 0a20 2020 2070 726f 6365 7373 5f6c  "".    process_l
-000026d0: 6973 743a 2054 7970 654c 6973 7420 3d20  ist: TypeList = 
-000026e0: 5b5d 0a20 2020 2063 6f6e 736f 6c65 203d  [].    console =
-000026f0: 2072 6963 682e 6765 745f 636f 6e73 6f6c   rich.get_consol
-00002700: 6528 290a 0a20 2020 2075 7365 726e 616d  e()..    usernam
-00002710: 652c 2070 6173 7377 6f72 6420 3d20 280a  e, password = (.
-00002720: 2020 2020 2020 2020 6578 7472 6163 745f          extract_
-00002730: 7573 6572 6e61 6d65 5f61 6e64 5f70 6173  username_and_pas
-00002740: 7328 636d 6473 5b30 5d29 2069 6620 6c65  s(cmds[0]) if le
-00002750: 6e28 636d 6473 2920 3e20 3020 656c 7365  n(cmds) > 0 else
-00002760: 2028 222d 222c 2022 2d22 290a 2020 2020   ("-", "-").    
-00002770: 290a 2020 2020 2320 6469 7370 6c61 7920  ).    # display 
-00002780: 564d 2063 7265 6465 6e74 6961 6c73 0a20  VM credentials. 
-00002790: 2020 2063 6f6e 736f 6c65 2e70 7269 6e74     console.print
-000027a0: 2867 656e 6572 6174 655f 7573 6572 5f74  (generate_user_t
-000027b0: 6162 6c65 2875 7365 726e 616d 653d 7573  able(username=us
-000027c0: 6572 6e61 6d65 2c20 7061 7373 776f 7264  ername, password
-000027d0: 3d70 6173 7377 6f72 6429 290a 0a20 2020  =password))..   
-000027e0: 2063 7764 203d 2028 0a20 2020 2020 2020   cwd = (.       
-000027f0: 206f 732e 7061 7468 2e6a 6f69 6e28 4752   os.path.join(GR
-00002800: 4944 5f53 5243 5f50 4154 482c 2052 454e  ID_SRC_PATH, REN
-00002810: 4445 5245 445f 4449 5229 0a20 2020 2020  DERED_DIR).     
-00002820: 2020 2069 6620 6672 6f6d 5f72 656e 6465     if from_rende
-00002830: 7265 645f 6469 720a 2020 2020 2020 2020  red_dir.        
-00002840: 656c 7365 2047 5249 445f 5352 435f 5041  else GRID_SRC_PA
-00002850: 5448 0a20 2020 2029 0a0a 2020 2020 7072  TH.    )..    pr
-00002860: 696e 7428 2243 7572 7265 6e74 2057 6f72  int("Current Wor
-00002870: 6b69 6e67 2044 6972 6563 746f 7279 3a20  king Directory: 
-00002880: 222c 2063 7764 290a 0a20 2020 2066 6f72  ", cwd)..    for
-00002890: 2063 6d64 2069 6e20 636d 6473 3a0a 2020   cmd in cmds:.  
-000028a0: 2020 2020 2020 6966 2064 7279 5f72 756e        if dry_run
-000028b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000028c0: 696e 7428 2252 756e 6e69 6e67 3a20 5c6e  int("Running: \n
-000028d0: 222c 2068 6964 655f 7061 7373 776f 7264  ", hide_password
-000028e0: 2863 6d64 3d63 6d64 2929 0a20 2020 2020  (cmd=cmd)).     
-000028f0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00002900: 0a20 2020 2020 2020 2023 2075 7365 2070  .        # use p
-00002910: 6f77 6572 7368 656c 6c20 6966 2065 6e76  owershell if env
-00002920: 6972 6f6e 6d65 6e74 2069 7320 5769 6e64  ironment is Wind
-00002930: 6f77 730a 2020 2020 2020 2020 636d 645f  ows.        cmd_
-00002940: 746f 5f65 7865 6320 3d20 5b22 706f 7765  to_exec = ["powe
-00002950: 7273 6865 6c6c 2e65 7865 222c 2022 2d43  rshell.exe", "-C
-00002960: 6f6d 6d61 6e64 222c 2063 6d64 5d20 6966  ommand", cmd] if
-00002970: 2069 735f 7769 6e64 6f77 7328 2920 656c   is_windows() el
-00002980: 7365 2063 6d64 0a0a 2020 2020 2020 2020  se cmd..        
-00002990: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000029a0: 2069 6620 6c65 6e28 636d 6473 2920 3e20   if len(cmds) > 
-000029b0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-000029c0: 2020 2070 726f 6365 7373 203d 2073 7562     process = sub
-000029d0: 7072 6f63 6573 732e 506f 7065 6e28 2020  process.Popen(  
-000029e0: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
-000029f0: 2020 2020 2020 2020 2020 2020 636d 645f              cmd_
-00002a00: 746f 5f65 7865 632c 0a20 2020 2020 2020  to_exec,.       
-00002a10: 2020 2020 2020 2020 2020 2020 2073 7464               std
-00002a20: 6f75 743d 7375 6270 726f 6365 7373 2e50  out=subprocess.P
-00002a30: 4950 452c 0a20 2020 2020 2020 2020 2020  IPE,.           
-00002a40: 2020 2020 2020 2020 2073 7464 6572 723d           stderr=
-00002a50: 7375 6270 726f 6365 7373 2e50 4950 452c  subprocess.PIPE,
-00002a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002a70: 2020 2020 2063 7764 3d63 7764 2c0a 2020       cwd=cwd,.  
-00002a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a90: 2020 7368 656c 6c3d 5472 7565 2c0a 2020    shell=True,.  
-00002aa0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00002ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ac0: 6970 5f61 6464 7265 7373 203d 2065 7874  ip_address = ext
-00002ad0: 7261 6374 5f68 6f73 745f 6970 5f66 726f  ract_host_ip_fro
-00002ae0: 6d5f 636d 6428 636d 6429 0a20 2020 2020  m_cmd(cmd).     
-00002af0: 2020 2020 2020 2020 2020 206a 7570 7974             jupyt
-00002b00: 6572 5f74 6f6b 656e 203d 2065 7874 7261  er_token = extra
-00002b10: 6374 5f6a 7570 7974 6572 5f74 6f6b 656e  ct_jupyter_token
-00002b20: 2863 6d64 290a 2020 2020 2020 2020 2020  (cmd).          
-00002b30: 2020 2020 2020 7072 6f63 6573 735f 6c69        process_li
-00002b40: 7374 2e61 7070 656e 6428 2869 705f 6164  st.append((ip_ad
-00002b50: 6472 6573 732c 2070 726f 6365 7373 2c20  dress, process, 
-00002b60: 6a75 7079 7465 725f 746f 6b65 6e29 290a  jupyter_token)).
-00002b70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00002b80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002b90: 2020 6469 7370 6c61 795f 6a75 7079 7465    display_jupyte
-00002ba0: 725f 746f 6b65 6e28 636d 6429 0a20 2020  r_token(cmd).   
-00002bb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00002bc0: 7369 6c65 6e74 3a0a 2020 2020 2020 2020  silent:.        
-00002bd0: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-00002be0: 6573 7320 3d20 7375 6270 726f 6365 7373  ess = subprocess
-00002bf0: 2e50 6f70 656e 2820 2023 206e 6f73 6563  .Popen(  # nosec
-00002c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002c10: 2020 2020 2020 2020 2063 6d64 5f74 6f5f           cmd_to_
-00002c20: 6578 6563 2c0a 2020 2020 2020 2020 2020  exec,.          
-00002c30: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00002c40: 646f 7574 3d73 7562 7072 6f63 6573 732e  dout=subprocess.
-00002c50: 5049 5045 2c0a 2020 2020 2020 2020 2020  PIPE,.          
-00002c60: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00002c70: 6465 7272 3d73 7562 7072 6f63 6573 732e  derr=subprocess.
-00002c80: 5049 5045 2c0a 2020 2020 2020 2020 2020  PIPE,.          
-00002c90: 2020 2020 2020 2020 2020 2020 2020 6377                cw
-00002ca0: 643d 6377 642c 0a20 2020 2020 2020 2020  d=cwd,.         
-00002cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002cc0: 6865 6c6c 3d54 7275 652c 0a20 2020 2020  hell=True,.     
-00002cd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00002ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002cf0: 2020 2020 2070 726f 6365 7373 2e63 6f6d       process.com
-00002d00: 6d75 6e69 6361 7465 2829 0a20 2020 2020  municate().     
-00002d10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00002d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002d30: 2020 2020 2073 7562 7072 6f63 6573 732e       subprocess.
-00002d40: 7275 6e28 2020 2320 6e6f 7365 630a 2020  run(  # nosec.  
-00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d60: 2020 2020 2020 636d 645f 746f 5f65 7865        cmd_to_exe
-00002d70: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
-00002d80: 2020 2020 2020 2020 2020 2073 6865 6c6c             shell
-00002d90: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00002da0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002db0: 7764 3d63 7764 2c0a 2020 2020 2020 2020  wd=cwd,.        
-00002dc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00002dd0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00002de0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-00002df0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00002e00: 2246 6169 6c65 6420 746f 2072 756e 2063  "Failed to run c
-00002e10: 6d64 3a20 7b63 6d64 7d2e 207b 657d 2229  md: {cmd}. {e}")
-00002e20: 0a0a 2020 2020 6966 2064 7279 5f72 756e  ..    if dry_run
-00002e30: 2069 7320 4661 6c73 6520 616e 6420 6c65   is False and le
-00002e40: 6e28 7072 6f63 6573 735f 6c69 7374 2920  n(process_list) 
-00002e50: 3e20 303a 0a20 2020 2020 2020 2023 2064  > 0:.        # d
-00002e60: 6973 706c 6179 2056 4d20 6c61 756e 6368  isplay VM launch
-00002e70: 2073 7461 7475 730a 2020 2020 2020 2020   status.        
-00002e80: 6469 7370 6c61 795f 766d 5f73 7461 7475  display_vm_statu
-00002e90: 7328 7072 6f63 6573 735f 6c69 7374 290a  s(process_list).
-00002ea0: 0a20 2020 2020 2020 2023 2073 6176 6520  .        # save 
-00002eb0: 766d 2064 6574 6169 6c73 2061 7320 6a73  vm details as js
-00002ec0: 6f6e 0a20 2020 2020 2020 2073 6176 655f  on.        save_
-00002ed0: 766d 5f64 6574 6169 6c73 5f61 735f 6a73  vm_details_as_js
-00002ee0: 6f6e 2875 7365 726e 616d 652c 2070 6173  on(username, pas
-00002ef0: 7377 6f72 642c 2070 726f 6365 7373 5f6c  sword, process_l
-00002f00: 6973 7429 0a0a 0a64 6566 2064 6973 706c  ist)...def displ
-00002f10: 6179 5f76 6d5f 7374 6174 7573 2870 726f  ay_vm_status(pro
-00002f20: 6365 7373 5f6c 6973 743a 2054 7970 654c  cess_list: TypeL
-00002f30: 6973 7429 202d 3e20 4e6f 6e65 3a0a 2020  ist) -> None:.  
-00002f40: 2020 2222 2244 6973 706c 6179 2074 6865    """Display the
-00002f50: 2073 7461 7475 7320 6f66 2074 6865 2070   status of the p
-00002f60: 726f 6365 7373 6573 2062 6569 6e67 2065  rocesses being e
-00002f70: 7865 6375 7465 6420 6f6e 2074 6865 2056  xecuted on the V
-00002f80: 4d2e 0a0a 2020 2020 4172 6773 3a0a 2020  M...    Args:.  
-00002f90: 2020 2020 2020 7072 6f63 6573 735f 6c69        process_li
-00002fa0: 7374 2028 6c69 7374 293a 206c 6973 7420  st (list): list 
-00002fb0: 6f66 2070 726f 6365 7373 6573 2065 7865  of processes exe
-00002fc0: 6375 7465 642e 0a20 2020 2022 2222 0a0a  cuted..    """..
-00002fd0: 2020 2020 2320 4765 6e65 7261 7465 2074      # Generate t
-00002fe0: 6865 2074 6162 6c65 2073 686f 7769 6e67  he table showing
-00002ff0: 2074 6865 2073 7461 7475 7320 6f66 2065   the status of e
-00003000: 6163 6820 7072 6f63 6573 7320 6265 696e  ach process bein
-00003010: 6720 6578 6563 7574 6564 0a20 2020 2073  g executed.    s
-00003020: 7461 7475 735f 7461 626c 652c 2070 726f  tatus_table, pro
-00003030: 6365 7373 5f63 6f6d 706c 6574 6564 203d  cess_completed =
-00003040: 2067 656e 6572 6174 655f 7072 6f63 6573   generate_proces
-00003050: 735f 7374 6174 7573 5f74 6162 6c65 2870  s_status_table(p
-00003060: 726f 6365 7373 5f6c 6973 7429 0a0a 2020  rocess_list)..  
-00003070: 2020 2320 5265 6e64 6572 2074 6865 206c    # Render the l
-00003080: 6976 6520 7461 626c 650a 2020 2020 7769  ive table.    wi
-00003090: 7468 204c 6976 6528 7374 6174 7573 5f74  th Live(status_t
-000030a0: 6162 6c65 2c20 7265 6672 6573 685f 7065  able, refresh_pe
-000030b0: 725f 7365 636f 6e64 3d31 2920 6173 206c  r_second=1) as l
-000030c0: 6976 653a 0a0a 2020 2020 2020 2020 2320  ive:..        # 
-000030d0: 4c6f 6f70 2074 696c 6c20 616c 6c20 7072  Loop till all pr
-000030e0: 6f63 6573 7365 7320 6861 7665 206e 6f74  ocesses have not
-000030f0: 2063 6f6d 706c 6574 6564 2065 7865 6375   completed execu
-00003100: 7469 6e67 0a20 2020 2020 2020 2077 6869  ting.        whi
-00003110: 6c65 206e 6f74 2070 726f 6365 7373 5f63  le not process_c
-00003120: 6f6d 706c 6574 6564 3a0a 2020 2020 2020  ompleted:.      
-00003130: 2020 2020 2020 7374 6174 7573 5f74 6162        status_tab
-00003140: 6c65 2c20 7072 6f63 6573 735f 636f 6d70  le, process_comp
-00003150: 6c65 7465 6420 3d20 6765 6e65 7261 7465  leted = generate
-00003160: 5f70 726f 6365 7373 5f73 7461 7475 735f  _process_status_
-00003170: 7461 626c 6528 0a20 2020 2020 2020 2020  table(.         
-00003180: 2020 2020 2020 2070 726f 6365 7373 5f6c         process_l
-00003190: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-000031a0: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
-000031b0: 7665 2e75 7064 6174 6528 7374 6174 7573  ve.update(status
-000031c0: 5f74 6162 6c65 2920 2023 2055 7064 6174  _table)  # Updat
-000031d0: 6520 7468 6520 7072 6f63 6573 7320 7374  e the process st
-000031e0: 6174 7573 2074 6162 6c65 0a0a 0a64 6566  atus table...def
-000031f0: 2064 6973 706c 6179 5f6a 7570 7974 6572   display_jupyter
-00003200: 5f74 6f6b 656e 2863 6d64 3a20 7374 7229  _token(cmd: str)
-00003210: 202d 3e20 4e6f 6e65 3a0a 2020 2020 746f   -> None:.    to
-00003220: 6b65 6e20 3d20 6578 7472 6163 745f 6a75  ken = extract_ju
-00003230: 7079 7465 725f 746f 6b65 6e28 636d 643d  pyter_token(cmd=
-00003240: 636d 6429 0a20 2020 2069 6620 746f 6b65  cmd).    if toke
-00003250: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-00003260: 2020 2020 2020 2070 7269 6e74 2866 224a         print(f"J
-00003270: 7570 7974 6572 2054 6f6b 656e 3a20 7b74  upyter Token: {t
-00003280: 6f6b 656e 7d22 290a 0a0a 6465 6620 6578  oken}")...def ex
-00003290: 7472 6163 745f 7573 6572 6e61 6d65 5f61  tract_username_a
-000032a0: 6e64 5f70 6173 7328 636d 643a 2073 7472  nd_pass(cmd: str
-000032b0: 2920 2d3e 2054 7570 6c65 3a0a 2020 2020  ) -> Tuple:.    
-000032c0: 2320 4578 7472 6163 7420 7573 6572 6e61  # Extract userna
-000032d0: 6d65 0a20 2020 206d 6174 6368 6572 203d  me.    matcher =
-000032e0: 2072 222d 2d75 7365 7220 282e 2b3f 2920   r"--user (.+?) 
-000032f0: 220a 2020 2020 7573 6572 6e61 6d65 203d  ".    username =
-00003300: 2072 652e 6669 6e64 616c 6c28 6d61 7463   re.findall(matc
-00003310: 6865 722c 2063 6d64 290a 2020 2020 7573  her, cmd).    us
-00003320: 6572 6e61 6d65 203d 2075 7365 726e 616d  ername = usernam
-00003330: 655b 305d 2069 6620 6c65 6e28 7573 6572  e[0] if len(user
-00003340: 6e61 6d65 2920 3e20 3020 656c 7365 204e  name) > 0 else N
-00003350: 6f6e 650a 0a20 2020 2023 2045 7874 7261  one..    # Extra
-00003360: 6374 2070 6173 7377 6f72 640a 2020 2020  ct password.    
-00003370: 6d61 7463 6865 7220 3d20 7222 616e 7369  matcher = r"ansi
-00003380: 626c 655f 7373 685f 7061 7373 3d27 282e  ble_ssh_pass='(.
-00003390: 2b3f 2927 220a 2020 2020 7061 7373 776f  +?)'".    passwo
-000033a0: 7264 203d 2072 652e 6669 6e64 616c 6c28  rd = re.findall(
-000033b0: 6d61 7463 6865 722c 2063 6d64 290a 2020  matcher, cmd).  
-000033c0: 2020 7061 7373 776f 7264 203d 2070 6173    password = pas
-000033d0: 7377 6f72 645b 305d 2069 6620 6c65 6e28  sword[0] if len(
-000033e0: 7061 7373 776f 7264 2920 3e20 3020 656c  password) > 0 el
-000033f0: 7365 204e 6f6e 650a 0a20 2020 2072 6574  se None..    ret
-00003400: 7572 6e20 7573 6572 6e61 6d65 2c20 7061  urn username, pa
-00003410: 7373 776f 7264 0a0a 0a64 6566 2065 7874  ssword...def ext
-00003420: 7261 6374 5f6a 7570 7974 6572 5f74 6f6b  ract_jupyter_tok
-00003430: 656e 2863 6d64 3a20 7374 7229 202d 3e20  en(cmd: str) -> 
-00003440: 4f70 7469 6f6e 616c 5b73 7472 5d3a 0a20  Optional[str]:. 
-00003450: 2020 206d 6174 6368 6572 203d 2072 226a     matcher = r"j
-00003460: 7570 7974 6572 5f74 6f6b 656e 3d27 282e  upyter_token='(.
-00003470: 2b3f 2927 220a 2020 2020 746f 6b65 6e20  +?)'".    token 
-00003480: 3d20 7265 2e66 696e 6461 6c6c 286d 6174  = re.findall(mat
-00003490: 6368 6572 2c20 636d 6429 0a20 2020 2069  cher, cmd).    i
-000034a0: 6620 6c65 6e28 746f 6b65 6e29 203d 3d20  f len(token) == 
-000034b0: 313a 0a20 2020 2020 2020 2072 6574 7572  1:.        retur
-000034c0: 6e20 746f 6b65 6e5b 305d 0a20 2020 2072  n token[0].    r
-000034d0: 6574 7572 6e20 4e6f 6e65 0a0a 0a64 6566  eturn None...def
-000034e0: 2068 6964 655f 7061 7373 776f 7264 2863   hide_password(c
-000034f0: 6d64 3a20 7374 7229 202d 3e20 7374 723a  md: str) -> str:
-00003500: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00003510: 2020 6d61 7463 6865 7220 3d20 7222 616e    matcher = r"an
-00003520: 7369 626c 655f 7373 685f 7061 7373 3d27  sible_ssh_pass='
-00003530: 282e 2b3f 2927 220a 2020 2020 2020 2020  (.+?)'".        
-00003540: 7061 7373 776f 7264 7320 3d20 7265 2e66  passwords = re.f
-00003550: 696e 6461 6c6c 286d 6174 6368 6572 2c20  indall(matcher, 
-00003560: 636d 6429 0a20 2020 2020 2020 2069 6620  cmd).        if 
-00003570: 6c65 6e28 7061 7373 776f 7264 7329 203e  len(passwords) >
-00003580: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00003590: 7061 7373 776f 7264 203d 2070 6173 7377  password = passw
-000035a0: 6f72 6473 5b30 5d0a 2020 2020 2020 2020  ords[0].        
-000035b0: 2020 2020 7374 6172 7320 3d20 222a 2220      stars = "*" 
-000035c0: 2a20 340a 2020 2020 2020 2020 2020 2020  * 4.            
-000035d0: 636d 6420 3d20 636d 642e 7265 706c 6163  cmd = cmd.replac
-000035e0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000035f0: 2020 2066 2261 6e73 6962 6c65 5f73 7368     f"ansible_ssh
-00003600: 5f70 6173 733d 277b 7061 7373 776f 7264  _pass='{password
-00003610: 7d27 222c 2066 2261 6e73 6962 6c65 5f73  }'", f"ansible_s
-00003620: 7368 5f70 6173 733d 277b 7374 6172 737d  sh_pass='{stars}
-00003630: 2722 0a20 2020 2020 2020 2020 2020 2029  '".            )
-00003640: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003650: 636d 640a 2020 2020 6578 6365 7074 2045  cmd.    except E
-00003660: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-00003670: 2020 2020 2020 2070 7269 6e74 2822 4661         print("Fa
-00003680: 696c 6564 2074 6f20 6869 6465 2070 6173  iled to hide pas
-00003690: 7377 6f72 642e 2229 0a20 2020 2020 2020  sword.").       
-000036a0: 2072 6169 7365 2065 0a0a 0a64 6566 2068   raise e...def h
-000036b0: 6964 655f 617a 7572 655f 766d 5f70 6173  ide_azure_vm_pas
-000036c0: 7377 6f72 6428 617a 7572 655f 636d 643a  sword(azure_cmd:
-000036d0: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
-000036e0: 2020 7472 793a 0a20 2020 2020 2020 206d    try:.        m
-000036f0: 6174 6368 6572 203d 2072 2261 646d 696e  atcher = r"admin
-00003700: 2d70 6173 7377 6f72 6420 2728 2e2b 3f29  -password '(.+?)
-00003710: 2722 0a20 2020 2020 2020 2070 6173 7377  '".        passw
-00003720: 6f72 6473 203d 2072 652e 6669 6e64 616c  ords = re.findal
-00003730: 6c28 6d61 7463 6865 722c 2061 7a75 7265  l(matcher, azure
-00003740: 5f63 6d64 290a 2020 2020 2020 2020 6966  _cmd).        if
-00003750: 206c 656e 2870 6173 7377 6f72 6473 2920   len(passwords) 
-00003760: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00003770: 2070 6173 7377 6f72 6420 3d20 7061 7373   password = pass
-00003780: 776f 7264 735b 305d 0a20 2020 2020 2020  words[0].       
-00003790: 2020 2020 2073 7461 7273 203d 2022 2a22       stars = "*"
-000037a0: 202a 2034 0a20 2020 2020 2020 2020 2020   * 4.           
-000037b0: 2061 7a75 7265 5f63 6d64 203d 2061 7a75   azure_cmd = azu
-000037c0: 7265 5f63 6d64 2e72 6570 6c61 6365 280a  re_cmd.replace(.
-000037d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037e0: 6622 6164 6d69 6e2d 7061 7373 776f 7264  f"admin-password
-000037f0: 2027 7b70 6173 7377 6f72 647d 2722 2c20   '{password}'", 
-00003800: 6622 6164 6d69 6e2d 7061 7373 776f 7264  f"admin-password
-00003810: 2027 7b73 7461 7273 7d27 220a 2020 2020   '{stars}'".    
-00003820: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003830: 2020 7265 7475 726e 2061 7a75 7265 5f63    return azure_c
-00003840: 6d64 0a20 2020 2065 7863 6570 7420 4578  md.    except Ex
-00003850: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-00003860: 2020 2020 2020 7072 696e 7428 2246 6169        print("Fai
-00003870: 6c65 6420 746f 2068 6964 6520 7061 7373  led to hide pass
-00003880: 776f 7264 2e22 290a 2020 2020 2020 2020  word.").        
-00003890: 7261 6973 6520 650a 0a0a 636c 6173 7320  raise e...class 
-000038a0: 5175 6573 7469 6f6e 496e 7075 7445 7272  QuestionInputErr
-000038b0: 6f72 2845 7863 6570 7469 6f6e 293a 0a20  or(Exception):. 
-000038c0: 2020 2070 6173 730a 0a0a 636c 6173 7320     pass...class 
-000038d0: 5175 6573 7469 6f6e 496e 7075 7450 6174  QuestionInputPat
-000038e0: 6845 7272 6f72 2845 7863 6570 7469 6f6e  hError(Exception
-000038f0: 293a 0a20 2020 2070 6173 730a 0a0a 636c  ):.    pass...cl
-00003900: 6173 7320 5175 6573 7469 6f6e 3a0a 2020  ass Question:.  
-00003910: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
-00003920: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00003930: 2020 2020 2020 7661 725f 6e61 6d65 3a20        var_name: 
-00003940: 7374 722c 0a20 2020 2020 2020 2071 7565  str,.        que
-00003950: 7374 696f 6e3a 2073 7472 2c0a 2020 2020  stion: str,.    
-00003960: 2020 2020 6b69 6e64 3a20 7374 722c 0a20      kind: str,. 
-00003970: 2020 2020 2020 2064 6566 6175 6c74 3a20         default: 
-00003980: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00003990: 4e6f 6e65 2c0a 2020 2020 2020 2020 6361  None,.        ca
-000039a0: 6368 653a 2062 6f6f 6c20 3d20 4661 6c73  che: bool = Fals
-000039b0: 652c 0a20 2020 2020 2020 206f 7074 696f  e,.        optio
-000039c0: 6e73 3a20 4f70 7469 6f6e 616c 5b54 7970  ns: Optional[Typ
-000039d0: 654c 6973 745b 7374 725d 5d20 3d20 4e6f  eList[str]] = No
-000039e0: 6e65 2c0a 2020 2020 2920 2d3e 204e 6f6e  ne,.    ) -> Non
-000039f0: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-00003a00: 7661 725f 6e61 6d65 203d 2076 6172 5f6e  var_name = var_n
-00003a10: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
-00003a20: 2e71 7565 7374 696f 6e20 3d20 7175 6573  .question = ques
-00003a30: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-00003a40: 662e 6465 6661 756c 7420 3d20 6465 6661  f.default = defa
-00003a50: 756c 740a 2020 2020 2020 2020 7365 6c66  ult.        self
-00003a60: 2e6b 696e 6420 3d20 6b69 6e64 0a20 2020  .kind = kind.   
-00003a70: 2020 2020 2073 656c 662e 6361 6368 6520       self.cache 
-00003a80: 3d20 6361 6368 650a 2020 2020 2020 2020  = cache.        
-00003a90: 7365 6c66 2e6f 7074 696f 6e73 203d 206f  self.options = o
-00003aa0: 7074 696f 6e73 2069 6620 6f70 7469 6f6e  ptions if option
-00003ab0: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
-00003ac0: 7365 205b 5d0a 0a20 2020 2064 6566 2076  se []..    def v
-00003ad0: 616c 6964 6174 6528 7365 6c66 2c20 7661  alidate(self, va
-00003ae0: 6c75 653a 2073 7472 2920 2d3e 2073 7472  lue: str) -> str
-00003af0: 3a0a 2020 2020 2020 2020 7661 6c75 6520  :.        value 
-00003b00: 3d20 7661 6c75 652e 7374 7269 7028 290a  = value.strip().
-00003b10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003b20: 6465 6661 756c 7420 6973 206e 6f74 204e  default is not N
-00003b30: 6f6e 6520 616e 6420 7661 6c75 6520 3d3d  one and value ==
-00003b40: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00003b50: 2072 6574 7572 6e20 7365 6c66 2e64 6566   return self.def
-00003b60: 6175 6c74 0a0a 2020 2020 2020 2020 6966  ault..        if
-00003b70: 2073 656c 662e 6b69 6e64 203d 3d20 2270   self.kind == "p
-00003b80: 6174 6822 3a0a 2020 2020 2020 2020 2020  ath":.          
-00003b90: 2020 7661 6c75 6520 3d20 6f73 2e70 6174    value = os.pat
-00003ba0: 682e 6578 7061 6e64 7573 6572 2876 616c  h.expanduser(val
-00003bb0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00003bc0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00003bd0: 7869 7374 7328 7661 6c75 6529 3a0a 2020  xists(value):.  
-00003be0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00003bf0: 726f 7220 3d20 6622 7b76 616c 7565 7d20  ror = f"{value} 
-00003c00: 6973 206e 6f74 2061 2076 616c 6964 2070  is not a valid p
-00003c10: 6174 682e 220a 2020 2020 2020 2020 2020  ath.".          
-00003c20: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-00003c30: 6661 756c 7420 6973 206e 6f74 204e 6f6e  fault is not Non
-00003c40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003c50: 2020 2020 2020 2065 7272 6f72 202b 3d20         error += 
-00003c60: 6622 2054 7279 207b 7365 6c66 2e64 6566  f" Try {self.def
-00003c70: 6175 6c74 7d22 0a20 2020 2020 2020 2020  ault}".         
-00003c80: 2020 2020 2020 2072 6169 7365 2051 7565         raise Que
-00003c90: 7374 696f 6e49 6e70 7574 5061 7468 4572  stionInputPathEr
-00003ca0: 726f 7228 6622 7b65 7272 6f72 7d22 290a  ror(f"{error}").
-00003cb0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00003cc0: 2e6b 696e 6420 3d3d 2022 7965 736e 6f22  .kind == "yesno"
-00003cd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00003ce0: 2076 616c 7565 2e6c 6f77 6572 2829 2e73   value.lower().s
-00003cf0: 7461 7274 7377 6974 6828 2279 2229 3a0a  tartswith("y"):.
-00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d10: 7265 7475 726e 2022 7922 0a20 2020 2020  return "y".     
-00003d20: 2020 2020 2020 2065 6c69 6620 7661 6c75         elif valu
-00003d30: 652e 6c6f 7765 7228 292e 7374 6172 7473  e.lower().starts
-00003d40: 7769 7468 2822 6e22 293a 0a20 2020 2020  with("n"):.     
-00003d50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003d60: 6e20 226e 220a 2020 2020 2020 2020 2020  n "n".          
-00003d70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00003d80: 2020 2020 2020 2020 7261 6973 6520 5175          raise Qu
-00003d90: 6573 7469 6f6e 496e 7075 7445 7272 6f72  estionInputError
-00003da0: 2866 227b 7661 6c75 657d 2069 7320 6e6f  (f"{value} is no
-00003db0: 7420 616e 2079 6573 206f 7220 6e6f 2061  t an yes or no a
-00003dc0: 6e73 7765 7222 290a 0a20 2020 2020 2020  nswer")..       
-00003dd0: 2069 6620 7365 6c66 2e6b 696e 6420 3d3d   if self.kind ==
-00003de0: 2022 6f70 7469 6f6e 7322 3a0a 2020 2020   "options":.    
-00003df0: 2020 2020 2020 2020 6966 2076 616c 7565          if value
-00003e00: 2069 6e20 7365 6c66 2e6f 7074 696f 6e73   in self.options
-00003e10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003e20: 2020 7265 7475 726e 2076 616c 7565 0a20    return value. 
-00003e30: 2020 2020 2020 2020 2020 2066 6972 7374             first
-00003e40: 5f6c 6574 7465 7220 3d20 7661 6c75 652e  _letter = value.
-00003e50: 6c6f 7765 7228 295b 305d 0a20 2020 2020  lower()[0].     
-00003e60: 2020 2020 2020 2066 6f72 206f 7074 696f         for optio
-00003e70: 6e20 696e 2073 656c 662e 6f70 7469 6f6e  n in self.option
-00003e80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00003e90: 2020 2069 6620 6f70 7469 6f6e 2e73 7461     if option.sta
-00003ea0: 7274 7377 6974 6828 6669 7273 745f 6c65  rtswith(first_le
-00003eb0: 7474 6572 293a 0a20 2020 2020 2020 2020  tter):.         
-00003ec0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003ed0: 6e20 6f70 7469 6f6e 0a0a 2020 2020 2020  n option..      
-00003ee0: 2020 2020 2020 7261 6973 6520 5175 6573        raise Ques
-00003ef0: 7469 6f6e 496e 7075 7445 7272 6f72 280a  tionInputError(.
-00003f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f10: 6622 7b76 616c 7565 7d20 6973 206e 6f74  f"{value} is not
-00003f20: 206f 6e65 206f 6620 7468 6520 6f70 7469   one of the opti
-00003f30: 6f6e 733a 207b 7365 6c66 2e6f 7074 696f  ons: {self.optio
-00003f40: 6e73 7d22 0a20 2020 2020 2020 2020 2020  ns}".           
-00003f50: 2029 0a0a 2020 2020 2020 2020 6966 2073   )..        if s
-00003f60: 656c 662e 6b69 6e64 203d 3d20 2270 6173  elf.kind == "pas
-00003f70: 7377 6f72 6422 3a0a 2020 2020 2020 2020  sword":.        
-00003f80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00003f90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00003fa0: 7661 6c69 6461 7465 5f70 6173 7377 6f72  validate_passwor
-00003fb0: 6428 7061 7373 776f 7264 3d76 616c 7565  d(password=value
-00003fc0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00003fd0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00003fe0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00003ff0: 2020 2020 2072 6169 7365 2051 7565 7374       raise Quest
-00004000: 696f 6e49 6e70 7574 4572 726f 7228 6622  ionInputError(f"
-00004010: 496e 7661 6c69 6420 7061 7373 776f 7264  Invalid password
-00004020: 2e20 7b65 7d22 290a 2020 2020 2020 2020  . {e}").        
-00004030: 7265 7475 726e 2076 616c 7565 0a0a 0a64  return value...d
-00004040: 6566 2061 736b 2871 7565 7374 696f 6e3a  ef ask(question:
-00004050: 2051 7565 7374 696f 6e2c 206b 7761 7267   Question, kwarg
-00004060: 733a 2054 7970 6544 6963 745b 7374 722c  s: TypeDict[str,
-00004070: 2073 7472 5d29 202d 3e20 7374 723a 0a20   str]) -> str:. 
-00004080: 2020 2069 6620 7175 6573 7469 6f6e 2e76     if question.v
-00004090: 6172 5f6e 616d 6520 696e 206b 7761 7267  ar_name in kwarg
-000040a0: 7320 616e 6420 6b77 6172 6773 5b71 7565  s and kwargs[que
-000040b0: 7374 696f 6e2e 7661 725f 6e61 6d65 5d20  stion.var_name] 
-000040c0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000040d0: 2020 2020 2076 616c 7565 203d 206b 7761       value = kwa
-000040e0: 7267 735b 7175 6573 7469 6f6e 2e76 6172  rgs[question.var
-000040f0: 5f6e 616d 655d 0a20 2020 2065 6c73 653a  _name].    else:
-00004100: 0a20 2020 2020 2020 2069 6620 7175 6573  .        if ques
-00004110: 7469 6f6e 2e64 6566 6175 6c74 2069 7320  tion.default is 
-00004120: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00004130: 2020 2020 2020 7661 6c75 6520 3d20 636c        value = cl
-00004140: 6963 6b2e 7072 6f6d 7074 2871 7565 7374  ick.prompt(quest
-00004150: 696f 6e2e 7175 6573 7469 6f6e 2c20 7479  ion.question, ty
-00004160: 7065 3d73 7472 2c20 6465 6661 756c 743d  pe=str, default=
-00004170: 7175 6573 7469 6f6e 2e64 6566 6175 6c74  question.default
-00004180: 290a 2020 2020 2020 2020 656c 6966 2071  ).        elif q
-00004190: 7565 7374 696f 6e2e 7661 725f 6e61 6d65  uestion.var_name
-000041a0: 203d 3d20 2270 6173 7377 6f72 6422 3a0a   == "password":.
-000041b0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-000041c0: 6520 3d20 636c 6963 6b2e 7072 6f6d 7074  e = click.prompt
-000041d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000041e0: 2020 7175 6573 7469 6f6e 2e71 7565 7374    question.quest
-000041f0: 696f 6e2c 2074 7970 653d 7374 722c 2068  ion, type=str, h
-00004200: 6964 655f 696e 7075 743d 5472 7565 2c20  ide_input=True, 
-00004210: 636f 6e66 6972 6d61 7469 6f6e 5f70 726f  confirmation_pro
-00004220: 6d70 743d 5472 7565 0a20 2020 2020 2020  mpt=True.       
-00004230: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00004240: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004250: 2076 616c 7565 203d 2063 6c69 636b 2e70   value = click.p
-00004260: 726f 6d70 7428 7175 6573 7469 6f6e 2e71  rompt(question.q
-00004270: 7565 7374 696f 6e2c 2074 7970 653d 7374  uestion, type=st
-00004280: 7229 0a0a 2020 2020 7472 793a 0a20 2020  r)..    try:.   
-00004290: 2020 2020 2076 616c 7565 203d 2071 7565       value = que
-000042a0: 7374 696f 6e2e 7661 6c69 6461 7465 2876  stion.validate(v
-000042b0: 616c 7565 3d76 616c 7565 290a 2020 2020  alue=value).    
-000042c0: 6578 6365 7074 2051 7565 7374 696f 6e49  except QuestionI
-000042d0: 6e70 7574 4572 726f 7220 6173 2065 3a0a  nputError as e:.
-000042e0: 2020 2020 2020 2020 7072 696e 7428 6529          print(e)
-000042f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004300: 6173 6b28 7175 6573 7469 6f6e 3d71 7565  ask(question=que
-00004310: 7374 696f 6e2c 206b 7761 7267 733d 6b77  stion, kwargs=kw
-00004320: 6172 6773 290a 2020 2020 6966 2071 7565  args).    if que
-00004330: 7374 696f 6e2e 6361 6368 653a 0a20 2020  stion.cache:.   
-00004340: 2020 2020 2073 6574 6174 7472 2861 7267       setattr(arg
-00004350: 5f63 6163 6865 2c20 7175 6573 7469 6f6e  _cache, question
-00004360: 2e76 6172 5f6e 616d 652c 2076 616c 7565  .var_name, value
-00004370: 290a 0a20 2020 2072 6574 7572 6e20 7661  )..    return va
-00004380: 6c75 650a 0a0a 6465 6620 6669 785f 6b65  lue...def fix_ke
-00004390: 795f 7065 726d 6973 7369 6f6e 2870 7269  y_permission(pri
-000043a0: 7661 7465 5f6b 6579 5f70 6174 683a 2073  vate_key_path: s
-000043b0: 7472 2920 2d3e 204e 6f6e 653a 0a20 2020  tr) -> None:.   
-000043c0: 206b 6579 5f70 6572 6d69 7373 696f 6e20   key_permission 
-000043d0: 3d20 6f63 7428 7374 6174 2e53 5f49 4d4f  = oct(stat.S_IMO
-000043e0: 4445 286f 732e 7374 6174 2870 7269 7661  DE(os.stat(priva
-000043f0: 7465 5f6b 6579 5f70 6174 6829 2e73 745f  te_key_path).st_
-00004400: 6d6f 6465 2929 0a20 2020 2063 686d 6f64  mode)).    chmod
-00004410: 5f70 6572 6d69 7373 696f 6e20 3d20 2234  _permission = "4
-00004420: 3030 220a 2020 2020 6f63 7461 6c5f 7065  00".    octal_pe
-00004430: 726d 6973 7369 6f6e 203d 2066 2230 6f7b  rmission = f"0o{
-00004440: 6368 6d6f 645f 7065 726d 6973 7369 6f6e  chmod_permission
-00004450: 7d22 0a20 2020 2069 6620 6b65 795f 7065  }".    if key_pe
-00004460: 726d 6973 7369 6f6e 2021 3d20 6f63 7461  rmission != octa
-00004470: 6c5f 7065 726d 6973 7369 6f6e 3a0a 2020  l_permission:.  
-00004480: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00004490: 2020 2020 2020 2020 2066 2246 6978 696e           f"Fixin
-000044a0: 6720 6b65 7920 7065 726d 6973 7369 6f6e  g key permission
-000044b0: 3a20 7b70 7269 7661 7465 5f6b 6579 5f70  : {private_key_p
-000044c0: 6174 687d 2c20 7365 7474 696e 6720 746f  ath}, setting to
-000044d0: 207b 6368 6d6f 645f 7065 726d 6973 7369   {chmod_permissi
-000044e0: 6f6e 7d22 0a20 2020 2020 2020 2029 0a20  on}".        ). 
-000044f0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00004500: 2020 2020 2020 2020 6f73 2e63 686d 6f64          os.chmod
-00004510: 2870 7269 7661 7465 5f6b 6579 5f70 6174  (private_key_pat
-00004520: 682c 2069 6e74 286f 6374 616c 5f70 6572  h, int(octal_per
-00004530: 6d69 7373 696f 6e2c 2038 2929 0a20 2020  mission, 8)).   
-00004540: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00004550: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00004560: 2020 2020 2020 2020 7072 696e 7428 2246          print("F
-00004570: 6169 6c65 6420 746f 2066 6978 206b 6579  ailed to fix key
-00004580: 2070 6572 6d69 7373 696f 6e22 2c20 6529   permission", e)
-00004590: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000045a0: 7365 2065 0a0a 0a64 6566 2070 7269 7661  se e...def priva
-000045b0: 7465 5f74 6f5f 7075 626c 6963 5f6b 6579  te_to_public_key
-000045c0: 2870 7269 7661 7465 5f6b 6579 5f70 6174  (private_key_pat
-000045d0: 683a 2073 7472 2c20 7465 6d70 5f70 6174  h: str, temp_pat
-000045e0: 683a 2073 7472 2c20 7573 6572 6e61 6d65  h: str, username
-000045f0: 3a20 7374 7229 202d 3e20 7374 723a 0a20  : str) -> str:. 
-00004600: 2020 2023 2063 6865 636b 206b 6579 2070     # check key p
-00004610: 6572 6d69 7373 696f 6e0a 2020 2020 6669  ermission.    fi
-00004620: 785f 6b65 795f 7065 726d 6973 7369 6f6e  x_key_permission
-00004630: 2870 7269 7661 7465 5f6b 6579 5f70 6174  (private_key_pat
-00004640: 683d 7072 6976 6174 655f 6b65 795f 7061  h=private_key_pa
-00004650: 7468 290a 2020 2020 6f75 7470 7574 5f70  th).    output_p
-00004660: 6174 6820 3d20 6622 7b74 656d 705f 7061  ath = f"{temp_pa
-00004670: 7468 7d2f 6861 6772 6964 5f7b 7573 6572  th}/hagrid_{user
-00004680: 6e61 6d65 7d5f 6b65 792e 7075 6222 0a20  name}_key.pub". 
-00004690: 2020 2063 6d64 203d 2066 2273 7368 2d6b     cmd = f"ssh-k
-000046a0: 6579 6765 6e20 2d66 207b 7072 6976 6174  eygen -f {privat
-000046b0: 655f 6b65 795f 7061 7468 7d20 2d79 203e  e_key_path} -y >
-000046c0: 207b 6f75 7470 7574 5f70 6174 687d 220a   {output_path}".
-000046d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000046e0: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
-000046f0: 6b5f 6361 6c6c 2863 6d64 2c20 7368 656c  k_call(cmd, shel
-00004700: 6c3d 5472 7565 2920 2023 206e 6f73 6563  l=True)  # nosec
-00004710: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
-00004720: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00004730: 2020 2020 7072 696e 7428 2266 6169 6c65      print("faile
-00004740: 6420 746f 206d 616b 6520 7373 6820 6b65  d to make ssh ke
-00004750: 7922 2c20 6529 0a20 2020 2020 2020 2072  y", e).        r
-00004760: 6169 7365 2065 0a20 2020 2072 6574 7572  aise e.    retur
-00004770: 6e20 6f75 7470 7574 5f70 6174 680a 0a0a  n output_path...
-00004780: 6465 6620 6368 6563 6b5f 617a 7572 655f  def check_azure_
-00004790: 6175 7468 6564 2829 202d 3e20 626f 6f6c  authed() -> bool
-000047a0: 3a0a 2020 2020 636d 6420 3d20 2261 7a20  :.    cmd = "az 
-000047b0: 6163 636f 756e 7420 7368 6f77 220a 2020  account show".  
-000047c0: 2020 7472 793a 0a20 2020 2020 2020 2073    try:.        s
-000047d0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
-000047e0: 6361 6c6c 2863 6d64 2c20 7368 656c 6c3d  call(cmd, shell=
-000047f0: 5472 7565 2c20 7374 646f 7574 3d73 7562  True, stdout=sub
-00004800: 7072 6f63 6573 732e 4445 564e 554c 4c29  process.DEVNULL)
-00004810: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
-00004820: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-00004830: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00004840: 6f6e 3a20 2023 206e 6f73 6563 0a20 2020  on:  # nosec.   
-00004850: 2020 2020 2070 6173 730a 2020 2020 7265       pass.    re
-00004860: 7475 726e 2046 616c 7365 0a0a 0a64 6566  turn False...def
-00004870: 206c 6f67 696e 5f61 7a75 7265 2829 202d   login_azure() -
-00004880: 3e20 626f 6f6c 3a0a 2020 2020 636d 6420  > bool:.    cmd 
-00004890: 3d20 2261 7a20 6c6f 6769 6e22 0a20 2020  = "az login".   
-000048a0: 2074 7279 3a0a 2020 2020 2020 2020 7375   try:.        su
-000048b0: 6270 726f 6365 7373 2e63 6865 636b 5f63  bprocess.check_c
-000048c0: 616c 6c28 636d 642c 2073 6865 6c6c 3d54  all(cmd, shell=T
-000048d0: 7275 652c 2073 7464 6f75 743d 7375 6270  rue, stdout=subp
-000048e0: 726f 6365 7373 2e44 4556 4e55 4c4c 2920  rocess.DEVNULL) 
-000048f0: 2023 206e 6f73 6563 0a20 2020 2020 2020   # nosec.       
-00004900: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00004910: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00004920: 6e3a 2020 2320 6e6f 7365 630a 2020 2020  n:  # nosec.    
-00004930: 2020 2020 7061 7373 0a20 2020 2072 6574      pass.    ret
-00004940: 7572 6e20 4661 6c73 650a 0a0a 6465 6620  urn False...def 
-00004950: 6368 6563 6b5f 617a 7572 655f 636c 695f  check_azure_cli_
-00004960: 696e 7374 616c 6c65 6428 2920 2d3e 2062  installed() -> b
-00004970: 6f6f 6c3a 0a20 2020 2074 7279 3a0a 2020  ool:.    try:.  
-00004980: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-00004990: 7562 7072 6f63 6573 732e 7275 6e28 2020  ubprocess.run(  
-000049a0: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
-000049b0: 2020 2020 5b22 617a 222c 2022 2d2d 7665      ["az", "--ve
-000049c0: 7273 696f 6e22 5d2c 2073 7464 6f75 743d  rsion"], stdout=
-000049d0: 7375 6270 726f 6365 7373 2e44 4556 4e55  subprocess.DEVNU
-000049e0: 4c4c 2c20 7374 6465 7272 3d73 7562 7072  LL, stderr=subpr
-000049f0: 6f63 6573 732e 5354 444f 5554 0a20 2020  ocess.STDOUT.   
-00004a00: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-00004a10: 6620 7265 7375 6c74 2e72 6574 7572 6e63  f result.returnc
-00004a20: 6f64 6520 213d 2030 3a0a 2020 2020 2020  ode != 0:.      
-00004a30: 2020 2020 2020 7261 6973 6520 4669 6c65        raise File
-00004a40: 4e6f 7446 6f75 6e64 4572 726f 7228 2261  NotFoundError("a
-00004a50: 7a20 6e6f 7420 696e 7374 616c 6c65 6422  z not installed"
-00004a60: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
-00004a70: 6570 7469 6f6e 3a20 2023 206e 6f73 6563  eption:  # nosec
-00004a80: 0a20 2020 2020 2020 206d 7367 203d 2022  .        msg = "
-00004a90: 5c6e 596f 7520 646f 6e27 7420 6170 7065  \nYou don't appe
-00004aa0: 6172 2074 6f20 6861 7665 2074 6865 2041  ar to have the A
-00004ab0: 7a75 7265 2043 4c49 2069 6e73 7461 6c6c  zure CLI install
-00004ac0: 6564 2121 2120 5c6e 5c6e 5c0a 506c 6561  ed!!! \n\n\.Plea
-00004ad0: 7365 2069 6e73 7461 6c6c 2069 7420 616e  se install it an
-00004ae0: 6420 7468 656e 2072 6574 7279 2079 6f75  d then retry you
-00004af0: 7220 636f 6d6d 616e 642e 5c0a 5c6e 5c6e  r command.\.\n\n
-00004b00: 496e 7374 616c 6c61 7469 6f6e 2049 6e73  Installation Ins
-00004b10: 7472 7563 7469 6f6e 733a 2068 7474 7073  tructions: https
-00004b20: 3a2f 2f64 6f63 732e 6d69 6372 6f73 6f66  ://docs.microsof
-00004b30: 742e 636f 6d2f 656e 2d75 732f 636c 692f  t.com/en-us/cli/
-00004b40: 617a 7572 652f 696e 7374 616c 6c2d 617a  azure/install-az
-00004b50: 7572 652d 636c 695c 6e22 0a20 2020 2020  ure-cli\n".     
-00004b60: 2020 2072 6169 7365 2046 696c 654e 6f74     raise FileNot
-00004b70: 466f 756e 6445 7272 6f72 286d 7367 290a  FoundError(msg).
-00004b80: 0a20 2020 2072 6574 7572 6e20 5472 7565  .    return True
-00004b90: 0a0a 0a64 6566 2063 6865 636b 5f67 636c  ...def check_gcl
-00004ba0: 6f75 645f 636c 695f 696e 7374 616c 6c65  oud_cli_installe
-00004bb0: 6428 2920 2d3e 2062 6f6f 6c3a 0a20 2020  d() -> bool:.   
-00004bc0: 2074 7279 3a0a 2020 2020 2020 2020 7375   try:.        su
-00004bd0: 6270 726f 6365 7373 2e63 616c 6c28 5b22  bprocess.call(["
-00004be0: 6763 6c6f 7564 222c 2022 7665 7273 696f  gcloud", "versio
-00004bf0: 6e22 5d29 2020 2320 6e6f 7365 630a 2020  n"])  # nosec.  
-00004c00: 2020 2020 2020 7072 696e 7428 2247 636c        print("Gcl
-00004c10: 6f75 6420 636c 6920 696e 7374 616c 6c65  oud cli installe
-00004c20: 6421 2229 0a20 2020 2065 7863 6570 7420  d!").    except 
-00004c30: 4669 6c65 4e6f 7446 6f75 6e64 4572 726f  FileNotFoundErro
-00004c40: 723a 0a20 2020 2020 2020 206d 7367 203d  r:.        msg =
-00004c50: 2022 5c6e 596f 7520 646f 6e27 7420 6170   "\nYou don't ap
-00004c60: 7065 6172 2074 6f20 6861 7665 2074 6865  pear to have the
-00004c70: 2067 636c 6f75 6420 434c 4920 746f 6f6c   gcloud CLI tool
-00004c80: 2069 6e73 7461 6c6c 6564 2120 5c6e 5c6e   installed! \n\n
-00004c90: 5c0a 506c 6561 7365 2069 6e73 7461 6c6c  \.Please install
-00004ca0: 2069 7420 616e 6420 7468 656e 2072 6574   it and then ret
-00004cb0: 7279 2061 6761 696e 2e5c 0a5c 6e5c 6e49  ry again.\.\n\nI
-00004cc0: 6e73 7461 6c6c 6174 696f 6e20 496e 7374  nstallation Inst
-00004cd0: 7275 6374 696f 6e73 3a20 6874 7470 733a  ructions: https:
-00004ce0: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
-00004cf0: 6f6d 2f73 646b 2f64 6f63 732f 696e 7374  om/sdk/docs/inst
-00004d00: 616c 6c2d 7364 6b20 5c6e 220a 2020 2020  all-sdk \n".    
-00004d10: 2020 2020 7261 6973 6520 4669 6c65 4e6f      raise FileNo
-00004d20: 7446 6f75 6e64 4572 726f 7228 6d73 6729  tFoundError(msg)
-00004d30: 0a0a 2020 2020 7265 7475 726e 2054 7275  ..    return Tru
-00004d40: 650a 0a0a 6465 6620 6368 6563 6b5f 6763  e...def check_gc
-00004d50: 6c6f 7564 5f61 7574 6865 6428 2920 2d3e  loud_authed() ->
-00004d60: 2062 6f6f 6c3a 0a20 2020 2074 7279 3a0a   bool:.    try:.
-00004d70: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00004d80: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
-00004d90: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
-00004da0: 2020 2020 2020 5b22 6763 6c6f 7564 222c        ["gcloud",
-00004db0: 2022 6175 7468 222c 2022 7072 696e 742d   "auth", "print-
-00004dc0: 6964 656e 7469 7479 2d74 6f6b 656e 225d  identity-token"]
-00004dd0: 2c20 7374 646f 7574 3d73 7562 7072 6f63  , stdout=subproc
-00004de0: 6573 732e 5049 5045 0a20 2020 2020 2020  ess.PIPE.       
-00004df0: 2029 0a20 2020 2020 2020 2069 6620 7265   ).        if re
-00004e00: 7375 6c74 2e72 6574 7572 6e63 6f64 6520  sult.returncode 
-00004e10: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00004e20: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-00004e30: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00004e40: 6f6e 3a20 2023 206e 6f73 6563 0a20 2020  on:  # nosec.   
-00004e50: 2020 2020 2070 6173 730a 2020 2020 7265       pass.    re
-00004e60: 7475 726e 2046 616c 7365 0a0a 0a64 6566  turn False...def
-00004e70: 206c 6f67 696e 5f67 636c 6f75 6428 2920   login_gcloud() 
-00004e80: 2d3e 2062 6f6f 6c3a 0a20 2020 2063 6d64  -> bool:.    cmd
-00004e90: 203d 2022 6763 6c6f 7564 2061 7574 6820   = "gcloud auth 
-00004ea0: 6c6f 6769 6e22 0a20 2020 2074 7279 3a0a  login".    try:.
-00004eb0: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
-00004ec0: 7373 2e63 6865 636b 5f63 616c 6c28 636d  ss.check_call(cm
-00004ed0: 642c 2073 6865 6c6c 3d54 7275 652c 2073  d, shell=True, s
-00004ee0: 7464 6f75 743d 7375 6270 726f 6365 7373  tdout=subprocess
-00004ef0: 2e44 4556 4e55 4c4c 2920 2023 206e 6f73  .DEVNULL)  # nos
-00004f00: 6563 0a20 2020 2020 2020 2072 6574 7572  ec.        retur
-00004f10: 6e20 5472 7565 0a20 2020 2065 7863 6570  n True.    excep
-00004f20: 7420 4578 6365 7074 696f 6e3a 2020 2320  t Exception:  # 
-00004f30: 6e6f 7365 630a 2020 2020 2020 2020 7061  nosec.        pa
-00004f40: 7373 0a20 2020 2072 6574 7572 6e20 4661  ss.    return Fa
-00004f50: 6c73 650a 0a0a 6465 6620 7374 725f 746f  lse...def str_to
-00004f60: 5f62 6f6f 6c28 626f 6f6c 5f73 7472 3a20  _bool(bool_str: 
-00004f70: 4f70 7469 6f6e 616c 5b73 7472 5d29 202d  Optional[str]) -
-00004f80: 3e20 626f 6f6c 3a0a 2020 2020 7265 7375  > bool:.    resu
-00004f90: 6c74 203d 2046 616c 7365 0a20 2020 2062  lt = False.    b
-00004fa0: 6f6f 6c5f 7374 7220 3d20 7374 7228 626f  ool_str = str(bo
-00004fb0: 6f6c 5f73 7472 292e 6c6f 7765 7228 290a  ol_str).lower().
-00004fc0: 2020 2020 6966 2062 6f6f 6c5f 7374 7220      if bool_str 
-00004fd0: 3d3d 2022 7472 7565 2220 6f72 2062 6f6f  == "true" or boo
-00004fe0: 6c5f 7374 7220 3d3d 2022 3122 3a0a 2020  l_str == "1":.  
-00004ff0: 2020 2020 2020 7265 7375 6c74 203d 2054        result = T
-00005000: 7275 650a 2020 2020 7265 7475 726e 2072  rue.    return r
-00005010: 6573 756c 740a 0a0a 4152 5420 3d20 7374  esult...ART = st
-00005020: 725f 746f 5f62 6f6f 6c28 6f73 2e65 6e76  r_to_bool(os.env
-00005030: 6972 6f6e 2e67 6574 2822 4841 4752 4944  iron.get("HAGRID
-00005040: 5f41 5254 222c 2022 5472 7565 2229 290a  _ART", "True")).
-00005050: 0a0a 6465 6620 6765 6e65 7261 7465 5f67  ..def generate_g
-00005060: 636c 6f75 645f 6b65 795f 6174 5f70 6174  cloud_key_at_pat
-00005070: 6828 6b65 795f 7061 7468 3a20 7374 7229  h(key_path: str)
-00005080: 202d 3e20 7374 723a 0a20 2020 206b 6579   -> str:.    key
-00005090: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
-000050a0: 6578 7061 6e64 7573 6572 286b 6579 5f70  expanduser(key_p
-000050b0: 6174 6829 0a20 2020 2069 6620 6f73 2e70  ath).    if os.p
-000050c0: 6174 682e 6578 6973 7473 286b 6579 5f70  ath.exists(key_p
-000050d0: 6174 6829 3a0a 2020 2020 2020 2020 7261  ath):.        ra
-000050e0: 6973 6520 4578 6365 7074 696f 6e28 6622  ise Exception(f"
-000050f0: 4361 6e27 7420 6765 6e65 7261 7465 206b  Can't generate k
-00005100: 6579 2073 696e 6365 2070 6174 6820 616c  ey since path al
-00005110: 7265 6164 7920 6578 6973 7473 2e20 7b6b  ready exists. {k
-00005120: 6579 5f70 6174 687d 2229 0a20 2020 2065  ey_path}").    e
-00005130: 6c73 653a 0a20 2020 2020 2020 2023 2074  lse:.        # t
-00005140: 7269 6767 6572 7320 6120 6b65 7920 6368  riggers a key ch
-00005150: 6563 6b0a 2020 2020 2020 2020 636d 6420  eck.        cmd 
-00005160: 3d20 2267 636c 6f75 6420 636f 6d70 7574  = "gcloud comput
-00005170: 6520 7373 6820 2727 202d 2d64 7279 2d72  e ssh '' --dry-r
-00005180: 756e 220a 2020 2020 2020 2020 7472 793a  un".        try:
-00005190: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
-000051a0: 7072 6f63 6573 732e 6368 6563 6b5f 6361  process.check_ca
-000051b0: 6c6c 2863 6d64 2c20 7368 656c 6c3d 5472  ll(cmd, shell=Tr
-000051c0: 7565 2920 2023 206e 6f73 6563 0a20 2020  ue)  # nosec.   
-000051d0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000051e0: 7074 696f 6e3a 2020 2320 6e6f 7365 630a  ption:  # nosec.
-000051f0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00005200: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00005210: 6f73 2e70 6174 682e 6578 6973 7473 286b  os.path.exists(k
-00005220: 6579 5f70 6174 6829 3a0a 2020 2020 2020  ey_path):.      
-00005230: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00005240: 7074 696f 6e28 6622 6763 6c6f 7564 2066  ption(f"gcloud f
-00005250: 6169 6c65 6420 746f 2067 656e 6572 6174  ailed to generat
-00005260: 6520 7373 682d 6b65 7920 6174 3a20 7b6b  e ssh-key at: {k
-00005270: 6579 5f70 6174 687d 2229 0a0a 2020 2020  ey_path}")..    
-00005280: 7265 7475 726e 206b 6579 5f70 6174 680a  return key_path.
-00005290: 0a0a 6465 6620 6765 6e65 7261 7465 5f6b  ..def generate_k
-000052a0: 6579 5f61 745f 7061 7468 286b 6579 5f70  ey_at_path(key_p
-000052b0: 6174 683a 2073 7472 2920 2d3e 2073 7472  ath: str) -> str
-000052c0: 3a0a 2020 2020 6b65 795f 7061 7468 203d  :.    key_path =
-000052d0: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-000052e0: 7365 7228 6b65 795f 7061 7468 290a 2020  ser(key_path).  
-000052f0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00005300: 7374 7328 6b65 795f 7061 7468 293a 0a20  sts(key_path):. 
-00005310: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00005320: 6570 7469 6f6e 2866 2243 616e 2774 2067  eption(f"Can't g
-00005330: 656e 6572 6174 6520 6b65 7920 7369 6e63  enerate key sinc
-00005340: 6520 7061 7468 2061 6c72 6561 6479 2065  e path already e
-00005350: 7869 7374 732e 207b 6b65 795f 7061 7468  xists. {key_path
-00005360: 7d22 290a 2020 2020 656c 7365 3a0a 2020  }").    else:.  
-00005370: 2020 2020 2020 636d 6420 3d20 6622 7373        cmd = f"ss
-00005380: 682d 6b65 7967 656e 202d 4e20 2727 202d  h-keygen -N '' -
-00005390: 6620 7b6b 6579 5f70 6174 687d 220a 2020  f {key_path}".  
-000053a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000053b0: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
-000053c0: 732e 6368 6563 6b5f 6361 6c6c 2863 6d64  s.check_call(cmd
-000053d0: 2c20 7368 656c 6c3d 5472 7565 2920 2023  , shell=True)  #
-000053e0: 206e 6f73 6563 0a20 2020 2020 2020 2020   nosec.         
-000053f0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-00005400: 682e 6578 6973 7473 286b 6579 5f70 6174  h.exists(key_pat
-00005410: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00005420: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00005430: 696f 6e28 6622 4661 696c 6564 2074 6f20  ion(f"Failed to 
-00005440: 6765 6e65 7261 7465 2073 7368 2d6b 6579  generate ssh-key
-00005450: 2061 743a 207b 6b65 795f 7061 7468 7d22   at: {key_path}"
-00005460: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00005470: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00005480: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005490: 7365 2065 0a0a 2020 2020 7265 7475 726e  se e..    return
-000054a0: 206b 6579 5f70 6174 680a 0a0a 6465 6620   key_path...def 
-000054b0: 7661 6c69 6461 7465 5f70 6173 7377 6f72  validate_passwor
-000054c0: 6428 7061 7373 776f 7264 3a20 7374 7229  d(password: str)
-000054d0: 202d 3e20 7374 723a 0a20 2020 2022 2222   -> str:.    """
-000054e0: 5661 6c69 6461 7465 2069 6620 7468 6520  Validate if the 
-000054f0: 7061 7373 776f 7264 2065 6e74 6572 6564  password entered
-00005500: 2062 7920 7468 6520 7573 6572 2069 7320   by the user is 
-00005510: 7661 6c69 642e 0a0a 2020 2020 5061 7373  valid...    Pass
-00005520: 776f 7264 206c 656e 6774 6820 7368 6f75  word length shou
-00005530: 6c64 2062 6520 6265 7477 6565 6e20 3132  ld be between 12
-00005540: 202d 2031 3233 2063 6861 7261 6374 6572   - 123 character
-00005550: 730a 2020 2020 5061 7373 776f 7264 7320  s.    Passwords 
-00005560: 6d75 7374 2061 6c73 6f20 6d65 6574 2033  must also meet 3
-00005570: 206f 7574 206f 6620 7468 6520 666f 6c6c   out of the foll
-00005580: 6f77 696e 6720 3420 636f 6d70 6c65 7869  owing 4 complexi
-00005590: 7479 2072 6571 7569 7265 6d65 6e74 733a  ty requirements:
-000055a0: 0a20 2020 202d 2048 6176 6520 6c6f 7765  .    - Have lowe
-000055b0: 7220 6368 6172 6163 7465 7273 0a20 2020  r characters.   
-000055c0: 202d 2048 6176 6520 7570 7065 7220 6368   - Have upper ch
-000055d0: 6172 6163 7465 7273 0a20 2020 202d 2048  aracters.    - H
-000055e0: 6176 6520 6120 6469 6769 740a 2020 2020  ave a digit.    
-000055f0: 2d20 4861 7665 2061 2073 7065 6369 616c  - Have a special
-00005600: 2063 6861 7261 6374 6572 0a0a 2020 2020   character..    
-00005610: 4172 6773 3a0a 2020 2020 2020 2020 7061  Args:.        pa
-00005620: 7373 776f 7264 2028 7374 7229 3a20 7061  ssword (str): pa
-00005630: 7373 776f 7264 2066 6f72 2074 6865 2076  ssword for the v
-00005640: 6d0a 0a20 2020 2052 6574 7572 6e73 3a0a  m..    Returns:.
-00005650: 2020 2020 2020 2020 7374 723a 2070 6173          str: pas
-00005660: 7377 6f72 6420 6966 2069 7420 6973 2076  sword if it is v
-00005670: 616c 6964 0a20 2020 2022 2222 0a20 2020  alid.    """.   
-00005680: 2023 2056 616c 6964 6174 6520 7061 7373   # Validate pass
-00005690: 776f 7264 206c 656e 6774 680a 2020 2020  word length.    
-000056a0: 6966 206c 656e 2870 6173 7377 6f72 6429  if len(password)
-000056b0: 203c 2031 3220 6f72 206c 656e 2870 6173   < 12 or len(pas
-000056c0: 7377 6f72 6429 203e 2031 3233 3a0a 2020  sword) > 123:.  
-000056d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000056e0: 6545 7272 6f72 2822 5061 7373 776f 7264  eError("Password
-000056f0: 206c 656e 6774 6820 7368 6f75 6c64 2062   length should b
-00005700: 6520 6265 7477 6565 6e20 3132 202d 2031  e between 12 - 1
-00005710: 3233 2063 6861 7261 6374 6572 7322 290a  23 characters").
-00005720: 0a20 2020 2023 2056 616c 6964 2063 6861  .    # Valid cha
-00005730: 7261 6374 6572 2074 7970 6573 0a20 2020  racter types.   
-00005740: 2063 6861 7261 6374 6572 5f74 7970 6573   character_types
-00005750: 203d 207b 0a20 2020 2020 2020 2022 7570   = {.        "up
-00005760: 7065 725f 6361 7365 223a 2046 616c 7365  per_case": False
-00005770: 2c0a 2020 2020 2020 2020 226c 6f77 6572  ,.        "lower
-00005780: 5f63 6173 6522 3a20 4661 6c73 652c 0a20  _case": False,. 
-00005790: 2020 2020 2020 2022 6469 6769 7422 3a20         "digit": 
-000057a0: 4661 6c73 652c 0a20 2020 2020 2020 2022  False,.        "
-000057b0: 7370 6563 6961 6c22 3a20 4661 6c73 652c  special": False,
-000057c0: 0a20 2020 207d 0a0a 2020 2020 666f 7220  .    }..    for 
-000057d0: 6368 2069 6e20 7061 7373 776f 7264 3a0a  ch in password:.
-000057e0: 2020 2020 2020 2020 6966 2063 682e 6973          if ch.is
-000057f0: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
-00005800: 2020 2020 2063 6861 7261 6374 6572 5f74       character_t
-00005810: 7970 6573 5b22 6c6f 7765 725f 6361 7365  ypes["lower_case
-00005820: 225d 203d 2054 7275 650a 2020 2020 2020  "] = True.      
-00005830: 2020 656c 6966 2063 682e 6973 7570 7065    elif ch.isuppe
-00005840: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-00005850: 2063 6861 7261 6374 6572 5f74 7970 6573   character_types
-00005860: 5b22 7570 7065 725f 6361 7365 225d 203d  ["upper_case"] =
-00005870: 2054 7275 650a 2020 2020 2020 2020 656c   True.        el
-00005880: 6966 2063 682e 6973 6469 6769 7428 293a  if ch.isdigit():
-00005890: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-000058a0: 7261 6374 6572 5f74 7970 6573 5b22 6469  racter_types["di
-000058b0: 6769 7422 5d20 3d20 5472 7565 0a20 2020  git"] = True.   
-000058c0: 2020 2020 2065 6c69 6620 6368 2e69 7361       elif ch.isa
-000058d0: 7363 6969 2829 3a0a 2020 2020 2020 2020  scii():.        
-000058e0: 2020 2020 6368 6172 6163 7465 725f 7479      character_ty
-000058f0: 7065 735b 2273 7065 6369 616c 225d 203d  pes["special"] =
-00005900: 2054 7275 650a 2020 2020 2020 2020 656c   True.        el
-00005910: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005920: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00005930: 2866 227b 6368 7d20 6973 206e 6f74 2061  (f"{ch} is not a
-00005940: 2076 616c 6964 2063 6861 7261 6374 6572   valid character
-00005950: 2066 6f72 2070 6173 7377 6f72 6422 290a   for password").
-00005960: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
-00005970: 6368 6172 6163 7465 7273 2069 6e20 7468  characters in th
-00005980: 6520 7061 7373 776f 7264 0a20 2020 2072  e password.    r
-00005990: 6571 7569 7265 645f 6368 6172 6163 7465  equired_characte
-000059a0: 725f 7479 7065 5f63 6f75 6e74 203d 2073  r_type_count = s
-000059b0: 756d 280a 2020 2020 2020 2020 5b69 6e74  um(.        [int
-000059c0: 2876 616c 7565 2920 666f 7220 7661 6c75  (value) for valu
-000059d0: 6520 696e 2063 6861 7261 6374 6572 5f74  e in character_t
-000059e0: 7970 6573 2e76 616c 7565 7328 295d 0a20  ypes.values()]. 
-000059f0: 2020 2029 0a0a 2020 2020 6966 2072 6571     )..    if req
-00005a00: 7569 7265 645f 6368 6172 6163 7465 725f  uired_character_
-00005a10: 7479 7065 5f63 6f75 6e74 203e 3d20 333a  type_count >= 3:
-00005a20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005a30: 7061 7373 776f 7264 0a0a 2020 2020 6162  password..    ab
-00005a40: 7365 6e74 5f63 6861 7261 6374 6572 5f74  sent_character_t
-00005a50: 7970 6573 203d 2022 2c20 222e 6a6f 696e  ypes = ", ".join
-00005a60: 280a 2020 2020 2020 2020 6368 6172 5f74  (.        char_t
-00005a70: 7970 6520 666f 7220 6368 6172 5f74 7970  ype for char_typ
-00005a80: 652c 2076 616c 7565 2069 6e20 6368 6172  e, value in char
-00005a90: 6163 7465 725f 7479 7065 732e 6974 656d  acter_types.item
-00005aa0: 7328 2920 6966 2076 616c 7565 2069 7320  s() if value is 
-00005ab0: 4661 6c73 650a 2020 2020 292e 7374 7269  False.    ).stri
-00005ac0: 7028 222c 2022 290a 0a20 2020 2072 6169  p(", ")..    rai
-00005ad0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00005ae0: 2020 2020 2020 2066 2241 7420 6c65 6173         f"At leas
-00005af0: 7420 6f6e 6520 7b61 6273 656e 745f 6368  t one {absent_ch
-00005b00: 6172 6163 7465 725f 7479 7065 737d 2063  aracter_types} c
-00005b10: 6861 7261 6374 6572 2074 7970 6573 206d  haracter types m
-00005b20: 7573 7420 6265 2070 7265 7365 6e74 220a  ust be present".
-00005b30: 2020 2020 290a 0a0a 6465 6620 6372 6561      )...def crea
-00005b40: 7465 5f6c 6175 6e63 685f 636d 6428 0a20  te_launch_cmd(. 
-00005b50: 2020 2076 6572 623a 2047 7261 6d6d 6172     verb: Grammar
-00005b60: 5665 7262 2c0a 2020 2020 6b77 6172 6773  Verb,.    kwargs
-00005b70: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-00005b80: 416e 795d 2c0a 2020 2020 6967 6e6f 7265  Any],.    ignore
-00005b90: 5f64 6f63 6b65 725f 7665 7273 696f 6e5f  _docker_version_
-00005ba0: 6368 6563 6b3a 204f 7074 696f 6e61 6c5b  check: Optional[
-00005bb0: 626f 6f6c 5d20 3d20 4661 6c73 652c 0a29  bool] = False,.)
-00005bc0: 202d 3e20 556e 696f 6e5b 7374 722c 2054   -> Union[str, T
-00005bd0: 7970 654c 6973 745b 7374 725d 5d3a 0a20  ypeList[str]]:. 
-00005be0: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
-00005bf0: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-00005c00: 416e 795d 203d 207b 7d0a 2020 2020 686f  Any] = {}.    ho
-00005c10: 7374 5f74 6572 6d20 3d20 7665 7262 2e67  st_term = verb.g
-00005c20: 6574 5f6e 616d 6564 5f74 6572 6d5f 686f  et_named_term_ho
-00005c30: 7374 6772 616d 6d61 7228 6e61 6d65 3d22  stgrammar(name="
-00005c40: 686f 7374 2229 0a20 2020 2068 6f73 7420  host").    host 
-00005c50: 3d20 686f 7374 5f74 6572 6d2e 686f 7374  = host_term.host
-00005c60: 0a20 2020 2061 7574 683a 204f 7074 696f  .    auth: Optio
-00005c70: 6e61 6c5b 4175 7468 4372 6564 656e 7469  nal[AuthCredenti
-00005c80: 616c 735d 203d 204e 6f6e 650a 0a20 2020  als] = None..   
-00005c90: 2074 6169 6c20 3d20 5472 7565 0a20 2020   tail = True.   
-00005ca0: 2069 6620 2274 6169 6c22 2069 6e20 6b77   if "tail" in kw
-00005cb0: 6172 6773 2061 6e64 206e 6f74 2073 7472  args and not str
-00005cc0: 5f74 6f5f 626f 6f6c 286b 7761 7267 735b  _to_bool(kwargs[
-00005cd0: 2274 6169 6c22 5d29 3a0a 2020 2020 2020  "tail"]):.      
-00005ce0: 2020 7461 696c 203d 2046 616c 7365 0a0a    tail = False..
-00005cf0: 2020 2020 7061 7273 6564 5f6b 7761 7267      parsed_kwarg
-00005d00: 7320 3d20 7b7d 0a0a 2020 2020 6966 2022  s = {}..    if "
-00005d10: 6275 696c 6422 2069 6e20 6b77 6172 6773  build" in kwargs
-00005d20: 2061 6e64 206b 7761 7267 735b 2262 7569   and kwargs["bui
-00005d30: 6c64 225d 2069 7320 6e6f 7420 4e6f 6e65  ld"] is not None
-00005d40: 3a0a 2020 2020 2020 2020 7061 7273 6564  :.        parsed
-00005d50: 5f6b 7761 7267 735b 2262 7569 6c64 225d  _kwargs["build"]
-00005d60: 203d 2073 7472 5f74 6f5f 626f 6f6c 2863   = str_to_bool(c
-00005d70: 6173 7428 7374 722c 206b 7761 7267 735b  ast(str, kwargs[
-00005d80: 2262 7569 6c64 225d 2929 0a20 2020 2065  "build"])).    e
-00005d90: 6c73 653a 0a20 2020 2020 2020 2070 6172  lse:.        par
-00005da0: 7365 645f 6b77 6172 6773 5b22 6275 696c  sed_kwargs["buil
-00005db0: 6422 5d20 3d20 4e6f 6e65 0a0a 2020 2020  d"] = None..    
-00005dc0: 7061 7273 6564 5f6b 7761 7267 735b 2275  parsed_kwargs["u
-00005dd0: 7365 5f62 6c6f 625f 7374 6f72 6167 6522  se_blob_storage"
-00005de0: 5d20 3d20 280a 2020 2020 2020 2020 6b77  ] = (.        kw
-00005df0: 6172 6773 5b22 7573 655f 626c 6f62 5f73  args["use_blob_s
-00005e00: 746f 7261 6765 225d 2069 6620 2275 7365  torage"] if "use
-00005e10: 5f62 6c6f 625f 7374 6f72 6167 6522 2069  _blob_storage" i
-00005e20: 6e20 6b77 6172 6773 2065 6c73 6520 4e6f  n kwargs else No
-00005e30: 6e65 0a20 2020 2029 0a0a 2020 2020 7061  ne.    )..    pa
-00005e40: 7273 6564 5f6b 7761 7267 735b 226e 6f64  rsed_kwargs["nod
-00005e50: 655f 636f 756e 7422 5d20 3d20 280a 2020  e_count"] = (.  
-00005e60: 2020 2020 2020 696e 7428 6b77 6172 6773        int(kwargs
-00005e70: 5b22 6e6f 6465 5f63 6f75 6e74 225d 2920  ["node_count"]) 
-00005e80: 6966 2022 6e6f 6465 5f63 6f75 6e74 2220  if "node_count" 
-00005e90: 696e 206b 7761 7267 7320 656c 7365 2031  in kwargs else 1
-00005ea0: 0a20 2020 2029 0a0a 2020 2020 6966 2070  .    )..    if p
-00005eb0: 6172 7365 645f 6b77 6172 6773 5b22 6e6f  arsed_kwargs["no
-00005ec0: 6465 5f63 6f75 6e74 225d 203e 2031 2061  de_count"] > 1 a
-00005ed0: 6e64 2068 6f73 7420 6e6f 7420 696e 205b  nd host not in [
-00005ee0: 2261 7a75 7265 225d 3a0a 2020 2020 2020  "azure"]:.      
-00005ef0: 2020 7072 696e 7428 225c 6e41 7267 756d    print("\nArgum
-00005f00: 656e 7420 606e 6f64 655f 636f 756e 7460  ent `node_count`
-00005f10: 2069 7320 6f6e 6c79 2073 7570 706f 7274   is only support
-00005f20: 6564 2077 6974 6820 6061 7a75 7265 602e  ed with `azure`.
-00005f30: 5c6e 2229 0a20 2020 2065 6c73 653a 0a20  \n").    else:. 
-00005f40: 2020 2020 2020 2023 2044 6566 6175 6c74         # Default
-00005f50: 2074 6f20 6465 7461 6368 6564 206d 6f64   to detached mod
-00005f60: 6520 6966 2072 756e 6e69 6e67 206d 6f72  e if running mor
-00005f70: 6520 7468 616e 206f 6e65 206e 6f64 6573  e than one nodes
-00005f80: 0a20 2020 2020 2020 2074 6169 6c20 3d20  .        tail = 
-00005f90: 4661 6c73 6520 6966 2070 6172 7365 645f  False if parsed_
-00005fa0: 6b77 6172 6773 5b22 6e6f 6465 5f63 6f75  kwargs["node_cou
-00005fb0: 6e74 225d 203e 2031 2065 6c73 6520 7461  nt"] > 1 else ta
-00005fc0: 696c 0a0a 2020 2020 6865 6164 6c65 7373  il..    headless
-00005fd0: 203d 2046 616c 7365 0a20 2020 2069 6620   = False.    if 
-00005fe0: 2268 6561 646c 6573 7322 2069 6e20 6b77  "headless" in kw
-00005ff0: 6172 6773 2061 6e64 2073 7472 5f74 6f5f  args and str_to_
-00006000: 626f 6f6c 2863 6173 7428 7374 722c 206b  bool(cast(str, k
-00006010: 7761 7267 735b 2268 6561 646c 6573 7322  wargs["headless"
-00006020: 5d29 293a 0a20 2020 2020 2020 2068 6561  ])):.        hea
-00006030: 646c 6573 7320 3d20 5472 7565 0a20 2020  dless = True.   
-00006040: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
-00006050: 6865 6164 6c65 7373 225d 203d 2068 6561  headless"] = hea
-00006060: 646c 6573 730a 0a20 2020 2070 6172 7365  dless..    parse
-00006070: 645f 6b77 6172 6773 5b22 746c 7322 5d20  d_kwargs["tls"] 
-00006080: 3d20 626f 6f6c 286b 7761 7267 735b 2274  = bool(kwargs["t
-00006090: 6c73 225d 2920 6966 2022 746c 7322 2069  ls"]) if "tls" i
-000060a0: 6e20 6b77 6172 6773 2065 6c73 6520 4661  n kwargs else Fa
-000060b0: 6c73 650a 2020 2020 7061 7273 6564 5f6b  lse.    parsed_k
-000060c0: 7761 7267 735b 2274 6573 7422 5d20 3d20  wargs["test"] = 
-000060d0: 626f 6f6c 286b 7761 7267 735b 2274 6573  bool(kwargs["tes
-000060e0: 7422 5d29 2069 6620 2274 6573 7422 2069  t"]) if "test" i
-000060f0: 6e20 6b77 6172 6773 2065 6c73 6520 4661  n kwargs else Fa
-00006100: 6c73 650a 2020 2020 7061 7273 6564 5f6b  lse.    parsed_k
-00006110: 7761 7267 735b 2264 6576 225d 203d 2062  wargs["dev"] = b
-00006120: 6f6f 6c28 6b77 6172 6773 5b22 6465 7622  ool(kwargs["dev"
-00006130: 5d29 2069 6620 2264 6576 2220 696e 206b  ]) if "dev" in k
-00006140: 7761 7267 7320 656c 7365 2046 616c 7365  wargs else False
-00006150: 0a20 2020 2070 6172 7365 645f 6b77 6172  .    parsed_kwar
-00006160: 6773 5b22 7369 6c65 6e74 225d 203d 2062  gs["silent"] = b
-00006170: 6f6f 6c28 6b77 6172 6773 5b22 7369 6c65  ool(kwargs["sile
-00006180: 6e74 225d 2920 6966 2022 7369 6c65 6e74  nt"]) if "silent
-00006190: 2220 696e 206b 7761 7267 7320 656c 7365  " in kwargs else
-000061a0: 2046 616c 7365 0a20 2020 2070 6172 7365   False.    parse
-000061b0: 645f 6b77 6172 6773 5b22 6672 6f6d 5f74  d_kwargs["from_t
-000061c0: 656d 706c 6174 6522 5d20 3d20 280a 2020  emplate"] = (.  
-000061d0: 2020 2020 2020 7374 725f 746f 5f62 6f6f        str_to_boo
-000061e0: 6c28 6b77 6172 6773 5b22 6672 6f6d 5f74  l(kwargs["from_t
-000061f0: 656d 706c 6174 6522 5d29 2069 6620 2266  emplate"]) if "f
-00006200: 726f 6d5f 7465 6d70 6c61 7465 2220 696e  rom_template" in
-00006210: 206b 7761 7267 7320 656c 7365 2046 616c   kwargs else Fal
-00006220: 7365 0a20 2020 2029 0a0a 2020 2020 7061  se.    )..    pa
-00006230: 7273 6564 5f6b 7761 7267 735b 2272 656c  rsed_kwargs["rel
-00006240: 6561 7365 225d 203d 2022 7072 6f64 7563  ease"] = "produc
-00006250: 7469 6f6e 220a 2020 2020 6966 2022 7265  tion".    if "re
-00006260: 6c65 6173 6522 2069 6e20 6b77 6172 6773  lease" in kwargs
-00006270: 2061 6e64 206b 7761 7267 735b 2272 656c   and kwargs["rel
-00006280: 6561 7365 225d 2021 3d20 2270 726f 6475  ease"] != "produ
-00006290: 6374 696f 6e22 3a0a 2020 2020 2020 2020  ction":.        
-000062a0: 7061 7273 6564 5f6b 7761 7267 735b 2272  parsed_kwargs["r
-000062b0: 656c 6561 7365 225d 203d 206b 7761 7267  elease"] = kwarg
-000062c0: 735b 2272 656c 6561 7365 225d 0a0a 2020  s["release"]..  
-000062d0: 2020 2320 6966 2077 6520 7573 6520 2d2d    # if we use --
-000062e0: 6465 7620 6f76 6572 7269 6465 2069 740a  dev override it.
-000062f0: 2020 2020 6966 2070 6172 7365 645f 6b77      if parsed_kw
-00006300: 6172 6773 5b22 6465 7622 5d20 6973 2054  args["dev"] is T
-00006310: 7275 653a 0a20 2020 2020 2020 2070 6172  rue:.        par
-00006320: 7365 645f 6b77 6172 6773 5b22 7265 6c65  sed_kwargs["rele
-00006330: 6173 6522 5d20 3d20 2264 6576 656c 6f70  ase"] = "develop
-00006340: 6d65 6e74 220a 0a20 2020 2069 6620 2263  ment"..    if "c
-00006350: 6572 745f 7374 6f72 655f 7061 7468 2220  ert_store_path" 
-00006360: 696e 206b 7761 7267 733a 0a20 2020 2020  in kwargs:.     
-00006370: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
-00006380: 5b22 6365 7274 5f73 746f 7265 5f70 6174  ["cert_store_pat
-00006390: 6822 5d20 3d20 6b77 6172 6773 5b22 6365  h"] = kwargs["ce
-000063a0: 7274 5f73 746f 7265 5f70 6174 6822 5d0a  rt_store_path"].
-000063b0: 2020 2020 6966 2022 7570 6c6f 6164 5f74      if "upload_t
-000063c0: 6c73 5f63 6572 7422 2069 6e20 6b77 6172  ls_cert" in kwar
-000063d0: 6773 3a0a 2020 2020 2020 2020 7061 7273  gs:.        pars
-000063e0: 6564 5f6b 7761 7267 735b 2275 706c 6f61  ed_kwargs["uploa
-000063f0: 645f 746c 735f 6365 7274 225d 203d 206b  d_tls_cert"] = k
-00006400: 7761 7267 735b 2275 706c 6f61 645f 746c  wargs["upload_tl
-00006410: 735f 6365 7274 225d 0a20 2020 2069 6620  s_cert"].    if 
-00006420: 2275 706c 6f61 645f 746c 735f 6b65 7922  "upload_tls_key"
-00006430: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
-00006440: 2020 2020 7061 7273 6564 5f6b 7761 7267      parsed_kwarg
-00006450: 735b 2275 706c 6f61 645f 746c 735f 6b65  s["upload_tls_ke
-00006460: 7922 5d20 3d20 6b77 6172 6773 5b22 7570  y"] = kwargs["up
-00006470: 6c6f 6164 5f74 6c73 5f6b 6579 225d 0a20  load_tls_key"]. 
-00006480: 2020 2069 6620 2270 726f 7669 7369 6f6e     if "provision
-00006490: 2220 696e 206b 7761 7267 733a 0a20 2020  " in kwargs:.   
-000064a0: 2020 2020 2070 6172 7365 645f 6b77 6172       parsed_kwar
-000064b0: 6773 5b22 7072 6f76 6973 696f 6e22 5d20  gs["provision"] 
-000064c0: 3d20 7374 725f 746f 5f62 6f6f 6c28 6361  = str_to_bool(ca
-000064d0: 7374 2873 7472 2c20 6b77 6172 6773 5b22  st(str, kwargs["
-000064e0: 7072 6f76 6973 696f 6e22 5d29 290a 0a20  provision"])).. 
-000064f0: 2020 2069 6620 2269 6d61 6765 5f6e 616d     if "image_nam
-00006500: 6522 2069 6e20 6b77 6172 6773 2061 6e64  e" in kwargs and
-00006510: 206b 7761 7267 735b 2269 6d61 6765 5f6e   kwargs["image_n
-00006520: 616d 6522 5d20 6973 206e 6f74 204e 6f6e  ame"] is not Non
-00006530: 653a 0a20 2020 2020 2020 2070 6172 7365  e:.        parse
-00006540: 645f 6b77 6172 6773 5b22 696d 6167 655f  d_kwargs["image_
-00006550: 6e61 6d65 225d 203d 206b 7761 7267 735b  name"] = kwargs[
-00006560: 2269 6d61 6765 5f6e 616d 6522 5d0a 2020  "image_name"].  
-00006570: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006580: 7061 7273 6564 5f6b 7761 7267 735b 2269  parsed_kwargs["i
-00006590: 6d61 6765 5f6e 616d 6522 5d20 3d20 2264  mage_name"] = "d
-000065a0: 6566 6175 6c74 220a 0a20 2020 2069 6620  efault"..    if 
-000065b0: 2274 6167 2220 696e 206b 7761 7267 7320  "tag" in kwargs 
-000065c0: 616e 6420 6b77 6172 6773 5b22 7461 6722  and kwargs["tag"
-000065d0: 5d20 6973 206e 6f74 204e 6f6e 6520 616e  ] is not None an
-000065e0: 6420 6b77 6172 6773 5b22 7461 6722 5d20  d kwargs["tag"] 
-000065f0: 213d 2022 223a 0a20 2020 2020 2020 2070  != "":.        p
-00006600: 6172 7365 645f 6b77 6172 6773 5b22 7461  arsed_kwargs["ta
-00006610: 6722 5d20 3d20 6b77 6172 6773 5b22 7461  g"] = kwargs["ta
-00006620: 6722 5d0a 2020 2020 656c 7365 3a0a 2020  g"].    else:.  
-00006630: 2020 2020 2020 7061 7273 6564 5f6b 7761        parsed_kwa
-00006640: 7267 735b 2274 6167 225d 203d 204e 6f6e  rgs["tag"] = Non
-00006650: 650a 0a20 2020 2069 6620 226a 7570 7974  e..    if "jupyt
-00006660: 6572 2220 696e 206b 7761 7267 7320 616e  er" in kwargs an
-00006670: 6420 6b77 6172 6773 5b22 6a75 7079 7465  d kwargs["jupyte
-00006680: 7222 5d20 6973 206e 6f74 204e 6f6e 653a  r"] is not None:
-00006690: 0a20 2020 2020 2020 2070 6172 7365 645f  .        parsed_
-000066a0: 6b77 6172 6773 5b22 6a75 7079 7465 7222  kwargs["jupyter"
-000066b0: 5d20 3d20 7374 725f 746f 5f62 6f6f 6c28  ] = str_to_bool(
-000066c0: 6361 7374 2873 7472 2c20 6b77 6172 6773  cast(str, kwargs
-000066d0: 5b22 6a75 7079 7465 7222 5d29 290a 2020  ["jupyter"])).  
-000066e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000066f0: 7061 7273 6564 5f6b 7761 7267 735b 226a  parsed_kwargs["j
-00006700: 7570 7974 6572 225d 203d 2046 616c 7365  upyter"] = False
-00006710: 0a0a 2020 2020 6966 2022 7670 6e22 2069  ..    if "vpn" i
-00006720: 6e20 6b77 6172 6773 2061 6e64 206b 7761  n kwargs and kwa
-00006730: 7267 735b 2276 706e 225d 2069 7320 6e6f  rgs["vpn"] is no
-00006740: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00006750: 7061 7273 6564 5f6b 7761 7267 735b 2276  parsed_kwargs["v
-00006760: 706e 225d 203d 2073 7472 5f74 6f5f 626f  pn"] = str_to_bo
-00006770: 6f6c 2863 6173 7428 7374 722c 206b 7761  ol(cast(str, kwa
-00006780: 7267 735b 2276 706e 225d 2929 0a20 2020  rgs["vpn"])).   
-00006790: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
-000067a0: 6172 7365 645f 6b77 6172 6773 5b22 7670  arsed_kwargs["vp
-000067b0: 6e22 5d20 3d20 5472 7565 0a0a 2020 2020  n"] = True..    
-000067c0: 2320 616c 6c6f 7773 2063 6861 6e67 696e  # allows changin
-000067d0: 6720 646f 636b 6572 2070 6c61 7466 6f72  g docker platfor
-000067e0: 6d20 746f 206f 7468 6572 2063 7075 2061  m to other cpu a
-000067f0: 7263 6869 7465 6374 7572 6573 206c 696b  rchitectures lik
-00006800: 6520 6172 6d36 340a 2020 2020 7061 7273  e arm64.    pars
-00006810: 6564 5f6b 7761 7267 735b 2270 6c61 7466  ed_kwargs["platf
-00006820: 6f72 6d22 5d20 3d20 6b77 6172 6773 5b22  orm"] = kwargs["
-00006830: 706c 6174 666f 726d 225d 2069 6620 2270  platform"] if "p
-00006840: 6c61 7466 6f72 6d22 2069 6e20 6b77 6172  latform" in kwar
-00006850: 6773 2065 6c73 6520 4e6f 6e65 0a0a 2020  gs else None..  
-00006860: 2020 6966 2070 6172 7365 645f 6b77 6172    if parsed_kwar
-00006870: 6773 5b22 6672 6f6d 5f74 656d 706c 6174  gs["from_templat
-00006880: 6522 5d20 616e 6420 686f 7374 2069 7320  e"] and host is 
-00006890: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000068a0: 2020 2320 5365 7475 7020 7468 6520 6669    # Setup the fi
-000068b0: 6c65 7320 6672 6f6d 2074 6865 206d 616e  les from the man
-000068c0: 6966 6573 745f 7465 6d70 6c61 7465 2e79  ifest_template.y
-000068d0: 6d6c 0a20 2020 2020 2020 206b 7761 7267  ml.        kwarg
-000068e0: 7320 3d20 7365 7475 705f 6672 6f6d 5f6d  s = setup_from_m
-000068f0: 616e 6966 6573 745f 7465 6d70 6c61 7465  anifest_template
-00006900: 2868 6f73 745f 7479 7065 3d68 6f73 7429  (host_type=host)
-00006910: 0a0a 2020 2020 2020 2020 2320 4f76 6572  ..        # Over
-00006920: 7269 6465 2074 656d 706c 6174 6520 7461  ride template ta
-00006930: 6720 7769 7468 2075 7365 7220 696e 7075  g with user inpu
-00006940: 7420 7461 670a 2020 2020 2020 2020 6966  t tag.        if
-00006950: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
-00006960: 7461 6722 5d20 6973 206e 6f74 204e 6f6e  tag"] is not Non
-00006970: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
-00006980: 7761 7267 732e 706f 7028 2274 6167 2229  wargs.pop("tag")
-00006990: 0a0a 2020 2020 2020 2020 7061 7273 6564  ..        parsed
-000069a0: 5f6b 7761 7267 732e 7570 6461 7465 286b  _kwargs.update(k
-000069b0: 7761 7267 7329 0a0a 2020 2020 6966 2068  wargs)..    if h
-000069c0: 6f73 7420 696e 205b 2264 6f63 6b65 7222  ost in ["docker"
-000069d0: 5d3a 0a0a 2020 2020 2020 2020 6966 206e  ]:..        if n
-000069e0: 6f74 2069 676e 6f72 655f 646f 636b 6572  ot ignore_docker
-000069f0: 5f76 6572 7369 6f6e 5f63 6865 636b 3a0a  _version_check:.
-00006a00: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-00006a10: 696f 6e20 3d20 6368 6563 6b5f 646f 636b  ion = check_dock
-00006a20: 6572 5f76 6572 7369 6f6e 2829 0a20 2020  er_version().   
-00006a30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00006a40: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
-00006a50: 2022 6e2f 6122 0a0a 2020 2020 2020 2020   "n/a"..        
-00006a60: 6966 2076 6572 7369 6f6e 3a0a 2020 2020  if version:.    
-00006a70: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00006a80: 2075 7365 7220 6973 2075 7369 6e67 2064   user is using d
-00006a90: 6f63 6b65 7220 6465 736b 746f 7020 284f  ocker desktop (O
-00006aa0: 5358 2f57 696e 646f 7773 292c 2063 6865  SX/Windows), che
-00006ab0: 636b 2074 6f20 6d61 6b65 2073 7572 6520  ck to make sure 
-00006ac0: 7468 6572 6527 7320 656e 6f75 6768 2052  there's enough R
-00006ad0: 414d 2e0a 2020 2020 2020 2020 2020 2020  AM..            
-00006ae0: 2320 4966 2074 6865 2075 7365 7220 6973  # If the user is
-00006af0: 2075 7369 6e67 204c 696e 7578 2074 6869   using Linux thi
-00006b00: 7320 6973 6e27 7420 616e 2069 7373 7565  s isn't an issue
-00006b10: 2062 6563 6175 7365 2044 6f63 6b65 7220   because Docker 
-00006b20: 7363 616c 6573 2074 6f20 7468 6520 6176  scales to the av
-00006b30: 6169 616c 626c 6520 5241 4d2c 0a20 2020  aialble RAM,.   
-00006b40: 2020 2020 2020 2020 2023 2062 7574 206f           # but o
-00006b50: 6e20 446f 636b 6572 2044 6573 6b74 6f70  n Docker Desktop
-00006b60: 2069 7420 6465 6661 756c 7473 2074 6f20   it defaults to 
-00006b70: 3247 4220 7768 6963 6820 6973 6e27 7420  2GB which isn't 
-00006b80: 656e 6f75 6768 2e0a 2020 2020 2020 2020  enough..        
-00006b90: 2020 2020 6464 5f6d 656d 6f72 7920 3d20      dd_memory = 
-00006ba0: 646f 636b 6572 5f64 6573 6b74 6f70 5f6d  docker_desktop_m
-00006bb0: 656d 6f72 7928 290a 2020 2020 2020 2020  emory().        
-00006bc0: 2020 2020 6966 2064 645f 6d65 6d6f 7279      if dd_memory
-00006bd0: 203c 2038 3139 3220 616e 6420 6464 5f6d   < 8192 and dd_m
-00006be0: 656d 6f72 7920 213d 202d 313a 0a20 2020  emory != -1:.   
-00006bf0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00006c00: 7365 2045 7863 6570 7469 6f6e 280a 2020  se Exception(.  
-00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c20: 2020 2259 6f75 2061 7070 6561 7220 746f    "You appear to
-00006c30: 2062 6520 7573 696e 6720 446f 636b 6572   be using Docker
-00006c40: 2044 6573 6b74 6f70 2062 7574 2064 6f6e   Desktop but don
-00006c50: 2774 2068 6176 6520 220a 2020 2020 2020  't have ".      
-00006c60: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00006c70: 6e6f 7567 6820 6d65 6d6f 7279 2061 6c6c  nough memory all
-00006c80: 6f63 6174 6564 2e20 4974 2061 7070 6561  ocated. It appea
-00006c90: 7273 2079 6f75 2776 6520 636f 6e66 6967  rs you've config
-00006ca0: 7572 6564 2022 0a20 2020 2020 2020 2020  ured ".         
-00006cb0: 2020 2020 2020 2020 2020 2066 224d 656d             f"Mem
-00006cc0: 6f72 793a 7b64 645f 6d65 6d6f 7279 7d20  ory:{dd_memory} 
-00006cd0: 4d42 2077 6865 6e20 3831 3932 4d42 2028  MB when 8192MB (
-00006ce0: 3847 4229 2069 7320 7265 7175 6972 6564  8GB) is required
-00006cf0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-00006d00: 2020 2020 2020 2020 6622 506c 6561 7365          f"Please
-00006d10: 206f 7065 6e20 446f 636b 6572 2044 6573   open Docker Des
-00006d20: 6b74 6f70 2050 7265 6665 7265 6e63 6573  ktop Preferences
-00006d30: 2070 616e 656c 2061 6e64 2073 6574 204d   panel and set M
-00006d40: 656d 6f72 7922 0a20 2020 2020 2020 2020  emory".         
-00006d50: 2020 2020 2020 2020 2020 2066 2220 746f             f" to
-00006d60: 2038 4742 206f 7220 6869 6768 6572 2e20   8GB or higher. 
-00006d70: 5c6e 5c6e 220a 2020 2020 2020 2020 2020  \n\n".          
-00006d80: 2020 2020 2020 2020 2020 6622 5c74 4f53            f"\tOS
-00006d90: 5820 4865 6c70 3a20 6874 7470 733a 2f2f  X Help: https://
-00006da0: 646f 6373 2e64 6f63 6b65 722e 636f 6d2f  docs.docker.com/
-00006db0: 6465 736b 746f 702f 6d61 632f 5c6e 220a  desktop/mac/\n".
-00006dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006dd0: 2020 2020 6622 5c74 5769 6e64 6f77 7320      f"\tWindows 
-00006de0: 4865 6c70 3a20 6874 7470 733a 2f2f 646f  Help: https://do
-00006df0: 6373 2e64 6f63 6b65 722e 636f 6d2f 6465  cs.docker.com/de
-00006e00: 736b 746f 702f 7769 6e64 6f77 732f 5c6e  sktop/windows/\n
-00006e10: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00006e20: 2020 2020 2020 2020 6622 5468 656e 2072          f"Then r
-00006e30: 652d 7275 6e20 796f 7572 2068 6167 7269  e-run your hagri
-00006e40: 6420 636f 6d6d 616e 642e 5c6e 5c6e 220a  d command.\n\n".
-00006e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e60: 2020 2020 6622 4966 2079 6f75 2073 6565      f"If you see
-00006e70: 2074 6869 7320 7761 726e 696e 6720 6f6e   this warning on
-00006e80: 204c 696e 7578 2074 6865 6e20 736f 6d65   Linux then some
-00006e90: 7468 696e 6720 6973 6e27 7420 7269 6768  thing isn't righ
-00006ea0: 742e 2022 0a20 2020 2020 2020 2020 2020  t. ".           
-00006eb0: 2020 2020 2020 2020 2066 2250 6c65 6173           f"Pleas
-00006ec0: 6520 6669 6c65 2061 2047 6974 6875 6220  e file a Github 
-00006ed0: 4973 7375 6520 6f6e 2050 7953 7966 7427  Issue on PySyft'
-00006ee0: 7320 4769 7468 7562 220a 2020 2020 2020  s Github".      
-00006ef0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00006f00: 2020 2020 2020 2020 2069 6620 6973 5f77           if is_w
-00006f10: 696e 646f 7773 2829 2061 6e64 206e 6f74  indows() and not
-00006f20: 2044 4550 454e 4445 4e43 4945 535b 2277   DEPENDENCIES["w
-00006f30: 736c 225d 3a0a 2020 2020 2020 2020 2020  sl"]:.          
-00006f40: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00006f50: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-00006f60: 2020 2020 2020 2020 2020 2022 596f 7520             "You 
-00006f70: 6d75 7374 2069 6e73 7461 6c6c 2077 736c  must install wsl
-00006f80: 3220 666f 7220 5769 6e64 6f77 7320 746f  2 for Windows to
-00006f90: 2075 7365 2048 4147 7269 642e 5c6e 220a   use HAGrid.\n".
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 2020 2020 2249 6e20 506f 7765 7253 6865      "In PowerShe
-00006fc0: 6c6c 206f 7220 436f 6d6d 616e 6420 5072  ll or Command Pr
-00006fd0: 6f6d 7074 2074 7970 653a 5c6e 3e20 7773  ompt type:\n> ws
-00006fe0: 6c20 2d2d 696e 7374 616c 6c5c 6e5c 6e22  l --install\n\n"
-00006ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007000: 2020 2020 2022 5265 6164 206d 6f72 6520       "Read more 
-00007010: 6865 7265 3a20 6874 7470 733a 2f2f 646f  here: https://do
-00007020: 6373 2e6d 6963 726f 736f 6674 2e63 6f6d  cs.microsoft.com
-00007030: 2f65 6e2d 7573 2f77 696e 646f 7773 2f77  /en-us/windows/w
-00007040: 736c 2f69 6e73 7461 6c6c 220a 2020 2020  sl/install".    
-00007050: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00007060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007070: 6e20 6372 6561 7465 5f6c 6175 6e63 685f  n create_launch_
-00007080: 646f 636b 6572 5f63 6d64 280a 2020 2020  docker_cmd(.    
-00007090: 2020 2020 2020 2020 2020 2020 7665 7262              verb
-000070a0: 3d76 6572 622c 0a20 2020 2020 2020 2020  =verb,.         
-000070b0: 2020 2020 2020 2064 6f63 6b65 725f 7665         docker_ve
-000070c0: 7273 696f 6e3d 7665 7273 696f 6e2c 0a20  rsion=version,. 
-000070d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000070e0: 6169 6c3d 7461 696c 2c0a 2020 2020 2020  ail=tail,.      
-000070f0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00007100: 3d70 6172 7365 645f 6b77 6172 6773 2c0a  =parsed_kwargs,.
-00007110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007120: 7369 6c65 6e74 3d70 6172 7365 645f 6b77  silent=parsed_kw
-00007130: 6172 6773 5b22 7369 6c65 6e74 225d 2c0a  args["silent"],.
-00007140: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00007150: 2020 2065 6c69 6620 686f 7374 2069 6e20     elif host in 
-00007160: 5b22 766d 225d 3a0a 2020 2020 2020 2020  ["vm"]:.        
-00007170: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00007180: 2044 4550 454e 4445 4e43 4945 535b 2276   DEPENDENCIES["v
-00007190: 6167 7261 6e74 225d 0a20 2020 2020 2020  agrant"].       
-000071a0: 2020 2020 2061 6e64 2044 4550 454e 4445       and DEPENDE
-000071b0: 4e43 4945 535b 2276 6972 7475 616c 626f  NCIES["virtualbo
-000071c0: 7822 5d0a 2020 2020 2020 2020 2020 2020  x"].            
-000071d0: 616e 6420 4445 5045 4e44 454e 4349 4553  and DEPENDENCIES
-000071e0: 5b22 616e 7369 626c 652d 706c 6179 626f  ["ansible-playbo
-000071f0: 6f6b 225d 0a20 2020 2020 2020 2029 3a0a  ok"].        ):.
-00007200: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00007210: 726e 2063 7265 6174 655f 6c61 756e 6368  rn create_launch
-00007220: 5f76 6167 7261 6e74 5f63 6d64 2876 6572  _vagrant_cmd(ver
-00007230: 623d 7665 7262 290a 2020 2020 2020 2020  b=verb).        
-00007240: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00007250: 2020 6572 726f 7273 203d 205b 5d0a 2020    errors = [].  
-00007260: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00007270: 2044 4550 454e 4445 4e43 4945 535b 2276   DEPENDENCIES["v
-00007280: 6167 7261 6e74 225d 3a0a 2020 2020 2020  agrant"]:.      
-00007290: 2020 2020 2020 2020 2020 6572 726f 7273            errors
-000072a0: 2e61 7070 656e 6428 2276 6167 7261 6e74  .append("vagrant
-000072b0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000072c0: 6620 6e6f 7420 4445 5045 4e44 454e 4349  f not DEPENDENCI
-000072d0: 4553 5b22 7669 7274 7561 6c62 6f78 225d  ES["virtualbox"]
-000072e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000072f0: 2020 6572 726f 7273 2e61 7070 656e 6428    errors.append(
-00007300: 2276 6972 7475 616c 626f 7822 290a 2020  "virtualbox").  
-00007310: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00007320: 2044 4550 454e 4445 4e43 4945 535b 2261   DEPENDENCIES["a
-00007330: 6e73 6962 6c65 2d70 6c61 7962 6f6f 6b22  nsible-playbook"
-00007340: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00007350: 2020 2065 7272 6f72 732e 6170 7065 6e64     errors.append
-00007360: 2822 616e 7369 626c 652d 706c 6179 626f  ("ansible-playbo
-00007370: 6f6b 2229 0a20 2020 2020 2020 2020 2020  ok").           
-00007380: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
-00007390: 7065 6e64 656e 6379 280a 2020 2020 2020  pendency(.      
-000073a0: 2020 2020 2020 2020 2020 6622 4c61 756e            f"Laun
-000073b0: 6368 696e 6720 6120 564d 206c 6f63 616c  ching a VM local
-000073c0: 6c79 2072 6571 7569 7265 733a 207b 2720  ly requires: {' 
-000073d0: 272e 6a6f 696e 2865 7272 6f72 7329 7d22  '.join(errors)}"
-000073e0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000073f0: 2020 2065 6c69 6620 686f 7374 2069 6e20     elif host in 
-00007400: 5b22 617a 7572 6522 5d3a 0a20 2020 2020  ["azure"]:.     
-00007410: 2020 2063 6865 636b 5f61 7a75 7265 5f63     check_azure_c
-00007420: 6c69 5f69 6e73 7461 6c6c 6564 2829 0a0a  li_installed()..
-00007430: 2020 2020 2020 2020 7768 696c 6520 6e6f          while no
-00007440: 7420 6368 6563 6b5f 617a 7572 655f 6175  t check_azure_au
-00007450: 7468 6564 2829 3a0a 2020 2020 2020 2020  thed():.        
-00007460: 2020 2020 7072 696e 7428 2259 6f75 206e      print("You n
-00007470: 6565 6420 746f 206c 6f67 2069 6e74 6f20  eed to log into 
-00007480: 417a 7572 6522 290a 2020 2020 2020 2020  Azure").        
-00007490: 2020 2020 6c6f 6769 6e5f 617a 7572 6528      login_azure(
-000074a0: 290a 0a20 2020 2020 2020 2069 6620 4445  )..        if DE
-000074b0: 5045 4e44 454e 4349 4553 5b22 616e 7369  PENDENCIES["ansi
-000074c0: 626c 652d 706c 6179 626f 6f6b 225d 3a0a  ble-playbook"]:.
-000074d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000074e0: 6f75 7263 655f 6772 6f75 7020 3d20 6173  ource_group = as
-000074f0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
-00007500: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
-00007510: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00007520: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
-00007530: 6d65 3d22 617a 7572 655f 7265 736f 7572  me="azure_resour
-00007540: 6365 5f67 726f 7570 222c 0a20 2020 2020  ce_group",.     
-00007550: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-00007560: 7565 7374 696f 6e3d 2257 6861 7420 7265  uestion="What re
-00007570: 736f 7572 6365 2067 726f 7570 206e 616d  source group nam
-00007580: 6520 646f 2079 6f75 2077 616e 7420 746f  e do you want to
-00007590: 2075 7365 2028 6f72 2063 7265 6174 6529   use (or create)
-000075a0: 3f22 2c0a 2020 2020 2020 2020 2020 2020  ?",.            
-000075b0: 2020 2020 2020 2020 6465 6661 756c 743d          default=
-000075c0: 6172 675f 6361 6368 652e 617a 7572 655f  arg_cache.azure_
-000075d0: 7265 736f 7572 6365 5f67 726f 7570 2c0a  resource_group,.
-000075e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075f0: 2020 2020 6b69 6e64 3d22 7374 7269 6e67      kind="string
-00007600: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00007610: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
-00007620: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00007630: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00007640: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
-00007650: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00007660: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00007670: 6c6f 6361 7469 6f6e 203d 2061 736b 280a  location = ask(.
-00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007690: 7175 6573 7469 6f6e 3d51 7565 7374 696f  question=Questio
-000076a0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-000076b0: 2020 2020 2020 2076 6172 5f6e 616d 653d         var_name=
-000076c0: 2261 7a75 7265 5f6c 6f63 6174 696f 6e22  "azure_location"
-000076d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000076e0: 2020 2020 2020 7175 6573 7469 6f6e 3d22        question="
-000076f0: 4966 2074 6869 7320 6973 2061 206e 6577  If this is a new
-00007700: 2072 6573 6f75 7263 6520 6772 6f75 7020   resource group 
-00007710: 7768 6174 206c 6f63 6174 696f 6e3f 222c  what location?",
-00007720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007730: 2020 2020 2064 6566 6175 6c74 3d61 7267       default=arg
-00007740: 5f63 6163 6865 2e61 7a75 7265 5f6c 6f63  _cache.azure_loc
-00007750: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-00007760: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
-00007770: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
-00007780: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00007790: 6368 653d 5472 7565 2c0a 2020 2020 2020  che=True,.      
-000077a0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-000077b0: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-000077c0: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
-000077d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000077e0: 2020 2020 2020 2073 697a 6520 3d20 6173         size = as
-000077f0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
-00007800: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
-00007810: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00007820: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
-00007830: 6d65 3d22 617a 7572 655f 7369 7a65 222c  me="azure_size",
-00007840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007850: 2020 2020 2071 7565 7374 696f 6e3d 2257       question="W
-00007860: 6861 7420 7369 7a65 206d 6163 6869 6e65  hat size machine
-00007870: 3f22 2c0a 2020 2020 2020 2020 2020 2020  ?",.            
-00007880: 2020 2020 2020 2020 6465 6661 756c 743d          default=
-00007890: 6172 675f 6361 6368 652e 617a 7572 655f  arg_cache.azure_
-000078a0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-000078b0: 2020 2020 2020 2020 2020 6b69 6e64 3d22            kind="
-000078c0: 7374 7269 6e67 222c 0a20 2020 2020 2020  string",.       
-000078d0: 2020 2020 2020 2020 2020 2020 2063 6163               cac
-000078e0: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
-000078f0: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00007900: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-00007910: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
-00007920: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00007930: 2020 2020 2020 7573 6572 6e61 6d65 203d        username =
-00007940: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
-00007950: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
-00007960: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
-00007970: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00007980: 5f6e 616d 653d 2261 7a75 7265 5f75 7365  _name="azure_use
-00007990: 726e 616d 6522 2c0a 2020 2020 2020 2020  rname",.        
-000079a0: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-000079b0: 7469 6f6e 3d22 5768 6174 2064 6f20 796f  tion="What do yo
-000079c0: 7520 7761 6e74 2074 6865 2075 7365 726e  u want the usern
-000079d0: 616d 6520 666f 7220 7468 6520 564d 2074  ame for the VM t
-000079e0: 6f20 6265 3f22 2c0a 2020 2020 2020 2020  o be?",.        
-000079f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007a00: 756c 743d 6172 675f 6361 6368 652e 617a  ult=arg_cache.az
-00007a10: 7572 655f 7573 6572 6e61 6d65 2c0a 2020  ure_username,.  
-00007a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a30: 2020 6b69 6e64 3d22 7374 7269 6e67 222c    kind="string",
-00007a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a50: 2020 2020 2063 6163 6865 3d54 7275 652c       cache=True,
-00007a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a70: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00007a80: 2020 2020 6b77 6172 6773 3d6b 7761 7267      kwargs=kwarg
-00007a90: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
-00007aa0: 0a0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-00007ab0: 7273 6564 5f6b 7761 7267 735b 2261 7574  rsed_kwargs["aut
-00007ac0: 685f 7479 7065 225d 203d 2061 736b 280a  h_type"] = ask(.
-00007ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ae0: 7175 6573 7469 6f6e 3d51 7565 7374 696f  question=Questio
-00007af0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00007b00: 2020 2020 2020 2076 6172 5f6e 616d 653d         var_name=
-00007b10: 2261 7574 685f 7479 7065 222c 0a20 2020  "auth_type",.   
-00007b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b30: 2071 7565 7374 696f 6e3d 2244 6f20 796f   question="Do yo
-00007b40: 7520 7761 6e74 2074 6f20 6c6f 6769 6e20  u want to login 
-00007b50: 7769 7468 2061 206b 6579 206f 7220 7061  with a key or pa
-00007b60: 7373 776f 7264 222c 0a20 2020 2020 2020  ssword",.       
-00007b70: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00007b80: 6175 6c74 3d61 7267 5f63 6163 6865 2e61  ault=arg_cache.a
-00007b90: 7574 685f 7479 7065 2c0a 2020 2020 2020  uth_type,.      
-00007ba0: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
-00007bb0: 6e64 3d22 6f70 7469 6f6e 222c 0a20 2020  nd="option",.   
-00007bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bd0: 206f 7074 696f 6e73 3d5b 226b 6579 222c   options=["key",
-00007be0: 2022 7061 7373 776f 7264 225d 2c0a 2020   "password"],.  
-00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c00: 2020 6361 6368 653d 5472 7565 2c0a 2020    cache=True,.  
-00007c10: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00007c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007c30: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
-00007c40: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00007c50: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
-00007c60: 6174 6820 3d20 4e6f 6e65 0a20 2020 2020  ath = None.     
-00007c70: 2020 2020 2020 2069 6620 7061 7273 6564         if parsed
-00007c80: 5f6b 7761 7267 735b 2261 7574 685f 7479  _kwargs["auth_ty
-00007c90: 7065 225d 203d 3d20 226b 6579 223a 0a20  pe"] == "key":. 
-00007ca0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00007cb0: 6579 5f70 6174 685f 7175 6573 7469 6f6e  ey_path_question
-00007cc0: 203d 2051 7565 7374 696f 6e28 0a20 2020   = Question(.   
-00007cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ce0: 2076 6172 5f6e 616d 653d 2261 7a75 7265   var_name="azure
-00007cf0: 5f6b 6579 5f70 6174 6822 2c0a 2020 2020  _key_path",.    
-00007d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d10: 7175 6573 7469 6f6e 3d66 2241 6273 6f6c  question=f"Absol
-00007d20: 7574 6520 7061 7468 206f 6620 7468 6520  ute path of the 
-00007d30: 7072 6976 6174 6520 6b65 7920 746f 2061  private key to a
-00007d40: 6363 6573 7320 7b75 7365 726e 616d 657d  ccess {username}
-00007d50: 407b 686f 7374 7d3f 222c 0a20 2020 2020  @{host}?",.     
-00007d60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00007d70: 6566 6175 6c74 3d61 7267 5f63 6163 6865  efault=arg_cache
-00007d80: 2e61 7a75 7265 5f6b 6579 5f70 6174 682c  .azure_key_path,
-00007d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007da0: 2020 2020 206b 696e 643d 2270 6174 6822       kind="path"
-00007db0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007dc0: 2020 2020 2020 6361 6368 653d 5472 7565        cache=True
-00007dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007de0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007df0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00007e00: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00007e10: 5f70 6174 6820 3d20 6173 6b28 0a20 2020  _path = ask(.   
-00007e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e30: 2020 2020 206b 6579 5f70 6174 685f 7175       key_path_qu
-00007e40: 6573 7469 6f6e 2c0a 2020 2020 2020 2020  estion,.        
-00007e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e60: 6b77 6172 6773 3d6b 7761 7267 732c 0a20  kwargs=kwargs,. 
-00007e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e80: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00007e90: 2020 2020 2065 7863 6570 7420 5175 6573       except Ques
-00007ea0: 7469 6f6e 496e 7075 7450 6174 6845 7272  tionInputPathErr
-00007eb0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-00007ec0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00007ed0: 6e74 2865 290a 2020 2020 2020 2020 2020  nt(e).          
-00007ee0: 2020 2020 2020 2020 2020 6b65 795f 7061            key_pa
-00007ef0: 7468 203d 2073 7472 2865 292e 7370 6c69  th = str(e).spli
-00007f00: 7428 2269 7320 6e6f 7420 6120 7661 6c69  t("is not a vali
-00007f10: 6420 7061 7468 2229 5b30 5d2e 7374 7269  d path")[0].stri
-00007f20: 7028 290a 0a20 2020 2020 2020 2020 2020  p()..           
-00007f30: 2020 2020 2020 2020 2063 7265 6174 655f           create_
-00007f40: 6b65 795f 7175 6573 7469 6f6e 203d 2051  key_question = Q
-00007f50: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
-00007f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f70: 2076 6172 5f6e 616d 653d 2261 7a75 7265   var_name="azure
-00007f80: 5f6b 6579 5f70 6174 6822 2c0a 2020 2020  _key_path",.    
-00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fa0: 2020 2020 7175 6573 7469 6f6e 3d66 224b      question=f"K
-00007fb0: 6579 207b 6b65 795f 7061 7468 7d20 646f  ey {key_path} do
-00007fc0: 6573 206e 6f74 2065 7869 7374 2e20 446f  es not exist. Do
-00007fd0: 2079 6f75 2077 616e 7420 746f 2063 7265   you want to cre
-00007fe0: 6174 6520 6974 3f20 2879 2f6e 2922 2c0a  ate it? (y/n)",.
-00007ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008000: 2020 2020 2020 2020 6465 6661 756c 743d          default=
-00008010: 2279 222c 0a20 2020 2020 2020 2020 2020  "y",.           
-00008020: 2020 2020 2020 2020 2020 2020 206b 696e               kin
-00008030: 643d 2279 6573 6e6f 222c 0a20 2020 2020  d="yesno",.     
-00008040: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008060: 2020 2020 2063 7265 6174 655f 6b65 7920       create_key 
-00008070: 3d20 6173 6b28 0a20 2020 2020 2020 2020  = ask(.         
-00008080: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00008090: 7265 6174 655f 6b65 795f 7175 6573 7469  reate_key_questi
-000080a0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-000080b0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-000080c0: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
-000080d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000080e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000080f0: 2020 2020 2069 6620 6372 6561 7465 5f6b       if create_k
-00008100: 6579 203d 3d20 2279 223a 0a20 2020 2020  ey == "y":.     
-00008110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008120: 2020 206b 6579 5f70 6174 6820 3d20 6765     key_path = ge
-00008130: 6e65 7261 7465 5f6b 6579 5f61 745f 7061  nerate_key_at_pa
-00008140: 7468 286b 6579 5f70 6174 683d 6b65 795f  th(key_path=key_
-00008150: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-00008160: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00008170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008180: 2020 2020 2020 2020 7261 6973 6520 5175          raise Qu
-00008190: 6573 7469 6f6e 496e 7075 7445 7272 6f72  estionInputError
-000081a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000081b0: 2020 2020 2020 2020 2020 2020 2020 2255                "U
-000081c0: 6e61 626c 6520 746f 2063 7265 6174 6520  nable to create 
-000081d0: 564d 2077 6974 686f 7574 2061 2070 7269  VM without a pri
-000081e0: 7661 7465 206b 6579 220a 2020 2020 2020  vate key".      
-000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008200: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00008210: 656c 6966 2070 6172 7365 645f 6b77 6172  elif parsed_kwar
-00008220: 6773 5b22 6175 7468 5f74 7970 6522 5d20  gs["auth_type"] 
-00008230: 3d3d 2022 7061 7373 776f 7264 223a 0a20  == "password":. 
-00008240: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00008250: 7574 6f5f 6765 6e65 7261 7465 5f70 6173  uto_generate_pas
-00008260: 7377 6f72 6420 3d20 6173 6b28 0a20 2020  sword = ask(.   
-00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008280: 2071 7565 7374 696f 6e3d 5175 6573 7469   question=Questi
-00008290: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000082a0: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-000082b0: 6e61 6d65 3d22 6175 746f 5f67 656e 6572  name="auto_gener
-000082c0: 6174 655f 7061 7373 776f 7264 222c 0a20  ate_password",. 
-000082d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082e0: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
-000082f0: 2244 6f20 796f 7520 7761 6e74 2074 6f20  "Do you want to 
-00008300: 6175 746f 2d67 656e 6572 6174 6520 7468  auto-generate th
-00008310: 6520 7061 7373 776f 7264 3f20 2879 2f6e  e password? (y/n
-00008320: 2922 2c0a 2020 2020 2020 2020 2020 2020  )",.            
-00008330: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
-00008340: 3d22 7965 736e 6f22 2c0a 2020 2020 2020  ="yesno",.      
-00008350: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00008360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008370: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
-00008380: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
-00008390: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000083a0: 2020 2020 2020 6966 2061 7574 6f5f 6765        if auto_ge
-000083b0: 6e65 7261 7465 5f70 6173 7377 6f72 6420  nerate_password 
-000083c0: 3d3d 2022 7922 3a20 2023 206e 6f73 6563  == "y":  # nosec
-000083d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000083e0: 2020 2020 2070 6172 7365 645f 6b77 6172       parsed_kwar
-000083f0: 6773 5b22 7061 7373 776f 7264 225d 203d  gs["password"] =
-00008400: 2067 656e 6572 6174 655f 7365 635f 7261   generate_sec_ra
-00008410: 6e64 6f6d 5f70 6173 7377 6f72 6428 6c65  ndom_password(le
-00008420: 6e67 7468 3d31 3629 0a20 2020 2020 2020  ngth=16).       
-00008430: 2020 2020 2020 2020 2065 6c69 6620 6175           elif au
-00008440: 746f 5f67 656e 6572 6174 655f 7061 7373  to_generate_pass
-00008450: 776f 7264 203d 3d20 226e 223a 2020 2320  word == "n":  # 
-00008460: 6e6f 7365 630a 2020 2020 2020 2020 2020  nosec.          
-00008470: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
-00008480: 5f6b 7761 7267 735b 2270 6173 7377 6f72  _kwargs["passwor
-00008490: 6422 5d20 3d20 6173 6b28 0a20 2020 2020  d"] = ask(.     
-000084a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084b0: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
-000084c0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084e0: 2020 7661 725f 6e61 6d65 3d22 7061 7373    var_name="pass
-000084f0: 776f 7264 222c 0a20 2020 2020 2020 2020  word",.         
-00008500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008510: 2020 2071 7565 7374 696f 6e3d 6622 5061     question=f"Pa
-00008520: 7373 776f 7264 2066 6f72 207b 7573 6572  ssword for {user
-00008530: 6e61 6d65 7d40 7b68 6f73 747d 3f22 2c0a  name}@{host}?",.
-00008540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008550: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
-00008560: 3d22 7061 7373 776f 7264 222c 0a20 2020  ="password",.   
-00008570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008580: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00008590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085a0: 6b77 6172 6773 3d6b 7761 7267 732c 0a20  kwargs=kwargs,. 
-000085b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085c0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-000085d0: 2020 7265 706f 203d 2061 736b 280a 2020    repo = ask(.  
-000085e0: 2020 2020 2020 2020 2020 2020 2020 5175                Qu
-000085f0: 6573 7469 6f6e 280a 2020 2020 2020 2020  estion(.        
-00008600: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-00008610: 6e61 6d65 3d22 617a 7572 655f 7265 706f  name="azure_repo
-00008620: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00008630: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
-00008640: 2252 6570 6f20 746f 2066 6574 6368 2073  "Repo to fetch s
-00008650: 6f75 7263 6520 6672 6f6d 3f22 2c0a 2020  ource from?",.  
-00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008670: 2020 6465 6661 756c 743d 6172 675f 6361    default=arg_ca
-00008680: 6368 652e 617a 7572 655f 7265 706f 2c0a  che.azure_repo,.
-00008690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086a0: 2020 2020 6b69 6e64 3d22 7374 7269 6e67      kind="string
-000086b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000086c0: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
-000086d0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000086e0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-000086f0: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
-00008700: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00008710: 2029 0a20 2020 2020 2020 2020 2020 2062   ).            b
-00008720: 7261 6e63 6820 3d20 6173 6b28 0a20 2020  ranch = ask(.   
-00008730: 2020 2020 2020 2020 2020 2020 2051 7565               Que
-00008740: 7374 696f 6e28 0a20 2020 2020 2020 2020  stion(.         
-00008750: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
-00008760: 616d 653d 2261 7a75 7265 5f62 7261 6e63  ame="azure_branc
-00008770: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
-00008780: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
-00008790: 3d22 4272 616e 6368 2074 6f20 6d6f 6e69  ="Branch to moni
-000087a0: 746f 7220 666f 7220 7570 6461 7465 733f  tor for updates?
-000087b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000087c0: 2020 2020 2020 2064 6566 6175 6c74 3d61         default=a
-000087d0: 7267 5f63 6163 6865 2e61 7a75 7265 5f62  rg_cache.azure_b
-000087e0: 7261 6e63 682c 0a20 2020 2020 2020 2020  ranch,.         
-000087f0: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
-00008800: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
-00008810: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00008820: 6368 653d 5472 7565 2c0a 2020 2020 2020  che=True,.      
-00008830: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00008840: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00008850: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
-00008860: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00008870: 2020 2020 2020 2075 7365 5f62 7261 6e63         use_branc
-00008880: 6828 6272 616e 6368 3d62 7261 6e63 6829  h(branch=branch)
-00008890: 0a0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-000088a0: 7373 776f 7264 203d 2070 6172 7365 645f  ssword = parsed_
-000088b0: 6b77 6172 6773 2e67 6574 2822 7061 7373  kwargs.get("pass
-000088c0: 776f 7264 2229 0a0a 2020 2020 2020 2020  word")..        
-000088d0: 2020 2020 6175 7468 203d 2041 7574 6843      auth = AuthC
-000088e0: 7265 6465 6e74 6961 6c73 280a 2020 2020  redentials(.    
-000088f0: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00008900: 6e61 6d65 3d75 7365 726e 616d 652c 206b  name=username, k
-00008910: 6579 5f70 6174 683d 6b65 795f 7061 7468  ey_path=key_path
-00008920: 2c20 7061 7373 776f 7264 3d70 6173 7377  , password=passw
-00008930: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
-00008940: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00008950: 6620 6e6f 7420 6175 7468 2e76 616c 6964  f not auth.valid
-00008960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008970: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00008980: 6e28 6622 4c6f 6769 6e20 4372 6564 656e  n(f"Login Creden
-00008990: 7469 616c 7320 6172 6520 6e6f 7420 7661  tials are not va
-000089a0: 6c69 642e 207b 6175 7468 7d22 290a 0a20  lid. {auth}").. 
-000089b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000089c0: 6e20 6372 6561 7465 5f6c 6175 6e63 685f  n create_launch_
-000089d0: 617a 7572 655f 636d 6428 0a20 2020 2020  azure_cmd(.     
-000089e0: 2020 2020 2020 2020 2020 2076 6572 623d             verb=
-000089f0: 7665 7262 2c0a 2020 2020 2020 2020 2020  verb,.          
-00008a00: 2020 2020 2020 7265 736f 7572 6365 5f67        resource_g
-00008a10: 726f 7570 3d72 6573 6f75 7263 655f 6772  roup=resource_gr
-00008a20: 6f75 702c 0a20 2020 2020 2020 2020 2020  oup,.           
-00008a30: 2020 2020 206c 6f63 6174 696f 6e3d 6c6f       location=lo
-00008a40: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
-00008a50: 2020 2020 2020 2020 7369 7a65 3d73 697a          size=siz
-00008a60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00008a70: 2020 2075 7365 726e 616d 653d 7573 6572     username=user
-00008a80: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00008a90: 2020 2020 2020 7061 7373 776f 7264 3d70        password=p
-00008aa0: 6173 7377 6f72 642c 0a20 2020 2020 2020  assword,.       
-00008ab0: 2020 2020 2020 2020 206b 6579 5f70 6174           key_pat
-00008ac0: 683d 6b65 795f 7061 7468 2c0a 2020 2020  h=key_path,.    
-00008ad0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00008ae0: 3d72 6570 6f2c 0a20 2020 2020 2020 2020  =repo,.         
-00008af0: 2020 2020 2020 2062 7261 6e63 683d 6272         branch=br
-00008b00: 616e 6368 2c0a 2020 2020 2020 2020 2020  anch,.          
-00008b10: 2020 2020 2020 6175 7468 3d61 7574 682c        auth=auth,
-00008b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b30: 2061 6e73 6962 6c65 5f65 7874 7261 733d   ansible_extras=
-00008b40: 6b77 6172 6773 5b22 616e 7369 626c 655f  kwargs["ansible_
-00008b50: 6578 7472 6173 225d 2c0a 2020 2020 2020  extras"],.      
-00008b60: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00008b70: 3d70 6172 7365 645f 6b77 6172 6773 2c0a  =parsed_kwargs,.
-00008b80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00008b90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008ba0: 2020 2020 2020 2020 6572 726f 7273 203d          errors =
-00008bb0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00008bc0: 6966 206e 6f74 2044 4550 454e 4445 4e43  if not DEPENDENC
-00008bd0: 4945 535b 2261 6e73 6962 6c65 2d70 6c61  IES["ansible-pla
-00008be0: 7962 6f6f 6b22 5d3a 0a20 2020 2020 2020  ybook"]:.       
-00008bf0: 2020 2020 2020 2020 2065 7272 6f72 732e           errors.
-00008c00: 6170 7065 6e64 2822 616e 7369 626c 652d  append("ansible-
-00008c10: 706c 6179 626f 6f6b 2229 0a20 2020 2020  playbook").     
-00008c20: 2020 2020 2020 206d 7367 203d 2022 5c6e         msg = "\n
-00008c30: 4552 524f 5221 2121 204d 4953 5349 4e47  ERROR!!! MISSING
-00008c40: 2044 4550 454e 4445 4e43 5921 2121 220a   DEPENDENCY!!!".
-00008c50: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-00008c60: 2b3d 2066 225c 6e5c 6e4c 6175 6e63 6869  += f"\n\nLaunchi
-00008c70: 6e67 2061 2043 6c6f 7564 2056 4d20 7265  ng a Cloud VM re
-00008c80: 7175 6972 6573 3a20 7b27 2027 2e6a 6f69  quires: {' '.joi
-00008c90: 6e28 6572 726f 7273 297d 220a 2020 2020  n(errors)}".    
-00008ca0: 2020 2020 2020 2020 6d73 6720 2b3d 2022          msg += "
-00008cb0: 5c6e 5c6e 506c 6561 7365 2066 6f6c 6c6f  \n\nPlease follo
-00008cc0: 7720 696e 7374 616c 6c61 7469 6f6e 2069  w installation i
-00008cd0: 6e73 7472 7563 7469 6f6e 733a 2022 0a20  nstructions: ". 
-00008ce0: 2020 2020 2020 2020 2020 206d 7367 202b             msg +
-00008cf0: 3d20 2268 7474 7073 3a2f 2f64 6f63 732e  = "https://docs.
-00008d00: 616e 7369 626c 652e 636f 6d2f 616e 7369  ansible.com/ansi
-00008d10: 626c 652f 6c61 7465 7374 2f69 6e73 7461  ble/latest/insta
-00008d20: 6c6c 6174 696f 6e5f 6775 6964 652f 696e  llation_guide/in
-00008d30: 7472 6f5f 696e 7374 616c 6c61 7469 6f6e  tro_installation
-00008d40: 2e68 746d 6c23 220a 2020 2020 2020 2020  .html#".        
-00008d50: 2020 2020 6d73 6720 2b3d 2022 5c6e 5c6e      msg += "\n\n
-00008d60: 4e6f 7465 3a20 7765 2776 6520 666f 756e  Note: we've foun
-00008d70: 6420 7468 6520 2763 6f6e 6461 2720 6261  d the 'conda' ba
-00008d80: 7365 6420 696e 7374 616c 6c61 7469 6f6e  sed installation
-00008d90: 2069 6e73 7472 7563 7469 6f6e 7320 746f   instructions to
-00008da0: 2077 6f72 6b20 6265 7374 220a 2020 2020   work best".    
-00008db0: 2020 2020 2020 2020 6d73 6720 2b3d 2022          msg += "
-00008dc0: 2028 652e 672e 2073 6f6d 6574 6869 6e67   (e.g. something
-00008dd0: 206c 6b65 2027 636f 6e64 6120 696e 7374   lke 'conda inst
-00008de0: 616c 6c20 2d63 2063 6f6e 6461 2d66 6f72  all -c conda-for
-00008df0: 6765 2061 6e73 6962 6c65 2729 2e20 220a  ge ansible'). ".
-00008e00: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-00008e10: 2b3d 2022 5468 6520 7069 7020 6261 7365  += "The pip base
-00008e20: 6420 696e 7374 7275 6374 696f 6e73 2073  d instructions s
-00008e30: 6565 6d20 746f 2062 6520 6120 6269 7420  eem to be a bit 
-00008e40: 6275 6767 7920 6966 2079 6f75 2772 6520  buggy if you're 
-00008e50: 7573 696e 6720 6120 636f 6e64 6120 656e  using a conda en
-00008e60: 7669 726f 6e6d 656e 7422 0a20 2020 2020  vironment".     
-00008e70: 2020 2020 2020 206d 7367 202b 3d20 225c         msg += "\
-00008e80: 6e22 0a20 2020 2020 2020 2020 2020 2072  n".            r
-00008e90: 6169 7365 204d 6973 7369 6e67 4465 7065  aise MissingDepe
-00008ea0: 6e64 656e 6379 286d 7367 290a 0a20 2020  ndency(msg)..   
-00008eb0: 2065 6c69 6620 686f 7374 2069 6e20 5b22   elif host in ["
-00008ec0: 6763 7022 5d3a 0a20 2020 2020 2020 2063  gcp"]:.        c
-00008ed0: 6865 636b 5f67 636c 6f75 645f 636c 695f  heck_gcloud_cli_
-00008ee0: 696e 7374 616c 6c65 6428 290a 0a20 2020  installed()..   
-00008ef0: 2020 2020 2077 6869 6c65 206e 6f74 2063       while not c
-00008f00: 6865 636b 5f67 636c 6f75 645f 6175 7468  heck_gcloud_auth
-00008f10: 6564 2829 3a0a 2020 2020 2020 2020 2020  ed():.          
-00008f20: 2020 7072 696e 7428 2259 6f75 206e 6565    print("You nee
-00008f30: 6420 746f 206c 6f67 2069 6e74 6f20 476f  d to log into Go
-00008f40: 6f67 6c65 2043 6c6f 7564 2229 0a20 2020  ogle Cloud").   
-00008f50: 2020 2020 2020 2020 206c 6f67 696e 5f67           login_g
-00008f60: 636c 6f75 6428 290a 0a20 2020 2020 2020  cloud()..       
-00008f70: 2069 6620 4445 5045 4e44 454e 4349 4553   if DEPENDENCIES
-00008f80: 5b22 616e 7369 626c 652d 706c 6179 626f  ["ansible-playbo
-00008f90: 6f6b 225d 3a0a 2020 2020 2020 2020 2020  ok"]:.          
-00008fa0: 2020 7072 6f6a 6563 745f 6964 203d 2061    project_id = a
-00008fb0: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
-00008fc0: 2020 2020 7175 6573 7469 6f6e 3d51 7565      question=Que
-00008fd0: 7374 696f 6e28 0a20 2020 2020 2020 2020  stion(.         
-00008fe0: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
-00008ff0: 616d 653d 2267 6370 5f70 726f 6a65 6374  ame="gcp_project
-00009000: 5f69 6422 2c0a 2020 2020 2020 2020 2020  _id",.          
-00009010: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-00009020: 6f6e 3d22 5768 6174 2050 524f 4a45 4354  on="What PROJECT
-00009030: 2049 4420 646f 2079 6f75 2077 616e 7420   ID do you want 
-00009040: 746f 2075 7365 3f22 2c0a 2020 2020 2020  to use?",.      
-00009050: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009060: 6661 756c 743d 6172 675f 6361 6368 652e  fault=arg_cache.
-00009070: 6763 705f 7072 6f6a 6563 745f 6964 2c0a  gcp_project_id,.
-00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009090: 2020 2020 6b69 6e64 3d22 7374 7269 6e67      kind="string
-000090a0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000090b0: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
-000090c0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000090d0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-000090e0: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
-000090f0: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00009100: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00009110: 7a6f 6e65 203d 2061 736b 280a 2020 2020  zone = ask(.    
-00009120: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-00009130: 7469 6f6e 3d51 7565 7374 696f 6e28 0a20  tion=Question(. 
-00009140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009150: 2020 2076 6172 5f6e 616d 653d 2267 6370     var_name="gcp
-00009160: 5f7a 6f6e 6522 2c0a 2020 2020 2020 2020  _zone",.        
-00009170: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-00009180: 7469 6f6e 3d22 5768 6174 207a 6f6e 6520  tion="What zone 
-00009190: 646f 2079 6f75 2077 616e 7420 796f 7572  do you want your
-000091a0: 2056 4d20 696e 3f22 2c0a 2020 2020 2020   VM in?",.      
-000091b0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000091c0: 6661 756c 743d 6172 675f 6361 6368 652e  fault=arg_cache.
-000091d0: 6763 705f 7a6f 6e65 2c0a 2020 2020 2020  gcp_zone,.      
-000091e0: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
-000091f0: 6e64 3d22 7374 7269 6e67 222c 0a20 2020  nd="string",.   
-00009200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009210: 2063 6163 6865 3d54 7275 652c 0a20 2020   cache=True,.   
-00009220: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00009230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009240: 6b77 6172 6773 3d6b 7761 7267 732c 0a20  kwargs=kwargs,. 
-00009250: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00009260: 2020 2020 2020 2020 2020 6d61 6368 696e            machin
-00009270: 655f 7479 7065 203d 2061 736b 280a 2020  e_type = ask(.  
-00009280: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-00009290: 6573 7469 6f6e 3d51 7565 7374 696f 6e28  estion=Question(
-000092a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000092b0: 2020 2020 2076 6172 5f6e 616d 653d 2267       var_name="g
-000092c0: 6370 5f6d 6163 6869 6e65 5f74 7970 6522  cp_machine_type"
-000092d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000092e0: 2020 2020 2020 7175 6573 7469 6f6e 3d22        question="
-000092f0: 5768 6174 2073 697a 6520 6d61 6368 696e  What size machin
-00009300: 653f 222c 0a20 2020 2020 2020 2020 2020  e?",.           
-00009310: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009320: 3d61 7267 5f63 6163 6865 2e67 6370 5f6d  =arg_cache.gcp_m
-00009330: 6163 6869 6e65 5f74 7970 652c 0a20 2020  achine_type,.   
-00009340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009350: 206b 696e 643d 2273 7472 696e 6722 2c0a   kind="string",.
-00009360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009370: 2020 2020 6361 6368 653d 5472 7565 2c0a      cache=True,.
-00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009390: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000093a0: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
-000093b0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-000093c0: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-000093d0: 726e 616d 6520 3d20 6173 6b28 0a20 2020  rname = ask(.   
-000093e0: 2020 2020 2020 2020 2020 2020 2071 7565               que
-000093f0: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
-00009400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009410: 2020 2020 7661 725f 6e61 6d65 3d22 6763      var_name="gc
-00009420: 705f 7573 6572 6e61 6d65 222c 0a20 2020  p_username",.   
-00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009440: 2071 7565 7374 696f 6e3d 2257 6861 7420   question="What 
-00009450: 6973 2079 6f75 7220 7368 656c 6c20 7573  is your shell us
-00009460: 6572 6e61 6d65 3f22 2c0a 2020 2020 2020  ername?",.      
-00009470: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009480: 6661 756c 743d 6172 675f 6361 6368 652e  fault=arg_cache.
-00009490: 6763 705f 7573 6572 6e61 6d65 2c0a 2020  gcp_username,.  
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2020 6b69 6e64 3d22 7374 7269 6e67 222c    kind="string",
-000094c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000094d0: 2020 2020 2063 6163 6865 3d54 7275 652c       cache=True,
-000094e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000094f0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00009500: 2020 2020 6b77 6172 6773 3d6b 7761 7267      kwargs=kwarg
-00009510: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
-00009520: 0a0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
-00009530: 795f 7061 7468 5f71 7565 7374 696f 6e20  y_path_question 
-00009540: 3d20 5175 6573 7469 6f6e 280a 2020 2020  = Question(.    
-00009550: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-00009560: 6e61 6d65 3d22 6763 705f 6b65 795f 7061  name="gcp_key_pa
-00009570: 7468 222c 0a20 2020 2020 2020 2020 2020  th",.           
-00009580: 2020 2020 2071 7565 7374 696f 6e3d 6622       question=f"
-00009590: 5072 6976 6174 6520 6b65 7920 746f 2061  Private key to a
-000095a0: 6363 6573 7320 7573 6572 407b 686f 7374  ccess user@{host
-000095b0: 7d3f 222c 0a20 2020 2020 2020 2020 2020  }?",.           
-000095c0: 2020 2020 2064 6566 6175 6c74 3d61 7267       default=arg
-000095d0: 5f63 6163 6865 2e67 6370 5f6b 6579 5f70  _cache.gcp_key_p
-000095e0: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-000095f0: 2020 2020 206b 696e 643d 2270 6174 6822       kind="path"
-00009600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009610: 2020 6361 6368 653d 5472 7565 2c0a 2020    cache=True,.  
-00009620: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00009630: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00009640: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00009650: 5f70 6174 6820 3d20 6173 6b28 0a20 2020  _path = ask(.   
-00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 206b 6579 5f70 6174 685f 7175 6573 7469   key_path_questi
-00009680: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00009690: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
-000096a0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
-000096b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000096c0: 2020 2020 2065 7863 6570 7420 5175 6573       except Ques
-000096d0: 7469 6f6e 496e 7075 7450 6174 6845 7272  tionInputPathErr
-000096e0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-000096f0: 2020 2020 2020 2020 2070 7269 6e74 2865           print(e
-00009700: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009710: 2020 6b65 795f 7061 7468 203d 2073 7472    key_path = str
-00009720: 2865 292e 7370 6c69 7428 2269 7320 6e6f  (e).split("is no
-00009730: 7420 6120 7661 6c69 6420 7061 7468 2229  t a valid path")
-00009740: 5b30 5d2e 7374 7269 7028 290a 0a20 2020  [0].strip()..   
-00009750: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-00009760: 6174 655f 6b65 795f 7175 6573 7469 6f6e  ate_key_question
-00009770: 203d 2051 7565 7374 696f 6e28 0a20 2020   = Question(.   
-00009780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009790: 2076 6172 5f6e 616d 653d 2267 6370 5f6b   var_name="gcp_k
-000097a0: 6579 5f70 6174 6822 2c0a 2020 2020 2020  ey_path",.      
-000097b0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-000097c0: 6573 7469 6f6e 3d66 224b 6579 207b 6b65  estion=f"Key {ke
-000097d0: 795f 7061 7468 7d20 646f 6573 206e 6f74  y_path} does not
-000097e0: 2065 7869 7374 2e20 446f 2079 6f75 2077   exist. Do you w
-000097f0: 616e 7420 6763 6c6f 7564 2074 6f20 6d61  ant gcloud to ma
-00009800: 6b65 2069 743f 2028 792f 6e29 222c 0a20  ke it? (y/n)",. 
-00009810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009820: 2020 2064 6566 6175 6c74 3d22 7922 2c0a     default="y",.
-00009830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009840: 2020 2020 6b69 6e64 3d22 7965 736e 6f22      kind="yesno"
-00009850: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009860: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00009870: 2020 2020 6372 6561 7465 5f6b 6579 203d      create_key =
-00009880: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
-00009890: 2020 2020 2020 2020 2020 6372 6561 7465            create
-000098a0: 5f6b 6579 5f71 7565 7374 696f 6e2c 0a20  _key_question,. 
-000098b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098c0: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
+00000000: 2320 7374 646c 6962 0a66 726f 6d20 636f  # stdlib.from co
+00000010: 6c6c 6563 7469 6f6e 7320 696d 706f 7274  llections import
+00000020: 206e 616d 6564 7475 706c 650a 696d 706f   namedtuple.impo
+00000030: 7274 206a 736f 6e0a 696d 706f 7274 206f  rt json.import o
+00000040: 730a 6672 6f6d 2070 6174 686c 6962 2069  s.from pathlib i
+00000050: 6d70 6f72 7420 5061 7468 0a69 6d70 6f72  mport Path.impor
+00000060: 7420 706c 6174 666f 726d 0a66 726f 6d20  t platform.from 
+00000070: 7175 6575 6520 696d 706f 7274 2051 7565  queue import Que
+00000080: 7565 0a69 6d70 6f72 7420 7265 0a69 6d70  ue.import re.imp
+00000090: 6f72 7420 7368 7574 696c 0a69 6d70 6f72  ort shutil.impor
+000000a0: 7420 736f 636b 6574 0a69 6d70 6f72 7420  t socket.import 
+000000b0: 7374 6174 0a69 6d70 6f72 7420 7375 6270  stat.import subp
+000000c0: 726f 6365 7373 2020 2320 6e6f 7365 630a  rocess  # nosec.
+000000d0: 696d 706f 7274 2073 7973 0a69 6d70 6f72  import sys.impor
+000000e0: 7420 7465 6d70 6669 6c65 0a66 726f 6d20  t tempfile.from 
+000000f0: 7468 7265 6164 696e 6720 696d 706f 7274  threading import
+00000100: 2045 7665 6e74 0a66 726f 6d20 7468 7265   Event.from thre
+00000110: 6164 696e 6720 696d 706f 7274 2054 6872  ading import Thr
+00000120: 6561 640a 696d 706f 7274 2074 696d 650a  ead.import time.
+00000130: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
+00000140: 7274 2041 6e79 0a66 726f 6d20 7479 7069  rt Any.from typi
+00000150: 6e67 2069 6d70 6f72 7420 4361 6c6c 6162  ng import Callab
+00000160: 6c65 0a66 726f 6d20 7479 7069 6e67 2069  le.from typing i
+00000170: 6d70 6f72 7420 4469 6374 2061 7320 5479  mport Dict as Ty
+00000180: 7065 4469 6374 0a66 726f 6d20 7479 7069  peDict.from typi
+00000190: 6e67 2069 6d70 6f72 7420 4c69 7374 2061  ng import List a
+000001a0: 7320 5479 7065 4c69 7374 0a66 726f 6d20  s TypeList.from 
+000001b0: 7479 7069 6e67 2069 6d70 6f72 7420 4f70  typing import Op
+000001c0: 7469 6f6e 616c 0a66 726f 6d20 7479 7069  tional.from typi
+000001d0: 6e67 2069 6d70 6f72 7420 5475 706c 650a  ng import Tuple.
+000001e0: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
+000001f0: 7274 2054 7570 6c65 2061 7320 5479 7065  rt Tuple as Type
+00000200: 5475 706c 650a 6672 6f6d 2074 7970 696e  Tuple.from typin
+00000210: 6720 696d 706f 7274 2055 6e69 6f6e 0a66  g import Union.f
+00000220: 726f 6d20 7479 7069 6e67 2069 6d70 6f72  rom typing impor
+00000230: 7420 6361 7374 0a66 726f 6d20 7572 6c6c  t cast.from urll
+00000240: 6962 2e70 6172 7365 2069 6d70 6f72 7420  ib.parse import 
+00000250: 7572 6c70 6172 7365 0a69 6d70 6f72 7420  urlparse.import 
+00000260: 7765 6262 726f 7773 6572 0a0a 2320 7468  webbrowser..# th
+00000270: 6972 6420 7061 7274 790a 696d 706f 7274  ird party.import
+00000280: 2063 6c69 636b 0a69 6d70 6f72 7420 7265   click.import re
+00000290: 7175 6573 7473 0a69 6d70 6f72 7420 7269  quests.import ri
+000002a0: 6368 0a66 726f 6d20 7269 6368 2e63 6f6e  ch.from rich.con
+000002b0: 736f 6c65 2069 6d70 6f72 7420 436f 6e73  sole import Cons
+000002c0: 6f6c 650a 6672 6f6d 2072 6963 682e 6c69  ole.from rich.li
+000002d0: 7665 2069 6d70 6f72 7420 4c69 7665 0a66  ve import Live.f
+000002e0: 726f 6d20 7269 6368 2e70 726f 6772 6573  rom rich.progres
+000002f0: 7320 696d 706f 7274 2042 6172 436f 6c75  s import BarColu
+00000300: 6d6e 0a66 726f 6d20 7269 6368 2e70 726f  mn.from rich.pro
+00000310: 6772 6573 7320 696d 706f 7274 2050 726f  gress import Pro
+00000320: 6772 6573 730a 6672 6f6d 2072 6963 682e  gress.from rich.
+00000330: 7072 6f67 7265 7373 2069 6d70 6f72 7420  progress import 
+00000340: 5370 696e 6e65 7243 6f6c 756d 6e0a 6672  SpinnerColumn.fr
+00000350: 6f6d 2072 6963 682e 7072 6f67 7265 7373  om rich.progress
+00000360: 2069 6d70 6f72 7420 5465 7874 436f 6c75   import TextColu
+00000370: 6d6e 0a66 726f 6d20 7669 7274 7561 6c65  mn.from virtuale
+00000380: 6e76 6170 692e 6d61 6e61 6765 2069 6d70  nvapi.manage imp
+00000390: 6f72 7420 5669 7274 7561 6c45 6e76 6972  ort VirtualEnvir
+000003a0: 6f6e 6d65 6e74 0a0a 2320 7265 6c61 7469  onment..# relati
+000003b0: 7665 0a66 726f 6d20 2e61 7274 2069 6d70  ve.from .art imp
+000003c0: 6f72 7420 5269 6368 456d 6f6a 690a 6672  ort RichEmoji.fr
+000003d0: 6f6d 202e 6172 7420 696d 706f 7274 2068  om .art import h
+000003e0: 6167 7269 640a 6672 6f6d 202e 6172 7420  agrid.from .art 
+000003f0: 696d 706f 7274 2071 7569 636b 7374 6172  import quickstar
+00000400: 745f 6172 740a 6672 6f6d 202e 6175 7468  t_art.from .auth
+00000410: 2069 6d70 6f72 7420 4175 7468 4372 6564   import AuthCred
+00000420: 656e 7469 616c 730a 6672 6f6d 202e 6361  entials.from .ca
+00000430: 6368 6520 696d 706f 7274 2044 4546 4155  che import DEFAU
+00000440: 4c54 5f42 5241 4e43 480a 6672 6f6d 202e  LT_BRANCH.from .
+00000450: 6361 6368 6520 696d 706f 7274 2044 4546  cache import DEF
+00000460: 4155 4c54 5f52 4550 4f0a 6672 6f6d 202e  AULT_REPO.from .
+00000470: 6361 6368 6520 696d 706f 7274 2052 454e  cache import REN
+00000480: 4445 5245 445f 4449 520a 6672 6f6d 202e  DERED_DIR.from .
+00000490: 6361 6368 6520 696d 706f 7274 2061 7267  cache import arg
+000004a0: 5f63 6163 6865 0a66 726f 6d20 2e64 6570  _cache.from .dep
+000004b0: 7320 696d 706f 7274 2044 4550 454e 4445  s import DEPENDE
+000004c0: 4e43 4945 530a 6672 6f6d 202e 6465 7073  NCIES.from .deps
+000004d0: 2069 6d70 6f72 7420 616c 6c6f 7765 645f   import allowed_
+000004e0: 686f 7374 730a 6672 6f6d 202e 6465 7073  hosts.from .deps
+000004f0: 2069 6d70 6f72 7420 6368 6563 6b5f 646f   import check_do
+00000500: 636b 6572 5f73 6572 7669 6365 5f73 7461  cker_service_sta
+00000510: 7475 730a 6672 6f6d 202e 6465 7073 2069  tus.from .deps i
+00000520: 6d70 6f72 7420 6368 6563 6b5f 646f 636b  mport check_dock
+00000530: 6572 5f76 6572 7369 6f6e 0a66 726f 6d20  er_version.from 
+00000540: 2e64 6570 7320 696d 706f 7274 2063 6865  .deps import che
+00000550: 636b 5f67 7269 645f 646f 636b 6572 0a66  ck_grid_docker.f
+00000560: 726f 6d20 2e64 6570 7320 696d 706f 7274  rom .deps import
+00000570: 2067 6174 6865 725f 6465 6275 670a 6672   gather_debug.fr
+00000580: 6f6d 202e 6465 7073 2069 6d70 6f72 7420  om .deps import 
+00000590: 6765 745f 7665 7273 696f 6e5f 7374 7269  get_version_stri
+000005a0: 6e67 0a66 726f 6d20 2e64 6570 7320 696d  ng.from .deps im
+000005b0: 706f 7274 2069 735f 7769 6e64 6f77 730a  port is_windows.
+000005c0: 6672 6f6d 202e 6578 6365 7074 696f 6e73  from .exceptions
+000005d0: 2069 6d70 6f72 7420 4d69 7373 696e 6744   import MissingD
+000005e0: 6570 656e 6465 6e63 790a 6672 6f6d 202e  ependency.from .
+000005f0: 6772 616d 6d61 7220 696d 706f 7274 2042  grammar import B
+00000600: 6164 4772 616d 6d61 720a 6672 6f6d 202e  adGrammar.from .
+00000610: 6772 616d 6d61 7220 696d 706f 7274 2047  grammar import G
+00000620: 7261 6d6d 6172 5665 7262 0a66 726f 6d20  rammarVerb.from 
+00000630: 2e67 7261 6d6d 6172 2069 6d70 6f72 7420  .grammar import 
+00000640: 7061 7273 655f 6772 616d 6d61 720a 6672  parse_grammar.fr
+00000650: 6f6d 202e 6c61 6e64 2069 6d70 6f72 7420  om .land import 
+00000660: 6765 745f 6c61 6e64 5f76 6572 620a 6672  get_land_verb.fr
+00000670: 6f6d 202e 6c61 756e 6368 2069 6d70 6f72  om .launch impor
+00000680: 7420 6765 745f 6c61 756e 6368 5f76 6572  t get_launch_ver
+00000690: 620a 6672 6f6d 202e 6c69 6220 696d 706f  b.from .lib impo
+000006a0: 7274 2047 4954 5f52 4550 4f0a 6672 6f6d  rt GIT_REPO.from
+000006b0: 202e 6c69 6220 696d 706f 7274 2047 5249   .lib import GRI
+000006c0: 445f 5352 435f 5041 5448 0a66 726f 6d20  D_SRC_PATH.from 
+000006d0: 2e6c 6962 2069 6d70 6f72 7420 4752 4944  .lib import GRID
+000006e0: 5f53 5243 5f56 4552 5349 4f4e 0a66 726f  _SRC_VERSION.fro
+000006f0: 6d20 2e6c 6962 2069 6d70 6f72 7420 6368  m .lib import ch
+00000700: 6563 6b5f 6170 695f 6d65 7461 6461 7461  eck_api_metadata
+00000710: 0a66 726f 6d20 2e6c 6962 2069 6d70 6f72  .from .lib impor
+00000720: 7420 6368 6563 6b5f 686f 7374 0a66 726f  t check_host.fro
+00000730: 6d20 2e6c 6962 2069 6d70 6f72 7420 6368  m .lib import ch
+00000740: 6563 6b5f 6a75 7079 7465 725f 7365 7276  eck_jupyter_serv
+00000750: 6572 0a66 726f 6d20 2e6c 6962 2069 6d70  er.from .lib imp
+00000760: 6f72 7420 6368 6563 6b5f 6c6f 6769 6e5f  ort check_login_
+00000770: 7061 6765 0a66 726f 6d20 2e6c 6962 2069  page.from .lib i
+00000780: 6d70 6f72 7420 636f 6d6d 6974 5f68 6173  mport commit_has
+00000790: 680a 6672 6f6d 202e 6c69 6220 696d 706f  h.from .lib impo
+000007a0: 7274 2064 6f63 6b65 725f 6465 736b 746f  rt docker_deskto
+000007b0: 705f 6d65 6d6f 7279 0a66 726f 6d20 2e6c  p_memory.from .l
+000007c0: 6962 2069 6d70 6f72 7420 6669 6e64 5f61  ib import find_a
+000007d0: 7661 696c 6162 6c65 5f70 6f72 740a 6672  vailable_port.fr
+000007e0: 6f6d 202e 6c69 6220 696d 706f 7274 2067  om .lib import g
+000007f0: 656e 6572 6174 655f 7072 6f63 6573 735f  enerate_process_
+00000800: 7374 6174 7573 5f74 6162 6c65 0a66 726f  status_table.fro
+00000810: 6d20 2e6c 6962 2069 6d70 6f72 7420 6765  m .lib import ge
+00000820: 6e65 7261 7465 5f75 7365 725f 7461 626c  nerate_user_tabl
+00000830: 650a 6672 6f6d 202e 6c69 6220 696d 706f  e.from .lib impo
+00000840: 7274 2067 6974 706f 645f 7572 6c0a 6672  rt gitpod_url.fr
+00000850: 6f6d 202e 6c69 6220 696d 706f 7274 2068  om .lib import h
+00000860: 6167 7269 645f 726f 6f74 0a66 726f 6d20  agrid_root.from 
+00000870: 2e6c 6962 2069 6d70 6f72 7420 6973 5f67  .lib import is_g
+00000880: 6974 706f 640a 6672 6f6d 202e 6c69 6220  itpod.from .lib 
+00000890: 696d 706f 7274 206e 616d 655f 7461 670a  import name_tag.
+000008a0: 6672 6f6d 202e 6c69 6220 696d 706f 7274  from .lib import
+000008b0: 2073 6176 655f 766d 5f64 6574 6169 6c73   save_vm_details
+000008c0: 5f61 735f 6a73 6f6e 0a66 726f 6d20 2e6c  _as_json.from .l
+000008d0: 6962 2069 6d70 6f72 7420 7570 6461 7465  ib import update
+000008e0: 5f72 6570 6f0a 6672 6f6d 202e 6c69 6220  _repo.from .lib 
+000008f0: 696d 706f 7274 2075 7365 5f62 7261 6e63  import use_branc
+00000900: 680a 6672 6f6d 202e 6d6f 6465 2069 6d70  h.from .mode imp
+00000910: 6f72 7420 4544 4954 4142 4c45 5f4d 4f44  ort EDITABLE_MOD
+00000920: 450a 6672 6f6d 202e 7061 7273 655f 7465  E.from .parse_te
+00000930: 6d70 6c61 7465 2069 6d70 6f72 7420 7265  mplate import re
+00000940: 6e64 6572 5f74 656d 706c 6174 6573 0a66  nder_templates.f
+00000950: 726f 6d20 2e70 6172 7365 5f74 656d 706c  rom .parse_templ
+00000960: 6174 6520 696d 706f 7274 2073 6574 7570  ate import setup
+00000970: 5f66 726f 6d5f 6d61 6e69 6665 7374 5f74  _from_manifest_t
+00000980: 656d 706c 6174 650a 6672 6f6d 202e 7175  emplate.from .qu
+00000990: 6963 6b73 7461 7274 5f75 6920 696d 706f  ickstart_ui impo
+000009a0: 7274 2066 6574 6368 5f6e 6f74 6562 6f6f  rt fetch_noteboo
+000009b0: 6b73 5f66 6f72 5f75 726c 0a66 726f 6d20  ks_for_url.from 
+000009c0: 2e71 7569 636b 7374 6172 745f 7569 2069  .quickstart_ui i
+000009d0: 6d70 6f72 7420 6665 7463 685f 6e6f 7465  mport fetch_note
+000009e0: 626f 6f6b 735f 6672 6f6d 5f7a 6970 6669  books_from_zipfi
+000009f0: 6c65 0a66 726f 6d20 2e71 7569 636b 7374  le.from .quickst
+00000a00: 6172 745f 7569 2069 6d70 6f72 7420 7175  art_ui import qu
+00000a10: 6963 6b73 7461 7274 5f64 6f77 6e6c 6f61  ickstart_downloa
+00000a20: 645f 6e6f 7465 626f 6f6b 0a66 726f 6d20  d_notebook.from 
+00000a30: 2e72 616e 645f 7365 6320 696d 706f 7274  .rand_sec import
+00000a40: 2067 656e 6572 6174 655f 7365 635f 7261   generate_sec_ra
+00000a50: 6e64 6f6d 5f70 6173 7377 6f72 640a 6672  ndom_password.fr
+00000a60: 6f6d 202e 7374 796c 6520 696d 706f 7274  om .style import
+00000a70: 2052 6963 6847 726f 7570 0a66 726f 6d20   RichGroup.from 
+00000a80: 2e75 7469 6c20 696d 706f 7274 2066 6978  .util import fix
+00000a90: 5f77 696e 646f 7773 5f76 6972 7475 616c  _windows_virtual
+00000aa0: 656e 765f 6170 690a 6672 6f6d 202e 7574  env_api.from .ut
+00000ab0: 696c 2069 6d70 6f72 7420 6672 6f6d 5f75  il import from_u
+00000ac0: 726c 0a66 726f 6d20 2e75 7469 6c20 696d  rl.from .util im
+00000ad0: 706f 7274 2073 6865 6c6c 0a0a 2320 6669  port shell..# fi
+00000ae0: 7820 5669 7274 7561 6c45 6e76 6972 6f6e  x VirtualEnviron
+00000af0: 6d65 6e74 2062 7567 2069 6e20 7769 6e64  ment bug in wind
+00000b00: 6f77 730a 6669 785f 7769 6e64 6f77 735f  ows.fix_windows_
+00000b10: 7669 7274 7561 6c65 6e76 5f61 7069 2856  virtualenv_api(V
+00000b20: 6972 7475 616c 456e 7669 726f 6e6d 656e  irtualEnvironmen
+00000b30: 7429 0a0a 0a64 6566 2067 6574 5f61 7a75  t)...def get_azu
+00000b40: 7265 5f69 6d61 6765 2873 686f 7274 5f6e  re_image(short_n
+00000b50: 616d 653a 2073 7472 2920 2d3e 2073 7472  ame: str) -> str
+00000b60: 3a0a 2020 2020 7072 6562 7569 6c64 5f30  :.    prebuild_0
+00000b70: 3730 203d 2028 0a20 2020 2020 2020 2022  70 = (.        "
+00000b80: 6d61 6468 6176 616a 6179 3136 3332 3236  madhavajay163226
+00000b90: 3932 3332 3035 393a 6f70 656e 6d69 6e65  9232059:openmine
+00000ba0: 645f 6d6a 5f67 7269 645f 646f 6d61 696e  d_mj_grid_domain
+00000bb0: 5f75 6275 6e74 755f 313a 646f 6d61 696e  _ubuntu_1:domain
+00000bc0: 5f30 3730 3a6c 6174 6573 7422 0a20 2020  _070:latest".   
+00000bd0: 2029 0a20 2020 2066 7265 7368 5f75 6275   ).    fresh_ubu
+00000be0: 6e74 7520 3d20 2243 616e 6f6e 6963 616c  ntu = "Canonical
+00000bf0: 3a30 3030 312d 636f 6d2d 7562 756e 7475  :0001-com-ubuntu
+00000c00: 2d73 6572 7665 722d 666f 6361 6c3a 3230  -server-focal:20
+00000c10: 5f30 342d 6c74 733a 6c61 7465 7374 220a  _04-lts:latest".
+00000c20: 2020 2020 6966 2073 686f 7274 5f6e 616d      if short_nam
+00000c30: 6520 3d3d 2022 6465 6661 756c 7422 3a0a  e == "default":.
+00000c40: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00000c50: 7265 7368 5f75 6275 6e74 750a 2020 2020  resh_ubuntu.    
+00000c60: 656c 6966 2073 686f 7274 5f6e 616d 6520  elif short_name 
+00000c70: 3d3d 2022 646f 6d61 696e 5f30 2e37 2e30  == "domain_0.7.0
+00000c80: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+00000c90: 6e20 7072 6562 7569 6c64 5f30 3730 0a20  n prebuild_070. 
+00000ca0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00000cb0: 6f6e 2866 2249 6d61 6765 206e 616d 6520  on(f"Image name 
+00000cc0: 646f 6573 6e27 7420 6578 6973 743a 207b  doesn't exist: {
+00000cd0: 7368 6f72 745f 6e61 6d65 7d2e 2054 7279  short_name}. Try
+00000ce0: 3a20 6465 6661 756c 7420 6f72 2030 2e37  : default or 0.7
+00000cf0: 2e30 2229 0a0a 0a40 636c 6963 6b2e 6772  .0")...@click.gr
+00000d00: 6f75 7028 636c 733d 5269 6368 4772 6f75  oup(cls=RichGrou
+00000d10: 7029 0a64 6566 2063 6c69 2829 202d 3e20  p).def cli() -> 
+00000d20: 4e6f 6e65 3a0a 2020 2020 7061 7373 0a0a  None:.    pass..
+00000d30: 0a40 636c 6963 6b2e 636f 6d6d 616e 6428  .@click.command(
+00000d40: 0a20 2020 2068 656c 703d 2252 6573 746f  .    help="Resto
+00000d50: 7265 2073 6f6d 6520 7061 7274 206f 6620  re some part of 
+00000d60: 7468 6520 6861 6772 6964 2069 6e73 7461  the hagrid insta
+00000d70: 6c6c 6174 696f 6e20 6f72 2064 6570 6c6f  llation or deplo
+00000d80: 796d 656e 7420 746f 2069 7473 2069 6e69  yment to its ini
+00000d90: 7469 616c 2f73 7461 7274 696e 6720 7374  tial/starting st
+00000da0: 6174 652e 222c 0a20 2020 2063 6f6e 7465  ate.",.    conte
+00000db0: 7874 5f73 6574 7469 6e67 733d 7b22 7368  xt_settings={"sh
+00000dc0: 6f77 5f64 6566 6175 6c74 223a 2054 7275  ow_default": Tru
+00000dd0: 657d 2c0a 290a 4063 6c69 636b 2e61 7267  e},.).@click.arg
+00000de0: 756d 656e 7428 226c 6f63 6174 696f 6e22  ument("location"
+00000df0: 2c20 7479 7065 3d73 7472 2c20 6e61 7267  , type=str, narg
+00000e00: 733d 3129 0a64 6566 2063 6c65 616e 286c  s=1).def clean(l
+00000e10: 6f63 6174 696f 6e3a 2073 7472 2920 2d3e  ocation: str) ->
+00000e20: 204e 6f6e 653a 0a20 2020 2069 6620 6c6f   None:.    if lo
+00000e30: 6361 7469 6f6e 203d 3d20 226c 6962 7261  cation == "libra
+00000e40: 7279 2220 6f72 206c 6f63 6174 696f 6e20  ry" or location 
+00000e50: 3d3d 2022 766f 6c75 6d65 7322 3a0a 2020  == "volumes":.  
+00000e60: 2020 2020 2020 7072 696e 7428 2244 656c        print("Del
+00000e70: 6574 696e 6720 616c 6c20 446f 636b 6572  eting all Docker
+00000e80: 2076 6f6c 756d 6573 2069 6e20 3220 7365   volumes in 2 se
+00000e90: 6373 2028 4374 726c 2d43 2074 6f20 7374  cs (Ctrl-C to st
+00000ea0: 6f70 2922 290a 2020 2020 2020 2020 7469  op)").        ti
+00000eb0: 6d65 2e73 6c65 6570 2832 290a 2020 2020  me.sleep(2).    
+00000ec0: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
+00000ed0: 616c 6c28 2264 6f63 6b65 7220 766f 6c75  all("docker volu
+00000ee0: 6d65 2072 6d20 2428 646f 636b 6572 2076  me rm $(docker v
+00000ef0: 6f6c 756d 6520 6c73 202d 7129 222c 2073  olume ls -q)", s
+00000f00: 6865 6c6c 3d54 7275 6529 2020 2320 6e6f  hell=True)  # no
+00000f10: 7365 630a 0a20 2020 2069 6620 6c6f 6361  sec..    if loca
+00000f20: 7469 6f6e 203d 3d20 2263 6f6e 7461 696e  tion == "contain
+00000f30: 6572 7322 206f 7220 6c6f 6361 7469 6f6e  ers" or location
+00000f40: 203d 3d20 2270 616e 7472 7922 3a0a 2020   == "pantry":.  
+00000f50: 2020 2020 2020 7072 696e 7428 2244 656c        print("Del
+00000f60: 6574 696e 6720 616c 6c20 446f 636b 6572  eting all Docker
+00000f70: 2063 6f6e 7461 696e 6572 7320 696e 2032   containers in 2
+00000f80: 2073 6563 7320 2843 7472 6c2d 4320 746f   secs (Ctrl-C to
+00000f90: 2073 746f 7029 2229 0a20 2020 2020 2020   stop)").       
+00000fa0: 2074 696d 652e 736c 6565 7028 3229 0a20   time.sleep(2). 
+00000fb0: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
+00000fc0: 732e 6361 6c6c 2822 646f 636b 6572 2072  s.call("docker r
+00000fd0: 6d20 2d66 2024 2864 6f63 6b65 7220 7073  m -f $(docker ps
+00000fe0: 202d 6120 2d71 2922 2c20 7368 656c 6c3d   -a -q)", shell=
+00000ff0: 5472 7565 2920 2023 206e 6f73 6563 0a0a  True)  # nosec..
+00001000: 2020 2020 6966 206c 6f63 6174 696f 6e20      if location 
+00001010: 3d3d 2022 696d 6167 6573 223a 0a20 2020  == "images":.   
+00001020: 2020 2020 2070 7269 6e74 2822 4465 6c65       print("Dele
+00001030: 7469 6e67 2061 6c6c 2044 6f63 6b65 7220  ting all Docker 
+00001040: 696d 6167 6573 2069 6e20 3220 7365 6373  images in 2 secs
+00001050: 2028 4374 726c 2d43 2074 6f20 7374 6f70   (Ctrl-C to stop
+00001060: 2922 290a 2020 2020 2020 2020 7469 6d65  )").        time
+00001070: 2e73 6c65 6570 2832 290a 2020 2020 2020  .sleep(2).      
+00001080: 2020 7375 6270 726f 6365 7373 2e63 616c    subprocess.cal
+00001090: 6c28 2264 6f63 6b65 7220 726d 6920 2428  l("docker rmi $(
+000010a0: 646f 636b 6572 2069 6d61 6765 7320 2d71  docker images -q
+000010b0: 2922 2c20 7368 656c 6c3d 5472 7565 2920  )", shell=True) 
+000010c0: 2023 206e 6f73 6563 0a0a 0a40 636c 6963   # nosec...@clic
+000010d0: 6b2e 636f 6d6d 616e 6428 0a20 2020 2068  k.command(.    h
+000010e0: 656c 703d 2253 7461 7274 2061 206e 6577  elp="Start a new
+000010f0: 2050 7947 7269 6420 646f 6d61 696e 2f6e   PyGrid domain/n
+00001100: 6574 776f 726b 206e 6f64 6521 222c 0a20  etwork node!",. 
+00001110: 2020 2063 6f6e 7465 7874 5f73 6574 7469     context_setti
+00001120: 6e67 733d 7b22 7368 6f77 5f64 6566 6175  ngs={"show_defau
+00001130: 6c74 223a 2054 7275 657d 2c0a 290a 4063  lt": True},.).@c
+00001140: 6c69 636b 2e61 7267 756d 656e 7428 2261  lick.argument("a
+00001150: 7267 7322 2c20 7479 7065 3d73 7472 2c20  rgs", type=str, 
+00001160: 6e61 7267 733d 2d31 290a 4063 6c69 636b  nargs=-1).@click
+00001170: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
+00001180: 7573 6572 6e61 6d65 222c 0a20 2020 2064  username",.    d
+00001190: 6566 6175 6c74 3d4e 6f6e 652c 0a20 2020  efault=None,.   
+000011a0: 2072 6571 7569 7265 643d 4661 6c73 652c   required=False,
+000011b0: 0a20 2020 2074 7970 653d 7374 722c 0a20  .    type=str,. 
+000011c0: 2020 2068 656c 703d 2255 7365 726e 616d     help="Usernam
+000011d0: 6520 666f 7220 7072 6f76 6973 696f 6e69  e for provisioni
+000011e0: 6e67 2074 6865 2072 656d 6f74 6520 686f  ng the remote ho
+000011f0: 7374 222c 0a29 0a40 636c 6963 6b2e 6f70  st",.).@click.op
+00001200: 7469 6f6e 280a 2020 2020 222d 2d6b 6579  tion(.    "--key
+00001210: 2d70 6174 6822 2c0a 2020 2020 6465 6661  -path",.    defa
+00001220: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
+00001230: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
+00001240: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
+00001250: 6865 6c70 3d22 5061 7468 2074 6f20 7468  help="Path to th
+00001260: 6520 6b65 7920 6669 6c65 2066 6f72 2070  e key file for p
+00001270: 726f 7669 7369 6f6e 696e 6720 7468 6520  rovisioning the 
+00001280: 7265 6d6f 7465 2068 6f73 7422 2c0a 290a  remote host",.).
+00001290: 4063 6c69 636b 2e6f 7074 696f 6e28 0a20  @click.option(. 
+000012a0: 2020 2022 2d2d 7061 7373 776f 7264 222c     "--password",
+000012b0: 0a20 2020 2064 6566 6175 6c74 3d4e 6f6e  .    default=Non
+000012c0: 652c 0a20 2020 2072 6571 7569 7265 643d  e,.    required=
+000012d0: 4661 6c73 652c 0a20 2020 2074 7970 653d  False,.    type=
+000012e0: 7374 722c 0a20 2020 2068 656c 703d 2250  str,.    help="P
+000012f0: 6173 7377 6f72 6420 666f 7220 7072 6f76  assword for prov
+00001300: 6973 696f 6e69 6e67 2074 6865 2072 656d  isioning the rem
+00001310: 6f74 6520 686f 7374 222c 0a29 0a40 636c  ote host",.).@cl
+00001320: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
+00001330: 222d 2d72 6570 6f22 2c0a 2020 2020 6465  "--repo",.    de
+00001340: 6661 756c 743d 4e6f 6e65 2c0a 2020 2020  fault=None,.    
+00001350: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
+00001360: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
+00001370: 2020 6865 6c70 3d22 5265 706f 2074 6f20    help="Repo to 
+00001380: 6665 7463 6820 736f 7572 6365 2066 726f  fetch source fro
+00001390: 6d22 2c0a 290a 4063 6c69 636b 2e6f 7074  m",.).@click.opt
+000013a0: 696f 6e28 0a20 2020 2022 2d2d 6272 616e  ion(.    "--bran
+000013b0: 6368 222c 0a20 2020 2064 6566 6175 6c74  ch",.    default
+000013c0: 3d4e 6f6e 652c 0a20 2020 2072 6571 7569  =None,.    requi
+000013d0: 7265 643d 4661 6c73 652c 0a20 2020 2074  red=False,.    t
+000013e0: 7970 653d 7374 722c 0a20 2020 2068 656c  ype=str,.    hel
+000013f0: 703d 2242 7261 6e63 6820 746f 206d 6f6e  p="Branch to mon
+00001400: 6974 6f72 2066 6f72 2075 7064 6174 6573  itor for updates
+00001410: 222c 0a29 0a40 636c 6963 6b2e 6f70 7469  ",.).@click.opti
+00001420: 6f6e 280a 2020 2020 222d 2d74 6169 6c22  on(.    "--tail"
+00001430: 2c0a 2020 2020 6973 5f66 6c61 673d 5472  ,.    is_flag=Tr
+00001440: 7565 2c0a 2020 2020 6865 6c70 3d22 5461  ue,.    help="Ta
+00001450: 696c 206c 6f67 7320 6f6e 206c 6175 6e63  il logs on launc
+00001460: 6822 2c0a 290a 4063 6c69 636b 2e6f 7074  h",.).@click.opt
+00001470: 696f 6e28 0a20 2020 2022 2d2d 6865 6164  ion(.    "--head
+00001480: 6c65 7373 222c 0a20 2020 2069 735f 666c  less",.    is_fl
+00001490: 6167 3d54 7275 652c 0a20 2020 2068 656c  ag=True,.    hel
+000014a0: 703d 2253 7461 7274 2074 6865 2066 726f  p="Start the fro
+000014b0: 6e74 656e 6420 636f 6e74 6169 6e65 7222  ntend container"
+000014c0: 2c0a 290a 4063 6c69 636b 2e6f 7074 696f  ,.).@click.optio
+000014d0: 6e28 0a20 2020 2022 2d2d 636d 6422 2c0a  n(.    "--cmd",.
+000014e0: 2020 2020 6973 5f66 6c61 673d 5472 7565      is_flag=True
+000014f0: 2c0a 2020 2020 6865 6c70 3d22 5072 696e  ,.    help="Prin
+00001500: 7420 7468 6520 636d 6420 7769 7468 6f75  t the cmd withou
+00001510: 7420 7275 6e6e 696e 6720 6974 222c 0a29  t running it",.)
+00001520: 0a40 636c 6963 6b2e 6f70 7469 6f6e 280a  .@click.option(.
+00001530: 2020 2020 222d 2d6a 7570 7974 6572 222c      "--jupyter",
+00001540: 0a20 2020 2069 735f 666c 6167 3d54 7275  .    is_flag=Tru
+00001550: 652c 0a20 2020 2068 656c 703d 2245 6e61  e,.    help="Ena
+00001560: 626c 6520 4a75 7079 7465 7220 4e6f 7465  ble Jupyter Note
+00001570: 626f 6f6b 7322 2c0a 290a 4063 6c69 636b  books",.).@click
+00001580: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
+00001590: 6275 696c 6422 2c0a 2020 2020 6973 5f66  build",.    is_f
+000015a0: 6c61 673d 5472 7565 2c0a 2020 2020 6865  lag=True,.    he
+000015b0: 6c70 3d22 4469 7361 626c 6520 666f 7263  lp="Disable forc
+000015c0: 696e 6720 7265 2d62 7569 6c64 222c 0a29  ing re-build",.)
+000015d0: 0a40 636c 6963 6b2e 6f70 7469 6f6e 280a  .@click.option(.
+000015e0: 2020 2020 222d 2d6e 6f2d 7072 6f76 6973      "--no-provis
+000015f0: 696f 6e22 2c0a 2020 2020 6973 5f66 6c61  ion",.    is_fla
+00001600: 673d 5472 7565 2c0a 2020 2020 6865 6c70  g=True,.    help
+00001610: 3d22 4469 7361 626c 6520 7072 6f76 6973  ="Disable provis
+00001620: 696f 6e69 6e67 2056 4d73 222c 0a29 0a40  ioning VMs",.).@
+00001630: 636c 6963 6b2e 6f70 7469 6f6e 280a 2020  click.option(.  
+00001640: 2020 222d 2d6e 6f64 652d 636f 756e 7422    "--node-count"
+00001650: 2c0a 2020 2020 6465 6661 756c 743d 312c  ,.    default=1,
+00001660: 0a20 2020 2072 6571 7569 7265 643d 4661  .    required=Fa
+00001670: 6c73 652c 0a20 2020 2074 7970 653d 636c  lse,.    type=cl
+00001680: 6963 6b2e 496e 7452 616e 6765 2831 2c20  ick.IntRange(1, 
+00001690: 3235 3029 2c0a 2020 2020 6865 6c70 3d22  250),.    help="
+000016a0: 4e75 6d62 6572 206f 6620 696e 6465 7065  Number of indepe
+000016b0: 6e64 656e 7420 6e6f 6465 732f 564d 7320  ndent nodes/VMs 
+000016c0: 746f 206c 6175 6e63 6822 2c0a 290a 4063  to launch",.).@c
+000016d0: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+000016e0: 2022 2d2d 6175 7468 2d74 7970 6522 2c0a   "--auth-type",.
+000016f0: 2020 2020 6465 6661 756c 743d 4e6f 6e65      default=None
+00001700: 2c0a 2020 2020 7479 7065 3d63 6c69 636b  ,.    type=click
+00001710: 2e43 686f 6963 6528 5b22 6b65 7922 2c20  .Choice(["key", 
+00001720: 2270 6173 7377 6f72 6422 5d2c 2063 6173  "password"], cas
+00001730: 655f 7365 6e73 6974 6976 653d 4661 6c73  e_sensitive=Fals
+00001740: 6529 2c0a 290a 4063 6c69 636b 2e6f 7074  e),.).@click.opt
+00001750: 696f 6e28 0a20 2020 2022 2d2d 616e 7369  ion(.    "--ansi
+00001760: 626c 652d 6578 7472 6173 222c 0a20 2020  ble-extras",.   
+00001770: 2064 6566 6175 6c74 3d22 222c 0a20 2020   default="",.   
+00001780: 2074 7970 653d 7374 722c 0a29 0a40 636c   type=str,.).@cl
+00001790: 6963 6b2e 6f70 7469 6f6e 2822 2d2d 746c  ick.option("--tl
+000017a0: 7322 2c20 6973 5f66 6c61 673d 5472 7565  s", is_flag=True
+000017b0: 2c20 6865 6c70 3d22 4c61 756e 6368 2077  , help="Launch w
+000017c0: 6974 6820 544c 5320 636f 6e66 6967 7572  ith TLS configur
+000017d0: 6174 696f 6e22 290a 4063 6c69 636b 2e6f  ation").@click.o
+000017e0: 7074 696f 6e28 222d 2d74 6573 7422 2c20  ption("--test", 
+000017f0: 6973 5f66 6c61 673d 5472 7565 2c20 6865  is_flag=True, he
+00001800: 6c70 3d22 4c61 756e 6368 2077 6974 6820  lp="Launch with 
+00001810: 7465 7374 2063 6f6e 6669 6775 7261 7469  test configurati
+00001820: 6f6e 2229 0a40 636c 6963 6b2e 6f70 7469  on").@click.opti
+00001830: 6f6e 2822 2d2d 6465 7622 2c20 6973 5f66  on("--dev", is_f
+00001840: 6c61 673d 5472 7565 2c20 6865 6c70 3d22  lag=True, help="
+00001850: 5368 6f72 7463 7574 2066 6f72 2064 6576  Shortcut for dev
+00001860: 656c 6f70 6d65 6e74 2072 656c 6561 7365  elopment release
+00001870: 2229 0a40 636c 6963 6b2e 6f70 7469 6f6e  ").@click.option
+00001880: 280a 2020 2020 222d 2d72 656c 6561 7365  (.    "--release
+00001890: 222c 0a20 2020 2064 6566 6175 6c74 3d22  ",.    default="
+000018a0: 7072 6f64 7563 7469 6f6e 222c 0a20 2020  production",.   
+000018b0: 2072 6571 7569 7265 643d 4661 6c73 652c   required=False,
+000018c0: 0a20 2020 2074 7970 653d 636c 6963 6b2e  .    type=click.
+000018d0: 4368 6f69 6365 285b 2270 726f 6475 6374  Choice(["product
+000018e0: 696f 6e22 2c20 2264 6576 656c 6f70 6d65  ion", "developme
+000018f0: 6e74 225d 2c20 6361 7365 5f73 656e 7369  nt"], case_sensi
+00001900: 7469 7665 3d46 616c 7365 292c 0a20 2020  tive=False),.   
+00001910: 2068 656c 703d 2243 686f 6f73 6520 6265   help="Choose be
+00001920: 7477 6565 6e20 7072 6f64 7563 7469 6f6e  tween production
+00001930: 2061 6e64 2064 6576 656c 6f70 6d65 6e74   and development
+00001940: 2072 656c 6561 7365 222c 0a29 0a40 636c   release",.).@cl
+00001950: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
+00001960: 222d 2d63 6572 742d 7374 6f72 652d 7061  "--cert-store-pa
+00001970: 7468 222c 0a20 2020 2064 6566 6175 6c74  th",.    default
+00001980: 3d22 2f68 6f6d 652f 6f6d 2f63 6572 7473  ="/home/om/certs
+00001990: 222c 0a20 2020 2072 6571 7569 7265 643d  ",.    required=
+000019a0: 4661 6c73 652c 0a20 2020 2074 7970 653d  False,.    type=
+000019b0: 7374 722c 0a20 2020 2068 656c 703d 2252  str,.    help="R
+000019c0: 656d 6f74 6520 7061 7468 2074 6f20 7374  emote path to st
+000019d0: 6f72 6520 616e 6420 6c6f 6164 2054 4c53  ore and load TLS
+000019e0: 2063 6572 7420 616e 6420 6b65 7922 2c0a   cert and key",.
+000019f0: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
+00001a00: 0a20 2020 2022 2d2d 7570 6c6f 6164 2d74  .    "--upload-t
+00001a10: 6c73 2d63 6572 7422 2c0a 2020 2020 6465  ls-cert",.    de
+00001a20: 6661 756c 743d 2222 2c0a 2020 2020 7265  fault="",.    re
+00001a30: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
+00001a40: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
+00001a50: 6865 6c70 3d22 4c6f 6361 6c20 7061 7468  help="Local path
+00001a60: 2074 6f20 544c 5320 6365 7274 2074 6f20   to TLS cert to 
+00001a70: 7570 6c6f 6164 2061 6e64 2073 746f 7265  upload and store
+00001a80: 2061 7420 2d2d 6365 7274 2d73 746f 7265   at --cert-store
+00001a90: 2d70 6174 6822 2c0a 290a 4063 6c69 636b  -path",.).@click
+00001aa0: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
+00001ab0: 7570 6c6f 6164 2d74 6c73 2d6b 6579 222c  upload-tls-key",
+00001ac0: 0a20 2020 2064 6566 6175 6c74 3d22 222c  .    default="",
+00001ad0: 0a20 2020 2072 6571 7569 7265 643d 4661  .    required=Fa
+00001ae0: 6c73 652c 0a20 2020 2074 7970 653d 7374  lse,.    type=st
+00001af0: 722c 0a20 2020 2068 656c 703d 224c 6f63  r,.    help="Loc
+00001b00: 616c 2070 6174 6820 746f 2054 4c53 2070  al path to TLS p
+00001b10: 7269 7661 7465 206b 6579 2074 6f20 7570  rivate key to up
+00001b20: 6c6f 6164 2061 6e64 2073 746f 7265 2061  load and store a
+00001b30: 7420 2d2d 6365 7274 2d73 746f 7265 2d70  t --cert-store-p
+00001b40: 6174 6822 2c0a 290a 4063 6c69 636b 2e6f  ath",.).@click.o
+00001b50: 7074 696f 6e28 0a20 2020 2022 2d2d 6e6f  ption(.    "--no
+00001b60: 2d62 6c6f 622d 7374 6f72 6167 6522 2c0a  -blob-storage",.
+00001b70: 2020 2020 6973 5f66 6c61 673d 5472 7565      is_flag=True
+00001b80: 2c0a 2020 2020 6865 6c70 3d22 4469 7361  ,.    help="Disa
+00001b90: 626c 6520 626c 6f62 2073 746f 7261 6765  ble blob storage
+00001ba0: 222c 0a29 0a40 636c 6963 6b2e 6f70 7469  ",.).@click.opti
+00001bb0: 6f6e 280a 2020 2020 222d 2d69 6d61 6765  on(.    "--image
+00001bc0: 2d6e 616d 6522 2c0a 2020 2020 6465 6661  -name",.    defa
+00001bd0: 756c 743d 4e6f 6e65 2c0a 2020 2020 7265  ult=None,.    re
+00001be0: 7175 6972 6564 3d46 616c 7365 2c0a 2020  quired=False,.  
+00001bf0: 2020 7479 7065 3d73 7472 2c0a 2020 2020    type=str,.    
+00001c00: 6865 6c70 3d22 496d 6167 6520 746f 2075  help="Image to u
+00001c10: 7365 2066 6f72 2074 6865 2056 4d22 2c0a  se for the VM",.
+00001c20: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
+00001c30: 0a20 2020 2022 2d2d 7461 6722 2c0a 2020  .    "--tag",.  
+00001c40: 2020 6465 6661 756c 743d 4e6f 6e65 2c0a    default=None,.
+00001c50: 2020 2020 7265 7175 6972 6564 3d46 616c      required=Fal
+00001c60: 7365 2c0a 2020 2020 7479 7065 3d73 7472  se,.    type=str
+00001c70: 2c0a 2020 2020 6865 6c70 3d22 436f 6e74  ,.    help="Cont
+00001c80: 6169 6e65 7220 696d 6167 6520 7461 6720  ainer image tag 
+00001c90: 746f 2075 7365 222c 0a29 0a40 636c 6963  to use",.).@clic
+00001ca0: 6b2e 6f70 7469 6f6e 280a 2020 2020 222d  k.option(.    "-
+00001cb0: 2d62 7569 6c64 2d73 7263 222c 0a20 2020  -build-src",.   
+00001cc0: 2064 6566 6175 6c74 3d44 4546 4155 4c54   default=DEFAULT
+00001cd0: 5f42 5241 4e43 482c 0a20 2020 2072 6571  _BRANCH,.    req
+00001ce0: 7569 7265 643d 4661 6c73 652c 0a20 2020  uired=False,.   
+00001cf0: 2074 7970 653d 7374 722c 0a20 2020 2068   type=str,.    h
+00001d00: 656c 703d 2247 6974 2062 7261 6e63 6820  elp="Git branch 
+00001d10: 746f 2075 7365 2066 6f72 206c 6175 6e63  to use for launc
+00001d20: 6820 2f20 6275 696c 6420 6f70 6572 6174  h / build operat
+00001d30: 696f 6e73 222c 0a29 0a40 636c 6963 6b2e  ions",.).@click.
+00001d40: 6f70 7469 6f6e 280a 2020 2020 222d 2d70  option(.    "--p
+00001d50: 6c61 7466 6f72 6d22 2c0a 2020 2020 6465  latform",.    de
+00001d60: 6661 756c 743d 4e6f 6e65 2c0a 2020 2020  fault=None,.    
+00001d70: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
+00001d80: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
+00001d90: 2020 6865 6c70 3d22 5275 6e20 646f 636b    help="Run dock
+00001da0: 6572 2077 6974 6820 6120 6469 6666 6572  er with a differ
+00001db0: 656e 7420 706c 6174 666f 726d 206c 696b  ent platform lik
+00001dc0: 6520 6c69 6e75 782f 6172 6d36 3422 2c0a  e linux/arm64",.
+00001dd0: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
+00001de0: 0a20 2020 2022 2d2d 6e6f 2d76 706e 222c  .    "--no-vpn",
+00001df0: 0a20 2020 2069 735f 666c 6167 3d54 7275  .    is_flag=Tru
+00001e00: 652c 0a20 2020 2068 656c 703d 2244 6973  e,.    help="Dis
+00001e10: 6162 6c65 2074 6169 6c73 6361 6c65 2076  able tailscale v
+00001e20: 706e 2063 6f6e 7461 696e 6572 222c 0a29  pn container",.)
+00001e30: 0a40 636c 6963 6b2e 6f70 7469 6f6e 280a  .@click.option(.
+00001e40: 2020 2020 222d 2d73 696c 656e 7422 2c0a      "--silent",.
+00001e50: 2020 2020 6973 5f66 6c61 673d 5472 7565      is_flag=True
+00001e60: 2c0a 2020 2020 6865 6c70 3d22 5375 7070  ,.    help="Supp
+00001e70: 7265 7373 2065 7874 7261 206c 6175 6e63  ress extra launc
+00001e80: 6820 6f75 7470 7574 7322 2c0a 290a 4063  h outputs",.).@c
+00001e90: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+00001ea0: 2022 2d2d 7472 6163 6522 2c0a 2020 2020   "--trace",.    
+00001eb0: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
+00001ec0: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
+00001ed0: 2020 6865 6c70 3d22 4f70 7469 6f6e 616c    help="Optional
+00001ee0: 3a20 616c 6c6f 7720 7472 6163 6520 746f  : allow trace to
+00001ef0: 2062 6520 7475 726e 6564 206f 6e20 6f72   be turned on or
+00001f00: 206f 6666 222c 0a29 0a40 636c 6963 6b2e   off",.).@click.
+00001f10: 6f70 7469 6f6e 280a 2020 2020 222d 2d66  option(.    "--f
+00001f20: 726f 6d2d 7465 6d70 6c61 7465 222c 0a20  rom-template",. 
+00001f30: 2020 2069 735f 666c 6167 3d54 7275 652c     is_flag=True,
+00001f40: 0a20 2020 2068 656c 703d 224c 6175 6e63  .    help="Launc
+00001f50: 6820 6e6f 6465 2075 7369 6e67 2074 6865  h node using the
+00001f60: 206d 616e 6966 6573 7420 7465 6d70 6c61   manifest templa
+00001f70: 7465 222c 0a29 0a40 636c 6963 6b2e 6f70  te",.).@click.op
+00001f80: 7469 6f6e 280a 2020 2020 222d 2d6e 6f2d  tion(.    "--no-
+00001f90: 6865 616c 7468 2d63 6865 636b 7322 2c0a  health-checks",.
+00001fa0: 2020 2020 6973 5f66 6c61 673d 5472 7565      is_flag=True
+00001fb0: 2c0a 2020 2020 6865 6c70 3d22 5475 726e  ,.    help="Turn
+00001fc0: 206f 6666 2061 7574 6f20 6865 616c 7468   off auto health
+00001fd0: 2063 6865 636b 7320 706f 7374 206e 6f64   checks post nod
+00001fe0: 6520 6c61 756e 6368 222c 0a29 0a40 636c  e launch",.).@cl
+00001ff0: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
+00002000: 222d 2d6f 626c 7622 2c0a 2020 2020 6973  "--oblv",.    is
+00002010: 5f66 6c61 673d 5472 7565 2c0a 2020 2020  _flag=True,.    
+00002020: 6865 6c70 3d22 496e 7374 616c 6c73 204f  help="Installs O
+00002030: 626c 6976 696f 7573 2043 4c49 2074 6f6f  blivious CLI too
+00002040: 6c22 2c0a 290a 4063 6c69 636b 2e6f 7074  l",.).@click.opt
+00002050: 696f 6e28 0a20 2020 2022 2d2d 7365 742d  ion(.    "--set-
+00002060: 726f 6f74 2d65 6d61 696c 222c 0a20 2020  root-email",.   
+00002070: 2064 6566 6175 6c74 3d4e 6f6e 652c 0a20   default=None,. 
+00002080: 2020 2072 6571 7569 7265 643d 4661 6c73     required=Fals
+00002090: 652c 0a20 2020 2074 7970 653d 7374 722c  e,.    type=str,
+000020a0: 0a20 2020 2068 656c 703d 2253 6574 2072  .    help="Set r
+000020b0: 6f6f 7420 656d 6169 6c20 6f66 206e 6f64  oot email of nod
+000020c0: 6522 2c0a 290a 4063 6c69 636b 2e6f 7074  e",.).@click.opt
+000020d0: 696f 6e28 0a20 2020 2022 2d2d 7365 742d  ion(.    "--set-
+000020e0: 726f 6f74 2d70 6173 7377 6f72 6422 2c0a  root-password",.
+000020f0: 2020 2020 6465 6661 756c 743d 4e6f 6e65      default=None
+00002100: 2c0a 2020 2020 7265 7175 6972 6564 3d46  ,.    required=F
+00002110: 616c 7365 2c0a 2020 2020 7479 7065 3d73  alse,.    type=s
+00002120: 7472 2c0a 2020 2020 6865 6c70 3d22 5365  tr,.    help="Se
+00002130: 7420 726f 6f74 2070 6173 7377 6f72 6420  t root password 
+00002140: 6f66 206e 6f64 6522 2c0a 290a 6465 6620  of node",.).def 
+00002150: 6c61 756e 6368 2861 7267 733a 2054 7970  launch(args: Typ
+00002160: 6554 7570 6c65 5b73 7472 5d2c 202a 2a6b  eTuple[str], **k
+00002170: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
+00002180: 6f6e 653a 0a20 2020 2076 6572 6220 3d20  one:.    verb = 
+00002190: 6765 745f 6c61 756e 6368 5f76 6572 6228  get_launch_verb(
+000021a0: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+000021b0: 2020 2067 7261 6d6d 6172 203d 2070 6172     grammar = par
+000021c0: 7365 5f67 7261 6d6d 6172 2861 7267 733d  se_grammar(args=
+000021d0: 6172 6773 2c20 7665 7262 3d76 6572 6229  args, verb=verb)
+000021e0: 0a20 2020 2020 2020 2076 6572 622e 6c6f  .        verb.lo
+000021f0: 6164 5f67 7261 6d6d 6172 2867 7261 6d6d  ad_grammar(gramm
+00002200: 6172 3d67 7261 6d6d 6172 290a 2020 2020  ar=grammar).    
+00002210: 6578 6365 7074 2042 6164 4772 616d 6d61  except BadGramma
+00002220: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+00002230: 7072 696e 7428 6529 0a20 2020 2020 2020  print(e).       
+00002240: 2072 6574 7572 6e0a 0a20 2020 2074 7279   return..    try
+00002250: 3a0a 2020 2020 2020 2020 7570 6461 7465  :.        update
+00002260: 5f72 6570 6f28 7265 706f 3d47 4954 5f52  _repo(repo=GIT_R
+00002270: 4550 4f2c 2062 7261 6e63 683d 7374 7228  EPO, branch=str(
+00002280: 6b77 6172 6773 5b22 6275 696c 645f 7372  kwargs["build_sr
+00002290: 6322 5d29 290a 2020 2020 6578 6365 7074  c"])).    except
+000022a0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+000022b0: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+000022c0: 2246 6169 6c65 6420 746f 2075 7064 6174  "Failed to updat
+000022d0: 6520 7265 706f 2e20 7b65 7d22 290a 2020  e repo. {e}").  
+000022e0: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
+000022f0: 6d64 7320 3d20 6372 6561 7465 5f6c 6175  mds = create_lau
+00002300: 6e63 685f 636d 6428 7665 7262 3d76 6572  nch_cmd(verb=ver
+00002310: 622c 206b 7761 7267 733d 6b77 6172 6773  b, kwargs=kwargs
+00002320: 290a 2020 2020 2020 2020 636d 6473 203d  ).        cmds =
+00002330: 205b 636d 6473 5d20 6966 2069 7369 6e73   [cmds] if isins
+00002340: 7461 6e63 6528 636d 6473 2c20 7374 7229  tance(cmds, str)
+00002350: 2065 6c73 6520 636d 6473 0a20 2020 2065   else cmds.    e
+00002360: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00002370: 6173 2065 3a0a 2020 2020 2020 2020 7072  as e:.        pr
+00002380: 696e 7428 6622 4572 726f 723a 207b 657d  int(f"Error: {e}
+00002390: 5c6e 5c6e 2229 0a20 2020 2020 2020 2072  \n\n").        r
+000023a0: 6574 7572 6e0a 0a20 2020 2064 7279 5f72  eturn..    dry_r
+000023b0: 756e 203d 2062 6f6f 6c28 6b77 6172 6773  un = bool(kwargs
+000023c0: 5b22 636d 6422 5d29 0a0a 2020 2020 6865  ["cmd"])..    he
+000023d0: 616c 7468 5f63 6865 636b 7320 3d20 6e6f  alth_checks = no
+000023e0: 7420 626f 6f6c 286b 7761 7267 735b 226e  t bool(kwargs["n
+000023f0: 6f5f 6865 616c 7468 5f63 6865 636b 7322  o_health_checks"
+00002400: 5d29 0a0a 2020 2020 7472 793a 0a20 2020  ])..    try:.   
+00002410: 2020 2020 2074 6169 6c20 3d20 626f 6f6c       tail = bool
+00002420: 286b 7761 7267 735b 2274 6169 6c22 5d29  (kwargs["tail"])
+00002430: 0a20 2020 2020 2020 2073 696c 656e 7420  .        silent 
+00002440: 3d20 6e6f 7420 7461 696c 0a0a 2020 2020  = not tail..    
+00002450: 2020 2020 6672 6f6d 5f72 656e 6465 7265      from_rendere
+00002460: 645f 6469 7220 3d20 626f 6f6c 286b 7761  d_dir = bool(kwa
+00002470: 7267 735b 2266 726f 6d5f 7465 6d70 6c61  rgs["from_templa
+00002480: 7465 225d 2920 616e 6420 4544 4954 4142  te"]) and EDITAB
+00002490: 4c45 5f4d 4f44 450a 0a20 2020 2020 2020  LE_MODE..       
+000024a0: 206e 6f64 655f 7479 7065 203d 2076 6572   node_type = ver
+000024b0: 622e 6765 745f 6e61 6d65 645f 7465 726d  b.get_named_term
+000024c0: 5f74 7970 6528 6e61 6d65 3d22 6e6f 6465  _type(name="node
+000024d0: 5f74 7970 6522 292e 696e 7075 740a 2020  _type").input.  
+000024e0: 2020 2020 2020 6578 6563 7574 655f 636f        execute_co
+000024f0: 6d6d 616e 6473 280a 2020 2020 2020 2020  mmands(.        
+00002500: 2020 2020 636d 6473 2c0a 2020 2020 2020      cmds,.      
+00002510: 2020 2020 2020 6472 795f 7275 6e3d 6472        dry_run=dr
+00002520: 795f 7275 6e2c 0a20 2020 2020 2020 2020  y_run,.         
+00002530: 2020 2073 696c 656e 743d 7369 6c65 6e74     silent=silent
+00002540: 2c0a 2020 2020 2020 2020 2020 2020 6672  ,.            fr
+00002550: 6f6d 5f72 656e 6465 7265 645f 6469 723d  om_rendered_dir=
+00002560: 6672 6f6d 5f72 656e 6465 7265 645f 6469  from_rendered_di
+00002570: 722c 0a20 2020 2020 2020 2020 2020 206e  r,.            n
+00002580: 6f64 655f 7479 7065 3d6e 6f64 655f 7479  ode_type=node_ty
+00002590: 7065 2c0a 2020 2020 2020 2020 290a 0a20  pe,.        ).. 
+000025a0: 2020 2020 2020 2068 6f73 745f 7465 726d         host_term
+000025b0: 203d 2076 6572 622e 6765 745f 6e61 6d65   = verb.get_name
+000025c0: 645f 7465 726d 5f68 6f73 7467 7261 6d6d  d_term_hostgramm
+000025d0: 6172 286e 616d 653d 2268 6f73 7422 290a  ar(name="host").
+000025e0: 2020 2020 2020 2020 7275 6e5f 6865 616c          run_heal
+000025f0: 7468 5f63 6865 636b 7320 3d20 280a 2020  th_checks = (.  
+00002600: 2020 2020 2020 2020 2020 6865 616c 7468            health
+00002610: 5f63 6865 636b 7320 616e 6420 6e6f 7420  _checks and not 
+00002620: 6472 795f 7275 6e20 616e 6420 686f 7374  dry_run and host
+00002630: 5f74 6572 6d2e 686f 7374 203d 3d20 2264  _term.host == "d
+00002640: 6f63 6b65 7222 2061 6e64 2073 696c 656e  ocker" and silen
+00002650: 740a 2020 2020 2020 2020 290a 0a20 2020  t.        )..   
+00002660: 2020 2020 2069 6620 7275 6e5f 6865 616c       if run_heal
+00002670: 7468 5f63 6865 636b 733a 0a20 2020 2020  th_checks:.     
+00002680: 2020 2020 2020 2064 6f63 6b65 725f 636d         docker_cm
+00002690: 6473 203d 2063 6173 7428 5479 7065 4469  ds = cast(TypeDi
+000026a0: 6374 5b73 7472 2c20 5479 7065 4c69 7374  ct[str, TypeList
+000026b0: 5b73 7472 5d5d 2c20 636d 6473 290a 0a20  [str]], cmds).. 
+000026c0: 2020 2020 2020 2020 2020 2023 2067 6574             # get
+000026d0: 2074 6865 2066 6972 7374 2063 6f6d 6d61   the first comma
+000026e0: 6e64 2028 636d 6431 2920 6672 6f6d 2064  nd (cmd1) from d
+000026f0: 6f63 6b65 725f 636d 6473 2077 6869 6368  ocker_cmds which
+00002700: 2069 7320 6f66 2074 6865 2066 6f72 6d0a   is of the form.
+00002710: 2020 2020 2020 2020 2020 2020 2320 7b22              # {"
+00002720: 3c66 6972 7374 3e22 3a20 5b63 6d64 312c  <first>": [cmd1,
+00002730: 2063 6d64 325d 2c20 223c 7365 636f 6e64   cmd2], "<second
+00002740: 3e22 3a20 5b63 6d64 332c 2063 6d64 345d  >": [cmd3, cmd4]
+00002750: 7d0a 2020 2020 2020 2020 2020 2020 2863  }.            (c
+00002760: 6f6d 6d61 6e64 2c20 2a5f 292c 202a 5f20  ommand, *_), *_ 
+00002770: 3d20 646f 636b 6572 5f63 6d64 732e 7661  = docker_cmds.va
+00002780: 6c75 6573 2829 0a0a 2020 2020 2020 2020  lues()..        
+00002790: 2020 2020 6d61 7463 685f 706f 7274 203d      match_port =
+000027a0: 2072 652e 7365 6172 6368 2822 4854 5450   re.search("HTTP
+000027b0: 5f50 4f52 543d 5b30 2d39 5d7b 312c 357d  _PORT=[0-9]{1,5}
+000027c0: 222c 2063 6f6d 6d61 6e64 290a 2020 2020  ", command).    
+000027d0: 2020 2020 2020 2020 6e6f 6465 5f6e 616d          node_nam
+000027e0: 6520 3d20 7665 7262 2e67 6574 5f6e 616d  e = verb.get_nam
+000027f0: 6564 5f74 6572 6d5f 7479 7065 286e 616d  ed_term_type(nam
+00002800: 653d 226e 6f64 655f 6e61 6d65 2229 2e73  e="node_name").s
+00002810: 6e61 6b65 5f69 6e70 7574 0a20 2020 2020  nake_input.     
+00002820: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
+00002830: 706f 7274 3a0a 2020 2020 2020 2020 2020  port:.          
+00002840: 2020 2020 2020 7269 6368 2e67 6574 5f63        rich.get_c
+00002850: 6f6e 736f 6c65 2829 2e70 7269 6e74 280a  onsole().print(.
+00002860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002870: 2020 2020 225c 6e5b 626f 6c64 2067 7265      "\n[bold gre
+00002880: 656e 5de2 a08b 5b62 6f6c 6420 626c 7565  en]...[bold blue
+00002890: 5d20 4368 6563 6b69 6e67 206e 6f64 6520  ] Checking node 
+000028a0: 4150 4920 5b2f 626f 6c64 2062 6c75 655d  API [/bold blue]
+000028b0: 5c74 220a 2020 2020 2020 2020 2020 2020  \t".            
+000028c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000028d0: 2020 2020 2020 706f 7274 203d 206d 6174        port = mat
+000028e0: 6368 5f70 6f72 742e 6772 6f75 7028 292e  ch_port.group().
+000028f0: 7265 706c 6163 6528 2248 5454 505f 504f  replace("HTTP_PO
+00002900: 5254 3d22 2c20 2222 290a 0a20 2020 2020  RT=", "")..     
+00002910: 2020 2020 2020 2020 2020 2063 6865 636b             check
+00002920: 5f73 7461 7475 7328 226c 6f63 616c 686f  _status("localho
+00002930: 7374 2220 2b20 223a 2220 2b20 706f 7274  st" + ":" + port
+00002940: 2c20 6e6f 6465 5f6e 616d 653d 6e6f 6465  , node_name=node
+00002950: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
+00002960: 2020 2020 7269 6368 2e67 6574 5f63 6f6e      rich.get_con
+00002970: 736f 6c65 2829 2e70 7269 6e74 280a 2020  sole().print(.  
+00002980: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00002990: 6368 2e70 616e 656c 2e50 616e 656c 2e66  ch.panel.Panel.f
+000029a0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+000029b0: 2020 2020 2020 2020 6622 e29c a820 546f          f"... To
+000029c0: 2076 6965 7720 636f 6e74 6169 6e65 7220   view container 
+000029d0: 6c6f 6773 2072 756e 205b 626f 6c64 2067  logs run [bold g
+000029e0: 7265 656e 5d68 6167 7269 6420 6c6f 6773  reen]hagrid logs
+000029f0: 207b 6e6f 6465 5f6e 616d 657d 5b2f 626f   {node_name}[/bo
+00002a00: 6c64 2067 7265 656e 5d5c 7422 0a20 2020  ld green]\t".   
+00002a10: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00002a20: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00002a30: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00002a40: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00002a50: 2070 7269 6e74 2866 2245 7272 6f72 3a20   print(f"Error: 
+00002a60: 7b65 7d5c 6e5c 6e22 290a 2020 2020 2020  {e}\n\n").      
+00002a70: 2020 7265 7475 726e 0a0a 0a64 6566 2063    return...def c
+00002a80: 6865 636b 5f65 7272 6f72 7328 0a20 2020  heck_errors(.   
+00002a90: 206c 696e 653a 2073 7472 2c20 7072 6f63   line: str, proc
+00002aa0: 6573 733a 2073 7562 7072 6f63 6573 732e  ess: subprocess.
+00002ab0: 506f 7065 6e2c 2063 6d64 5f6e 616d 653a  Popen, cmd_name:
+00002ac0: 2073 7472 2c20 7072 6f67 7265 7373 5f62   str, progress_b
+00002ad0: 6172 3a20 5072 6f67 7265 7373 0a29 202d  ar: Progress.) -
+00002ae0: 3e20 4e6f 6e65 3a0a 2020 2020 7461 736b  > None:.    task
+00002af0: 203d 2070 726f 6772 6573 735f 6261 722e   = progress_bar.
+00002b00: 7461 736b 735b 305d 0a20 2020 2069 6620  tasks[0].    if 
+00002b10: 2245 7272 6f72 2072 6573 706f 6e73 6520  "Error response 
+00002b20: 6672 6f6d 2064 6165 6d6f 6e3a 2022 2069  from daemon: " i
+00002b30: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
+00002b40: 6966 2070 726f 6772 6573 735f 6261 723a  if progress_bar:
+00002b50: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00002b60: 6772 6573 735f 6261 722e 7570 6461 7465  gress_bar.update
+00002b70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002b80: 2020 302c 0a20 2020 2020 2020 2020 2020    0,.           
+00002b90: 2020 2020 2064 6573 6372 6970 7469 6f6e       description
+00002ba0: 3d66 22e2 9d8c 205b 626f 6c64 2072 6564  =f"... [bold red
+00002bb0: 5d7b 636d 645f 6e61 6d65 7d5b 2f62 6f6c  ]{cmd_name}[/bol
+00002bc0: 6420 7265 645d 205b 7b74 6173 6b2e 636f  d red] [{task.co
+00002bd0: 6d70 6c65 7465 647d 202f 207b 7461 736b  mpleted} / {task
+00002be0: 2e74 6f74 616c 7d5d 222c 0a20 2020 2020  .total}]",.     
+00002bf0: 2020 2020 2020 2020 2020 2072 6566 7265             refre
+00002c00: 7368 3d54 7275 652c 0a20 2020 2020 2020  sh=True,.       
+00002c10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00002c20: 2020 2070 726f 6772 6573 735f 6261 722e     progress_bar.
+00002c30: 7570 6461 7465 2830 2c20 7669 7369 626c  update(0, visibl
+00002c40: 653d 4661 6c73 6529 0a20 2020 2020 2020  e=False).       
+00002c50: 2020 2020 2070 726f 6772 6573 735f 6261       progress_ba
+00002c60: 722e 636f 6e73 6f6c 652e 636c 6561 725f  r.console.clear_
+00002c70: 6c69 7665 2829 0a20 2020 2020 2020 2020  live().         
+00002c80: 2020 2070 726f 6772 6573 735f 6261 722e     progress_bar.
+00002c90: 636f 6e73 6f6c 652e 7175 6965 7420 3d20  console.quiet = 
+00002ca0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00002cb0: 2070 726f 6772 6573 735f 6261 722e 7374   progress_bar.st
+00002cc0: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
+00002cd0: 2063 6f6e 736f 6c65 203d 2072 6963 682e   console = rich.
+00002ce0: 6765 745f 636f 6e73 6f6c 6528 290a 2020  get_console().  
+00002cf0: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
+00002d00: 7373 5f62 6172 2e63 6f6e 736f 6c65 2e71  ss_bar.console.q
+00002d10: 7569 6574 203d 2046 616c 7365 0a20 2020  uiet = False.   
+00002d20: 2020 2020 2020 2020 2063 6f6e 736f 6c65           console
+00002d30: 2e70 7269 6e74 2866 225c 6e5c 6e20 5b72  .print(f"\n\n [r
+00002d40: 6564 5d20 4552 524f 5220 5b2f 7265 645d  ed] ERROR [/red]
+00002d50: 3a20 5b62 6f6c 645d 7b6c 696e 657d 5b2f  : [bold]{line}[/
+00002d60: 626f 6c64 5d5c 6e22 290a 2020 2020 2020  bold]\n").      
+00002d70: 2020 7072 6f63 6573 732e 7465 726d 696e    process.termin
+00002d80: 6174 6528 290a 2020 2020 2020 2020 7261  ate().        ra
+00002d90: 6973 6520 4578 6365 7074 696f 6e0a 0a0a  ise Exception...
+00002da0: 6465 6620 6368 6563 6b5f 7075 6c6c 696e  def check_pullin
+00002db0: 6728 6c69 6e65 3a20 7374 722c 2063 6d64  g(line: str, cmd
+00002dc0: 5f6e 616d 653a 2073 7472 2c20 7072 6f67  _name: str, prog
+00002dd0: 7265 7373 5f62 6172 3a20 5072 6f67 7265  ress_bar: Progre
+00002de0: 7373 2920 2d3e 204e 6f6e 653a 0a20 2020  ss) -> None:.   
+00002df0: 2074 6173 6b20 3d20 7072 6f67 7265 7373   task = progress
+00002e00: 5f62 6172 2e74 6173 6b73 5b30 5d0a 2020  _bar.tasks[0].  
+00002e10: 2020 6966 2022 5075 6c6c 696e 6722 2069    if "Pulling" i
+00002e20: 6e20 6c69 6e65 2061 6e64 2022 6673 206c  n line and "fs l
+00002e30: 6179 6572 2220 6e6f 7420 696e 206c 696e  ayer" not in lin
+00002e40: 653a 0a20 2020 2020 2020 2070 726f 6772  e:.        progr
+00002e50: 6573 735f 6261 722e 7570 6461 7465 280a  ess_bar.update(.
+00002e60: 2020 2020 2020 2020 2020 2020 302c 0a20              0,. 
+00002e70: 2020 2020 2020 2020 2020 2064 6573 6372             descr
+00002e80: 6970 7469 6f6e 3d66 225b 626f 6c64 5d7b  iption=f"[bold]{
+00002e90: 636d 645f 6e61 6d65 7d20 5b7b 7461 736b  cmd_name} [{task
+00002ea0: 2e63 6f6d 706c 6574 6564 7d20 2f20 7b74  .completed} / {t
+00002eb0: 6173 6b2e 746f 7461 6c2b 317d 5d22 2c0a  ask.total+1}]",.
+00002ec0: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+00002ed0: 6c3d 7461 736b 2e74 6f74 616c 202b 2031  l=task.total + 1
+00002ee0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+00002ef0: 6672 6573 683d 5472 7565 2c0a 2020 2020  fresh=True,.    
+00002f00: 2020 2020 290a 2020 2020 6966 2022 5075      ).    if "Pu
+00002f10: 6c6c 6564 2220 696e 206c 696e 653a 0a20  lled" in line:. 
+00002f20: 2020 2020 2020 2070 726f 6772 6573 735f         progress_
+00002f30: 6261 722e 7570 6461 7465 280a 2020 2020  bar.update(.    
+00002f40: 2020 2020 2020 2020 302c 0a20 2020 2020          0,.     
+00002f50: 2020 2020 2020 2064 6573 6372 6970 7469         descripti
+00002f60: 6f6e 3d66 225b 626f 6c64 5d7b 636d 645f  on=f"[bold]{cmd_
+00002f70: 6e61 6d65 7d20 5b7b 7461 736b 2e63 6f6d  name} [{task.com
+00002f80: 706c 6574 6564 202b 2031 7d20 2f20 7b74  pleted + 1} / {t
+00002f90: 6173 6b2e 746f 7461 6c7d 5d22 2c0a 2020  ask.total}]",.  
+00002fa0: 2020 2020 2020 2020 2020 636f 6d70 6c65            comple
+00002fb0: 7465 643d 7461 736b 2e63 6f6d 706c 6574  ted=task.complet
+00002fc0: 6564 202b 2031 2c0a 2020 2020 2020 2020  ed + 1,.        
+00002fd0: 2020 2020 7265 6672 6573 683d 5472 7565      refresh=True
+00002fe0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00002ff0: 2020 2020 6966 2070 726f 6772 6573 735f      if progress_
+00003000: 6261 722e 6669 6e69 7368 6564 3a0a 2020  bar.finished:.  
+00003010: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
+00003020: 7373 5f62 6172 2e75 7064 6174 6528 0a20  ss_bar.update(. 
+00003030: 2020 2020 2020 2020 2020 2020 2020 2030                 0
+00003040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003050: 2020 6465 7363 7269 7074 696f 6e3d 6622    description=f"
+00003060: e29c 8520 5b62 6f6c 6420 6772 6565 6e5d  ... [bold green]
+00003070: 7b63 6d64 5f6e 616d 657d 205b 7b74 6173  {cmd_name} [{tas
+00003080: 6b2e 636f 6d70 6c65 7465 647d 202f 207b  k.completed} / {
+00003090: 7461 736b 2e74 6f74 616c 7d5d 222c 0a20  task.total}]",. 
+000030a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000030b0: 6566 7265 7368 3d54 7275 652c 0a20 2020  efresh=True,.   
+000030c0: 2020 2020 2020 2020 2029 0a0a 0a64 6566           )...def
+000030d0: 2063 6865 636b 5f62 7569 6c64 696e 6728   check_building(
+000030e0: 6c69 6e65 3a20 7374 722c 2063 6d64 5f6e  line: str, cmd_n
+000030f0: 616d 653a 2073 7472 2c20 7072 6f67 7265  ame: str, progre
+00003100: 7373 5f62 6172 3a20 5072 6f67 7265 7373  ss_bar: Progress
+00003110: 2920 2d3e 204e 6f6e 653a 0a20 2020 206c  ) -> None:.    l
+00003120: 6f61 645f 7061 7474 6572 6e20 3d20 7265  oad_pattern = re
+00003130: 2e63 6f6d 7069 6c65 280a 2020 2020 2020  .compile(.      
+00003140: 2020 7222 5e23 2e2a 206c 6f61 6420 6275    r"^#.* load bu
+00003150: 696c 6420 6465 6669 6e69 7469 6f6e 2066  ild definition f
+00003160: 726f 6d20 5b41 2d5a 612d 7a30 2d39 5d2b  rom [A-Za-z0-9]+
+00003170: 5c2e 646f 636b 6572 6669 6c65 2422 2c20  \.dockerfile$", 
+00003180: 7265 2e49 474e 4f52 4543 4153 450a 2020  re.IGNORECASE.  
+00003190: 2020 290a 2020 2020 6275 696c 645f 7061    ).    build_pa
+000031a0: 7474 6572 6e20 3d20 7265 2e63 6f6d 7069  ttern = re.compi
+000031b0: 6c65 280a 2020 2020 2020 2020 7222 5e23  le(.        r"^#
+000031c0: 2e2a 206e 616d 696e 6720 746f 2064 6f63  .* naming to doc
+000031d0: 6b65 725c 2e69 6f2f 6f70 656e 6d69 6e65  ker\.io/openmine
+000031e0: 642f 2e2a 2064 6f6e 6524 222c 2072 652e  d/.* done$", re.
+000031f0: 4947 4e4f 5245 4341 5345 0a20 2020 2029  IGNORECASE.    )
+00003200: 0a20 2020 2074 6173 6b20 3d20 7072 6f67  .    task = prog
+00003210: 7265 7373 5f62 6172 2e74 6173 6b73 5b30  ress_bar.tasks[0
+00003220: 5d0a 0a20 2020 2069 6620 6c6f 6164 5f70  ]..    if load_p
+00003230: 6174 7465 726e 2e6d 6174 6368 286c 696e  attern.match(lin
+00003240: 6529 3a0a 2020 2020 2020 2020 7072 6f67  e):.        prog
+00003250: 7265 7373 5f62 6172 2e75 7064 6174 6528  ress_bar.update(
+00003260: 0a20 2020 2020 2020 2020 2020 2030 2c0a  .            0,.
+00003270: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00003280: 7269 7074 696f 6e3d 6622 5b62 6f6c 645d  ription=f"[bold]
+00003290: 7b63 6d64 5f6e 616d 657d 205b 7b74 6173  {cmd_name} [{tas
+000032a0: 6b2e 636f 6d70 6c65 7465 647d 202f 207b  k.completed} / {
+000032b0: 7461 736b 2e74 6f74 616c 202b 317d 5d22  task.total +1}]"
+000032c0: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
+000032d0: 7461 6c3d 7461 736b 2e74 6f74 616c 202b  tal=task.total +
+000032e0: 2031 2c0a 2020 2020 2020 2020 2020 2020   1,.            
+000032f0: 7265 6672 6573 683d 5472 7565 2c0a 2020  refresh=True,.  
+00003300: 2020 2020 2020 290a 2020 2020 6966 2062        ).    if b
+00003310: 7569 6c64 5f70 6174 7465 726e 2e6d 6174  uild_pattern.mat
+00003320: 6368 286c 696e 6529 3a0a 2020 2020 2020  ch(line):.      
+00003330: 2020 7072 6f67 7265 7373 5f62 6172 2e75    progress_bar.u
+00003340: 7064 6174 6528 0a20 2020 2020 2020 2020  pdate(.         
+00003350: 2020 2030 2c0a 2020 2020 2020 2020 2020     0,.          
+00003360: 2020 6465 7363 7269 7074 696f 6e3d 6622    description=f"
+00003370: 5b62 6f6c 645d 7b63 6d64 5f6e 616d 657d  [bold]{cmd_name}
+00003380: 205b 7b74 6173 6b2e 636f 6d70 6c65 7465   [{task.complete
+00003390: 642b 317d 202f 207b 7461 736b 2e74 6f74  d+1} / {task.tot
+000033a0: 616c 7d5d 222c 0a20 2020 2020 2020 2020  al}]",.         
+000033b0: 2020 2063 6f6d 706c 6574 6564 3d74 6173     completed=tas
+000033c0: 6b2e 636f 6d70 6c65 7465 6420 2b20 312c  k.completed + 1,
+000033d0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+000033e0: 7265 7368 3d54 7275 652c 0a20 2020 2020  resh=True,.     
+000033f0: 2020 2029 0a0a 2020 2020 6966 2070 726f     )..    if pro
+00003400: 6772 6573 735f 6261 722e 6669 6e69 7368  gress_bar.finish
+00003410: 6564 3a0a 2020 2020 2020 2020 7072 6f67  ed:.        prog
+00003420: 7265 7373 5f62 6172 2e75 7064 6174 6528  ress_bar.update(
+00003430: 0a20 2020 2020 2020 2020 2020 2030 2c0a  .            0,.
+00003440: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00003450: 7269 7074 696f 6e3d 6622 e29c 8520 5b62  ription=f"... [b
+00003460: 6f6c 6420 6772 6565 6e5d 7b63 6d64 5f6e  old green]{cmd_n
+00003470: 616d 657d 205b 7b74 6173 6b2e 636f 6d70  ame} [{task.comp
+00003480: 6c65 7465 647d 202f 207b 7461 736b 2e74  leted} / {task.t
+00003490: 6f74 616c 7d5d 222c 0a20 2020 2020 2020  otal}]",.       
+000034a0: 2020 2020 2072 6566 7265 7368 3d54 7275       refresh=Tru
+000034b0: 652c 0a20 2020 2020 2020 2029 0a0a 0a64  e,.        )...d
+000034c0: 6566 2063 6865 636b 5f6c 6175 6e63 6869  ef check_launchi
+000034d0: 6e67 286c 696e 653a 2073 7472 2c20 636d  ng(line: str, cm
+000034e0: 645f 6e61 6d65 3a20 7374 722c 2070 726f  d_name: str, pro
+000034f0: 6772 6573 735f 6261 723a 2050 726f 6772  gress_bar: Progr
+00003500: 6573 7329 202d 3e20 4e6f 6e65 3a0a 2020  ess) -> None:.  
+00003510: 2020 7461 736b 203d 2070 726f 6772 6573    task = progres
+00003520: 735f 6261 722e 7461 736b 735b 305d 0a20  s_bar.tasks[0]. 
+00003530: 2020 2069 6620 2253 7461 7274 696e 6722     if "Starting"
+00003540: 2069 6e20 6c69 6e65 3a0a 2020 2020 2020   in line:.      
+00003550: 2020 7072 6f67 7265 7373 5f62 6172 2e75    progress_bar.u
+00003560: 7064 6174 6528 0a20 2020 2020 2020 2020  pdate(.         
+00003570: 2020 2030 2c0a 2020 2020 2020 2020 2020     0,.          
+00003580: 2020 6465 7363 7269 7074 696f 6e3d 6622    description=f"
+00003590: 205b 626f 6c64 5d7b 636d 645f 6e61 6d65   [bold]{cmd_name
+000035a0: 7d20 5b7b 7461 736b 2e63 6f6d 706c 6574  } [{task.complet
+000035b0: 6564 7d20 2f20 7b74 6173 6b2e 746f 7461  ed} / {task.tota
+000035c0: 6c2b 317d 5d22 2c0a 2020 2020 2020 2020  l+1}]",.        
+000035d0: 2020 2020 746f 7461 6c3d 7461 736b 2e74      total=task.t
+000035e0: 6f74 616c 202b 2031 2c0a 2020 2020 2020  otal + 1,.      
+000035f0: 2020 2020 2020 7265 6672 6573 683d 5472        refresh=Tr
+00003600: 7565 2c0a 2020 2020 2020 2020 290a 2020  ue,.        ).  
+00003610: 2020 6966 2022 5374 6172 7465 6422 2069    if "Started" i
+00003620: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
+00003630: 7072 6f67 7265 7373 5f62 6172 2e75 7064  progress_bar.upd
+00003640: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
+00003650: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
+00003660: 6465 7363 7269 7074 696f 6e3d 6622 205b  description=f" [
+00003670: 626f 6c64 5d7b 636d 645f 6e61 6d65 7d20  bold]{cmd_name} 
+00003680: 5b7b 7461 736b 2e63 6f6d 706c 6574 6564  [{task.completed
+00003690: 202b 2031 7d20 2f20 7b74 6173 6b2e 746f   + 1} / {task.to
+000036a0: 7461 6c7d 5d22 2c0a 2020 2020 2020 2020  tal}]",.        
+000036b0: 2020 2020 636f 6d70 6c65 7465 643d 7461      completed=ta
+000036c0: 736b 2e63 6f6d 706c 6574 6564 202b 2031  sk.completed + 1
+000036d0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+000036e0: 6672 6573 683d 5472 7565 2c0a 2020 2020  fresh=True,.    
+000036f0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+00003700: 2070 726f 6772 6573 735f 6261 722e 6669   progress_bar.fi
+00003710: 6e69 7368 6564 3a0a 2020 2020 2020 2020  nished:.        
+00003720: 2020 2020 7072 6f67 7265 7373 5f62 6172      progress_bar
+00003730: 2e75 7064 6174 6528 0a20 2020 2020 2020  .update(.       
+00003740: 2020 2020 2020 2020 2030 2c0a 2020 2020           0,.    
+00003750: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00003760: 7269 7074 696f 6e3d 6622 e29c 8520 5b62  ription=f"... [b
+00003770: 6f6c 6420 6772 6565 6e5d 7b63 6d64 5f6e  old green]{cmd_n
+00003780: 616d 657d 205b 7b74 6173 6b2e 636f 6d70  ame} [{task.comp
+00003790: 6c65 7465 647d 202f 207b 7461 736b 2e74  leted} / {task.t
+000037a0: 6f74 616c 7d5d 222c 0a20 2020 2020 2020  otal}]",.       
+000037b0: 2020 2020 2020 2020 2072 6566 7265 7368           refresh
+000037c0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+000037d0: 2020 2029 0a0a 0a44 4f43 4b45 525f 4655     )...DOCKER_FU
+000037e0: 4e43 5f4d 4150 203d 207b 0a20 2020 2022  NC_MAP = {.    "
+000037f0: 5075 6c6c 696e 6722 3a20 6368 6563 6b5f  Pulling": check_
+00003800: 7075 6c6c 696e 672c 0a20 2020 2022 4275  pulling,.    "Bu
+00003810: 696c 6469 6e67 223a 2063 6865 636b 5f62  ilding": check_b
+00003820: 7569 6c64 696e 672c 0a20 2020 2022 4c61  uilding,.    "La
+00003830: 756e 6368 696e 6722 3a20 6368 6563 6b5f  unching": check_
+00003840: 6c61 756e 6368 696e 672c 0a7d 0a0a 0a64  launching,.}...d
+00003850: 6566 2072 6561 645f 7468 7265 6164 5f6c  ef read_thread_l
+00003860: 6f67 7328 0a20 2020 2070 726f 6772 6573  ogs(.    progres
+00003870: 735f 6261 723a 2050 726f 6772 6573 732c  s_bar: Progress,
+00003880: 2070 726f 6365 7373 3a20 7375 6270 726f   process: subpro
+00003890: 6365 7373 2e50 6f70 656e 2c20 7175 6575  cess.Popen, queu
+000038a0: 653a 2051 7565 7565 2c20 636d 645f 6e61  e: Queue, cmd_na
+000038b0: 6d65 3a20 7374 720a 2920 2d3e 204e 6f6e  me: str.) -> Non
+000038c0: 653a 0a20 2020 206c 696e 6520 3d20 7175  e:.    line = qu
+000038d0: 6575 652e 6765 7428 290a 2020 2020 6c69  eue.get().    li
+000038e0: 6e65 203d 2073 7472 286c 696e 652c 2065  ne = str(line, e
+000038f0: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+00003900: 2e73 7472 6970 2829 0a0a 2020 2020 6966  .strip()..    if
+00003910: 2070 726f 6772 6573 735f 6261 723a 0a20   progress_bar:. 
+00003920: 2020 2020 2020 2063 6865 636b 5f65 7272         check_err
+00003930: 6f72 7328 6c69 6e65 2c20 7072 6f63 6573  ors(line, proces
+00003940: 732c 2063 6d64 5f6e 616d 652c 2070 726f  s, cmd_name, pro
+00003950: 6772 6573 735f 6261 723d 7072 6f67 7265  gress_bar=progre
+00003960: 7373 5f62 6172 290a 2020 2020 2020 2020  ss_bar).        
+00003970: 444f 434b 4552 5f46 554e 435f 4d41 505b  DOCKER_FUNC_MAP[
+00003980: 636d 645f 6e61 6d65 5d28 6c69 6e65 2c20  cmd_name](line, 
+00003990: 636d 645f 6e61 6d65 2c20 7072 6f67 7265  cmd_name, progre
+000039a0: 7373 5f62 6172 3d70 726f 6772 6573 735f  ss_bar=progress_
+000039b0: 6261 7229 0a0a 0a64 6566 2063 7265 6174  bar)...def creat
+000039c0: 655f 7468 7265 6164 5f6c 6f67 7328 7072  e_thread_logs(pr
+000039d0: 6f63 6573 733a 2073 7562 7072 6f63 6573  ocess: subproces
+000039e0: 732e 506f 7065 6e29 202d 3e20 5175 6575  s.Popen) -> Queu
+000039f0: 653a 0a20 2020 2064 6566 2065 6e71 7565  e:.    def enque
+00003a00: 7565 5f6f 7574 7075 7428 6f75 743a 2041  ue_output(out: A
+00003a10: 6e79 2c20 7175 6575 653a 2051 7565 7565  ny, queue: Queue
+00003a20: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00003a30: 2020 2066 6f72 206c 696e 6520 696e 2069     for line in i
+00003a40: 7465 7228 6f75 742e 7265 6164 6c69 6e65  ter(out.readline
+00003a50: 2c20 6222 2229 3a0a 2020 2020 2020 2020  , b""):.        
+00003a60: 2020 2020 7175 6575 652e 7075 7428 6c69      queue.put(li
+00003a70: 6e65 290a 2020 2020 2020 2020 6f75 742e  ne).        out.
+00003a80: 636c 6f73 6528 290a 0a20 2020 2071 7565  close()..    que
+00003a90: 7565 3a20 5175 6575 6520 3d20 5175 6575  ue: Queue = Queu
+00003aa0: 6528 290a 2020 2020 7468 7265 6164 5f31  e().    thread_1
+00003ab0: 203d 2054 6872 6561 6428 7461 7267 6574   = Thread(target
+00003ac0: 3d65 6e71 7565 7565 5f6f 7574 7075 742c  =enqueue_output,
+00003ad0: 2061 7267 733d 2870 726f 6365 7373 2e73   args=(process.s
+00003ae0: 7464 6f75 742c 2071 7565 7565 2929 0a20  tdout, queue)). 
+00003af0: 2020 2074 6872 6561 645f 3220 3d20 5468     thread_2 = Th
+00003b00: 7265 6164 2874 6172 6765 743d 656e 7175  read(target=enqu
+00003b10: 6575 655f 6f75 7470 7574 2c20 6172 6773  eue_output, args
+00003b20: 3d28 7072 6f63 6573 732e 7374 6465 7272  =(process.stderr
+00003b30: 2c20 7175 6575 6529 290a 0a20 2020 2074  , queue))..    t
+00003b40: 6872 6561 645f 312e 6461 656d 6f6e 203d  hread_1.daemon =
+00003b50: 2054 7275 6520 2023 2074 6872 6561 6420   True  # thread 
+00003b60: 6469 6573 2077 6974 6820 7468 6520 7072  dies with the pr
+00003b70: 6f67 7261 6d0a 2020 2020 7468 7265 6164  ogram.    thread
+00003b80: 5f31 2e73 7461 7274 2829 0a20 2020 2074  _1.start().    t
+00003b90: 6872 6561 645f 322e 6461 656d 6f6e 203d  hread_2.daemon =
+00003ba0: 2054 7275 6520 2023 2074 6872 6561 6420   True  # thread 
+00003bb0: 6469 6573 2077 6974 6820 7468 6520 7072  dies with the pr
+00003bc0: 6f67 7261 6d0a 2020 2020 7468 7265 6164  ogram.    thread
+00003bd0: 5f32 2e73 7461 7274 2829 0a20 2020 2072  _2.start().    r
+00003be0: 6574 7572 6e20 7175 6575 650a 0a0a 6465  eturn queue...de
+00003bf0: 6620 7072 6f63 6573 735f 636d 6428 0a20  f process_cmd(. 
+00003c00: 2020 2063 6d64 733a 2054 7970 654c 6973     cmds: TypeLis
+00003c10: 745b 7374 725d 2c0a 2020 2020 6e6f 6465  t[str],.    node
+00003c20: 5f74 7970 653a 2073 7472 2c0a 2020 2020  _type: str,.    
+00003c30: 6472 795f 7275 6e3a 2062 6f6f 6c2c 0a20  dry_run: bool,. 
+00003c40: 2020 2073 696c 656e 743a 2062 6f6f 6c2c     silent: bool,
+00003c50: 0a20 2020 2066 726f 6d5f 7265 6e64 6572  .    from_render
+00003c60: 6564 5f64 6972 3a20 626f 6f6c 2c0a 2020  ed_dir: bool,.  
+00003c70: 2020 7072 6f67 7265 7373 5f62 6172 3a20    progress_bar: 
+00003c80: 556e 696f 6e5b 5072 6f67 7265 7373 2c20  Union[Progress, 
+00003c90: 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a 2020  None] = None,.  
+00003ca0: 2020 636d 645f 6e61 6d65 3a20 7374 7220    cmd_name: str 
+00003cb0: 3d20 2222 2c0a 2920 2d3e 204e 6f6e 653a  = "",.) -> None:
+00003cc0: 0a20 2020 2070 726f 6365 7373 5f6c 6973  .    process_lis
+00003cd0: 743a 2054 7970 654c 6973 7420 3d20 5b5d  t: TypeList = []
+00003ce0: 0a0a 2020 2020 6966 206e 6f64 655f 7479  ..    if node_ty
+00003cf0: 7065 203d 3d20 2265 6e63 6c61 7665 223a  pe == "enclave":
+00003d00: 0a20 2020 2020 2020 2063 7764 203d 2047  .        cwd = G
+00003d10: 5249 445f 5352 435f 5041 5448 202b 2022  RID_SRC_PATH + "
+00003d20: 2f77 6f72 6b65 7222 0a20 2020 2065 6c73  /worker".    els
+00003d30: 653a 0a20 2020 2020 2020 2063 7764 203d  e:.        cwd =
+00003d40: 2028 0a20 2020 2020 2020 2020 2020 206f   (.            o
+00003d50: 732e 7061 7468 2e6a 6f69 6e28 4752 4944  s.path.join(GRID
+00003d60: 5f53 5243 5f50 4154 482c 2052 454e 4445  _SRC_PATH, RENDE
+00003d70: 5245 445f 4449 5229 0a20 2020 2020 2020  RED_DIR).       
+00003d80: 2020 2020 2069 6620 6672 6f6d 5f72 656e       if from_ren
+00003d90: 6465 7265 645f 6469 720a 2020 2020 2020  dered_dir.      
+00003da0: 2020 2020 2020 656c 7365 2047 5249 445f        else GRID_
+00003db0: 5352 435f 5041 5448 0a20 2020 2020 2020  SRC_PATH.       
+00003dc0: 2029 0a0a 2020 2020 7573 6572 6e61 6d65   )..    username
+00003dd0: 2c20 7061 7373 776f 7264 203d 2028 0a20  , password = (. 
+00003de0: 2020 2020 2020 2065 7874 7261 6374 5f75         extract_u
+00003df0: 7365 726e 616d 655f 616e 645f 7061 7373  sername_and_pass
+00003e00: 2863 6d64 735b 305d 2920 6966 206c 656e  (cmds[0]) if len
+00003e10: 2863 6d64 7329 203e 2030 2065 6c73 6520  (cmds) > 0 else 
+00003e20: 2822 2d22 2c20 222d 2229 0a20 2020 2029  ("-", "-").    )
+00003e30: 0a20 2020 2023 2064 6973 706c 6179 2056  .    # display V
+00003e40: 4d20 6372 6564 656e 7469 616c 730a 2020  M credentials.  
+00003e50: 2020 636f 6e73 6f6c 6520 3d20 7269 6368    console = rich
+00003e60: 2e67 6574 5f63 6f6e 736f 6c65 2829 0a20  .get_console(). 
+00003e70: 2020 2063 7265 6465 6e74 6961 6c73 203d     credentials =
+00003e80: 2067 656e 6572 6174 655f 7573 6572 5f74   generate_user_t
+00003e90: 6162 6c65 2875 7365 726e 616d 653d 7573  able(username=us
+00003ea0: 6572 6e61 6d65 2c20 7061 7373 776f 7264  ername, password
+00003eb0: 3d70 6173 7377 6f72 6429 0a20 2020 2069  =password).    i
+00003ec0: 6620 6372 6564 656e 7469 616c 733a 0a20  f credentials:. 
+00003ed0: 2020 2020 2020 2063 6f6e 736f 6c65 2e70         console.p
+00003ee0: 7269 6e74 2863 7265 6465 6e74 6961 6c73  rint(credentials
+00003ef0: 290a 0a20 2020 2066 6f72 2063 6d64 2069  )..    for cmd i
+00003f00: 6e20 636d 6473 3a0a 2020 2020 2020 2020  n cmds:.        
+00003f10: 6966 2064 7279 5f72 756e 3a0a 2020 2020  if dry_run:.    
+00003f20: 2020 2020 2020 2020 7072 696e 7428 2252          print("R
+00003f30: 756e 6e69 6e67 3a20 5c6e 222c 2068 6964  unning: \n", hid
+00003f40: 655f 7061 7373 776f 7264 2863 6d64 3d63  e_password(cmd=c
+00003f50: 6d64 2929 0a20 2020 2020 2020 2020 2020  md)).           
+00003f60: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+00003f70: 2020 2023 2075 7365 2070 6f77 6572 7368     # use powersh
+00003f80: 656c 6c20 6966 2065 6e76 6972 6f6e 6d65  ell if environme
+00003f90: 6e74 2069 7320 5769 6e64 6f77 730a 2020  nt is Windows.  
+00003fa0: 2020 2020 2020 636d 645f 746f 5f65 7865        cmd_to_exe
+00003fb0: 6320 3d20 5b22 706f 7765 7273 6865 6c6c  c = ["powershell
+00003fc0: 2e65 7865 222c 2022 2d43 6f6d 6d61 6e64  .exe", "-Command
+00003fd0: 222c 2063 6d64 5d20 6966 2069 735f 7769  ", cmd] if is_wi
+00003fe0: 6e64 6f77 7328 2920 656c 7365 2063 6d64  ndows() else cmd
+00003ff0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+00004000: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00004010: 6e28 636d 6473 2920 3e20 313a 0a20 2020  n(cmds) > 1:.   
+00004020: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+00004030: 6365 7373 203d 2073 7562 7072 6f63 6573  cess = subproces
+00004040: 732e 506f 7065 6e28 2020 2320 6e6f 7365  s.Popen(  # nose
+00004050: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00004060: 2020 2020 2020 636d 645f 746f 5f65 7865        cmd_to_exe
+00004070: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
+00004080: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
+00004090: 6270 726f 6365 7373 2e50 4950 452c 0a20  bprocess.PIPE,. 
+000040a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040b0: 2020 2073 7464 6572 723d 7375 6270 726f     stderr=subpro
+000040c0: 6365 7373 2e50 4950 452c 0a20 2020 2020  cess.PIPE,.     
+000040d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000040e0: 7764 3d63 7764 2c0a 2020 2020 2020 2020  wd=cwd,.        
+000040f0: 2020 2020 2020 2020 2020 2020 7368 656c              shel
+00004100: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+00004110: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00004120: 2020 2020 2020 2020 2020 6970 5f61 6464            ip_add
+00004130: 7265 7373 203d 2065 7874 7261 6374 5f68  ress = extract_h
+00004140: 6f73 745f 6970 5f66 726f 6d5f 636d 6428  ost_ip_from_cmd(
+00004150: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
+00004160: 2020 2020 206a 7570 7974 6572 5f74 6f6b       jupyter_tok
+00004170: 656e 203d 2065 7874 7261 6374 5f6a 7570  en = extract_jup
+00004180: 7974 6572 5f74 6f6b 656e 2863 6d64 290a  yter_token(cmd).
+00004190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041a0: 7072 6f63 6573 735f 6c69 7374 2e61 7070  process_list.app
+000041b0: 656e 6428 2869 705f 6164 6472 6573 732c  end((ip_address,
+000041c0: 2070 726f 6365 7373 2c20 6a75 7079 7465   process, jupyte
+000041d0: 725f 746f 6b65 6e29 290a 2020 2020 2020  r_token)).      
+000041e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000041f0: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+00004200: 6c61 795f 6a75 7079 7465 725f 746f 6b65  lay_jupyter_toke
+00004210: 6e28 636d 6429 0a20 2020 2020 2020 2020  n(cmd).         
+00004220: 2020 2020 2020 2069 6620 7369 6c65 6e74         if silent
+00004230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004240: 2020 2020 2020 4f4e 5f50 4f53 4958 203d        ON_POSIX =
+00004250: 2022 706f 7369 7822 2069 6e20 7379 732e   "posix" in sys.
+00004260: 6275 696c 7469 6e5f 6d6f 6475 6c65 5f6e  builtin_module_n
+00004270: 616d 6573 0a0a 2020 2020 2020 2020 2020  ames..          
+00004280: 2020 2020 2020 2020 2020 7072 6f63 6573            proces
+00004290: 7320 3d20 7375 6270 726f 6365 7373 2e50  s = subprocess.P
+000042a0: 6f70 656e 2820 2023 206e 6f73 6563 0a20  open(  # nosec. 
+000042b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000042c0: 2020 2020 2020 2063 6d64 5f74 6f5f 6578         cmd_to_ex
+000042d0: 6563 2c0a 2020 2020 2020 2020 2020 2020  ec,.            
+000042e0: 2020 2020 2020 2020 2020 2020 7374 646f              stdo
+000042f0: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
+00004300: 5045 2c0a 2020 2020 2020 2020 2020 2020  PE,.            
+00004310: 2020 2020 2020 2020 2020 2020 7374 6465              stde
+00004320: 7272 3d73 7562 7072 6f63 6573 732e 5049  rr=subprocess.PI
+00004330: 5045 2c0a 2020 2020 2020 2020 2020 2020  PE,.            
+00004340: 2020 2020 2020 2020 2020 2020 6377 643d              cwd=
+00004350: 6377 642c 0a20 2020 2020 2020 2020 2020  cwd,.           
+00004360: 2020 2020 2020 2020 2020 2020 2063 6c6f               clo
+00004370: 7365 5f66 6473 3d4f 4e5f 504f 5349 582c  se_fds=ON_POSIX,
+00004380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004390: 2020 2020 2020 2020 2073 6865 6c6c 3d54           shell=T
+000043a0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+000043b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000043c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043d0: 2320 4372 6561 7465 7320 7477 6f20 7468  # Creates two th
+000043e0: 7265 6164 7320 746f 2067 6574 2064 6f63  reads to get doc
+000043f0: 6b65 7220 7374 646f 7574 2061 6e64 2073  ker stdout and s
+00004400: 7465 7272 0a20 2020 2020 2020 2020 2020  terr.           
+00004410: 2020 2020 2020 2020 206c 6f67 735f 7175           logs_qu
+00004420: 6575 6520 3d20 6372 6561 7465 5f74 6872  eue = create_thr
+00004430: 6561 645f 6c6f 6773 2870 726f 6365 7373  ead_logs(process
+00004440: 3d70 726f 6365 7373 290a 0a20 2020 2020  =process)..     
+00004450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004460: 6561 645f 7468 7265 6164 5f6c 6f67 7328  ead_thread_logs(
+00004470: 7072 6f67 7265 7373 5f62 6172 2c20 7072  progress_bar, pr
+00004480: 6f63 6573 732c 206c 6f67 735f 7175 6575  ocess, logs_queu
+00004490: 652c 2063 6d64 5f6e 616d 6529 0a20 2020  e, cmd_name).   
+000044a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044b0: 2077 6869 6c65 2070 726f 6365 7373 2e70   while process.p
+000044c0: 6f6c 6c28 2920 213d 2030 3a0a 2020 2020  oll() != 0:.    
+000044d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044e0: 2020 2020 7768 696c 6520 6e6f 7420 6c6f      while not lo
+000044f0: 6773 5f71 7565 7565 2e65 6d70 7479 2829  gs_queue.empty()
+00004500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004510: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00004520: 5265 6164 2073 7464 6f75 7420 616e 6420  Read stdout and 
+00004530: 7374 6572 7220 746f 2063 6865 636b 2065  sterr to check e
+00004540: 7272 6f72 7320 6f72 2075 7064 6174 6520  rrors or update 
+00004550: 7072 6f67 7265 7373 2062 6172 2e0a 2020  progress bar..  
+00004560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004570: 2020 2020 2020 2020 2020 7265 6164 5f74            read_t
+00004580: 6872 6561 645f 6c6f 6773 280a 2020 2020  hread_logs(.    
+00004590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045a0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+000045b0: 7265 7373 5f62 6172 2c20 7072 6f63 6573  ress_bar, proces
+000045c0: 732c 206c 6f67 735f 7175 6575 652c 2063  s, logs_queue, c
+000045d0: 6d64 5f6e 616d 650a 2020 2020 2020 2020  md_name.        
+000045e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00004600: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00004610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004620: 6966 2070 726f 6772 6573 735f 6261 723a  if progress_bar:
+00004630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004640: 2020 2020 2020 2020 2070 726f 6772 6573           progres
+00004650: 735f 6261 722e 7374 6f70 2829 0a0a 2020  s_bar.stop()..  
+00004660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004670: 2020 7375 6270 726f 6365 7373 2e72 756e    subprocess.run
+00004680: 2820 2023 206e 6f73 6563 0a20 2020 2020  (  # nosec.     
+00004690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046a0: 2020 2063 6d64 5f74 6f5f 6578 6563 2c0a     cmd_to_exec,.
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046c0: 2020 2020 2020 2020 7368 656c 6c3d 5472          shell=Tr
+000046d0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000046e0: 2020 2020 2020 2020 2020 2020 6377 643d              cwd=
+000046f0: 6377 642c 0a20 2020 2020 2020 2020 2020  cwd,.           
+00004700: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00004710: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00004720: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00004730: 2020 2020 2020 7072 696e 7428 6622 4661        print(f"Fa
+00004740: 696c 6564 2074 6f20 7275 6e20 636d 643a  iled to run cmd:
+00004750: 207b 636d 647d 2e20 7b65 7d22 290a 0a20   {cmd}. {e}").. 
+00004760: 2020 2069 6620 6472 795f 7275 6e20 6973     if dry_run is
+00004770: 2046 616c 7365 2061 6e64 206c 656e 2870   False and len(p
+00004780: 726f 6365 7373 5f6c 6973 7429 203e 2030  rocess_list) > 0
+00004790: 3a0a 2020 2020 2020 2020 2320 6469 7370  :.        # disp
+000047a0: 6c61 7920 564d 206c 6175 6e63 6820 7374  lay VM launch st
+000047b0: 6174 7573 0a20 2020 2020 2020 2064 6973  atus.        dis
+000047c0: 706c 6179 5f76 6d5f 7374 6174 7573 2870  play_vm_status(p
+000047d0: 726f 6365 7373 5f6c 6973 7429 0a0a 2020  rocess_list)..  
+000047e0: 2020 2020 2020 2320 7361 7665 2076 6d20        # save vm 
+000047f0: 6465 7461 696c 7320 6173 206a 736f 6e0a  details as json.
+00004800: 2020 2020 2020 2020 7361 7665 5f76 6d5f          save_vm_
+00004810: 6465 7461 696c 735f 6173 5f6a 736f 6e28  details_as_json(
+00004820: 7573 6572 6e61 6d65 2c20 7061 7373 776f  username, passwo
+00004830: 7264 2c20 7072 6f63 6573 735f 6c69 7374  rd, process_list
+00004840: 290a 0a0a 6465 6620 6578 6563 7574 655f  )...def execute_
+00004850: 636f 6d6d 616e 6473 280a 2020 2020 636d  commands(.    cm
+00004860: 6473 3a20 556e 696f 6e5b 5479 7065 4c69  ds: Union[TypeLi
+00004870: 7374 5b73 7472 5d2c 2054 7970 6544 6963  st[str], TypeDic
+00004880: 745b 7374 722c 2054 7970 654c 6973 745b  t[str, TypeList[
+00004890: 7374 725d 5d5d 2c0a 2020 2020 6e6f 6465  str]]],.    node
+000048a0: 5f74 7970 653a 2073 7472 2c0a 2020 2020  _type: str,.    
+000048b0: 6472 795f 7275 6e3a 2062 6f6f 6c20 3d20  dry_run: bool = 
+000048c0: 4661 6c73 652c 0a20 2020 2073 696c 656e  False,.    silen
+000048d0: 743a 2062 6f6f 6c20 3d20 4661 6c73 652c  t: bool = False,
+000048e0: 0a20 2020 2066 726f 6d5f 7265 6e64 6572  .    from_render
+000048f0: 6564 5f64 6972 3a20 626f 6f6c 203d 2046  ed_dir: bool = F
+00004900: 616c 7365 2c0a 2920 2d3e 204e 6f6e 653a  alse,.) -> None:
+00004910: 0a20 2020 2022 2222 4578 6563 7574 6520  .    """Execute 
+00004920: 7468 6520 6c61 756e 6368 2063 6f6d 6d61  the launch comma
+00004930: 6e64 7320 616e 6420 6469 7370 6c61 7920  nds and display 
+00004940: 7468 6569 7220 7374 6174 7573 2069 6e20  their status in 
+00004950: 7265 616c 7469 6d65 2e0a 0a20 2020 2041  realtime...    A
+00004960: 7267 733a 0a20 2020 2020 2020 2063 6d64  rgs:.        cmd
+00004970: 7320 286c 6973 7429 3a20 6c69 7374 206f  s (list): list o
+00004980: 6620 636f 6d6d 616e 6473 2074 6f20 6265  f commands to be
+00004990: 2065 7865 6375 7465 640a 2020 2020 2020   executed.      
+000049a0: 2020 6472 795f 7275 6e20 2862 6f6f 6c2c    dry_run (bool,
+000049b0: 206f 7074 696f 6e61 6c29 3a20 4966 2060   optional): If `
+000049c0: 5472 7565 6020 6f6e 6c79 2064 6973 706c  True` only displ
+000049d0: 6179 7320 636d 6473 2074 6f20 6265 2065  ays cmds to be e
+000049e0: 7865 6375 7465 642e 2044 6566 6175 6c74  xecuted. Default
+000049f0: 7320 746f 2046 616c 7365 2e0a 2020 2020  s to False..    
+00004a00: 2222 220a 2020 2020 636f 6e73 6f6c 6520  """.    console 
+00004a10: 3d20 7269 6368 2e67 6574 5f63 6f6e 736f  = rich.get_conso
+00004a20: 6c65 2829 0a20 2020 2069 6620 6973 696e  le().    if isin
+00004a30: 7374 616e 6365 2863 6d64 732c 2064 6963  stance(cmds, dic
+00004a40: 7429 3a0a 2020 2020 2020 2020 636f 6e73  t):.        cons
+00004a50: 6f6c 652e 7072 696e 7428 225b 626f 6c64  ole.print("[bold
+00004a60: 2067 7265 656e 5de2 a08b 5b62 6f6c 6420   green]...[bold 
+00004a70: 626c 7565 5d20 4c61 756e 6368 696e 6720  blue] Launching 
+00004a80: 436f 6e74 6169 6e65 7273 205b 2f62 6f6c  Containers [/bol
+00004a90: 6420 626c 7565 5d5c 7422 290a 2020 2020  d blue]\t").    
+00004aa0: 2020 2020 666f 7220 636d 645f 6e61 6d65      for cmd_name
+00004ab0: 2c20 636d 6420 696e 2063 6d64 732e 6974  , cmd in cmds.it
+00004ac0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00004ad0: 2020 2077 6974 6820 5072 6f67 7265 7373     with Progress
+00004ae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004af0: 2020 5370 696e 6e65 7243 6f6c 756d 6e28    SpinnerColumn(
+00004b00: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00004b10: 2020 2054 6578 7443 6f6c 756d 6e28 225b     TextColumn("[
+00004b20: 7072 6f67 7265 7373 2e64 6573 6372 6970  progress.descrip
+00004b30: 7469 6f6e 5d7b 7461 736b 2e64 6573 6372  tion]{task.descr
+00004b40: 6970 7469 6f6e 7d22 292c 0a20 2020 2020  iption}"),.     
+00004b50: 2020 2020 2020 2020 2020 2042 6172 436f             BarCo
+00004b60: 6c75 6d6e 2829 2c0a 2020 2020 2020 2020  lumn(),.        
+00004b70: 2020 2020 2020 2020 5465 7874 436f 6c75          TextColu
+00004b80: 6d6e 2822 5b70 726f 6772 6573 732e 7065  mn("[progress.pe
+00004b90: 7263 656e 7461 6765 5d7b 7461 736b 2e70  rcentage]{task.p
+00004ba0: 6572 6365 6e74 6167 653a 2e32 667d 2520  ercentage:.2f}% 
+00004bb0: 2020 2229 2c0a 2020 2020 2020 2020 2020    "),.          
+00004bc0: 2020 2020 2020 636f 6e73 6f6c 653d 636f        console=co
+00004bd0: 6e73 6f6c 652c 0a20 2020 2020 2020 2020  nsole,.         
+00004be0: 2020 2020 2020 2061 7574 6f5f 7265 6672         auto_refr
+00004bf0: 6573 683d 5472 7565 2c0a 2020 2020 2020  esh=True,.      
+00004c00: 2020 2020 2020 2920 6173 2070 726f 6772        ) as progr
+00004c10: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+00004c20: 2020 2020 2069 6620 7369 6c65 6e74 3a0a       if silent:.
+00004c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c40: 2020 2020 7072 6f67 7265 7373 2e61 6464      progress.add
+00004c50: 5f74 6173 6b28 0a20 2020 2020 2020 2020  _task(.         
+00004c60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00004c70: 225b 626f 6c64 2067 7265 656e 5d7b 636d  "[bold green]{cm
+00004c80: 645f 6e61 6d65 7d20 496d 6167 6573 222c  d_name} Images",
+00004c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ca0: 2020 2020 2020 2020 2074 6f74 616c 3d30           total=0
+00004cb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004cc0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00004cd0: 2020 2020 2020 2020 7072 6f63 6573 735f          process_
+00004ce0: 636d 6428 0a20 2020 2020 2020 2020 2020  cmd(.           
+00004cf0: 2020 2020 2020 2020 2063 6d64 733d 636d           cmds=cm
+00004d00: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00004d10: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00004d20: 3d6e 6f64 655f 7479 7065 2c0a 2020 2020  =node_type,.    
+00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d40: 6472 795f 7275 6e3d 6472 795f 7275 6e2c  dry_run=dry_run,
+00004d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d60: 2020 2020 2073 696c 656e 743d 7369 6c65       silent=sile
+00004d70: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+00004d80: 2020 2020 2020 2020 6672 6f6d 5f72 656e          from_ren
+00004d90: 6465 7265 645f 6469 723d 6672 6f6d 5f72  dered_dir=from_r
+00004da0: 656e 6465 7265 645f 6469 722c 0a20 2020  endered_dir,.   
+00004db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dc0: 2070 726f 6772 6573 735f 6261 723d 7072   progress_bar=pr
+00004dd0: 6f67 7265 7373 2c0a 2020 2020 2020 2020  ogress,.        
+00004de0: 2020 2020 2020 2020 2020 2020 636d 645f              cmd_
+00004df0: 6e61 6d65 3d63 6d64 5f6e 616d 652c 0a20  name=cmd_name,. 
+00004e00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00004e10: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00004e20: 2020 2070 726f 6365 7373 5f63 6d64 280a     process_cmd(.
+00004e30: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
+00004e40: 3d63 6d64 732c 0a20 2020 2020 2020 2020  =cmds,.         
+00004e50: 2020 206e 6f64 655f 7479 7065 3d6e 6f64     node_type=nod
+00004e60: 655f 7479 7065 2c0a 2020 2020 2020 2020  e_type,.        
+00004e70: 2020 2020 6472 795f 7275 6e3d 6472 795f      dry_run=dry_
+00004e80: 7275 6e2c 0a20 2020 2020 2020 2020 2020  run,.           
+00004e90: 2073 696c 656e 743d 7369 6c65 6e74 2c0a   silent=silent,.
+00004ea0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00004eb0: 5f72 656e 6465 7265 645f 6469 723d 6672  _rendered_dir=fr
+00004ec0: 6f6d 5f72 656e 6465 7265 645f 6469 722c  om_rendered_dir,
+00004ed0: 0a20 2020 2020 2020 2029 0a0a 0a64 6566  .        )...def
+00004ee0: 2064 6973 706c 6179 5f76 6d5f 7374 6174   display_vm_stat
+00004ef0: 7573 2870 726f 6365 7373 5f6c 6973 743a  us(process_list:
+00004f00: 2054 7970 654c 6973 7429 202d 3e20 4e6f   TypeList) -> No
+00004f10: 6e65 3a0a 2020 2020 2222 2244 6973 706c  ne:.    """Displ
+00004f20: 6179 2074 6865 2073 7461 7475 7320 6f66  ay the status of
+00004f30: 2074 6865 2070 726f 6365 7373 6573 2062   the processes b
+00004f40: 6569 6e67 2065 7865 6375 7465 6420 6f6e  eing executed on
+00004f50: 2074 6865 2056 4d2e 0a0a 2020 2020 4172   the VM...    Ar
+00004f60: 6773 3a0a 2020 2020 2020 2020 7072 6f63  gs:.        proc
+00004f70: 6573 735f 6c69 7374 2028 6c69 7374 293a  ess_list (list):
+00004f80: 206c 6973 7420 6f66 2070 726f 6365 7373   list of process
+00004f90: 6573 2065 7865 6375 7465 642e 0a20 2020  es executed..   
+00004fa0: 2022 2222 0a0a 2020 2020 2320 4765 6e65   """..    # Gene
+00004fb0: 7261 7465 2074 6865 2074 6162 6c65 2073  rate the table s
+00004fc0: 686f 7769 6e67 2074 6865 2073 7461 7475  howing the statu
+00004fd0: 7320 6f66 2065 6163 6820 7072 6f63 6573  s of each proces
+00004fe0: 7320 6265 696e 6720 6578 6563 7574 6564  s being executed
+00004ff0: 0a20 2020 2073 7461 7475 735f 7461 626c  .    status_tabl
+00005000: 652c 2070 726f 6365 7373 5f63 6f6d 706c  e, process_compl
+00005010: 6574 6564 203d 2067 656e 6572 6174 655f  eted = generate_
+00005020: 7072 6f63 6573 735f 7374 6174 7573 5f74  process_status_t
+00005030: 6162 6c65 2870 726f 6365 7373 5f6c 6973  able(process_lis
+00005040: 7429 0a0a 2020 2020 2320 5265 6e64 6572  t)..    # Render
+00005050: 2074 6865 206c 6976 6520 7461 626c 650a   the live table.
+00005060: 2020 2020 7769 7468 204c 6976 6528 7374      with Live(st
+00005070: 6174 7573 5f74 6162 6c65 2c20 7265 6672  atus_table, refr
+00005080: 6573 685f 7065 725f 7365 636f 6e64 3d31  esh_per_second=1
+00005090: 2920 6173 206c 6976 653a 0a20 2020 2020  ) as live:.     
+000050a0: 2020 2023 204c 6f6f 7020 7469 6c6c 2061     # Loop till a
+000050b0: 6c6c 2070 726f 6365 7373 6573 2068 6176  ll processes hav
+000050c0: 6520 6e6f 7420 636f 6d70 6c65 7465 6420  e not completed 
+000050d0: 6578 6563 7574 696e 670a 2020 2020 2020  executing.      
+000050e0: 2020 7768 696c 6520 6e6f 7420 7072 6f63    while not proc
+000050f0: 6573 735f 636f 6d70 6c65 7465 643a 0a20  ess_completed:. 
+00005100: 2020 2020 2020 2020 2020 2073 7461 7475             statu
+00005110: 735f 7461 626c 652c 2070 726f 6365 7373  s_table, process
+00005120: 5f63 6f6d 706c 6574 6564 203d 2067 656e  _completed = gen
+00005130: 6572 6174 655f 7072 6f63 6573 735f 7374  erate_process_st
+00005140: 6174 7573 5f74 6162 6c65 280a 2020 2020  atus_table(.    
+00005150: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00005160: 6573 735f 6c69 7374 0a20 2020 2020 2020  ess_list.       
+00005170: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005180: 2020 206c 6976 652e 7570 6461 7465 2873     live.update(s
+00005190: 7461 7475 735f 7461 626c 6529 2020 2320  tatus_table)  # 
+000051a0: 5570 6461 7465 2074 6865 2070 726f 6365  Update the proce
+000051b0: 7373 2073 7461 7475 7320 7461 626c 650a  ss status table.
+000051c0: 0a0a 6465 6620 6469 7370 6c61 795f 6a75  ..def display_ju
+000051d0: 7079 7465 725f 746f 6b65 6e28 636d 643a  pyter_token(cmd:
+000051e0: 2073 7472 2920 2d3e 204e 6f6e 653a 0a20   str) -> None:. 
+000051f0: 2020 2074 6f6b 656e 203d 2065 7874 7261     token = extra
+00005200: 6374 5f6a 7570 7974 6572 5f74 6f6b 656e  ct_jupyter_token
+00005210: 2863 6d64 3d63 6d64 290a 2020 2020 6966  (cmd=cmd).    if
+00005220: 2074 6f6b 656e 2069 7320 6e6f 7420 4e6f   token is not No
+00005230: 6e65 3a0a 2020 2020 2020 2020 7072 696e  ne:.        prin
+00005240: 7428 6622 4a75 7079 7465 7220 546f 6b65  t(f"Jupyter Toke
+00005250: 6e3a 207b 746f 6b65 6e7d 2229 0a0a 0a64  n: {token}")...d
+00005260: 6566 2065 7874 7261 6374 5f75 7365 726e  ef extract_usern
+00005270: 616d 655f 616e 645f 7061 7373 2863 6d64  ame_and_pass(cmd
+00005280: 3a20 7374 7229 202d 3e20 5475 706c 653a  : str) -> Tuple:
+00005290: 0a20 2020 2023 2045 7874 7261 6374 2075  .    # Extract u
+000052a0: 7365 726e 616d 650a 2020 2020 6d61 7463  sername.    matc
+000052b0: 6865 7220 3d20 7222 2d2d 7573 6572 2028  her = r"--user (
+000052c0: 2e2b 3f29 2022 0a20 2020 2075 7365 726e  .+?) ".    usern
+000052d0: 616d 6520 3d20 7265 2e66 696e 6461 6c6c  ame = re.findall
+000052e0: 286d 6174 6368 6572 2c20 636d 6429 0a20  (matcher, cmd). 
+000052f0: 2020 2075 7365 726e 616d 6520 3d20 7573     username = us
+00005300: 6572 6e61 6d65 5b30 5d20 6966 206c 656e  ername[0] if len
+00005310: 2875 7365 726e 616d 6529 203e 2030 2065  (username) > 0 e
+00005320: 6c73 6520 4e6f 6e65 0a0a 2020 2020 2320  lse None..    # 
+00005330: 4578 7472 6163 7420 7061 7373 776f 7264  Extract password
+00005340: 0a20 2020 206d 6174 6368 6572 203d 2072  .    matcher = r
+00005350: 2261 6e73 6962 6c65 5f73 7368 5f70 6173  "ansible_ssh_pas
+00005360: 733d 2728 2e2b 3f29 2722 0a20 2020 2070  s='(.+?)'".    p
+00005370: 6173 7377 6f72 6420 3d20 7265 2e66 696e  assword = re.fin
+00005380: 6461 6c6c 286d 6174 6368 6572 2c20 636d  dall(matcher, cm
+00005390: 6429 0a20 2020 2070 6173 7377 6f72 6420  d).    password 
+000053a0: 3d20 7061 7373 776f 7264 5b30 5d20 6966  = password[0] if
+000053b0: 206c 656e 2870 6173 7377 6f72 6429 203e   len(password) >
+000053c0: 2030 2065 6c73 6520 4e6f 6e65 0a0a 2020   0 else None..  
+000053d0: 2020 7265 7475 726e 2075 7365 726e 616d    return usernam
+000053e0: 652c 2070 6173 7377 6f72 640a 0a0a 6465  e, password...de
+000053f0: 6620 6578 7472 6163 745f 6a75 7079 7465  f extract_jupyte
+00005400: 725f 746f 6b65 6e28 636d 643a 2073 7472  r_token(cmd: str
+00005410: 2920 2d3e 204f 7074 696f 6e61 6c5b 7374  ) -> Optional[st
+00005420: 725d 3a0a 2020 2020 6d61 7463 6865 7220  r]:.    matcher 
+00005430: 3d20 7222 6a75 7079 7465 725f 746f 6b65  = r"jupyter_toke
+00005440: 6e3d 2728 2e2b 3f29 2722 0a20 2020 2074  n='(.+?)'".    t
+00005450: 6f6b 656e 203d 2072 652e 6669 6e64 616c  oken = re.findal
+00005460: 6c28 6d61 7463 6865 722c 2063 6d64 290a  l(matcher, cmd).
+00005470: 2020 2020 6966 206c 656e 2874 6f6b 656e      if len(token
+00005480: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00005490: 7265 7475 726e 2074 6f6b 656e 5b30 5d0a  return token[0].
+000054a0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+000054b0: 0a0a 6465 6620 6869 6465 5f70 6173 7377  ..def hide_passw
+000054c0: 6f72 6428 636d 643a 2073 7472 2920 2d3e  ord(cmd: str) ->
+000054d0: 2073 7472 3a0a 2020 2020 7472 793a 0a20   str:.    try:. 
+000054e0: 2020 2020 2020 206d 6174 6368 6572 203d         matcher =
+000054f0: 2072 2261 6e73 6962 6c65 5f73 7368 5f70   r"ansible_ssh_p
+00005500: 6173 733d 2728 2e2b 3f29 2722 0a20 2020  ass='(.+?)'".   
+00005510: 2020 2020 2070 6173 7377 6f72 6473 203d       passwords =
+00005520: 2072 652e 6669 6e64 616c 6c28 6d61 7463   re.findall(matc
+00005530: 6865 722c 2063 6d64 290a 2020 2020 2020  her, cmd).      
+00005540: 2020 6966 206c 656e 2870 6173 7377 6f72    if len(passwor
+00005550: 6473 2920 3e20 303a 0a20 2020 2020 2020  ds) > 0:.       
+00005560: 2020 2020 2070 6173 7377 6f72 6420 3d20       password = 
+00005570: 7061 7373 776f 7264 735b 305d 0a20 2020  passwords[0].   
+00005580: 2020 2020 2020 2020 2073 7461 7273 203d           stars =
+00005590: 2022 2a22 202a 2034 0a20 2020 2020 2020   "*" * 4.       
+000055a0: 2020 2020 2063 6d64 203d 2063 6d64 2e72       cmd = cmd.r
+000055b0: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
+000055c0: 2020 2020 2020 2020 6622 616e 7369 626c          f"ansibl
+000055d0: 655f 7373 685f 7061 7373 3d27 7b70 6173  e_ssh_pass='{pas
+000055e0: 7377 6f72 647d 2722 2c20 6622 616e 7369  sword}'", f"ansi
+000055f0: 626c 655f 7373 685f 7061 7373 3d27 7b73  ble_ssh_pass='{s
+00005600: 7461 7273 7d27 220a 2020 2020 2020 2020  tars}'".        
+00005610: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00005620: 7475 726e 2063 6d64 0a20 2020 2065 7863  turn cmd.    exc
+00005630: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00005640: 2065 3a0a 2020 2020 2020 2020 7072 696e   e:.        prin
+00005650: 7428 2246 6169 6c65 6420 746f 2068 6964  t("Failed to hid
+00005660: 6520 7061 7373 776f 7264 2e22 290a 2020  e password.").  
+00005670: 2020 2020 2020 7261 6973 6520 650a 0a0a        raise e...
+00005680: 6465 6620 6869 6465 5f61 7a75 7265 5f76  def hide_azure_v
+00005690: 6d5f 7061 7373 776f 7264 2861 7a75 7265  m_password(azure
+000056a0: 5f63 6d64 3a20 7374 7229 202d 3e20 7374  _cmd: str) -> st
+000056b0: 723a 0a20 2020 2074 7279 3a0a 2020 2020  r:.    try:.    
+000056c0: 2020 2020 6d61 7463 6865 7220 3d20 7222      matcher = r"
+000056d0: 6164 6d69 6e2d 7061 7373 776f 7264 2027  admin-password '
+000056e0: 282e 2b3f 2927 220a 2020 2020 2020 2020  (.+?)'".        
+000056f0: 7061 7373 776f 7264 7320 3d20 7265 2e66  passwords = re.f
+00005700: 696e 6461 6c6c 286d 6174 6368 6572 2c20  indall(matcher, 
+00005710: 617a 7572 655f 636d 6429 0a20 2020 2020  azure_cmd).     
+00005720: 2020 2069 6620 6c65 6e28 7061 7373 776f     if len(passwo
+00005730: 7264 7329 203e 2030 3a0a 2020 2020 2020  rds) > 0:.      
+00005740: 2020 2020 2020 7061 7373 776f 7264 203d        password =
+00005750: 2070 6173 7377 6f72 6473 5b30 5d0a 2020   passwords[0].  
+00005760: 2020 2020 2020 2020 2020 7374 6172 7320            stars 
+00005770: 3d20 222a 2220 2a20 340a 2020 2020 2020  = "*" * 4.      
+00005780: 2020 2020 2020 617a 7572 655f 636d 6420        azure_cmd 
+00005790: 3d20 617a 7572 655f 636d 642e 7265 706c  = azure_cmd.repl
+000057a0: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
+000057b0: 2020 2020 2066 2261 646d 696e 2d70 6173       f"admin-pas
+000057c0: 7377 6f72 6420 277b 7061 7373 776f 7264  sword '{password
+000057d0: 7d27 222c 2066 2261 646d 696e 2d70 6173  }'", f"admin-pas
+000057e0: 7377 6f72 6420 277b 7374 6172 737d 2722  sword '{stars}'"
+000057f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00005800: 2020 2020 2020 2072 6574 7572 6e20 617a         return az
+00005810: 7572 655f 636d 640a 2020 2020 6578 6365  ure_cmd.    exce
+00005820: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00005830: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+00005840: 2822 4661 696c 6564 2074 6f20 6869 6465  ("Failed to hide
+00005850: 2070 6173 7377 6f72 642e 2229 0a20 2020   password.").   
+00005860: 2020 2020 2072 6169 7365 2065 0a0a 0a63       raise e...c
+00005870: 6c61 7373 2051 7565 7374 696f 6e49 6e70  lass QuestionInp
+00005880: 7574 4572 726f 7228 4578 6365 7074 696f  utError(Exceptio
+00005890: 6e29 3a0a 2020 2020 7061 7373 0a0a 0a63  n):.    pass...c
+000058a0: 6c61 7373 2051 7565 7374 696f 6e49 6e70  lass QuestionInp
+000058b0: 7574 5061 7468 4572 726f 7228 4578 6365  utPathError(Exce
+000058c0: 7074 696f 6e29 3a0a 2020 2020 7061 7373  ption):.    pass
+000058d0: 0a0a 0a63 6c61 7373 2051 7565 7374 696f  ...class Questio
+000058e0: 6e3a 0a20 2020 2064 6566 205f 5f69 6e69  n:.    def __ini
+000058f0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+00005900: 662c 0a20 2020 2020 2020 2076 6172 5f6e  f,.        var_n
+00005910: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
+00005920: 2020 7175 6573 7469 6f6e 3a20 7374 722c    question: str,
+00005930: 0a20 2020 2020 2020 206b 696e 643a 2073  .        kind: s
+00005940: 7472 2c0a 2020 2020 2020 2020 6465 6661  tr,.        defa
+00005950: 756c 743a 204f 7074 696f 6e61 6c5b 7374  ult: Optional[st
+00005960: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+00005970: 2020 2063 6163 6865 3a20 626f 6f6c 203d     cache: bool =
+00005980: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00005990: 6f70 7469 6f6e 733a 204f 7074 696f 6e61  options: Optiona
+000059a0: 6c5b 5479 7065 4c69 7374 5b73 7472 5d5d  l[TypeList[str]]
+000059b0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+000059c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000059d0: 7365 6c66 2e76 6172 5f6e 616d 6520 3d20  self.var_name = 
+000059e0: 7661 725f 6e61 6d65 0a20 2020 2020 2020  var_name.       
+000059f0: 2073 656c 662e 7175 6573 7469 6f6e 203d   self.question =
+00005a00: 2071 7565 7374 696f 6e0a 2020 2020 2020   question.      
+00005a10: 2020 7365 6c66 2e64 6566 6175 6c74 203d    self.default =
+00005a20: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00005a30: 2073 656c 662e 6b69 6e64 203d 206b 696e   self.kind = kin
+00005a40: 640a 2020 2020 2020 2020 7365 6c66 2e63  d.        self.c
+00005a50: 6163 6865 203d 2063 6163 6865 0a20 2020  ache = cache.   
+00005a60: 2020 2020 2073 656c 662e 6f70 7469 6f6e       self.option
+00005a70: 7320 3d20 6f70 7469 6f6e 7320 6966 206f  s = options if o
+00005a80: 7074 696f 6e73 2069 7320 6e6f 7420 4e6f  ptions is not No
+00005a90: 6e65 2065 6c73 6520 5b5d 0a0a 2020 2020  ne else []..    
+00005aa0: 6465 6620 7661 6c69 6461 7465 2873 656c  def validate(sel
+00005ab0: 662c 2076 616c 7565 3a20 7374 7229 202d  f, value: str) -
+00005ac0: 3e20 7374 723a 0a20 2020 2020 2020 2076  > str:.        v
+00005ad0: 616c 7565 203d 2076 616c 7565 2e73 7472  alue = value.str
+00005ae0: 6970 2829 0a20 2020 2020 2020 2069 6620  ip().        if 
+00005af0: 7365 6c66 2e64 6566 6175 6c74 2069 7320  self.default is 
+00005b00: 6e6f 7420 4e6f 6e65 2061 6e64 2076 616c  not None and val
+00005b10: 7565 203d 3d20 2222 3a0a 2020 2020 2020  ue == "":.      
+00005b20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00005b30: 662e 6465 6661 756c 740a 0a20 2020 2020  f.default..     
+00005b40: 2020 2069 6620 7365 6c66 2e6b 696e 6420     if self.kind 
+00005b50: 3d3d 2022 7061 7468 223a 0a20 2020 2020  == "path":.     
+00005b60: 2020 2020 2020 2076 616c 7565 203d 206f         value = o
+00005b70: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+00005b80: 7228 7661 6c75 6529 0a20 2020 2020 2020  r(value).       
+00005b90: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00005ba0: 6174 682e 6578 6973 7473 2876 616c 7565  ath.exists(value
+00005bb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00005bc0: 2020 2065 7272 6f72 203d 2066 227b 7661     error = f"{va
+00005bd0: 6c75 657d 2069 7320 6e6f 7420 6120 7661  lue} is not a va
+00005be0: 6c69 6420 7061 7468 2e22 0a20 2020 2020  lid path.".     
+00005bf0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00005c00: 6c66 2e64 6566 6175 6c74 2069 7320 6e6f  lf.default is no
+00005c10: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00005c20: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00005c30: 7220 2b3d 2066 2220 5472 7920 7b73 656c  r += f" Try {sel
+00005c40: 662e 6465 6661 756c 747d 220a 2020 2020  f.default}".    
+00005c50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005c60: 6520 5175 6573 7469 6f6e 496e 7075 7450  e QuestionInputP
+00005c70: 6174 6845 7272 6f72 2866 227b 6572 726f  athError(f"{erro
+00005c80: 727d 2229 0a0a 2020 2020 2020 2020 6966  r}")..        if
+00005c90: 2073 656c 662e 6b69 6e64 203d 3d20 2279   self.kind == "y
+00005ca0: 6573 6e6f 223a 0a20 2020 2020 2020 2020  esno":.         
+00005cb0: 2020 2069 6620 7661 6c75 652e 6c6f 7765     if value.lowe
+00005cc0: 7228 292e 7374 6172 7473 7769 7468 2822  r().startswith("
+00005cd0: 7922 293a 0a20 2020 2020 2020 2020 2020  y"):.           
+00005ce0: 2020 2020 2072 6574 7572 6e20 2279 220a       return "y".
+00005cf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00005d00: 2076 616c 7565 2e6c 6f77 6572 2829 2e73   value.lower().s
+00005d10: 7461 7274 7377 6974 6828 226e 2229 3a0a  tartswith("n"):.
+00005d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d30: 7265 7475 726e 2022 6e22 0a20 2020 2020  return "n".     
+00005d40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005d50: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00005d60: 7365 2051 7565 7374 696f 6e49 6e70 7574  se QuestionInput
+00005d70: 4572 726f 7228 6622 7b76 616c 7565 7d20  Error(f"{value} 
+00005d80: 6973 206e 6f74 2061 6e20 7965 7320 6f72  is not an yes or
+00005d90: 206e 6f20 616e 7377 6572 2229 0a0a 2020   no answer")..  
+00005da0: 2020 2020 2020 6966 2073 656c 662e 6b69        if self.ki
+00005db0: 6e64 203d 3d20 226f 7074 696f 6e73 223a  nd == "options":
+00005dc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005dd0: 7661 6c75 6520 696e 2073 656c 662e 6f70  value in self.op
+00005de0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+00005df0: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
+00005e00: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00005e10: 6669 7273 745f 6c65 7474 6572 203d 2076  first_letter = v
+00005e20: 616c 7565 2e6c 6f77 6572 2829 5b30 5d0a  alue.lower()[0].
+00005e30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00005e40: 6f70 7469 6f6e 2069 6e20 7365 6c66 2e6f  option in self.o
+00005e50: 7074 696f 6e73 3a0a 2020 2020 2020 2020  ptions:.        
+00005e60: 2020 2020 2020 2020 6966 206f 7074 696f          if optio
+00005e70: 6e2e 7374 6172 7473 7769 7468 2866 6972  n.startswith(fir
+00005e80: 7374 5f6c 6574 7465 7229 3a0a 2020 2020  st_letter):.    
+00005e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ea0: 7265 7475 726e 206f 7074 696f 6e0a 0a20  return option.. 
+00005eb0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00005ec0: 2051 7565 7374 696f 6e49 6e70 7574 4572   QuestionInputEr
+00005ed0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00005ee0: 2020 2020 2066 227b 7661 6c75 657d 2069       f"{value} i
+00005ef0: 7320 6e6f 7420 6f6e 6520 6f66 2074 6865  s not one of the
+00005f00: 206f 7074 696f 6e73 3a20 7b73 656c 662e   options: {self.
+00005f10: 6f70 7469 6f6e 737d 220a 2020 2020 2020  options}".      
+00005f20: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00005f30: 2069 6620 7365 6c66 2e6b 696e 6420 3d3d   if self.kind ==
+00005f40: 2022 7061 7373 776f 7264 223a 0a20 2020   "password":.   
+00005f50: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00005f60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00005f70: 7475 726e 2076 616c 6964 6174 655f 7061  turn validate_pa
+00005f80: 7373 776f 7264 2870 6173 7377 6f72 643d  ssword(password=
+00005f90: 7661 6c75 6529 0a20 2020 2020 2020 2020  value).         
+00005fa0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00005fb0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00005fc0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00005fd0: 5175 6573 7469 6f6e 496e 7075 7445 7272  QuestionInputErr
+00005fe0: 6f72 2866 2249 6e76 616c 6964 2070 6173  or(f"Invalid pas
+00005ff0: 7377 6f72 642e 207b 657d 2229 0a20 2020  sword. {e}").   
+00006000: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
+00006010: 650a 0a0a 6465 6620 6173 6b28 7175 6573  e...def ask(ques
+00006020: 7469 6f6e 3a20 5175 6573 7469 6f6e 2c20  tion: Question, 
+00006030: 6b77 6172 6773 3a20 5479 7065 4469 6374  kwargs: TypeDict
+00006040: 5b73 7472 2c20 7374 725d 2920 2d3e 2073  [str, str]) -> s
+00006050: 7472 3a0a 2020 2020 6966 2071 7565 7374  tr:.    if quest
+00006060: 696f 6e2e 7661 725f 6e61 6d65 2069 6e20  ion.var_name in 
+00006070: 6b77 6172 6773 2061 6e64 206b 7761 7267  kwargs and kwarg
+00006080: 735b 7175 6573 7469 6f6e 2e76 6172 5f6e  s[question.var_n
+00006090: 616d 655d 2069 7320 6e6f 7420 4e6f 6e65  ame] is not None
+000060a0: 3a0a 2020 2020 2020 2020 7661 6c75 6520  :.        value 
+000060b0: 3d20 6b77 6172 6773 5b71 7565 7374 696f  = kwargs[questio
+000060c0: 6e2e 7661 725f 6e61 6d65 5d0a 2020 2020  n.var_name].    
+000060d0: 656c 7365 3a0a 2020 2020 2020 2020 6966  else:.        if
+000060e0: 2071 7565 7374 696f 6e2e 6465 6661 756c   question.defaul
+000060f0: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+00006100: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00006110: 203d 2063 6c69 636b 2e70 726f 6d70 7428   = click.prompt(
+00006120: 7175 6573 7469 6f6e 2e71 7565 7374 696f  question.questio
+00006130: 6e2c 2074 7970 653d 7374 722c 2064 6566  n, type=str, def
+00006140: 6175 6c74 3d71 7565 7374 696f 6e2e 6465  ault=question.de
+00006150: 6661 756c 7429 0a20 2020 2020 2020 2065  fault).        e
+00006160: 6c69 6620 7175 6573 7469 6f6e 2e76 6172  lif question.var
+00006170: 5f6e 616d 6520 3d3d 2022 7061 7373 776f  _name == "passwo
+00006180: 7264 223a 0a20 2020 2020 2020 2020 2020  rd":.           
+00006190: 2076 616c 7565 203d 2063 6c69 636b 2e70   value = click.p
+000061a0: 726f 6d70 7428 0a20 2020 2020 2020 2020  rompt(.         
+000061b0: 2020 2020 2020 2071 7565 7374 696f 6e2e         question.
+000061c0: 7175 6573 7469 6f6e 2c20 7479 7065 3d73  question, type=s
+000061d0: 7472 2c20 6869 6465 5f69 6e70 7574 3d54  tr, hide_input=T
+000061e0: 7275 652c 2063 6f6e 6669 726d 6174 696f  rue, confirmatio
+000061f0: 6e5f 7072 6f6d 7074 3d54 7275 650a 2020  n_prompt=True.  
+00006200: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00006210: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006220: 2020 2020 2020 7661 6c75 6520 3d20 636c        value = cl
+00006230: 6963 6b2e 7072 6f6d 7074 2871 7565 7374  ick.prompt(quest
+00006240: 696f 6e2e 7175 6573 7469 6f6e 2c20 7479  ion.question, ty
+00006250: 7065 3d73 7472 290a 0a20 2020 2074 7279  pe=str)..    try
+00006260: 3a0a 2020 2020 2020 2020 7661 6c75 6520  :.        value 
+00006270: 3d20 7175 6573 7469 6f6e 2e76 616c 6964  = question.valid
+00006280: 6174 6528 7661 6c75 653d 7661 6c75 6529  ate(value=value)
+00006290: 0a20 2020 2065 7863 6570 7420 5175 6573  .    except Ques
+000062a0: 7469 6f6e 496e 7075 7445 7272 6f72 2061  tionInputError a
+000062b0: 7320 653a 0a20 2020 2020 2020 2070 7269  s e:.        pri
+000062c0: 6e74 2865 290a 2020 2020 2020 2020 7265  nt(e).        re
+000062d0: 7475 726e 2061 736b 2871 7565 7374 696f  turn ask(questio
+000062e0: 6e3d 7175 6573 7469 6f6e 2c20 6b77 6172  n=question, kwar
+000062f0: 6773 3d6b 7761 7267 7329 0a20 2020 2069  gs=kwargs).    i
+00006300: 6620 7175 6573 7469 6f6e 2e63 6163 6865  f question.cache
+00006310: 3a0a 2020 2020 2020 2020 6172 675f 6361  :.        arg_ca
+00006320: 6368 655b 7175 6573 7469 6f6e 2e76 6172  che[question.var
+00006330: 5f6e 616d 655d 203d 2076 616c 7565 0a0a  _name] = value..
+00006340: 2020 2020 7265 7475 726e 2076 616c 7565      return value
+00006350: 0a0a 0a64 6566 2066 6978 5f6b 6579 5f70  ...def fix_key_p
+00006360: 6572 6d69 7373 696f 6e28 7072 6976 6174  ermission(privat
+00006370: 655f 6b65 795f 7061 7468 3a20 7374 7229  e_key_path: str)
+00006380: 202d 3e20 4e6f 6e65 3a0a 2020 2020 6b65   -> None:.    ke
+00006390: 795f 7065 726d 6973 7369 6f6e 203d 206f  y_permission = o
+000063a0: 6374 2873 7461 742e 535f 494d 4f44 4528  ct(stat.S_IMODE(
+000063b0: 6f73 2e73 7461 7428 7072 6976 6174 655f  os.stat(private_
+000063c0: 6b65 795f 7061 7468 292e 7374 5f6d 6f64  key_path).st_mod
+000063d0: 6529 290a 2020 2020 6368 6d6f 645f 7065  e)).    chmod_pe
+000063e0: 726d 6973 7369 6f6e 203d 2022 3430 3022  rmission = "400"
+000063f0: 0a20 2020 206f 6374 616c 5f70 6572 6d69  .    octal_permi
+00006400: 7373 696f 6e20 3d20 6622 306f 7b63 686d  ssion = f"0o{chm
+00006410: 6f64 5f70 6572 6d69 7373 696f 6e7d 220a  od_permission}".
+00006420: 2020 2020 6966 206b 6579 5f70 6572 6d69      if key_permi
+00006430: 7373 696f 6e20 213d 206f 6374 616c 5f70  ssion != octal_p
+00006440: 6572 6d69 7373 696f 6e3a 0a20 2020 2020  ermission:.     
+00006450: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00006460: 2020 2020 2020 6622 4669 7869 6e67 206b        f"Fixing k
+00006470: 6579 2070 6572 6d69 7373 696f 6e3a 207b  ey permission: {
+00006480: 7072 6976 6174 655f 6b65 795f 7061 7468  private_key_path
+00006490: 7d2c 2073 6574 7469 6e67 2074 6f20 7b63  }, setting to {c
+000064a0: 686d 6f64 5f70 6572 6d69 7373 696f 6e7d  hmod_permission}
+000064b0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+000064c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000064d0: 2020 2020 206f 732e 6368 6d6f 6428 7072       os.chmod(pr
+000064e0: 6976 6174 655f 6b65 795f 7061 7468 2c20  ivate_key_path, 
+000064f0: 696e 7428 6f63 7461 6c5f 7065 726d 6973  int(octal_permis
+00006500: 7369 6f6e 2c20 3829 290a 2020 2020 2020  sion, 8)).      
+00006510: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00006520: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00006530: 2020 2020 2070 7269 6e74 2822 4661 696c       print("Fail
+00006540: 6564 2074 6f20 6669 7820 6b65 7920 7065  ed to fix key pe
+00006550: 726d 6973 7369 6f6e 222c 2065 290a 2020  rmission", e).  
+00006560: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006570: 650a 0a0a 6465 6620 7072 6976 6174 655f  e...def private_
+00006580: 746f 5f70 7562 6c69 635f 6b65 7928 7072  to_public_key(pr
+00006590: 6976 6174 655f 6b65 795f 7061 7468 3a20  ivate_key_path: 
+000065a0: 7374 722c 2074 656d 705f 7061 7468 3a20  str, temp_path: 
+000065b0: 7374 722c 2075 7365 726e 616d 653a 2073  str, username: s
+000065c0: 7472 2920 2d3e 2073 7472 3a0a 2020 2020  tr) -> str:.    
+000065d0: 2320 6368 6563 6b20 6b65 7920 7065 726d  # check key perm
+000065e0: 6973 7369 6f6e 0a20 2020 2066 6978 5f6b  ission.    fix_k
+000065f0: 6579 5f70 6572 6d69 7373 696f 6e28 7072  ey_permission(pr
+00006600: 6976 6174 655f 6b65 795f 7061 7468 3d70  ivate_key_path=p
+00006610: 7269 7661 7465 5f6b 6579 5f70 6174 6829  rivate_key_path)
+00006620: 0a20 2020 206f 7574 7075 745f 7061 7468  .    output_path
+00006630: 203d 2066 227b 7465 6d70 5f70 6174 687d   = f"{temp_path}
+00006640: 2f68 6167 7269 645f 7b75 7365 726e 616d  /hagrid_{usernam
+00006650: 657d 5f6b 6579 2e70 7562 220a 2020 2020  e}_key.pub".    
+00006660: 636d 6420 3d20 6622 7373 682d 6b65 7967  cmd = f"ssh-keyg
+00006670: 656e 202d 6620 7b70 7269 7661 7465 5f6b  en -f {private_k
+00006680: 6579 5f70 6174 687d 202d 7920 3e20 7b6f  ey_path} -y > {o
+00006690: 7574 7075 745f 7061 7468 7d22 0a20 2020  utput_path}".   
+000066a0: 2074 7279 3a0a 2020 2020 2020 2020 7375   try:.        su
+000066b0: 6270 726f 6365 7373 2e63 6865 636b 5f63  bprocess.check_c
+000066c0: 616c 6c28 636d 642c 2073 6865 6c6c 3d54  all(cmd, shell=T
+000066d0: 7275 6529 2020 2320 6e6f 7365 630a 2020  rue)  # nosec.  
+000066e0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+000066f0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00006700: 2070 7269 6e74 2822 6661 696c 6564 2074   print("failed t
+00006710: 6f20 6d61 6b65 2073 7368 206b 6579 222c  o make ssh key",
+00006720: 2065 290a 2020 2020 2020 2020 7261 6973   e).        rais
+00006730: 6520 650a 2020 2020 7265 7475 726e 206f  e e.    return o
+00006740: 7574 7075 745f 7061 7468 0a0a 0a64 6566  utput_path...def
+00006750: 2063 6865 636b 5f61 7a75 7265 5f61 7574   check_azure_aut
+00006760: 6865 6428 2920 2d3e 2062 6f6f 6c3a 0a20  hed() -> bool:. 
+00006770: 2020 2063 6d64 203d 2022 617a 2061 6363     cmd = "az acc
+00006780: 6f75 6e74 2073 686f 7722 0a20 2020 2074  ount show".    t
+00006790: 7279 3a0a 2020 2020 2020 2020 7375 6270  ry:.        subp
+000067a0: 726f 6365 7373 2e63 6865 636b 5f63 616c  rocess.check_cal
+000067b0: 6c28 636d 642c 2073 6865 6c6c 3d54 7275  l(cmd, shell=Tru
+000067c0: 652c 2073 7464 6f75 743d 7375 6270 726f  e, stdout=subpro
+000067d0: 6365 7373 2e44 4556 4e55 4c4c 2920 2023  cess.DEVNULL)  #
+000067e0: 206e 6f73 6563 0a20 2020 2020 2020 2072   nosec.        r
+000067f0: 6574 7572 6e20 5472 7565 0a20 2020 2065  eturn True.    e
+00006800: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00006810: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
+00006820: 2020 7061 7373 0a20 2020 2072 6574 7572    pass.    retur
+00006830: 6e20 4661 6c73 650a 0a0a 6465 6620 6c6f  n False...def lo
+00006840: 6769 6e5f 617a 7572 6528 2920 2d3e 2062  gin_azure() -> b
+00006850: 6f6f 6c3a 0a20 2020 2063 6d64 203d 2022  ool:.    cmd = "
+00006860: 617a 206c 6f67 696e 220a 2020 2020 7472  az login".    tr
+00006870: 793a 0a20 2020 2020 2020 2073 7562 7072  y:.        subpr
+00006880: 6f63 6573 732e 6368 6563 6b5f 6361 6c6c  ocess.check_call
+00006890: 2863 6d64 2c20 7368 656c 6c3d 5472 7565  (cmd, shell=True
+000068a0: 2c20 7374 646f 7574 3d73 7562 7072 6f63  , stdout=subproc
+000068b0: 6573 732e 4445 564e 554c 4c29 2020 2320  ess.DEVNULL)  # 
+000068c0: 6e6f 7365 630a 2020 2020 2020 2020 7265  nosec.        re
+000068d0: 7475 726e 2054 7275 650a 2020 2020 6578  turn True.    ex
+000068e0: 6365 7074 2045 7863 6570 7469 6f6e 3a20  cept Exception: 
+000068f0: 2023 206e 6f73 6563 0a20 2020 2020 2020   # nosec.       
+00006900: 2070 6173 730a 2020 2020 7265 7475 726e   pass.    return
+00006910: 2046 616c 7365 0a0a 0a64 6566 2063 6865   False...def che
+00006920: 636b 5f61 7a75 7265 5f63 6c69 5f69 6e73  ck_azure_cli_ins
+00006930: 7461 6c6c 6564 2829 202d 3e20 626f 6f6c  talled() -> bool
+00006940: 3a0a 2020 2020 7472 793a 0a20 2020 2020  :.    try:.     
+00006950: 2020 2072 6573 756c 7420 3d20 7375 6270     result = subp
+00006960: 726f 6365 7373 2e72 756e 2820 2023 206e  rocess.run(  # n
+00006970: 6f73 6563 0a20 2020 2020 2020 2020 2020  osec.           
+00006980: 205b 2261 7a22 2c20 222d 2d76 6572 7369   ["az", "--versi
+00006990: 6f6e 225d 2c20 7374 646f 7574 3d73 7562  on"], stdout=sub
+000069a0: 7072 6f63 6573 732e 4445 564e 554c 4c2c  process.DEVNULL,
+000069b0: 2073 7464 6572 723d 7375 6270 726f 6365   stderr=subproce
+000069c0: 7373 2e53 5444 4f55 540a 2020 2020 2020  ss.STDOUT.      
+000069d0: 2020 290a 2020 2020 2020 2020 6966 2072    ).        if r
+000069e0: 6573 756c 742e 7265 7475 726e 636f 6465  esult.returncode
+000069f0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
+00006a00: 2020 2072 6169 7365 2046 696c 654e 6f74     raise FileNot
+00006a10: 466f 756e 6445 7272 6f72 2822 617a 206e  FoundError("az n
+00006a20: 6f74 2069 6e73 7461 6c6c 6564 2229 0a20  ot installed"). 
+00006a30: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00006a40: 696f 6e3a 2020 2320 6e6f 7365 630a 2020  ion:  # nosec.  
+00006a50: 2020 2020 2020 6d73 6720 3d20 225c 6e59        msg = "\nY
+00006a60: 6f75 2064 6f6e 2774 2061 7070 6561 7220  ou don't appear 
+00006a70: 746f 2068 6176 6520 7468 6520 417a 7572  to have the Azur
+00006a80: 6520 434c 4920 696e 7374 616c 6c65 6421  e CLI installed!
+00006a90: 2121 205c 6e5c 6e5c 0a50 6c65 6173 6520  !! \n\n\.Please 
+00006aa0: 696e 7374 616c 6c20 6974 2061 6e64 2074  install it and t
+00006ab0: 6865 6e20 7265 7472 7920 796f 7572 2063  hen retry your c
+00006ac0: 6f6d 6d61 6e64 2e5c 0a5c 6e5c 6e49 6e73  ommand.\.\n\nIns
+00006ad0: 7461 6c6c 6174 696f 6e20 496e 7374 7275  tallation Instru
+00006ae0: 6374 696f 6e73 3a20 6874 7470 733a 2f2f  ctions: https://
+00006af0: 646f 6373 2e6d 6963 726f 736f 6674 2e63  docs.microsoft.c
+00006b00: 6f6d 2f65 6e2d 7573 2f63 6c69 2f61 7a75  om/en-us/cli/azu
+00006b10: 7265 2f69 6e73 7461 6c6c 2d61 7a75 7265  re/install-azure
+00006b20: 2d63 6c69 5c6e 220a 2020 2020 2020 2020  -cli\n".        
+00006b30: 7261 6973 6520 4669 6c65 4e6f 7446 6f75  raise FileNotFou
+00006b40: 6e64 4572 726f 7228 6d73 6729 0a0a 2020  ndError(msg)..  
+00006b50: 2020 7265 7475 726e 2054 7275 650a 0a0a    return True...
+00006b60: 6465 6620 6368 6563 6b5f 6763 6c6f 7564  def check_gcloud
+00006b70: 5f63 6c69 5f69 6e73 7461 6c6c 6564 2829  _cli_installed()
+00006b80: 202d 3e20 626f 6f6c 3a0a 2020 2020 7472   -> bool:.    tr
+00006b90: 793a 0a20 2020 2020 2020 2073 7562 7072  y:.        subpr
+00006ba0: 6f63 6573 732e 6361 6c6c 285b 2267 636c  ocess.call(["gcl
+00006bb0: 6f75 6422 2c20 2276 6572 7369 6f6e 225d  oud", "version"]
+00006bc0: 2920 2023 206e 6f73 6563 0a20 2020 2020  )  # nosec.     
+00006bd0: 2020 2070 7269 6e74 2822 4763 6c6f 7564     print("Gcloud
+00006be0: 2063 6c69 2069 6e73 7461 6c6c 6564 2122   cli installed!"
+00006bf0: 290a 2020 2020 6578 6365 7074 2046 696c  ).    except Fil
+00006c00: 654e 6f74 466f 756e 6445 7272 6f72 3a0a  eNotFoundError:.
+00006c10: 2020 2020 2020 2020 6d73 6720 3d20 225c          msg = "\
+00006c20: 6e59 6f75 2064 6f6e 2774 2061 7070 6561  nYou don't appea
+00006c30: 7220 746f 2068 6176 6520 7468 6520 6763  r to have the gc
+00006c40: 6c6f 7564 2043 4c49 2074 6f6f 6c20 696e  loud CLI tool in
+00006c50: 7374 616c 6c65 6421 205c 6e5c 6e5c 0a50  stalled! \n\n\.P
+00006c60: 6c65 6173 6520 696e 7374 616c 6c20 6974  lease install it
+00006c70: 2061 6e64 2074 6865 6e20 7265 7472 7920   and then retry 
+00006c80: 6167 6169 6e2e 5c0a 5c6e 5c6e 496e 7374  again.\.\n\nInst
+00006c90: 616c 6c61 7469 6f6e 2049 6e73 7472 7563  allation Instruc
+00006ca0: 7469 6f6e 733a 2068 7474 7073 3a2f 2f63  tions: https://c
+00006cb0: 6c6f 7564 2e67 6f6f 676c 652e 636f 6d2f  loud.google.com/
+00006cc0: 7364 6b2f 646f 6373 2f69 6e73 7461 6c6c  sdk/docs/install
+00006cd0: 2d73 646b 205c 6e22 0a20 2020 2020 2020  -sdk \n".       
+00006ce0: 2072 6169 7365 2046 696c 654e 6f74 466f   raise FileNotFo
+00006cf0: 756e 6445 7272 6f72 286d 7367 290a 0a20  undError(msg).. 
+00006d00: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+00006d10: 0a64 6566 2063 6865 636b 5f61 7773 5f63  .def check_aws_c
+00006d20: 6c69 5f69 6e73 7461 6c6c 6564 2829 202d  li_installed() -
+00006d30: 3e20 626f 6f6c 3a0a 2020 2020 7472 793a  > bool:.    try:
+00006d40: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+00006d50: 3d20 7375 6270 726f 6365 7373 2e72 756e  = subprocess.run
+00006d60: 2820 2023 206e 6f73 6563 0a20 2020 2020  (  # nosec.     
+00006d70: 2020 2020 2020 205b 2261 7773 222c 2022         ["aws", "
+00006d80: 2d2d 7665 7273 696f 6e22 5d2c 2073 7464  --version"], std
+00006d90: 6f75 743d 7375 6270 726f 6365 7373 2e44  out=subprocess.D
+00006da0: 4556 4e55 4c4c 2c20 7374 6465 7272 3d73  EVNULL, stderr=s
+00006db0: 7562 7072 6f63 6573 732e 5354 444f 5554  ubprocess.STDOUT
+00006dc0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00006dd0: 2020 2069 6620 7265 7375 6c74 2e72 6574     if result.ret
+00006de0: 7572 6e63 6f64 6520 213d 2030 3a0a 2020  urncode != 0:.  
+00006df0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006e00: 4669 6c65 4e6f 7446 6f75 6e64 4572 726f  FileNotFoundErro
+00006e10: 7228 2241 5753 2043 4c49 206e 6f74 2069  r("AWS CLI not i
+00006e20: 6e73 7461 6c6c 6564 2229 0a20 2020 2065  nstalled").    e
+00006e30: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00006e40: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
+00006e50: 2020 6d73 6720 3d20 225c 6e59 6f75 2064    msg = "\nYou d
+00006e60: 6f6e 2774 2061 7070 6561 7220 746f 2068  on't appear to h
+00006e70: 6176 6520 7468 6520 4157 5320 434c 4920  ave the AWS CLI 
+00006e80: 696e 7374 616c 6c65 6421 205c 6e5c 6e5c  installed! \n\n\
+00006e90: 0a50 6c65 6173 6520 696e 7374 616c 6c20  .Please install 
+00006ea0: 6974 2061 6e64 2074 6865 6e20 7265 7472  it and then retr
+00006eb0: 7920 796f 7572 2063 6f6d 6d61 6e64 2e5c  y your command.\
+00006ec0: 0a5c 6e5c 6e49 6e73 7461 6c6c 6174 696f  .\n\nInstallatio
+00006ed0: 6e20 496e 7374 7275 6374 696f 6e73 3a20  n Instructions: 
+00006ee0: 6874 7470 733a 2f2f 646f 6373 2e61 7773  https://docs.aws
+00006ef0: 2e61 6d61 7a6f 6e2e 636f 6d2f 636c 692f  .amazon.com/cli/
+00006f00: 6c61 7465 7374 2f75 7365 7267 7569 6465  latest/userguide
+00006f10: 2f67 6574 7469 6e67 2d73 7461 7274 6564  /getting-started
+00006f20: 2d69 6e73 7461 6c6c 2e68 746d 6c5c 6e22  -install.html\n"
+00006f30: 0a20 2020 2020 2020 2072 6169 7365 2046  .        raise F
+00006f40: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
+00006f50: 286d 7367 290a 0a20 2020 2072 6574 7572  (msg)..    retur
+00006f60: 6e20 5472 7565 0a0a 0a64 6566 2063 6865  n True...def che
+00006f70: 636b 5f67 636c 6f75 645f 6175 7468 6564  ck_gcloud_authed
+00006f80: 2829 202d 3e20 626f 6f6c 3a0a 2020 2020  () -> bool:.    
+00006f90: 7472 793a 0a20 2020 2020 2020 2072 6573  try:.        res
+00006fa0: 756c 7420 3d20 7375 6270 726f 6365 7373  ult = subprocess
+00006fb0: 2e72 756e 2820 2023 206e 6f73 6563 0a20  .run(  # nosec. 
+00006fc0: 2020 2020 2020 2020 2020 205b 2267 636c             ["gcl
+00006fd0: 6f75 6422 2c20 2261 7574 6822 2c20 2270  oud", "auth", "p
+00006fe0: 7269 6e74 2d69 6465 6e74 6974 792d 746f  rint-identity-to
+00006ff0: 6b65 6e22 5d2c 2073 7464 6f75 743d 7375  ken"], stdout=su
+00007000: 6270 726f 6365 7373 2e50 4950 450a 2020  bprocess.PIPE.  
+00007010: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007020: 6966 2072 6573 756c 742e 7265 7475 726e  if result.return
+00007030: 636f 6465 203d 3d20 303a 0a20 2020 2020  code == 0:.     
+00007040: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00007050: 7565 0a20 2020 2065 7863 6570 7420 4578  ue.    except Ex
+00007060: 6365 7074 696f 6e3a 2020 2320 6e6f 7365  ception:  # nose
+00007070: 630a 2020 2020 2020 2020 7061 7373 0a20  c.        pass. 
+00007080: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00007090: 0a0a 6465 6620 6c6f 6769 6e5f 6763 6c6f  ..def login_gclo
+000070a0: 7564 2829 202d 3e20 626f 6f6c 3a0a 2020  ud() -> bool:.  
+000070b0: 2020 636d 6420 3d20 2267 636c 6f75 6420    cmd = "gcloud 
+000070c0: 6175 7468 206c 6f67 696e 220a 2020 2020  auth login".    
+000070d0: 7472 793a 0a20 2020 2020 2020 2073 7562  try:.        sub
+000070e0: 7072 6f63 6573 732e 6368 6563 6b5f 6361  process.check_ca
+000070f0: 6c6c 2863 6d64 2c20 7368 656c 6c3d 5472  ll(cmd, shell=Tr
+00007100: 7565 2c20 7374 646f 7574 3d73 7562 7072  ue, stdout=subpr
+00007110: 6f63 6573 732e 4445 564e 554c 4c29 2020  ocess.DEVNULL)  
+00007120: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
+00007130: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00007140: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00007150: 3a20 2023 206e 6f73 6563 0a20 2020 2020  :  # nosec.     
+00007160: 2020 2070 6173 730a 2020 2020 7265 7475     pass.    retu
+00007170: 726e 2046 616c 7365 0a0a 0a64 6566 2073  rn False...def s
+00007180: 7472 5f74 6f5f 626f 6f6c 2862 6f6f 6c5f  tr_to_bool(bool_
+00007190: 7374 723a 204f 7074 696f 6e61 6c5b 7374  str: Optional[st
+000071a0: 725d 2920 2d3e 2062 6f6f 6c3a 0a20 2020  r]) -> bool:.   
+000071b0: 2072 6573 756c 7420 3d20 4661 6c73 650a   result = False.
+000071c0: 2020 2020 626f 6f6c 5f73 7472 203d 2073      bool_str = s
+000071d0: 7472 2862 6f6f 6c5f 7374 7229 2e6c 6f77  tr(bool_str).low
+000071e0: 6572 2829 0a20 2020 2069 6620 626f 6f6c  er().    if bool
+000071f0: 5f73 7472 203d 3d20 2274 7275 6522 206f  _str == "true" o
+00007200: 7220 626f 6f6c 5f73 7472 203d 3d20 2231  r bool_str == "1
+00007210: 223a 0a20 2020 2020 2020 2072 6573 756c  ":.        resul
+00007220: 7420 3d20 5472 7565 0a20 2020 2072 6574  t = True.    ret
+00007230: 7572 6e20 7265 7375 6c74 0a0a 0a41 5254  urn result...ART
+00007240: 203d 2073 7472 5f74 6f5f 626f 6f6c 286f   = str_to_bool(o
+00007250: 732e 656e 7669 726f 6e2e 6765 7428 2248  s.environ.get("H
+00007260: 4147 5249 445f 4152 5422 2c20 2254 7275  AGRID_ART", "Tru
+00007270: 6522 2929 0a0a 0a64 6566 2067 656e 6572  e"))...def gener
+00007280: 6174 655f 6763 6c6f 7564 5f6b 6579 5f61  ate_gcloud_key_a
+00007290: 745f 7061 7468 286b 6579 5f70 6174 683a  t_path(key_path:
+000072a0: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
+000072b0: 2020 6b65 795f 7061 7468 203d 206f 732e    key_path = os.
+000072c0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+000072d0: 6b65 795f 7061 7468 290a 2020 2020 6966  key_path).    if
+000072e0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000072f0: 6b65 795f 7061 7468 293a 0a20 2020 2020  key_path):.     
+00007300: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00007310: 6f6e 2866 2243 616e 2774 2067 656e 6572  on(f"Can't gener
+00007320: 6174 6520 6b65 7920 7369 6e63 6520 7061  ate key since pa
+00007330: 7468 2061 6c72 6561 6479 2065 7869 7374  th already exist
+00007340: 732e 207b 6b65 795f 7061 7468 7d22 290a  s. {key_path}").
+00007350: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00007360: 2020 2320 7472 6967 6765 7273 2061 206b    # triggers a k
+00007370: 6579 2063 6865 636b 0a20 2020 2020 2020  ey check.       
+00007380: 2063 6d64 203d 2022 6763 6c6f 7564 2063   cmd = "gcloud c
+00007390: 6f6d 7075 7465 2073 7368 2027 2720 2d2d  ompute ssh '' --
+000073a0: 6472 792d 7275 6e22 0a20 2020 2020 2020  dry-run".       
+000073b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000073c0: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
+000073d0: 636b 5f63 616c 6c28 636d 642c 2073 6865  ck_call(cmd, she
+000073e0: 6c6c 3d54 7275 6529 2020 2320 6e6f 7365  ll=True)  # nose
+000073f0: 630a 2020 2020 2020 2020 6578 6365 7074  c.        except
+00007400: 2045 7863 6570 7469 6f6e 3a20 2023 206e   Exception:  # n
+00007410: 6f73 6563 0a20 2020 2020 2020 2020 2020  osec.           
+00007420: 2070 6173 730a 2020 2020 2020 2020 6966   pass.        if
+00007430: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+00007440: 7374 7328 6b65 795f 7061 7468 293a 0a20  sts(key_path):. 
+00007450: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00007460: 2045 7863 6570 7469 6f6e 2866 2267 636c   Exception(f"gcl
+00007470: 6f75 6420 6661 696c 6564 2074 6f20 6765  oud failed to ge
+00007480: 6e65 7261 7465 2073 7368 2d6b 6579 2061  nerate ssh-key a
+00007490: 743a 207b 6b65 795f 7061 7468 7d22 290a  t: {key_path}").
+000074a0: 0a20 2020 2072 6574 7572 6e20 6b65 795f  .    return key_
+000074b0: 7061 7468 0a0a 0a64 6566 2067 656e 6572  path...def gener
+000074c0: 6174 655f 6177 735f 6b65 795f 6174 5f70  ate_aws_key_at_p
+000074d0: 6174 6828 6b65 795f 7061 7468 3a20 7374  ath(key_path: st
+000074e0: 722c 206b 6579 5f6e 616d 653a 2073 7472  r, key_name: str
+000074f0: 2920 2d3e 2073 7472 3a0a 2020 2020 6b65  ) -> str:.    ke
+00007500: 795f 7061 7468 203d 206f 732e 7061 7468  y_path = os.path
+00007510: 2e65 7870 616e 6475 7365 7228 6b65 795f  .expanduser(key_
+00007520: 7061 7468 290a 2020 2020 6966 206f 732e  path).    if os.
+00007530: 7061 7468 2e65 7869 7374 7328 6b65 795f  path.exists(key_
+00007540: 7061 7468 293a 0a20 2020 2020 2020 2072  path):.        r
+00007550: 6169 7365 2045 7863 6570 7469 6f6e 2866  aise Exception(f
+00007560: 2243 616e 2774 2067 656e 6572 6174 6520  "Can't generate 
+00007570: 6b65 7920 7369 6e63 6520 7061 7468 2061  key since path a
+00007580: 6c72 6561 6479 2065 7869 7374 732e 207b  lready exists. {
+00007590: 6b65 795f 7061 7468 7d22 290a 2020 2020  key_path}").    
+000075a0: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
+000075b0: 544f 444f 2077 6520 6e65 6564 2074 6f20  TODO we need to 
+000075c0: 646f 2064 6966 6665 7265 6e74 6c79 2066  do differently f
+000075d0: 6f72 2070 6f77 6572 7368 656c 6c2e 0a20  or powershell.. 
+000075e0: 2020 2020 2020 2023 2045 783a 2061 7773         # Ex: aws
+000075f0: 2065 6332 2063 7265 6174 652d 6b65 792d   ec2 create-key-
+00007600: 7061 6972 202d 2d6b 6579 2d6e 616d 6520  pair --key-name 
+00007610: 4d79 4b65 7950 6169 7220 2d2d 7175 6572  MyKeyPair --quer
+00007620: 7920 274b 6579 4d61 7465 7269 616c 270a  y 'KeyMaterial'.
+00007630: 2020 2020 2020 2020 2320 2d2d 6f75 7470          # --outp
+00007640: 7574 2074 6578 7420 7c20 6f75 742d 6669  ut text | out-fi
+00007650: 6c65 202d 656e 636f 6469 6e67 2061 7363  le -encoding asc
+00007660: 6969 202d 6669 6c65 7061 7468 204d 794b  ii -filepath MyK
+00007670: 6579 5061 6972 2e70 656d 0a0a 2020 2020  eyPair.pem..    
+00007680: 2020 2020 7072 696e 7428 6622 4372 6561      print(f"Crea
+00007690: 7469 6e67 2041 5753 206b 6579 2070 6169  ting AWS key pai
+000076a0: 7220 7769 7468 206e 616d 6520 7b6b 6579  r with name {key
+000076b0: 5f6e 616d 657d 2061 7420 7061 7468 207b  _name} at path {
+000076c0: 6b65 795f 7061 7468 7d2e 2e22 290a 2020  key_path}..").  
+000076d0: 2020 2020 2020 636d 6420 3d20 6622 6177        cmd = f"aw
+000076e0: 7320 6563 3220 6372 6561 7465 2d6b 6579  s ec2 create-key
+000076f0: 2d70 6169 7220 2d2d 6b65 792d 6e61 6d65  -pair --key-name
+00007700: 207b 6b65 795f 6e61 6d65 7d20 2d2d 7175   {key_name} --qu
+00007710: 6572 7920 274b 6579 4d61 7465 7269 616c  ery 'KeyMaterial
+00007720: 2720 2d2d 6f75 7470 7574 2074 6578 7420  ' --output text 
+00007730: 3e20 7b6b 6579 5f70 6174 687d 220a 2020  > {key_path}".  
+00007740: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00007750: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
+00007760: 732e 6368 6563 6b5f 6361 6c6c 2863 6d64  s.check_call(cmd
+00007770: 2c20 7368 656c 6c3d 5472 7565 2920 2023  , shell=True)  #
+00007780: 206e 6f73 6563 0a20 2020 2020 2020 2020   nosec.         
+00007790: 2020 2073 7562 7072 6f63 6573 732e 6368     subprocess.ch
+000077a0: 6563 6b5f 6361 6c6c 2866 2263 686d 6f64  eck_call(f"chmod
+000077b0: 2034 3030 207b 6b65 795f 7061 7468 7d22   400 {key_path}"
+000077c0: 2c20 7368 656c 6c3d 5472 7565 2920 2023  , shell=True)  #
+000077d0: 206e 6f73 6563 0a20 2020 2020 2020 2065   nosec.        e
+000077e0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+000077f0: 6173 2065 3a20 2023 206e 6f73 6563 0a20  as e:  # nosec. 
+00007800: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00007810: 2866 2246 6169 6c65 6420 746f 2063 7265  (f"Failed to cre
+00007820: 6174 6520 6b65 793a 207b 657d 2229 0a20  ate key: {e}"). 
+00007830: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+00007840: 2e70 6174 682e 6578 6973 7473 286b 6579  .path.exists(key
+00007850: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+00007860: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+00007870: 696f 6e28 6622 4157 5320 6661 696c 6564  ion(f"AWS failed
+00007880: 2074 6f20 6765 6e65 7261 7465 206b 6579   to generate key
+00007890: 2070 6169 7220 6174 3a20 7b6b 6579 5f70   pair at: {key_p
+000078a0: 6174 687d 2229 0a0a 2020 2020 7265 7475  ath}")..    retu
+000078b0: 726e 206b 6579 5f70 6174 680a 0a0a 6465  rn key_path...de
+000078c0: 6620 6765 6e65 7261 7465 5f6b 6579 5f61  f generate_key_a
+000078d0: 745f 7061 7468 286b 6579 5f70 6174 683a  t_path(key_path:
+000078e0: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
+000078f0: 2020 6b65 795f 7061 7468 203d 206f 732e    key_path = os.
+00007900: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+00007910: 6b65 795f 7061 7468 290a 2020 2020 6966  key_path).    if
+00007920: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00007930: 6b65 795f 7061 7468 293a 0a20 2020 2020  key_path):.     
+00007940: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00007950: 6f6e 2866 2243 616e 2774 2067 656e 6572  on(f"Can't gener
+00007960: 6174 6520 6b65 7920 7369 6e63 6520 7061  ate key since pa
+00007970: 7468 2061 6c72 6561 6479 2065 7869 7374  th already exist
+00007980: 732e 207b 6b65 795f 7061 7468 7d22 290a  s. {key_path}").
+00007990: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000079a0: 2020 636d 6420 3d20 6622 7373 682d 6b65    cmd = f"ssh-ke
+000079b0: 7967 656e 202d 4e20 2727 202d 6620 7b6b  ygen -N '' -f {k
+000079c0: 6579 5f70 6174 687d 220a 2020 2020 2020  ey_path}".      
+000079d0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000079e0: 2020 2073 7562 7072 6f63 6573 732e 6368     subprocess.ch
+000079f0: 6563 6b5f 6361 6c6c 2863 6d64 2c20 7368  eck_call(cmd, sh
+00007a00: 656c 6c3d 5472 7565 2920 2023 206e 6f73  ell=True)  # nos
+00007a10: 6563 0a20 2020 2020 2020 2020 2020 2069  ec.            i
+00007a20: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+00007a30: 6973 7473 286b 6579 5f70 6174 6829 3a0a  ists(key_path):.
+00007a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a50: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00007a60: 6622 4661 696c 6564 2074 6f20 6765 6e65  f"Failed to gene
+00007a70: 7261 7465 2073 7368 2d6b 6579 2061 743a  rate ssh-key at:
+00007a80: 207b 6b65 795f 7061 7468 7d22 290a 2020   {key_path}").  
+00007a90: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00007aa0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+00007ab0: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
+00007ac0: 0a0a 2020 2020 7265 7475 726e 206b 6579  ..    return key
+00007ad0: 5f70 6174 680a 0a0a 6465 6620 7661 6c69  _path...def vali
+00007ae0: 6461 7465 5f70 6173 7377 6f72 6428 7061  date_password(pa
+00007af0: 7373 776f 7264 3a20 7374 7229 202d 3e20  ssword: str) -> 
+00007b00: 7374 723a 0a20 2020 2022 2222 5661 6c69  str:.    """Vali
+00007b10: 6461 7465 2069 6620 7468 6520 7061 7373  date if the pass
+00007b20: 776f 7264 2065 6e74 6572 6564 2062 7920  word entered by 
+00007b30: 7468 6520 7573 6572 2069 7320 7661 6c69  the user is vali
+00007b40: 642e 0a0a 2020 2020 5061 7373 776f 7264  d...    Password
+00007b50: 206c 656e 6774 6820 7368 6f75 6c64 2062   length should b
+00007b60: 6520 6265 7477 6565 6e20 3132 202d 2031  e between 12 - 1
+00007b70: 3233 2063 6861 7261 6374 6572 730a 2020  23 characters.  
+00007b80: 2020 5061 7373 776f 7264 7320 6d75 7374    Passwords must
+00007b90: 2061 6c73 6f20 6d65 6574 2033 206f 7574   also meet 3 out
+00007ba0: 206f 6620 7468 6520 666f 6c6c 6f77 696e   of the followin
+00007bb0: 6720 3420 636f 6d70 6c65 7869 7479 2072  g 4 complexity r
+00007bc0: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
+00007bd0: 202d 2048 6176 6520 6c6f 7765 7220 6368   - Have lower ch
+00007be0: 6172 6163 7465 7273 0a20 2020 202d 2048  aracters.    - H
+00007bf0: 6176 6520 7570 7065 7220 6368 6172 6163  ave upper charac
+00007c00: 7465 7273 0a20 2020 202d 2048 6176 6520  ters.    - Have 
+00007c10: 6120 6469 6769 740a 2020 2020 2d20 4861  a digit.    - Ha
+00007c20: 7665 2061 2073 7065 6369 616c 2063 6861  ve a special cha
+00007c30: 7261 6374 6572 0a0a 2020 2020 4172 6773  racter..    Args
+00007c40: 3a0a 2020 2020 2020 2020 7061 7373 776f  :.        passwo
+00007c50: 7264 2028 7374 7229 3a20 7061 7373 776f  rd (str): passwo
+00007c60: 7264 2066 6f72 2074 6865 2076 6d0a 0a20  rd for the vm.. 
+00007c70: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+00007c80: 2020 2020 7374 723a 2070 6173 7377 6f72      str: passwor
+00007c90: 6420 6966 2069 7420 6973 2076 616c 6964  d if it is valid
+00007ca0: 0a20 2020 2022 2222 0a20 2020 2023 2056  .    """.    # V
+00007cb0: 616c 6964 6174 6520 7061 7373 776f 7264  alidate password
+00007cc0: 206c 656e 6774 680a 2020 2020 6966 206c   length.    if l
+00007cd0: 656e 2870 6173 7377 6f72 6429 203c 2031  en(password) < 1
+00007ce0: 3220 6f72 206c 656e 2870 6173 7377 6f72  2 or len(passwor
+00007cf0: 6429 203e 2031 3233 3a0a 2020 2020 2020  d) > 123:.      
+00007d00: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00007d10: 6f72 2822 5061 7373 776f 7264 206c 656e  or("Password len
+00007d20: 6774 6820 7368 6f75 6c64 2062 6520 6265  gth should be be
+00007d30: 7477 6565 6e20 3132 202d 2031 3233 2063  tween 12 - 123 c
+00007d40: 6861 7261 6374 6572 7322 290a 0a20 2020  haracters")..   
+00007d50: 2023 2056 616c 6964 2063 6861 7261 6374   # Valid charact
+00007d60: 6572 2074 7970 6573 0a20 2020 2063 6861  er types.    cha
+00007d70: 7261 6374 6572 5f74 7970 6573 203d 207b  racter_types = {
+00007d80: 0a20 2020 2020 2020 2022 7570 7065 725f  .        "upper_
+00007d90: 6361 7365 223a 2046 616c 7365 2c0a 2020  case": False,.  
+00007da0: 2020 2020 2020 226c 6f77 6572 5f63 6173        "lower_cas
+00007db0: 6522 3a20 4661 6c73 652c 0a20 2020 2020  e": False,.     
+00007dc0: 2020 2022 6469 6769 7422 3a20 4661 6c73     "digit": Fals
+00007dd0: 652c 0a20 2020 2020 2020 2022 7370 6563  e,.        "spec
+00007de0: 6961 6c22 3a20 4661 6c73 652c 0a20 2020  ial": False,.   
+00007df0: 207d 0a0a 2020 2020 666f 7220 6368 2069   }..    for ch i
+00007e00: 6e20 7061 7373 776f 7264 3a0a 2020 2020  n password:.    
+00007e10: 2020 2020 6966 2063 682e 6973 6c6f 7765      if ch.islowe
+00007e20: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+00007e30: 2063 6861 7261 6374 6572 5f74 7970 6573   character_types
+00007e40: 5b22 6c6f 7765 725f 6361 7365 225d 203d  ["lower_case"] =
+00007e50: 2054 7275 650a 2020 2020 2020 2020 656c   True.        el
+00007e60: 6966 2063 682e 6973 7570 7065 7228 293a  if ch.isupper():
+00007e70: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
+00007e80: 7261 6374 6572 5f74 7970 6573 5b22 7570  racter_types["up
+00007e90: 7065 725f 6361 7365 225d 203d 2054 7275  per_case"] = Tru
+00007ea0: 650a 2020 2020 2020 2020 656c 6966 2063  e.        elif c
+00007eb0: 682e 6973 6469 6769 7428 293a 0a20 2020  h.isdigit():.   
+00007ec0: 2020 2020 2020 2020 2063 6861 7261 6374           charact
+00007ed0: 6572 5f74 7970 6573 5b22 6469 6769 7422  er_types["digit"
+00007ee0: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00007ef0: 2065 6c69 6620 6368 2e69 7361 7363 6969   elif ch.isascii
+00007f00: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00007f10: 6368 6172 6163 7465 725f 7479 7065 735b  character_types[
+00007f20: 2273 7065 6369 616c 225d 203d 2054 7275  "special"] = Tru
+00007f30: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+00007f40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00007f50: 6520 5661 6c75 6545 7272 6f72 2866 227b  e ValueError(f"{
+00007f60: 6368 7d20 6973 206e 6f74 2061 2076 616c  ch} is not a val
+00007f70: 6964 2063 6861 7261 6374 6572 2066 6f72  id character for
+00007f80: 2070 6173 7377 6f72 6422 290a 0a20 2020   password")..   
+00007f90: 2023 2056 616c 6964 6174 6520 6368 6172   # Validate char
+00007fa0: 6163 7465 7273 2069 6e20 7468 6520 7061  acters in the pa
+00007fb0: 7373 776f 7264 0a20 2020 2072 6571 7569  ssword.    requi
+00007fc0: 7265 645f 6368 6172 6163 7465 725f 7479  red_character_ty
+00007fd0: 7065 5f63 6f75 6e74 203d 2073 756d 280a  pe_count = sum(.
+00007fe0: 2020 2020 2020 2020 5b69 6e74 2876 616c          [int(val
+00007ff0: 7565 2920 666f 7220 7661 6c75 6520 696e  ue) for value in
+00008000: 2063 6861 7261 6374 6572 5f74 7970 6573   character_types
+00008010: 2e76 616c 7565 7328 295d 0a20 2020 2029  .values()].    )
+00008020: 0a0a 2020 2020 6966 2072 6571 7569 7265  ..    if require
+00008030: 645f 6368 6172 6163 7465 725f 7479 7065  d_character_type
+00008040: 5f63 6f75 6e74 203e 3d20 333a 0a20 2020  _count >= 3:.   
+00008050: 2020 2020 2072 6574 7572 6e20 7061 7373       return pass
+00008060: 776f 7264 0a0a 2020 2020 6162 7365 6e74  word..    absent
+00008070: 5f63 6861 7261 6374 6572 5f74 7970 6573  _character_types
+00008080: 203d 2022 2c20 222e 6a6f 696e 280a 2020   = ", ".join(.  
+00008090: 2020 2020 2020 6368 6172 5f74 7970 6520        char_type 
+000080a0: 666f 7220 6368 6172 5f74 7970 652c 2076  for char_type, v
+000080b0: 616c 7565 2069 6e20 6368 6172 6163 7465  alue in characte
+000080c0: 725f 7479 7065 732e 6974 656d 7328 2920  r_types.items() 
+000080d0: 6966 2076 616c 7565 2069 7320 4661 6c73  if value is Fals
+000080e0: 650a 2020 2020 292e 7374 7269 7028 222c  e.    ).strip(",
+000080f0: 2022 290a 0a20 2020 2072 6169 7365 2056   ")..    raise V
+00008100: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00008110: 2020 2066 2241 7420 6c65 6173 7420 6f6e     f"At least on
+00008120: 6520 7b61 6273 656e 745f 6368 6172 6163  e {absent_charac
+00008130: 7465 725f 7479 7065 737d 2063 6861 7261  ter_types} chara
+00008140: 6374 6572 2074 7970 6573 206d 7573 7420  cter types must 
+00008150: 6265 2070 7265 7365 6e74 220a 2020 2020  be present".    
+00008160: 290a 0a0a 6465 6620 6372 6561 7465 5f6c  )...def create_l
+00008170: 6175 6e63 685f 636d 6428 0a20 2020 2076  aunch_cmd(.    v
+00008180: 6572 623a 2047 7261 6d6d 6172 5665 7262  erb: GrammarVerb
+00008190: 2c0a 2020 2020 6b77 6172 6773 3a20 5479  ,.    kwargs: Ty
+000081a0: 7065 4469 6374 5b73 7472 2c20 416e 795d  peDict[str, Any]
+000081b0: 2c0a 2020 2020 6967 6e6f 7265 5f64 6f63  ,.    ignore_doc
+000081c0: 6b65 725f 7665 7273 696f 6e5f 6368 6563  ker_version_chec
+000081d0: 6b3a 204f 7074 696f 6e61 6c5b 626f 6f6c  k: Optional[bool
+000081e0: 5d20 3d20 4661 6c73 652c 0a29 202d 3e20  ] = False,.) -> 
+000081f0: 556e 696f 6e5b 7374 722c 2054 7970 654c  Union[str, TypeL
+00008200: 6973 745b 7374 725d 2c20 5479 7065 4469  ist[str], TypeDi
+00008210: 6374 5b73 7472 2c20 5479 7065 4c69 7374  ct[str, TypeList
+00008220: 5b73 7472 5d5d 5d3a 0a20 2020 2070 6172  [str]]]:.    par
+00008230: 7365 645f 6b77 6172 6773 3a20 5479 7065  sed_kwargs: Type
+00008240: 4469 6374 5b73 7472 2c20 416e 795d 203d  Dict[str, Any] =
+00008250: 207b 7d0a 2020 2020 686f 7374 5f74 6572   {}.    host_ter
+00008260: 6d20 3d20 7665 7262 2e67 6574 5f6e 616d  m = verb.get_nam
+00008270: 6564 5f74 6572 6d5f 686f 7374 6772 616d  ed_term_hostgram
+00008280: 6d61 7228 6e61 6d65 3d22 686f 7374 2229  mar(name="host")
+00008290: 0a20 2020 2068 6f73 7420 3d20 686f 7374  .    host = host
+000082a0: 5f74 6572 6d2e 686f 7374 0a20 2020 2061  _term.host.    a
+000082b0: 7574 683a 204f 7074 696f 6e61 6c5b 4175  uth: Optional[Au
+000082c0: 7468 4372 6564 656e 7469 616c 735d 203d  thCredentials] =
+000082d0: 204e 6f6e 650a 0a20 2020 2074 6169 6c20   None..    tail 
+000082e0: 3d20 626f 6f6c 286b 7761 7267 735b 2274  = bool(kwargs["t
+000082f0: 6169 6c22 5d29 0a0a 2020 2020 7061 7273  ail"])..    pars
+00008300: 6564 5f6b 7761 7267 7320 3d20 7b7d 0a0a  ed_kwargs = {}..
+00008310: 2020 2020 7061 7273 6564 5f6b 7761 7267      parsed_kwarg
+00008320: 735b 2262 7569 6c64 225d 203d 2062 6f6f  s["build"] = boo
+00008330: 6c28 6b77 6172 6773 5b22 6275 696c 6422  l(kwargs["build"
+00008340: 5d29 0a0a 2020 2020 7061 7273 6564 5f6b  ])..    parsed_k
+00008350: 7761 7267 735b 2275 7365 5f62 6c6f 625f  wargs["use_blob_
+00008360: 7374 6f72 6167 6522 5d20 3d20 6e6f 7420  storage"] = not 
+00008370: 626f 6f6c 286b 7761 7267 735b 226e 6f5f  bool(kwargs["no_
+00008380: 626c 6f62 5f73 746f 7261 6765 225d 290a  blob_storage"]).
+00008390: 0a20 2020 2070 6172 7365 645f 6b77 6172  .    parsed_kwar
+000083a0: 6773 5b22 6e6f 6465 5f63 6f75 6e74 225d  gs["node_count"]
+000083b0: 203d 2028 0a20 2020 2020 2020 2069 6e74   = (.        int
+000083c0: 286b 7761 7267 735b 226e 6f64 655f 636f  (kwargs["node_co
+000083d0: 756e 7422 5d29 2069 6620 226e 6f64 655f  unt"]) if "node_
+000083e0: 636f 756e 7422 2069 6e20 6b77 6172 6773  count" in kwargs
+000083f0: 2065 6c73 6520 310a 2020 2020 290a 0a20   else 1.    ).. 
+00008400: 2020 2069 6620 7061 7273 6564 5f6b 7761     if parsed_kwa
+00008410: 7267 735b 226e 6f64 655f 636f 756e 7422  rgs["node_count"
+00008420: 5d20 3e20 3120 616e 6420 686f 7374 206e  ] > 1 and host n
+00008430: 6f74 2069 6e20 5b22 617a 7572 6522 5d3a  ot in ["azure"]:
+00008440: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+00008450: 5c6e 4172 6775 6d65 6e74 2060 6e6f 6465  \nArgument `node
+00008460: 5f63 6f75 6e74 6020 6973 206f 6e6c 7920  _count` is only 
+00008470: 7375 7070 6f72 7465 6420 7769 7468 2060  supported with `
+00008480: 617a 7572 6560 2e5c 6e22 290a 2020 2020  azure`.\n").    
+00008490: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
+000084a0: 4465 6661 756c 7420 746f 2064 6574 6163  Default to detac
+000084b0: 6865 6420 6d6f 6465 2069 6620 7275 6e6e  hed mode if runn
+000084c0: 696e 6720 6d6f 7265 2074 6861 6e20 6f6e  ing more than on
+000084d0: 6520 6e6f 6465 730a 2020 2020 2020 2020  e nodes.        
+000084e0: 7461 696c 203d 2046 616c 7365 2069 6620  tail = False if 
+000084f0: 7061 7273 6564 5f6b 7761 7267 735b 226e  parsed_kwargs["n
+00008500: 6f64 655f 636f 756e 7422 5d20 3e20 3120  ode_count"] > 1 
+00008510: 656c 7365 2074 6169 6c0a 0a20 2020 2068  else tail..    h
+00008520: 6561 646c 6573 7320 3d20 626f 6f6c 286b  eadless = bool(k
+00008530: 7761 7267 735b 2268 6561 646c 6573 7322  wargs["headless"
+00008540: 5d29 0a20 2020 2070 6172 7365 645f 6b77  ]).    parsed_kw
+00008550: 6172 6773 5b22 6865 6164 6c65 7373 225d  args["headless"]
+00008560: 203d 2068 6561 646c 6573 730a 0a20 2020   = headless..   
+00008570: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
+00008580: 6f62 6c76 225d 203d 2062 6f6f 6c28 6b77  oblv"] = bool(kw
+00008590: 6172 6773 5b22 6f62 6c76 225d 290a 0a20  args["oblv"]).. 
+000085a0: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
+000085b0: 5b22 746c 7322 5d20 3d20 626f 6f6c 286b  ["tls"] = bool(k
+000085c0: 7761 7267 735b 2274 6c73 225d 290a 2020  wargs["tls"]).  
+000085d0: 2020 7061 7273 6564 5f6b 7761 7267 735b    parsed_kwargs[
+000085e0: 2274 6573 7422 5d20 3d20 626f 6f6c 286b  "test"] = bool(k
+000085f0: 7761 7267 735b 2274 6573 7422 5d29 0a20  wargs["test"]). 
+00008600: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
+00008610: 5b22 6465 7622 5d20 3d20 626f 6f6c 286b  ["dev"] = bool(k
+00008620: 7761 7267 735b 2264 6576 225d 290a 0a20  wargs["dev"]).. 
+00008630: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
+00008640: 5b22 7369 6c65 6e74 225d 203d 2062 6f6f  ["silent"] = boo
+00008650: 6c28 6b77 6172 6773 5b22 7369 6c65 6e74  l(kwargs["silent
+00008660: 225d 290a 2020 2020 7061 7273 6564 5f6b  "]).    parsed_k
+00008670: 7761 7267 735b 2266 726f 6d5f 7465 6d70  wargs["from_temp
+00008680: 6c61 7465 225d 203d 2062 6f6f 6c28 6b77  late"] = bool(kw
+00008690: 6172 6773 5b22 6672 6f6d 5f74 656d 706c  args["from_templ
+000086a0: 6174 6522 5d29 0a0a 2020 2020 7061 7273  ate"])..    pars
+000086b0: 6564 5f6b 7761 7267 735b 2274 7261 6365  ed_kwargs["trace
+000086c0: 225d 203d 2046 616c 7365 0a20 2020 2069  "] = False.    i
+000086d0: 6620 2822 7472 6163 6522 206e 6f74 2069  f ("trace" not i
+000086e0: 6e20 6b77 6172 6773 206f 7220 6b77 6172  n kwargs or kwar
+000086f0: 6773 5b22 7472 6163 6522 5d20 6973 204e  gs["trace"] is N
+00008700: 6f6e 6529 2061 6e64 2070 6172 7365 645f  one) and parsed_
+00008710: 6b77 6172 6773 5b22 6465 7622 5d3a 0a20  kwargs["dev"]:. 
+00008720: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
+00008730: 2074 6f20 7472 6163 6520 6f6e 2069 6e20   to trace on in 
+00008740: 6465 7620 6d6f 6465 0a20 2020 2020 2020  dev mode.       
+00008750: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
+00008760: 7472 6163 6522 5d20 3d20 5472 7565 0a20  trace"] = True. 
+00008770: 2020 2065 6c69 6620 2274 7261 6365 2220     elif "trace" 
+00008780: 696e 206b 7761 7267 733a 0a20 2020 2020  in kwargs:.     
+00008790: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
+000087a0: 5b22 7472 6163 6522 5d20 3d20 7374 725f  ["trace"] = str_
+000087b0: 746f 5f62 6f6f 6c28 6361 7374 2873 7472  to_bool(cast(str
+000087c0: 2c20 6b77 6172 6773 5b22 7472 6163 6522  , kwargs["trace"
+000087d0: 5d29 290a 0a20 2020 2070 6172 7365 645f  ]))..    parsed_
+000087e0: 6b77 6172 6773 5b22 7265 6c65 6173 6522  kwargs["release"
+000087f0: 5d20 3d20 2270 726f 6475 6374 696f 6e22  ] = "production"
+00008800: 0a20 2020 2069 6620 2272 656c 6561 7365  .    if "release
+00008810: 2220 696e 206b 7761 7267 7320 616e 6420  " in kwargs and 
+00008820: 6b77 6172 6773 5b22 7265 6c65 6173 6522  kwargs["release"
+00008830: 5d20 213d 2022 7072 6f64 7563 7469 6f6e  ] != "production
+00008840: 223a 0a20 2020 2020 2020 2070 6172 7365  ":.        parse
+00008850: 645f 6b77 6172 6773 5b22 7265 6c65 6173  d_kwargs["releas
+00008860: 6522 5d20 3d20 6b77 6172 6773 5b22 7265  e"] = kwargs["re
+00008870: 6c65 6173 6522 5d0a 0a20 2020 2023 2069  lease"]..    # i
+00008880: 6620 7765 2075 7365 202d 2d64 6576 206f  f we use --dev o
+00008890: 7665 7272 6964 6520 6974 0a20 2020 2069  verride it.    i
+000088a0: 6620 7061 7273 6564 5f6b 7761 7267 735b  f parsed_kwargs[
+000088b0: 2264 6576 225d 2069 7320 5472 7565 3a0a  "dev"] is True:.
+000088c0: 2020 2020 2020 2020 7061 7273 6564 5f6b          parsed_k
+000088d0: 7761 7267 735b 2272 656c 6561 7365 225d  wargs["release"]
+000088e0: 203d 2022 6465 7665 6c6f 706d 656e 7422   = "development"
+000088f0: 0a0a 2020 2020 6966 2022 6365 7274 5f73  ..    if "cert_s
+00008900: 746f 7265 5f70 6174 6822 2069 6e20 6b77  tore_path" in kw
+00008910: 6172 6773 3a0a 2020 2020 2020 2020 7061  args:.        pa
+00008920: 7273 6564 5f6b 7761 7267 735b 2263 6572  rsed_kwargs["cer
+00008930: 745f 7374 6f72 655f 7061 7468 225d 203d  t_store_path"] =
+00008940: 206b 7761 7267 735b 2263 6572 745f 7374   kwargs["cert_st
+00008950: 6f72 655f 7061 7468 225d 0a20 2020 2069  ore_path"].    i
+00008960: 6620 2275 706c 6f61 645f 746c 735f 6365  f "upload_tls_ce
+00008970: 7274 2220 696e 206b 7761 7267 733a 0a20  rt" in kwargs:. 
+00008980: 2020 2020 2020 2070 6172 7365 645f 6b77         parsed_kw
+00008990: 6172 6773 5b22 7570 6c6f 6164 5f74 6c73  args["upload_tls
+000089a0: 5f63 6572 7422 5d20 3d20 6b77 6172 6773  _cert"] = kwargs
+000089b0: 5b22 7570 6c6f 6164 5f74 6c73 5f63 6572  ["upload_tls_cer
+000089c0: 7422 5d0a 2020 2020 6966 2022 7570 6c6f  t"].    if "uplo
+000089d0: 6164 5f74 6c73 5f6b 6579 2220 696e 206b  ad_tls_key" in k
+000089e0: 7761 7267 733a 0a20 2020 2020 2020 2070  wargs:.        p
+000089f0: 6172 7365 645f 6b77 6172 6773 5b22 7570  arsed_kwargs["up
+00008a00: 6c6f 6164 5f74 6c73 5f6b 6579 225d 203d  load_tls_key"] =
+00008a10: 206b 7761 7267 735b 2275 706c 6f61 645f   kwargs["upload_
+00008a20: 746c 735f 6b65 7922 5d0a 0a20 2020 2070  tls_key"]..    p
+00008a30: 6172 7365 645f 6b77 6172 6773 5b22 7072  arsed_kwargs["pr
+00008a40: 6f76 6973 696f 6e22 5d20 3d20 6e6f 7420  ovision"] = not 
+00008a50: 626f 6f6c 286b 7761 7267 735b 226e 6f5f  bool(kwargs["no_
+00008a60: 7072 6f76 6973 696f 6e22 5d29 0a0a 2020  provision"])..  
+00008a70: 2020 6966 2022 696d 6167 655f 6e61 6d65    if "image_name
+00008a80: 2220 696e 206b 7761 7267 7320 616e 6420  " in kwargs and 
+00008a90: 6b77 6172 6773 5b22 696d 6167 655f 6e61  kwargs["image_na
+00008aa0: 6d65 225d 2069 7320 6e6f 7420 4e6f 6e65  me"] is not None
+00008ab0: 3a0a 2020 2020 2020 2020 7061 7273 6564  :.        parsed
+00008ac0: 5f6b 7761 7267 735b 2269 6d61 6765 5f6e  _kwargs["image_n
+00008ad0: 616d 6522 5d20 3d20 6b77 6172 6773 5b22  ame"] = kwargs["
+00008ae0: 696d 6167 655f 6e61 6d65 225d 0a20 2020  image_name"].   
+00008af0: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
+00008b00: 6172 7365 645f 6b77 6172 6773 5b22 696d  arsed_kwargs["im
+00008b10: 6167 655f 6e61 6d65 225d 203d 2022 6465  age_name"] = "de
+00008b20: 6661 756c 7422 0a0a 2020 2020 6966 2022  fault"..    if "
+00008b30: 7461 6722 2069 6e20 6b77 6172 6773 2061  tag" in kwargs a
+00008b40: 6e64 206b 7761 7267 735b 2274 6167 225d  nd kwargs["tag"]
+00008b50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00008b60: 206b 7761 7267 735b 2274 6167 225d 2021   kwargs["tag"] !
+00008b70: 3d20 2222 3a0a 2020 2020 2020 2020 7061  = "":.        pa
+00008b80: 7273 6564 5f6b 7761 7267 735b 2274 6167  rsed_kwargs["tag
+00008b90: 225d 203d 206b 7761 7267 735b 2274 6167  "] = kwargs["tag
+00008ba0: 225d 0a20 2020 2065 6c73 653a 0a20 2020  "].    else:.   
+00008bb0: 2020 2020 2070 6172 7365 645f 6b77 6172       parsed_kwar
+00008bc0: 6773 5b22 7461 6722 5d20 3d20 4e6f 6e65  gs["tag"] = None
+00008bd0: 0a0a 2020 2020 6966 2022 6a75 7079 7465  ..    if "jupyte
+00008be0: 7222 2069 6e20 6b77 6172 6773 2061 6e64  r" in kwargs and
+00008bf0: 206b 7761 7267 735b 226a 7570 7974 6572   kwargs["jupyter
+00008c00: 225d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  "] is not None:.
+00008c10: 2020 2020 2020 2020 7061 7273 6564 5f6b          parsed_k
+00008c20: 7761 7267 735b 226a 7570 7974 6572 225d  wargs["jupyter"]
+00008c30: 203d 2073 7472 5f74 6f5f 626f 6f6c 2863   = str_to_bool(c
+00008c40: 6173 7428 7374 722c 206b 7761 7267 735b  ast(str, kwargs[
+00008c50: 226a 7570 7974 6572 225d 2929 0a20 2020  "jupyter"])).   
+00008c60: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
+00008c70: 6172 7365 645f 6b77 6172 6773 5b22 6a75  arsed_kwargs["ju
+00008c80: 7079 7465 7222 5d20 3d20 4661 6c73 650a  pyter"] = False.
+00008c90: 0a20 2020 2070 6172 7365 645f 6b77 6172  .    parsed_kwar
+00008ca0: 6773 5b22 7670 6e22 5d20 3d20 6e6f 7420  gs["vpn"] = not 
+00008cb0: 626f 6f6c 286b 7761 7267 735b 226e 6f5f  bool(kwargs["no_
+00008cc0: 7670 6e22 5d29 0a0a 2020 2020 2320 616c  vpn"])..    # al
+00008cd0: 6c6f 7773 2063 6861 6e67 696e 6720 646f  lows changing do
+00008ce0: 636b 6572 2070 6c61 7466 6f72 6d20 746f  cker platform to
+00008cf0: 206f 7468 6572 2063 7075 2061 7263 6869   other cpu archi
+00008d00: 7465 6374 7572 6573 206c 696b 6520 6172  tectures like ar
+00008d10: 6d36 340a 2020 2020 7061 7273 6564 5f6b  m64.    parsed_k
+00008d20: 7761 7267 735b 2270 6c61 7466 6f72 6d22  wargs["platform"
+00008d30: 5d20 3d20 6b77 6172 6773 5b22 706c 6174  ] = kwargs["plat
+00008d40: 666f 726d 225d 2069 6620 2270 6c61 7466  form"] if "platf
+00008d50: 6f72 6d22 2069 6e20 6b77 6172 6773 2065  orm" in kwargs e
+00008d60: 6c73 6520 4e6f 6e65 0a0a 2020 2020 7061  lse None..    pa
+00008d70: 7273 6564 5f6b 7761 7267 735b 2274 6169  rsed_kwargs["tai
+00008d80: 6c22 5d20 3d20 7461 696c 0a0a 2020 2020  l"] = tail..    
+00008d90: 7061 7273 6564 5f6b 7761 7267 735b 2273  parsed_kwargs["s
+00008da0: 6574 5f72 6f6f 745f 7061 7373 776f 7264  et_root_password
+00008db0: 225d 203d 2028 0a20 2020 2020 2020 206b  "] = (.        k
+00008dc0: 7761 7267 735b 2273 6574 5f72 6f6f 745f  wargs["set_root_
+00008dd0: 7061 7373 776f 7264 225d 2069 6620 2273  password"] if "s
+00008de0: 6574 5f72 6f6f 745f 7061 7373 776f 7264  et_root_password
+00008df0: 2220 696e 206b 7761 7267 7320 656c 7365  " in kwargs else
+00008e00: 204e 6f6e 650a 2020 2020 290a 0a20 2020   None.    )..   
+00008e10: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
+00008e20: 7365 745f 726f 6f74 5f65 6d61 696c 225d  set_root_email"]
+00008e30: 203d 2028 0a20 2020 2020 2020 206b 7761   = (.        kwa
+00008e40: 7267 735b 2273 6574 5f72 6f6f 745f 656d  rgs["set_root_em
+00008e50: 6169 6c22 5d20 6966 2022 7365 745f 726f  ail"] if "set_ro
+00008e60: 6f74 5f65 6d61 696c 2220 696e 206b 7761  ot_email" in kwa
+00008e70: 7267 7320 656c 7365 204e 6f6e 650a 2020  rgs else None.  
+00008e80: 2020 290a 0a20 2020 2069 6620 7061 7273    )..    if pars
+00008e90: 6564 5f6b 7761 7267 735b 2266 726f 6d5f  ed_kwargs["from_
+00008ea0: 7465 6d70 6c61 7465 225d 2061 6e64 2068  template"] and h
+00008eb0: 6f73 7420 6973 206e 6f74 204e 6f6e 653a  ost is not None:
+00008ec0: 0a20 2020 2020 2020 2023 2053 6574 7570  .        # Setup
+00008ed0: 2074 6865 2066 696c 6573 2066 726f 6d20   the files from 
+00008ee0: 7468 6520 6d61 6e69 6665 7374 5f74 656d  the manifest_tem
+00008ef0: 706c 6174 652e 796d 6c0a 2020 2020 2020  plate.yml.      
+00008f00: 2020 6b77 6172 6773 203d 2073 6574 7570    kwargs = setup
+00008f10: 5f66 726f 6d5f 6d61 6e69 6665 7374 5f74  _from_manifest_t
+00008f20: 656d 706c 6174 6528 686f 7374 5f74 7970  emplate(host_typ
+00008f30: 653d 686f 7374 290a 0a20 2020 2020 2020  e=host)..       
+00008f40: 2023 204f 7665 7272 6964 6520 7465 6d70   # Override temp
+00008f50: 6c61 7465 2074 6167 2077 6974 6820 7573  late tag with us
+00008f60: 6572 2069 6e70 7574 2074 6167 0a20 2020  er input tag.   
+00008f70: 2020 2020 2069 6620 7061 7273 6564 5f6b       if parsed_k
+00008f80: 7761 7267 735b 2274 6167 225d 2069 7320  wargs["tag"] is 
+00008f90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00008fa0: 2020 2020 2020 6b77 6172 6773 2e70 6f70        kwargs.pop
+00008fb0: 2822 7461 6722 290a 0a20 2020 2020 2020  ("tag")..       
+00008fc0: 2070 6172 7365 645f 6b77 6172 6773 2e75   parsed_kwargs.u
+00008fd0: 7064 6174 6528 6b77 6172 6773 290a 0a20  pdate(kwargs).. 
+00008fe0: 2020 2069 6620 686f 7374 2069 6e20 5b22     if host in ["
+00008ff0: 646f 636b 6572 225d 3a0a 2020 2020 2020  docker"]:.      
+00009000: 2020 2320 4368 6563 6b20 646f 636b 6572    # Check docker
+00009010: 2073 6572 7669 6365 2073 7461 7475 730a   service status.
+00009020: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00009030: 676e 6f72 655f 646f 636b 6572 5f76 6572  gnore_docker_ver
+00009040: 7369 6f6e 5f63 6865 636b 3a0a 2020 2020  sion_check:.    
+00009050: 2020 2020 2020 2020 6368 6563 6b5f 646f          check_do
+00009060: 636b 6572 5f73 6572 7669 6365 5f73 7461  cker_service_sta
+00009070: 7475 7328 290a 0a20 2020 2020 2020 2023  tus()..        #
+00009080: 2043 6865 636b 2067 7269 6420 646f 636b   Check grid dock
+00009090: 6572 2076 6572 7369 6f6e 730a 2020 2020  er versions.    
+000090a0: 2020 2020 6966 206e 6f74 2069 676e 6f72      if not ignor
+000090b0: 655f 646f 636b 6572 5f76 6572 7369 6f6e  e_docker_version
+000090c0: 5f63 6865 636b 3a0a 2020 2020 2020 2020  _check:.        
+000090d0: 2020 2020 6368 6563 6b5f 6772 6964 5f64      check_grid_d
+000090e0: 6f63 6b65 7228 6469 7370 6c61 793d 5472  ocker(display=Tr
+000090f0: 7565 2c20 6f75 7470 7574 5f69 6e5f 7465  ue, output_in_te
+00009100: 7874 3d54 7275 6529 0a0a 2020 2020 2020  xt=True)..      
+00009110: 2020 6966 206e 6f74 2069 676e 6f72 655f    if not ignore_
+00009120: 646f 636b 6572 5f76 6572 7369 6f6e 5f63  docker_version_c
+00009130: 6865 636b 3a0a 2020 2020 2020 2020 2020  heck:.          
+00009140: 2020 7665 7273 696f 6e20 3d20 6368 6563    version = chec
+00009150: 6b5f 646f 636b 6572 5f76 6572 7369 6f6e  k_docker_version
+00009160: 2829 0a20 2020 2020 2020 2065 6c73 653a  ().        else:
+00009170: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
+00009180: 7369 6f6e 203d 2022 6e2f 6122 0a0a 2020  sion = "n/a"..  
+00009190: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
+000091a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000091b0: 4966 2074 6865 2075 7365 7220 6973 2075  If the user is u
+000091c0: 7369 6e67 2064 6f63 6b65 7220 6465 736b  sing docker desk
+000091d0: 746f 7020 284f 5358 2f57 696e 646f 7773  top (OSX/Windows
+000091e0: 292c 2063 6865 636b 2074 6f20 6d61 6b65  ), check to make
+000091f0: 2073 7572 6520 7468 6572 6527 7320 656e   sure there's en
+00009200: 6f75 6768 2052 414d 2e0a 2020 2020 2020  ough RAM..      
+00009210: 2020 2020 2020 2320 4966 2074 6865 2075        # If the u
+00009220: 7365 7220 6973 2075 7369 6e67 204c 696e  ser is using Lin
+00009230: 7578 2074 6869 7320 6973 6e27 7420 616e  ux this isn't an
+00009240: 2069 7373 7565 2062 6563 6175 7365 2044   issue because D
+00009250: 6f63 6b65 7220 7363 616c 6573 2074 6f20  ocker scales to 
+00009260: 7468 6520 6176 6169 616c 626c 6520 5241  the avaialble RA
+00009270: 4d2c 0a20 2020 2020 2020 2020 2020 2023  M,.            #
+00009280: 2062 7574 206f 6e20 446f 636b 6572 2044   but on Docker D
+00009290: 6573 6b74 6f70 2069 7420 6465 6661 756c  esktop it defaul
+000092a0: 7473 2074 6f20 3247 4220 7768 6963 6820  ts to 2GB which 
+000092b0: 6973 6e27 7420 656e 6f75 6768 2e0a 2020  isn't enough..  
+000092c0: 2020 2020 2020 2020 2020 6464 5f6d 656d            dd_mem
+000092d0: 6f72 7920 3d20 646f 636b 6572 5f64 6573  ory = docker_des
+000092e0: 6b74 6f70 5f6d 656d 6f72 7928 290a 2020  ktop_memory().  
+000092f0: 2020 2020 2020 2020 2020 6966 2064 645f            if dd_
+00009300: 6d65 6d6f 7279 203c 2038 3139 3220 616e  memory < 8192 an
+00009310: 6420 6464 5f6d 656d 6f72 7920 213d 202d  d dd_memory != -
+00009320: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00009330: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00009340: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00009350: 2020 2020 2020 2020 2259 6f75 2061 7070          "You app
+00009360: 6561 7220 746f 2062 6520 7573 696e 6720  ear to be using 
+00009370: 446f 636b 6572 2044 6573 6b74 6f70 2062  Docker Desktop b
+00009380: 7574 2064 6f6e 2774 2068 6176 6520 220a  ut don't have ".
+00009390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093a0: 2020 2020 2265 6e6f 7567 6820 6d65 6d6f      "enough memo
+000093b0: 7279 2061 6c6c 6f63 6174 6564 2e20 4974  ry allocated. It
+000093c0: 2061 7070 6561 7273 2079 6f75 2776 6520   appears you've 
+000093d0: 636f 6e66 6967 7572 6564 2022 0a20 2020  configured ".   
+000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093f0: 2066 224d 656d 6f72 793a 7b64 645f 6d65   f"Memory:{dd_me
+00009400: 6d6f 7279 7d20 4d42 2077 6865 6e20 3831  mory} MB when 81
+00009410: 3932 4d42 2028 3847 4229 2069 7320 7265  92MB (8GB) is re
+00009420: 7175 6972 6564 2e20 220a 2020 2020 2020  quired. ".      
+00009430: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00009440: 506c 6561 7365 206f 7065 6e20 446f 636b  Please open Dock
+00009450: 6572 2044 6573 6b74 6f70 2050 7265 6665  er Desktop Prefe
+00009460: 7265 6e63 6573 2070 616e 656c 2061 6e64  rences panel and
+00009470: 2073 6574 204d 656d 6f72 7922 0a20 2020   set Memory".   
+00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009490: 2066 2220 746f 2038 4742 206f 7220 6869   f" to 8GB or hi
+000094a0: 6768 6572 2e20 5c6e 5c6e 220a 2020 2020  gher. \n\n".    
+000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094c0: 6622 5c74 4f53 5820 4865 6c70 3a20 6874  f"\tOSX Help: ht
+000094d0: 7470 733a 2f2f 646f 6373 2e64 6f63 6b65  tps://docs.docke
+000094e0: 722e 636f 6d2f 6465 736b 746f 702f 6d61  r.com/desktop/ma
+000094f0: 632f 5c6e 220a 2020 2020 2020 2020 2020  c/\n".          
+00009500: 2020 2020 2020 2020 2020 6622 5c74 5769            f"\tWi
+00009510: 6e64 6f77 7320 4865 6c70 3a20 6874 7470  ndows Help: http
+00009520: 733a 2f2f 646f 6373 2e64 6f63 6b65 722e  s://docs.docker.
+00009530: 636f 6d2f 6465 736b 746f 702f 7769 6e64  com/desktop/wind
+00009540: 6f77 732f 5c6e 5c6e 220a 2020 2020 2020  ows/\n\n".      
+00009550: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00009560: 5468 656e 2072 652d 7275 6e20 796f 7572  Then re-run your
+00009570: 2068 6167 7269 6420 636f 6d6d 616e 642e   hagrid command.
+00009580: 5c6e 5c6e 220a 2020 2020 2020 2020 2020  \n\n".          
+00009590: 2020 2020 2020 2020 2020 6622 4966 2079            f"If y
+000095a0: 6f75 2073 6565 2074 6869 7320 7761 726e  ou see this warn
+000095b0: 696e 6720 6f6e 204c 696e 7578 2074 6865  ing on Linux the
+000095c0: 6e20 736f 6d65 7468 696e 6720 6973 6e27  n something isn'
+000095d0: 7420 7269 6768 742e 2022 0a20 2020 2020  t right. ".     
+000095e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000095f0: 2250 6c65 6173 6520 6669 6c65 2061 2047  "Please file a G
+00009600: 6974 6875 6220 4973 7375 6520 6f6e 2050  ithub Issue on P
+00009610: 7953 7966 7427 7320 4769 7468 7562 2e5c  ySyft's Github.\
+00009620: 6e5c 6e22 0a20 2020 2020 2020 2020 2020  n\n".           
+00009630: 2020 2020 2020 2020 2066 2241 6c74 6572           f"Alter
+00009640: 6e61 7469 7665 6c79 2069 6e20 6361 7365  natively in case
+00009650: 206e 6f20 6d6f 7265 206d 656d 6f72 7920   no more memory 
+00009660: 636f 756c 6420 6265 2061 6c6c 6f63 6174  could be allocat
+00009670: 6564 2c20 220a 2020 2020 2020 2020 2020  ed, ".          
+00009680: 2020 2020 2020 2020 2020 6622 796f 7520            f"you 
+00009690: 6361 6e20 7275 6e20 6861 6772 6964 206f  can run hagrid o
+000096a0: 6e20 7468 6520 636c 6f75 6420 7769 7468  n the cloud with
+000096b0: 2047 6974 506f 6420 6279 2076 6973 6974   GitPod by visit
+000096c0: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
+000096d0: 2020 2020 2020 2020 2020 6622 6874 7470            f"http
+000096e0: 733a 2f2f 6769 7470 6f64 2e69 6f2f 2368  s://gitpod.io/#h
+000096f0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00009700: 6d2f 4f70 656e 4d69 6e65 642f 5079 5379  m/OpenMined/PySy
+00009710: 6674 2e22 0a20 2020 2020 2020 2020 2020  ft.".           
+00009720: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00009730: 2020 2020 6966 2069 735f 7769 6e64 6f77      if is_window
+00009740: 7328 2920 616e 6420 6e6f 7420 4445 5045  s() and not DEPE
+00009750: 4e44 454e 4349 4553 5b22 7773 6c22 5d3a  NDENCIES["wsl"]:
+00009760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009770: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00009780: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009790: 2020 2020 2020 2259 6f75 206d 7573 7420        "You must 
+000097a0: 696e 7374 616c 6c20 7773 6c32 2066 6f72  install wsl2 for
+000097b0: 2057 696e 646f 7773 2074 6f20 7573 6520   Windows to use 
+000097c0: 4841 4772 6964 2e5c 6e22 0a20 2020 2020  HAGrid.\n".     
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000097e0: 496e 2050 6f77 6572 5368 656c 6c20 6f72  In PowerShell or
+000097f0: 2043 6f6d 6d61 6e64 2050 726f 6d70 7420   Command Prompt 
+00009800: 7479 7065 3a5c 6e3e 2077 736c 202d 2d69  type:\n> wsl --i
+00009810: 6e73 7461 6c6c 5c6e 5c6e 220a 2020 2020  nstall\n\n".    
+00009820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009830: 2252 6561 6420 6d6f 7265 2068 6572 653a  "Read more here:
+00009840: 2068 7474 7073 3a2f 2f64 6f63 732e 6d69   https://docs.mi
+00009850: 6372 6f73 6f66 742e 636f 6d2f 656e 2d75  crosoft.com/en-u
+00009860: 732f 7769 6e64 6f77 732f 7773 6c2f 696e  s/windows/wsl/in
+00009870: 7374 616c 6c22 0a20 2020 2020 2020 2020  stall".         
+00009880: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00009890: 2020 2020 2020 7265 7475 726e 2063 7265        return cre
+000098a0: 6174 655f 6c61 756e 6368 5f64 6f63 6b65  ate_launch_docke
+000098b0: 725f 636d 6428 0a20 2020 2020 2020 2020  r_cmd(.         
+000098c0: 2020 2020 2020 2076 6572 623d 7665 7262         verb=verb
 000098d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000098e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000098f0: 2020 2020 6966 2063 7265 6174 655f 6b65      if create_ke
-00009900: 7920 3d3d 2022 7922 3a0a 2020 2020 2020  y == "y":.      
-00009910: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00009920: 795f 7061 7468 203d 2067 656e 6572 6174  y_path = generat
-00009930: 655f 6763 6c6f 7564 5f6b 6579 5f61 745f  e_gcloud_key_at_
-00009940: 7061 7468 286b 6579 5f70 6174 683d 6b65  path(key_path=ke
-00009950: 795f 7061 7468 290a 2020 2020 2020 2020  y_path).        
-00009960: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009980: 2020 7261 6973 6520 5175 6573 7469 6f6e    raise Question
-00009990: 496e 7075 7445 7272 6f72 280a 2020 2020  InputError(.    
-000099a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099b0: 2020 2020 2255 6e61 626c 6520 746f 2063      "Unable to c
-000099c0: 7265 6174 6520 564d 2077 6974 686f 7574  reate VM without
-000099d0: 2061 2070 7269 7661 7465 206b 6579 220a   a private key".
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099f0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00009a00: 2020 2072 6570 6f20 3d20 6173 6b28 0a20     repo = ask(. 
-00009a10: 2020 2020 2020 2020 2020 2020 2020 2051                 Q
-00009a20: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
-00009a30: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00009a40: 5f6e 616d 653d 2267 6370 5f72 6570 6f22  _name="gcp_repo"
-00009a50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009a60: 2020 2020 2020 7175 6573 7469 6f6e 3d22        question="
-00009a70: 5265 706f 2074 6f20 6665 7463 6820 736f  Repo to fetch so
-00009a80: 7572 6365 2066 726f 6d3f 222c 0a20 2020  urce from?",.   
-00009a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009aa0: 2064 6566 6175 6c74 3d61 7267 5f63 6163   default=arg_cac
-00009ab0: 6865 2e67 6370 5f72 6570 6f2c 0a20 2020  he.gcp_repo,.   
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ad0: 206b 696e 643d 2273 7472 696e 6722 2c0a   kind="string",.
-00009ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009af0: 2020 2020 6361 6368 653d 5472 7565 2c0a      cache=True,.
-00009b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00009b20: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
-00009b30: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00009b40: 2020 2020 2020 2020 2020 2020 6272 616e              bran
-00009b50: 6368 203d 2061 736b 280a 2020 2020 2020  ch = ask(.      
-00009b60: 2020 2020 2020 2020 2020 5175 6573 7469            Questi
-00009b70: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00009b80: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
-00009b90: 3d22 6763 705f 6272 616e 6368 222c 0a20  ="gcp_branch",. 
-00009ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bb0: 2020 2071 7565 7374 696f 6e3d 2242 7261     question="Bra
-00009bc0: 6e63 6820 746f 206d 6f6e 6974 6f72 2066  nch to monitor f
-00009bd0: 6f72 2075 7064 6174 6573 3f22 2c0a 2020  or updates?",.  
-00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bf0: 2020 6465 6661 756c 743d 6172 675f 6361    default=arg_ca
-00009c00: 6368 652e 6763 705f 6272 616e 6368 2c0a  che.gcp_branch,.
-00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c20: 2020 2020 6b69 6e64 3d22 7374 7269 6e67      kind="string
-00009c30: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00009c40: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
-00009c50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00009c60: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00009c70: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
-00009c80: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00009c90: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00009ca0: 7573 655f 6272 616e 6368 2862 7261 6e63  use_branch(branc
-00009cb0: 683d 6272 616e 6368 290a 0a20 2020 2020  h=branch)..     
-00009cc0: 2020 2020 2020 2061 7574 6820 3d20 4175         auth = Au
-00009cd0: 7468 4372 6564 656e 7469 616c 7328 7573  thCredentials(us
-00009ce0: 6572 6e61 6d65 3d75 7365 726e 616d 652c  ername=username,
-00009cf0: 206b 6579 5f70 6174 683d 6b65 795f 7061   key_path=key_pa
-00009d00: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
-00009d10: 2072 6574 7572 6e20 6372 6561 7465 5f6c   return create_l
-00009d20: 6175 6e63 685f 6763 705f 636d 6428 0a20  aunch_gcp_cmd(. 
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00009d40: 6572 623d 7665 7262 2c0a 2020 2020 2020  erb=verb,.      
-00009d50: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-00009d60: 745f 6964 3d70 726f 6a65 6374 5f69 642c  t_id=project_id,
-00009d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009d80: 207a 6f6e 653d 7a6f 6e65 2c0a 2020 2020   zone=zone,.    
-00009d90: 2020 2020 2020 2020 2020 2020 6d61 6368              mach
-00009da0: 696e 655f 7479 7065 3d6d 6163 6869 6e65  ine_type=machine
-00009db0: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
-00009dc0: 2020 2020 2020 2072 6570 6f3d 7265 706f         repo=repo
-00009dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009de0: 2020 6175 7468 3d61 7574 682c 0a20 2020    auth=auth,.   
-00009df0: 2020 2020 2020 2020 2020 2020 2062 7261               bra
-00009e00: 6e63 683d 6272 616e 6368 2c0a 2020 2020  nch=branch,.    
-00009e10: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-00009e20: 626c 655f 6578 7472 6173 3d6b 7761 7267  ble_extras=kwarg
-00009e30: 735b 2261 6e73 6962 6c65 5f65 7874 7261  s["ansible_extra
-00009e40: 7322 5d2c 0a20 2020 2020 2020 2020 2020  s"],.           
-00009e50: 2020 2020 206b 7761 7267 733d 7061 7273       kwargs=pars
-00009e60: 6564 5f6b 7761 7267 732c 0a20 2020 2020  ed_kwargs,.     
-00009e70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009e80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00009e90: 2020 2065 7272 6f72 7320 3d20 5b5d 0a20     errors = []. 
-00009ea0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00009eb0: 7420 4445 5045 4e44 454e 4349 4553 5b22  t DEPENDENCIES["
-00009ec0: 616e 7369 626c 652d 706c 6179 626f 6f6b  ansible-playbook
-00009ed0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00009ee0: 2020 2020 6572 726f 7273 2e61 7070 656e      errors.appen
-00009ef0: 6428 2261 6e73 6962 6c65 2d70 6c61 7962  d("ansible-playb
-00009f00: 6f6f 6b22 290a 2020 2020 2020 2020 2020  ook").          
-00009f10: 2020 6d73 6720 3d20 225c 6e45 5252 4f52    msg = "\nERROR
-00009f20: 2121 2120 4d49 5353 494e 4720 4445 5045  !!! MISSING DEPE
-00009f30: 4e44 454e 4359 2121 2122 0a20 2020 2020  NDENCY!!!".     
-00009f40: 2020 2020 2020 206d 7367 202b 3d20 6622         msg += f"
-00009f50: 5c6e 5c6e 4c61 756e 6368 696e 6720 6120  \n\nLaunching a 
-00009f60: 436c 6f75 6420 564d 2072 6571 7569 7265  Cloud VM require
-00009f70: 733a 207b 2720 272e 6a6f 696e 2865 7272  s: {' '.join(err
-00009f80: 6f72 7329 7d22 0a20 2020 2020 2020 2020  ors)}".         
-00009f90: 2020 206d 7367 202b 3d20 225c 6e5c 6e50     msg += "\n\nP
-00009fa0: 6c65 6173 6520 666f 6c6c 6f77 2069 6e73  lease follow ins
-00009fb0: 7461 6c6c 6174 696f 6e20 696e 7374 7275  tallation instru
-00009fc0: 6374 696f 6e73 3a20 220a 2020 2020 2020  ctions: ".      
-00009fd0: 2020 2020 2020 6d73 6720 2b3d 2022 6874        msg += "ht
-00009fe0: 7470 733a 2f2f 646f 6373 2e61 6e73 6962  tps://docs.ansib
-00009ff0: 6c65 2e63 6f6d 2f61 6e73 6962 6c65 2f6c  le.com/ansible/l
-0000a000: 6174 6573 742f 696e 7374 616c 6c61 7469  atest/installati
-0000a010: 6f6e 5f67 7569 6465 2f69 6e74 726f 5f69  on_guide/intro_i
-0000a020: 6e73 7461 6c6c 6174 696f 6e2e 6874 6d6c  nstallation.html
-0000a030: 2322 0a20 2020 2020 2020 2020 2020 206d  #".            m
-0000a040: 7367 202b 3d20 225c 6e5c 6e4e 6f74 653a  sg += "\n\nNote:
-0000a050: 2077 6527 7665 2066 6f75 6e64 2074 6865   we've found the
-0000a060: 2027 636f 6e64 6127 2062 6173 6564 2069   'conda' based i
-0000a070: 6e73 7461 6c6c 6174 696f 6e20 696e 7374  nstallation inst
-0000a080: 7275 6374 696f 6e73 2074 6f20 776f 726b  ructions to work
-0000a090: 2062 6573 7422 0a20 2020 2020 2020 2020   best".         
-0000a0a0: 2020 206d 7367 202b 3d20 2220 2865 2e67     msg += " (e.g
-0000a0b0: 2e20 736f 6d65 7468 696e 6720 6c6b 6520  . something lke 
-0000a0c0: 2763 6f6e 6461 2069 6e73 7461 6c6c 202d  'conda install -
-0000a0d0: 6320 636f 6e64 612d 666f 7267 6520 616e  c conda-forge an
-0000a0e0: 7369 626c 6527 292e 2022 0a20 2020 2020  sible'). ".     
-0000a0f0: 2020 2020 2020 206d 7367 202b 3d20 2254         msg += "T
-0000a100: 6865 2070 6970 2062 6173 6564 2069 6e73  he pip based ins
-0000a110: 7472 7563 7469 6f6e 7320 7365 656d 2074  tructions seem t
-0000a120: 6f20 6265 2061 2062 6974 2062 7567 6779  o be a bit buggy
-0000a130: 2069 6620 796f 7527 7265 2075 7369 6e67   if you're using
-0000a140: 2061 2063 6f6e 6461 2065 6e76 6972 6f6e   a conda environ
-0000a150: 6d65 6e74 220a 2020 2020 2020 2020 2020  ment".          
-0000a160: 2020 6d73 6720 2b3d 2022 5c6e 220a 2020    msg += "\n".  
-0000a170: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000a180: 4d69 7373 696e 6744 6570 656e 6465 6e63  MissingDependenc
-0000a190: 7928 6d73 6729 0a0a 2020 2020 656c 6966  y(msg)..    elif
-0000a1a0: 2068 6f73 7420 696e 205b 2261 7773 225d   host in ["aws"]
-0000a1b0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0000a1c0: 2243 6f6d 696e 6720 736f 6f6e 2e22 290a  "Coming soon.").
-0000a1d0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-0000a1e0: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
-0000a1f0: 2020 2020 6966 2044 4550 454e 4445 4e43      if DEPENDENC
-0000a200: 4945 535b 2261 6e73 6962 6c65 2d70 6c61  IES["ansible-pla
-0000a210: 7962 6f6f 6b22 5d3a 0a20 2020 2020 2020  ybook"]:.       
-0000a220: 2020 2020 2069 6620 686f 7374 2021 3d20       if host != 
-0000a230: 226c 6f63 616c 686f 7374 223a 0a20 2020  "localhost":.   
-0000a240: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000a250: 7365 645f 6b77 6172 6773 5b22 7573 6572  sed_kwargs["user
-0000a260: 6e61 6d65 225d 203d 2061 736b 280a 2020  name"] = ask(.  
-0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a280: 2020 7175 6573 7469 6f6e 3d51 7565 7374    question=Quest
-0000a290: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000a2a0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0000a2b0: 5f6e 616d 653d 2275 7365 726e 616d 6522  _name="username"
-0000a2c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a2d0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-0000a2e0: 6f6e 3d66 2255 7365 726e 616d 6520 666f  on=f"Username fo
-0000a2f0: 7220 7b68 6f73 747d 2077 6974 6820 7375  r {host} with su
-0000a300: 646f 2070 7269 766c 6564 6765 733f 222c  do privledges?",
-0000a310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a320: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0000a330: 3d61 7267 5f63 6163 6865 2e75 7365 726e  =arg_cache.usern
-0000a340: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0000a350: 2020 2020 2020 2020 2020 2020 206b 696e               kin
-0000a360: 643d 2273 7472 696e 6722 2c0a 2020 2020  d="string",.    
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a380: 2020 2020 6361 6368 653d 5472 7565 2c0a      cache=True,.
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-0000a3b0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-0000a3c0: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
-0000a3d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000a3e0: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0000a3f0: 6564 5f6b 7761 7267 735b 2261 7574 685f  ed_kwargs["auth_
-0000a400: 7479 7065 225d 203d 2061 736b 280a 2020  type"] = ask(.  
-0000a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a420: 2020 7175 6573 7469 6f6e 3d51 7565 7374    question=Quest
-0000a430: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000a440: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0000a450: 5f6e 616d 653d 2261 7574 685f 7479 7065  _name="auth_type
-0000a460: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000a470: 2020 2020 2020 2020 2020 2071 7565 7374             quest
-0000a480: 696f 6e3d 2244 6f20 796f 7520 7761 6e74  ion="Do you want
-0000a490: 2074 6f20 6c6f 6769 6e20 7769 7468 2061   to login with a
-0000a4a0: 206b 6579 206f 7220 7061 7373 776f 7264   key or password
-0000a4b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000a4c0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-0000a4d0: 6c74 3d61 7267 5f63 6163 6865 2e61 7574  lt=arg_cache.aut
-0000a4e0: 685f 7479 7065 2c0a 2020 2020 2020 2020  h_type,.        
-0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a500: 6b69 6e64 3d22 6f70 7469 6f6e 222c 0a20  kind="option",. 
-0000a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a520: 2020 2020 2020 206f 7074 696f 6e73 3d5b         options=[
-0000a530: 226b 6579 222c 2022 7061 7373 776f 7264  "key", "password
-0000a540: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0000a550: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-0000a560: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-0000a570: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a590: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
-0000a5a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a5b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000a5c0: 2020 2020 6966 2070 6172 7365 645f 6b77      if parsed_kw
-0000a5d0: 6172 6773 5b22 6175 7468 5f74 7970 6522  args["auth_type"
-0000a5e0: 5d20 3d3d 2022 6b65 7922 3a0a 2020 2020  ] == "key":.    
+000098e0: 2020 646f 636b 6572 5f76 6572 7369 6f6e    docker_version
+000098f0: 3d76 6572 7369 6f6e 2c0a 2020 2020 2020  =version,.      
+00009900: 2020 2020 2020 2020 2020 7461 696c 3d74            tail=t
+00009910: 6169 6c2c 0a20 2020 2020 2020 2020 2020  ail,.           
+00009920: 2020 2020 206b 7761 7267 733d 7061 7273       kwargs=pars
+00009930: 6564 5f6b 7761 7267 732c 0a20 2020 2020  ed_kwargs,.     
+00009940: 2020 2020 2020 2020 2020 2073 696c 656e             silen
+00009950: 743d 7061 7273 6564 5f6b 7761 7267 735b  t=parsed_kwargs[
+00009960: 2273 696c 656e 7422 5d2c 0a20 2020 2020  "silent"],.     
+00009970: 2020 2020 2020 2029 0a0a 2020 2020 656c         )..    el
+00009980: 6966 2068 6f73 7420 696e 205b 2261 7a75  if host in ["azu
+00009990: 7265 225d 3a0a 2020 2020 2020 2020 6368  re"]:.        ch
+000099a0: 6563 6b5f 617a 7572 655f 636c 695f 696e  eck_azure_cli_in
+000099b0: 7374 616c 6c65 6428 290a 0a20 2020 2020  stalled()..     
+000099c0: 2020 2077 6869 6c65 206e 6f74 2063 6865     while not che
+000099d0: 636b 5f61 7a75 7265 5f61 7574 6865 6428  ck_azure_authed(
+000099e0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+000099f0: 7269 6e74 2822 596f 7520 6e65 6564 2074  rint("You need t
+00009a00: 6f20 6c6f 6720 696e 746f 2041 7a75 7265  o log into Azure
+00009a10: 2229 0a20 2020 2020 2020 2020 2020 206c  ").            l
+00009a20: 6f67 696e 5f61 7a75 7265 2829 0a0a 2020  ogin_azure()..  
+00009a30: 2020 2020 2020 6966 2044 4550 454e 4445        if DEPENDE
+00009a40: 4e43 4945 535b 2261 6e73 6962 6c65 2d70  NCIES["ansible-p
+00009a50: 6c61 7962 6f6f 6b22 5d3a 0a20 2020 2020  laybook"]:.     
+00009a60: 2020 2020 2020 2072 6573 6f75 7263 655f         resource_
+00009a70: 6772 6f75 7020 3d20 6173 6b28 0a20 2020  group = ask(.   
+00009a80: 2020 2020 2020 2020 2020 2020 2071 7565               que
+00009a90: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
+00009aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ab0: 2020 2020 7661 725f 6e61 6d65 3d22 617a      var_name="az
+00009ac0: 7572 655f 7265 736f 7572 6365 5f67 726f  ure_resource_gro
+00009ad0: 7570 222c 0a20 2020 2020 2020 2020 2020  up",.           
+00009ae0: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+00009af0: 6e3d 2257 6861 7420 7265 736f 7572 6365  n="What resource
+00009b00: 2067 726f 7570 206e 616d 6520 646f 2079   group name do y
+00009b10: 6f75 2077 616e 7420 746f 2075 7365 2028  ou want to use (
+00009b20: 6f72 2063 7265 6174 6529 3f22 2c0a 2020  or create)?",.  
+00009b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b40: 2020 6465 6661 756c 743d 6172 675f 6361    default=arg_ca
+00009b50: 6368 655b 2261 7a75 7265 5f72 6573 6f75  che["azure_resou
+00009b60: 7263 655f 6772 6f75 7022 5d2c 0a20 2020  rce_group"],.   
+00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b80: 206b 696e 643d 2273 7472 696e 6722 2c0a   kind="string",.
+00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ba0: 2020 2020 6361 6368 653d 5472 7565 2c0a      cache=True,.
+00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bc0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00009bd0: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
+00009be0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00009bf0: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
+00009c00: 6174 696f 6e20 3d20 6173 6b28 0a20 2020  ation = ask(.   
+00009c10: 2020 2020 2020 2020 2020 2020 2071 7565               que
+00009c20: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
+00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c40: 2020 2020 7661 725f 6e61 6d65 3d22 617a      var_name="az
+00009c50: 7572 655f 6c6f 6361 7469 6f6e 222c 0a20  ure_location",. 
+00009c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c70: 2020 2071 7565 7374 696f 6e3d 2249 6620     question="If 
+00009c80: 7468 6973 2069 7320 6120 6e65 7720 7265  this is a new re
+00009c90: 736f 7572 6365 2067 726f 7570 2077 6861  source group wha
+00009ca0: 7420 6c6f 6361 7469 6f6e 3f22 2c0a 2020  t location?",.  
+00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cc0: 2020 6465 6661 756c 743d 6172 675f 6361    default=arg_ca
+00009cd0: 6368 655b 2261 7a75 7265 5f6c 6f63 6174  che["azure_locat
+00009ce0: 696f 6e22 5d2c 0a20 2020 2020 2020 2020  ion"],.         
+00009cf0: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
+00009d00: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
+00009d10: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00009d20: 6368 653d 5472 7565 2c0a 2020 2020 2020  che=True,.      
+00009d30: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00009d40: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+00009d50: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
+00009d60: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00009d70: 2020 2020 2020 2073 697a 6520 3d20 6173         size = as
+00009d80: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+00009d90: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
+00009da0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+00009db0: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
+00009dc0: 6d65 3d22 617a 7572 655f 7369 7a65 222c  me="azure_size",
+00009dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009de0: 2020 2020 2071 7565 7374 696f 6e3d 2257       question="W
+00009df0: 6861 7420 7369 7a65 206d 6163 6869 6e65  hat size machine
+00009e00: 3f22 2c0a 2020 2020 2020 2020 2020 2020  ?",.            
+00009e10: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+00009e20: 6172 675f 6361 6368 655b 2261 7a75 7265  arg_cache["azure
+00009e30: 5f73 697a 6522 5d2c 0a20 2020 2020 2020  _size"],.       
+00009e40: 2020 2020 2020 2020 2020 2020 206b 696e               kin
+00009e50: 643d 2273 7472 696e 6722 2c0a 2020 2020  d="string",.    
+00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e70: 6361 6368 653d 5472 7565 2c0a 2020 2020  cache=True,.    
+00009e80: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00009e90: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00009ea0: 7761 7267 733d 6b77 6172 6773 2c0a 2020  wargs=kwargs,.  
+00009eb0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00009ec0: 2020 2020 2020 2020 2075 7365 726e 616d           usernam
+00009ed0: 6520 3d20 6173 6b28 0a20 2020 2020 2020  e = ask(.       
+00009ee0: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+00009ef0: 6e3d 5175 6573 7469 6f6e 280a 2020 2020  n=Question(.    
+00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f10: 7661 725f 6e61 6d65 3d22 617a 7572 655f  var_name="azure_
+00009f20: 7573 6572 6e61 6d65 222c 0a20 2020 2020  username",.     
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00009f40: 7565 7374 696f 6e3d 2257 6861 7420 646f  uestion="What do
+00009f50: 2079 6f75 2077 616e 7420 7468 6520 7573   you want the us
+00009f60: 6572 6e61 6d65 2066 6f72 2074 6865 2056  ername for the V
+00009f70: 4d20 746f 2062 653f 222c 0a20 2020 2020  M to be?",.     
+00009f80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009f90: 6566 6175 6c74 3d61 7267 5f63 6163 6865  efault=arg_cache
+00009fa0: 5b22 617a 7572 655f 7573 6572 6e61 6d65  ["azure_username
+00009fb0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00009fc0: 2020 2020 2020 2020 6b69 6e64 3d22 7374          kind="st
+00009fd0: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
+00009fe0: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00009ff0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+0000a000: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0000a010: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0000a020: 3d6b 7761 7267 732c 0a20 2020 2020 2020  =kwargs,.       
+0000a030: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000a040: 2020 2020 7061 7273 6564 5f6b 7761 7267      parsed_kwarg
+0000a050: 735b 2261 7574 685f 7479 7065 225d 203d  s["auth_type"] =
+0000a060: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
+0000a070: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
+0000a080: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+0000a090: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000a0a0: 5f6e 616d 653d 2261 7574 685f 7479 7065  _name="auth_type
+0000a0b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000a0c0: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000a0d0: 2244 6f20 796f 7520 7761 6e74 2074 6f20  "Do you want to 
+0000a0e0: 6c6f 6769 6e20 7769 7468 2061 206b 6579  login with a key
+0000a0f0: 206f 7220 7061 7373 776f 7264 222c 0a20   or password",. 
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 2020 2064 6566 6175 6c74 3d61 7267 5f63     default=arg_c
+0000a120: 6163 6865 5b22 6175 7468 5f74 7970 6522  ache["auth_type"
+0000a130: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000a140: 2020 2020 2020 206b 696e 643d 226f 7074         kind="opt
+0000a150: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000a160: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
+0000a170: 733d 5b22 6b65 7922 2c20 2270 6173 7377  s=["key", "passw
+0000a180: 6f72 6422 5d2c 0a20 2020 2020 2020 2020  ord"],.         
+0000a190: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+0000a1a0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+0000a1b0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0000a1c0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0000a1d0: 3d6b 7761 7267 732c 0a20 2020 2020 2020  =kwargs,.       
+0000a1e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000a1f0: 2020 2020 6b65 795f 7061 7468 203d 204e      key_path = N
+0000a200: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000a210: 6966 2070 6172 7365 645f 6b77 6172 6773  if parsed_kwargs
+0000a220: 5b22 6175 7468 5f74 7970 6522 5d20 3d3d  ["auth_type"] ==
+0000a230: 2022 6b65 7922 3a0a 2020 2020 2020 2020   "key":.        
+0000a240: 2020 2020 2020 2020 6b65 795f 7061 7468          key_path
+0000a250: 5f71 7565 7374 696f 6e20 3d20 5175 6573  _question = Ques
+0000a260: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+0000a270: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
+0000a280: 6d65 3d22 617a 7572 655f 6b65 795f 7061  me="azure_key_pa
+0000a290: 7468 222c 0a20 2020 2020 2020 2020 2020  th",.           
+0000a2a0: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+0000a2b0: 6e3d 6622 4162 736f 6c75 7465 2070 6174  n=f"Absolute pat
+0000a2c0: 6820 6f66 2074 6865 2070 7269 7661 7465  h of the private
+0000a2d0: 206b 6579 2074 6f20 6163 6365 7373 207b   key to access {
+0000a2e0: 7573 6572 6e61 6d65 7d40 7b68 6f73 747d  username}@{host}
+0000a2f0: 3f22 2c0a 2020 2020 2020 2020 2020 2020  ?",.            
+0000a300: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+0000a310: 6172 675f 6361 6368 655b 2261 7a75 7265  arg_cache["azure
+0000a320: 5f6b 6579 5f70 6174 6822 5d2c 0a20 2020  _key_path"],.   
+0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a340: 206b 696e 643d 2270 6174 6822 2c0a 2020   kind="path",.  
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a360: 2020 6361 6368 653d 5472 7565 2c0a 2020    cache=True,.  
+0000a370: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a390: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000a3a0: 2020 2020 2020 2020 206b 6579 5f70 6174           key_pat
+0000a3b0: 6820 3d20 6173 6b28 0a20 2020 2020 2020  h = ask(.       
+0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3d0: 206b 6579 5f70 6174 685f 7175 6573 7469   key_path_questi
+0000a3e0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000a3f0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000a400: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
+0000a410: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000a420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a430: 2065 7863 6570 7420 5175 6573 7469 6f6e   except Question
+0000a440: 496e 7075 7450 6174 6845 7272 6f72 2061  InputPathError a
+0000a450: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000a460: 2020 2020 2020 2020 2070 7269 6e74 2865           print(e
+0000a470: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a480: 2020 2020 2020 6b65 795f 7061 7468 203d        key_path =
+0000a490: 2073 7472 2865 292e 7370 6c69 7428 2269   str(e).split("i
+0000a4a0: 7320 6e6f 7420 6120 7661 6c69 6420 7061  s not a valid pa
+0000a4b0: 7468 2229 5b30 5d2e 7374 7269 7028 290a  th")[0].strip().
+0000a4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4d0: 2020 2020 2063 7265 6174 655f 6b65 795f       create_key_
+0000a4e0: 7175 6573 7469 6f6e 203d 2051 7565 7374  question = Quest
+0000a4f0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0000a500: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000a510: 5f6e 616d 653d 2261 7a75 7265 5f6b 6579  _name="azure_key
+0000a520: 5f70 6174 6822 2c0a 2020 2020 2020 2020  _path",.        
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a540: 7175 6573 7469 6f6e 3d66 224b 6579 207b  question=f"Key {
+0000a550: 6b65 795f 7061 7468 7d20 646f 6573 206e  key_path} does n
+0000a560: 6f74 2065 7869 7374 2e20 446f 2079 6f75  ot exist. Do you
+0000a570: 2077 616e 7420 746f 2063 7265 6174 6520   want to create 
+0000a580: 6974 3f20 2879 2f6e 2922 2c0a 2020 2020  it? (y/n)",.    
+0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5a0: 2020 2020 6465 6661 756c 743d 2279 222c      default="y",
+0000a5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a5c0: 2020 2020 2020 2020 206b 696e 643d 2279           kind="y
+0000a5d0: 6573 6e6f 222c 0a20 2020 2020 2020 2020  esno",.         
+0000a5e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
 0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a600: 7061 7273 6564 5f6b 7761 7267 735b 226b  parsed_kwargs["k
-0000a610: 6579 5f70 6174 6822 5d20 3d20 6173 6b28  ey_path"] = ask(
-0000a620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a630: 2020 2020 2020 2020 2071 7565 7374 696f           questio
-0000a640: 6e3d 5175 6573 7469 6f6e 280a 2020 2020  n=Question(.    
-0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a660: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
-0000a670: 3d22 6b65 795f 7061 7468 222c 0a20 2020  ="key_path",.   
+0000a600: 2063 7265 6174 655f 6b65 7920 3d20 6173   create_key = as
+0000a610: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+0000a620: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+0000a630: 655f 6b65 795f 7175 6573 7469 6f6e 2c0a  e_key_question,.
+0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a650: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
+0000a660: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0000a670: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
 0000a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a690: 2020 2020 2020 2020 2071 7565 7374 696f           questio
-0000a6a0: 6e3d 6622 5072 6976 6174 6520 6b65 7920  n=f"Private key 
-0000a6b0: 746f 2061 6363 6573 7320 7b70 6172 7365  to access {parse
-0000a6c0: 645f 6b77 6172 6773 5b27 7573 6572 6e61  d_kwargs['userna
-0000a6d0: 6d65 275d 7d40 7b68 6f73 747d 3f22 2c0a  me']}@{host}?",.
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-0000a700: 756c 743d 6172 675f 6361 6368 652e 6b65  ult=arg_cache.ke
-0000a710: 795f 7061 7468 2c0a 2020 2020 2020 2020  y_path,.        
-0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a730: 2020 2020 6b69 6e64 3d22 7061 7468 222c      kind="path",
-0000a740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a750: 2020 2020 2020 2020 2020 2020 2063 6163               cac
-0000a760: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
-0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a780: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0000a790: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-0000a7a0: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
-0000a7b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000a7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a7d0: 2065 6c69 6620 7061 7273 6564 5f6b 7761   elif parsed_kwa
-0000a7e0: 7267 735b 2261 7574 685f 7479 7065 225d  rgs["auth_type"]
-0000a7f0: 203d 3d20 2270 6173 7377 6f72 6422 3a0a   == "password":.
-0000a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a810: 2020 2020 7061 7273 6564 5f6b 7761 7267      parsed_kwarg
-0000a820: 735b 2270 6173 7377 6f72 6422 5d20 3d20  s["password"] = 
-0000a830: 6173 6b28 0a20 2020 2020 2020 2020 2020  ask(.           
-0000a840: 2020 2020 2020 2020 2020 2020 2071 7565               que
-0000a850: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
-0000a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a870: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-0000a880: 6e61 6d65 3d22 7061 7373 776f 7264 222c  name="password",
-0000a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a8a0: 2020 2020 2020 2020 2020 2020 2071 7565               que
-0000a8b0: 7374 696f 6e3d 6622 5061 7373 776f 7264  stion=f"Password
-0000a8c0: 2066 6f72 207b 7061 7273 6564 5f6b 7761   for {parsed_kwa
-0000a8d0: 7267 735b 2775 7365 726e 616d 6527 5d7d  rgs['username']}
-0000a8e0: 407b 686f 7374 7d3f 222c 0a20 2020 2020  @{host}?",.     
-0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a900: 2020 2020 2020 206b 696e 643d 2270 6173         kind="pas
-0000a910: 7377 6f72 6422 2c0a 2020 2020 2020 2020  sword",.        
+0000a690: 2069 6620 6372 6561 7465 5f6b 6579 203d   if create_key =
+0000a6a0: 3d20 2279 223a 0a20 2020 2020 2020 2020  = "y":.         
+0000a6b0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000a6c0: 6579 5f70 6174 6820 3d20 6765 6e65 7261  ey_path = genera
+0000a6d0: 7465 5f6b 6579 5f61 745f 7061 7468 286b  te_key_at_path(k
+0000a6e0: 6579 5f70 6174 683d 6b65 795f 7061 7468  ey_path=key_path
+0000a6f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a700: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a720: 2020 2020 7261 6973 6520 5175 6573 7469      raise Questi
+0000a730: 6f6e 496e 7075 7445 7272 6f72 280a 2020  onInputError(.  
+0000a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a750: 2020 2020 2020 2020 2020 2255 6e61 626c            "Unabl
+0000a760: 6520 746f 2063 7265 6174 6520 564d 2077  e to create VM w
+0000a770: 6974 686f 7574 2061 2070 7269 7661 7465  ithout a private
+0000a780: 206b 6579 220a 2020 2020 2020 2020 2020   key".          
+0000a790: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000a7a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000a7b0: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
+0000a7c0: 6175 7468 5f74 7970 6522 5d20 3d3d 2022  auth_type"] == "
+0000a7d0: 7061 7373 776f 7264 223a 0a20 2020 2020  password":.     
+0000a7e0: 2020 2020 2020 2020 2020 2061 7574 6f5f             auto_
+0000a7f0: 6765 6e65 7261 7465 5f70 6173 7377 6f72  generate_passwor
+0000a800: 6420 3d20 6173 6b28 0a20 2020 2020 2020  d = ask(.       
+0000a810: 2020 2020 2020 2020 2020 2020 2071 7565               que
+0000a820: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
+0000a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a840: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
+0000a850: 3d22 6175 746f 5f67 656e 6572 6174 655f  ="auto_generate_
+0000a860: 7061 7373 776f 7264 222c 0a20 2020 2020  password",.     
+0000a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a880: 2020 2071 7565 7374 696f 6e3d 2244 6f20     question="Do 
+0000a890: 796f 7520 7761 6e74 2074 6f20 6175 746f  you want to auto
+0000a8a0: 2d67 656e 6572 6174 6520 7468 6520 7061  -generate the pa
+0000a8b0: 7373 776f 7264 3f20 2879 2f6e 2922 2c0a  ssword? (y/n)",.
+0000a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8d0: 2020 2020 2020 2020 6b69 6e64 3d22 7965          kind="ye
+0000a8e0: 736e 6f22 2c0a 2020 2020 2020 2020 2020  sno",.          
+0000a8f0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+0000a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a910: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
 0000a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a930: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000a940: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-0000a950: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
-0000a960: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000a970: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0000a980: 7365 645f 6b77 6172 6773 5b22 7265 706f  sed_kwargs["repo
-0000a990: 225d 203d 2061 736b 280a 2020 2020 2020  "] = ask(.      
-0000a9a0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-0000a9b0: 6f6e 3d51 7565 7374 696f 6e28 0a20 2020  on=Question(.   
-0000a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9d0: 2076 6172 5f6e 616d 653d 2272 6570 6f22   var_name="repo"
-0000a9e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a9f0: 2020 2020 2020 7175 6573 7469 6f6e 3d22        question="
-0000aa00: 5265 706f 2074 6f20 6665 7463 6820 736f  Repo to fetch so
-0000aa10: 7572 6365 2066 726f 6d3f 222c 0a20 2020  urce from?",.   
-0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa30: 2064 6566 6175 6c74 3d61 7267 5f63 6163   default=arg_cac
-0000aa40: 6865 2e72 6570 6f2c 0a20 2020 2020 2020  he.repo,.       
-0000aa50: 2020 2020 2020 2020 2020 2020 206b 696e               kin
-0000aa60: 643d 2273 7472 696e 6722 2c0a 2020 2020  d="string",.    
-0000aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa80: 6361 6368 653d 5472 7565 2c0a 2020 2020  cache=True,.    
-0000aa90: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0000aab0: 7761 7267 733d 6b77 6172 6773 2c0a 2020  wargs=kwargs,.  
-0000aac0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000aad0: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
-0000aae0: 6b77 6172 6773 5b22 6272 616e 6368 225d  kwargs["branch"]
-0000aaf0: 203d 2061 736b 280a 2020 2020 2020 2020   = ask(.        
-0000ab00: 2020 2020 2020 2020 5175 6573 7469 6f6e          Question
-0000ab10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ab20: 2020 2020 2020 7661 725f 6e61 6d65 3d22        var_name="
-0000ab30: 6272 616e 6368 222c 0a20 2020 2020 2020  branch",.       
-0000ab40: 2020 2020 2020 2020 2020 2020 2071 7565               que
-0000ab50: 7374 696f 6e3d 2242 7261 6e63 6820 746f  stion="Branch to
-0000ab60: 206d 6f6e 6974 6f72 2066 6f72 2075 7064   monitor for upd
-0000ab70: 6174 6573 3f22 2c0a 2020 2020 2020 2020  ates?",.        
-0000ab80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-0000ab90: 756c 743d 6172 675f 6361 6368 652e 6272  ult=arg_cache.br
-0000aba0: 616e 6368 2c0a 2020 2020 2020 2020 2020  anch,.          
-0000abb0: 2020 2020 2020 2020 2020 6b69 6e64 3d22            kind="
-0000abc0: 7374 7269 6e67 222c 0a20 2020 2020 2020  string",.       
-0000abd0: 2020 2020 2020 2020 2020 2020 2063 6163               cac
-0000abe0: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
-0000abf0: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-0000ac00: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-0000ac10: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
-0000ac20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000ac30: 2020 2020 2020 6175 7468 203d 204e 6f6e        auth = Non
-0000ac40: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0000ac50: 2068 6f73 7420 213d 2022 6c6f 6361 6c68   host != "localh
-0000ac60: 6f73 7422 3a0a 2020 2020 2020 2020 2020  ost":.          
-0000ac70: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
-0000ac80: 6b77 6172 6773 5b22 6175 7468 5f74 7970  kwargs["auth_typ
-0000ac90: 6522 5d20 3d3d 2022 6b65 7922 3a0a 2020  e"] == "key":.  
-0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acb0: 2020 6175 7468 203d 2041 7574 6843 7265    auth = AuthCre
-0000acc0: 6465 6e74 6961 6c73 280a 2020 2020 2020  dentials(.      
-0000acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ace0: 2020 7573 6572 6e61 6d65 3d70 6172 7365    username=parse
-0000acf0: 645f 6b77 6172 6773 5b22 7573 6572 6e61  d_kwargs["userna
-0000ad00: 6d65 225d 2c0a 2020 2020 2020 2020 2020  me"],.          
-0000ad10: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0000ad20: 795f 7061 7468 3d70 6172 7365 645f 6b77  y_path=parsed_kw
-0000ad30: 6172 6773 5b22 6b65 795f 7061 7468 225d  args["key_path"]
-0000ad40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ad50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ad60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad80: 2020 6175 7468 203d 2041 7574 6843 7265    auth = AuthCre
-0000ad90: 6465 6e74 6961 6c73 280a 2020 2020 2020  dentials(.      
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 2020 7573 6572 6e61 6d65 3d70 6172 7365    username=parse
-0000adc0: 645f 6b77 6172 6773 5b22 7573 6572 6e61  d_kwargs["userna
-0000add0: 6d65 225d 2c0a 2020 2020 2020 2020 2020  me"],.          
-0000ade0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0000adf0: 795f 7061 7468 3d70 6172 7365 645f 6b77  y_path=parsed_kw
-0000ae00: 6172 6773 5b22 7061 7373 776f 7264 225d  args["password"]
-0000ae10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ae20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ae30: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-0000ae40: 7574 682e 7661 6c69 643a 0a20 2020 2020  uth.valid:.     
-0000ae50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ae60: 6169 7365 2045 7863 6570 7469 6f6e 2866  aise Exception(f
-0000ae70: 224c 6f67 696e 2043 7265 6465 6e74 6961  "Login Credentia
-0000ae80: 6c73 2061 7265 206e 6f74 2076 616c 6964  ls are not valid
-0000ae90: 2e20 7b61 7574 687d 2229 0a20 2020 2020  . {auth}").     
-0000aea0: 2020 2020 2020 2070 6172 7365 645f 6b77         parsed_kw
-0000aeb0: 6172 6773 5b22 616e 7369 626c 655f 6578  args["ansible_ex
-0000aec0: 7472 6173 225d 203d 206b 7761 7267 735b  tras"] = kwargs[
-0000aed0: 2261 6e73 6962 6c65 5f65 7874 7261 7322  "ansible_extras"
-0000aee0: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-0000aef0: 7475 726e 2063 7265 6174 655f 6c61 756e  turn create_laun
-0000af00: 6368 5f63 7573 746f 6d5f 636d 6428 7665  ch_custom_cmd(ve
-0000af10: 7262 3d76 6572 622c 2061 7574 683d 6175  rb=verb, auth=au
-0000af20: 7468 2c20 6b77 6172 6773 3d70 6172 7365  th, kwargs=parse
-0000af30: 645f 6b77 6172 6773 290a 2020 2020 2020  d_kwargs).      
-0000af40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000af50: 2020 2020 6572 726f 7273 203d 205b 5d0a      errors = [].
-0000af60: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000af70: 6f74 2044 4550 454e 4445 4e43 4945 535b  ot DEPENDENCIES[
-0000af80: 2261 6e73 6962 6c65 2d70 6c61 7962 6f6f  "ansible-playboo
-0000af90: 6b22 5d3a 0a20 2020 2020 2020 2020 2020  k"]:.           
-0000afa0: 2020 2020 2065 7272 6f72 732e 6170 7065       errors.appe
-0000afb0: 6e64 2822 616e 7369 626c 652d 706c 6179  nd("ansible-play
-0000afc0: 626f 6f6b 2229 0a20 2020 2020 2020 2020  book").         
-0000afd0: 2020 2072 6169 7365 204d 6973 7369 6e67     raise Missing
-0000afe0: 4465 7065 6e64 656e 6379 280a 2020 2020  Dependency(.    
-0000aff0: 2020 2020 2020 2020 2020 2020 6622 4c61              f"La
-0000b000: 756e 6368 696e 6720 6120 4375 7374 6f6d  unching a Custom
-0000b010: 2056 4d20 7265 7175 6972 6573 3a20 7b27   VM requires: {'
-0000b020: 2027 2e6a 6f69 6e28 6572 726f 7273 297d   '.join(errors)}
-0000b030: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0000b040: 0a20 2020 2068 6f73 745f 6f70 7469 6f6e  .    host_option
-0000b050: 7320 3d20 222c 2022 2e6a 6f69 6e28 616c  s = ", ".join(al
-0000b060: 6c6f 7765 645f 686f 7374 7329 0a20 2020  lowed_hosts).   
-0000b070: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
-0000b080: 7065 6e64 656e 6379 280a 2020 2020 2020  pendency(.      
-0000b090: 2020 6622 4c61 756e 6368 2072 6571 7569    f"Launch requi
-0000b0a0: 7265 7320 6120 636f 7272 6563 7420 686f  res a correct ho
-0000b0b0: 7374 206f 7074 696f 6e2c 2074 7279 3a20  st option, try: 
-0000b0c0: 7b68 6f73 745f 6f70 7469 6f6e 737d 220a  {host_options}".
-0000b0d0: 2020 2020 290a 0a0a 6465 6620 6372 6561      )...def crea
-0000b0e0: 7465 5f6c 6175 6e63 685f 646f 636b 6572  te_launch_docker
-0000b0f0: 5f63 6d64 280a 2020 2020 7665 7262 3a20  _cmd(.    verb: 
-0000b100: 4772 616d 6d61 7256 6572 622c 0a20 2020  GrammarVerb,.   
-0000b110: 2064 6f63 6b65 725f 7665 7273 696f 6e3a   docker_version:
-0000b120: 2073 7472 2c0a 2020 2020 6b77 6172 6773   str,.    kwargs
-0000b130: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-0000b140: 416e 795d 2c0a 2020 2020 7461 696c 3a20  Any],.    tail: 
-0000b150: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-0000b160: 2073 696c 656e 743a 2062 6f6f 6c20 3d20   silent: bool = 
-0000b170: 4661 6c73 652c 0a29 202d 3e20 7374 723a  False,.) -> str:
-0000b180: 0a20 2020 2068 6f73 745f 7465 726d 203d  .    host_term =
-0000b190: 2076 6572 622e 6765 745f 6e61 6d65 645f   verb.get_named_
-0000b1a0: 7465 726d 5f68 6f73 7467 7261 6d6d 6172  term_hostgrammar
-0000b1b0: 286e 616d 653d 2268 6f73 7422 290a 2020  (name="host").  
-0000b1c0: 2020 6e6f 6465 5f6e 616d 6520 3d20 7665    node_name = ve
-0000b1d0: 7262 2e67 6574 5f6e 616d 6564 5f74 6572  rb.get_named_ter
-0000b1e0: 6d5f 7479 7065 286e 616d 653d 226e 6f64  m_type(name="nod
-0000b1f0: 655f 6e61 6d65 2229 0a20 2020 206e 6f64  e_name").    nod
-0000b200: 655f 7479 7065 203d 2076 6572 622e 6765  e_type = verb.ge
-0000b210: 745f 6e61 6d65 645f 7465 726d 5f74 7970  t_named_term_typ
-0000b220: 6528 6e61 6d65 3d22 6e6f 6465 5f74 7970  e(name="node_typ
-0000b230: 6522 290a 0a20 2020 2073 6e61 6b65 5f6e  e")..    snake_n
-0000b240: 616d 6520 3d20 7374 7228 6e6f 6465 5f6e  ame = str(node_n
-0000b250: 616d 652e 736e 616b 655f 696e 7075 7429  ame.snake_input)
-0000b260: 0a20 2020 2074 6167 203d 206e 616d 655f  .    tag = name_
-0000b270: 7461 6728 6e61 6d65 3d73 7472 286e 6f64  tag(name=str(nod
-0000b280: 655f 6e61 6d65 2e69 6e70 7574 2929 0a0a  e_name.input))..
-0000b290: 2020 2020 6966 2041 5254 2061 6e64 206e      if ART and n
-0000b2a0: 6f74 2073 696c 656e 743a 0a20 2020 2020  ot silent:.     
-0000b2b0: 2020 2068 6167 7269 6428 290a 0a20 2020     hagrid()..   
-0000b2c0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0000b2d0: 224c 6175 6e63 6869 6e67 2061 2050 7947  "Launching a PyG
-0000b2e0: 7269 6420 220a 2020 2020 2020 2020 2b20  rid ".        + 
-0000b2f0: 7374 7228 6e6f 6465 5f74 7970 652e 696e  str(node_type.in
-0000b300: 7075 7429 2e63 6170 6974 616c 697a 6528  put).capitalize(
-0000b310: 290a 2020 2020 2020 2020 2b20 2220 6e6f  ).        + " no
-0000b320: 6465 206f 6e20 706f 7274 2022 0a20 2020  de on port ".   
-0000b330: 2020 2020 202b 2073 7472 2868 6f73 745f       + str(host_
-0000b340: 7465 726d 2e66 7265 655f 706f 7274 290a  term.free_port).
-0000b350: 2020 2020 2020 2020 2b20 2221 5c6e 220a          + "!\n".
-0000b360: 2020 2020 290a 0a20 2020 2070 7269 6e74      )..    print
-0000b370: 2822 2020 2d20 5459 5045 3a20 2220 2b20  ("  - TYPE: " + 
-0000b380: 7374 7228 6e6f 6465 5f74 7970 652e 696e  str(node_type.in
-0000b390: 7075 7429 290a 2020 2020 7072 696e 7428  put)).    print(
-0000b3a0: 2220 202d 204e 414d 453a 2022 202b 2073  "  - NAME: " + s
-0000b3b0: 7472 2873 6e61 6b65 5f6e 616d 6529 290a  tr(snake_name)).
-0000b3c0: 2020 2020 2320 7072 696e 7428 2220 202d      # print("  -
-0000b3d0: 2054 4147 3a20 2220 2b20 7374 7228 7461   TAG: " + str(ta
-0000b3e0: 6729 290a 2020 2020 7072 696e 7428 2220  g)).    print(" 
-0000b3f0: 202d 2050 4f52 543a 2022 202b 2073 7472   - PORT: " + str
-0000b400: 2868 6f73 745f 7465 726d 2e66 7265 655f  (host_term.free_
-0000b410: 706f 7274 2929 0a20 2020 2070 7269 6e74  port)).    print
-0000b420: 2822 2020 2d20 444f 434b 4552 3a20 2220  ("  - DOCKER: " 
-0000b430: 2b20 646f 636b 6572 5f76 6572 7369 6f6e  + docker_version
-0000b440: 290a 2020 2020 2320 7072 696e 7428 2220  ).    # print(" 
-0000b450: 202d 2054 4149 4c3a 2022 202b 2073 7472   - TAIL: " + str
-0000b460: 2874 6169 6c29 290a 2020 2020 7072 696e  (tail)).    prin
-0000b470: 7428 225c 6e22 290a 0a20 2020 2076 6572  t("\n")..    ver
-0000b480: 7369 6f6e 5f73 7472 696e 6720 3d20 6b77  sion_string = kw
-0000b490: 6172 6773 5b22 7461 6722 5d0a 2020 2020  args["tag"].    
-0000b4a0: 7665 7273 696f 6e5f 6861 7368 203d 2022  version_hash = "
-0000b4b0: 646f 636b 6572 6875 6222 0a20 2020 2062  dockerhub".    b
-0000b4c0: 7569 6c64 203d 206b 7761 7267 735b 2262  uild = kwargs["b
-0000b4d0: 7569 6c64 225d 0a20 2020 2066 726f 6d5f  uild"].    from_
-0000b4e0: 7465 6d70 6c61 7465 203d 206b 7761 7267  template = kwarg
-0000b4f0: 735b 2266 726f 6d5f 7465 6d70 6c61 7465  s["from_template
-0000b500: 225d 0a0a 2020 2020 6966 2022 7265 6c65  "]..    if "rele
-0000b510: 6173 6522 2069 6e20 6b77 6172 6773 2061  ase" in kwargs a
-0000b520: 6e64 206b 7761 7267 735b 2272 656c 6561  nd kwargs["relea
-0000b530: 7365 225d 203d 3d20 2264 6576 656c 6f70  se"] == "develop
-0000b540: 6d65 6e74 223a 0a20 2020 2020 2020 2023  ment":.        #
-0000b550: 2066 6f72 6365 2076 6572 7369 6f6e 2074   force version t
-0000b560: 6f20 6861 7665 202d 6465 7620 6174 2074  o have -dev at t
-0000b570: 6865 2065 6e64 2069 6e20 6465 7620 6d6f  he end in dev mo
-0000b580: 6465 0a20 2020 2020 2020 2023 2064 7572  de.        # dur
-0000b590: 696e 6720 6465 7665 6c6f 706d 656e 7420  ing development 
-0000b5a0: 7765 2063 616e 2075 7365 2074 6865 206c  we can use the l
-0000b5b0: 6174 6573 7420 6265 7461 2076 6572 7369  atest beta versi
-0000b5c0: 6f6e 0a20 2020 2020 2020 2069 6620 7665  on.        if ve
-0000b5d0: 7273 696f 6e5f 7374 7269 6e67 2069 7320  rsion_string is 
-0000b5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000b5f0: 2020 7665 7273 696f 6e5f 7374 7269 6e67    version_string
-0000b600: 203d 2047 5249 445f 5352 435f 5645 5253   = GRID_SRC_VERS
-0000b610: 494f 4e5b 305d 0a20 2020 2020 2020 2076  ION[0].        v
-0000b620: 6572 7369 6f6e 5f73 7472 696e 6720 2b3d  ersion_string +=
-0000b630: 2022 2d64 6576 220a 2020 2020 2020 2020   "-dev".        
-0000b640: 7665 7273 696f 6e5f 6861 7368 203d 2047  version_hash = G
-0000b650: 5249 445f 5352 435f 5645 5253 494f 4e5b  RID_SRC_VERSION[
-0000b660: 315d 0a20 2020 2020 2020 2069 6620 6275  1].        if bu
-0000b670: 696c 6420 6973 204e 6f6e 653a 0a20 2020  ild is None:.   
-0000b680: 2020 2020 2020 2020 2062 7569 6c64 203d           build =
-0000b690: 2054 7275 650a 2020 2020 656c 7365 3a0a   True.    else:.
-0000b6a0: 2020 2020 2020 2020 6966 2062 7569 6c64          if build
-0000b6b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000b6c0: 2020 2020 2020 6275 696c 6420 3d20 4661        build = Fa
-0000b6d0: 6c73 650a 0a20 2020 2020 2020 2023 2064  lse..        # d
-0000b6e0: 7572 696e 6720 7072 6f64 7563 7469 6f6e  uring production
-0000b6f0: 2074 6865 2064 6566 6175 6c74 2077 6f75   the default wou
-0000b700: 6c64 2062 6520 7374 6162 6c65 0a20 2020  ld be stable.   
-0000b710: 2020 2020 2069 6620 7665 7273 696f 6e5f       if version_
-0000b720: 7374 7269 6e67 203d 3d20 226c 6f63 616c  string == "local
-0000b730: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
-0000b740: 2074 6869 7320 6361 6e20 6265 2075 7365   this can be use
-0000b750: 6420 696e 2056 4d73 2069 6e20 7072 6f64  d in VMs in prod
-0000b760: 7563 7469 6f6e 2074 6f20 6175 746f 2075  uction to auto u
-0000b770: 7064 6174 6520 6672 6f6d 2073 7263 0a20  pdate from src. 
-0000b780: 2020 2020 2020 2020 2020 2076 6572 7369             versi
-0000b790: 6f6e 5f73 7472 696e 6720 3d20 4752 4944  on_string = GRID
-0000b7a0: 5f53 5243 5f56 4552 5349 4f4e 5b30 5d0a  _SRC_VERSION[0].
-0000b7b0: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-0000b7c0: 696f 6e5f 6861 7368 203d 2047 5249 445f  ion_hash = GRID_
-0000b7d0: 5352 435f 5645 5253 494f 4e5b 315d 0a20  SRC_VERSION[1]. 
-0000b7e0: 2020 2020 2020 2020 2020 2062 7569 6c64             build
-0000b7f0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0000b800: 656c 6966 2076 6572 7369 6f6e 5f73 7472  elif version_str
-0000b810: 696e 6720 6973 204e 6f6e 653a 0a20 2020  ing is None:.   
-0000b820: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
-0000b830: 5f73 7472 696e 6720 3d20 2273 7461 626c  _string = "stabl
-0000b840: 6522 0a0a 2020 2020 7573 655f 626c 6f62  e"..    use_blob
-0000b850: 5f73 746f 7261 6765 203d 2022 5472 7565  _storage = "True
-0000b860: 220a 2020 2020 6966 2073 7472 286e 6f64  ".    if str(nod
-0000b870: 655f 7479 7065 2e69 6e70 7574 2920 3d3d  e_type.input) ==
-0000b880: 2022 6e65 7477 6f72 6b22 3a0a 2020 2020   "network":.    
-0000b890: 2020 2020 7573 655f 626c 6f62 5f73 746f      use_blob_sto
-0000b8a0: 7261 6765 203d 2022 4661 6c73 6522 0a20  rage = "False". 
-0000b8b0: 2020 2065 6c69 6620 2275 7365 5f62 6c6f     elif "use_blo
-0000b8c0: 625f 7374 6f72 6167 6522 2069 6e20 6b77  b_storage" in kw
-0000b8d0: 6172 6773 2061 6e64 206b 7761 7267 735b  args and kwargs[
-0000b8e0: 2275 7365 5f62 6c6f 625f 7374 6f72 6167  "use_blob_storag
-0000b8f0: 6522 5d20 6973 206e 6f74 204e 6f6e 653a  e"] is not None:
-0000b900: 0a20 2020 2020 2020 2075 7365 5f62 6c6f  .        use_blo
-0000b910: 625f 7374 6f72 6167 6520 3d20 7374 7228  b_storage = str(
-0000b920: 7374 725f 746f 5f62 6f6f 6c28 6b77 6172  str_to_bool(kwar
-0000b930: 6773 5b22 7573 655f 626c 6f62 5f73 746f  gs["use_blob_sto
-0000b940: 7261 6765 225d 2929 0a0a 2020 2020 656e  rage"]))..    en
-0000b950: 7673 203d 207b 0a20 2020 2020 2020 2022  vs = {.        "
-0000b960: 5245 4c45 4153 4522 3a20 2270 726f 6475  RELEASE": "produ
-0000b970: 6374 696f 6e22 2c0a 2020 2020 2020 2020  ction",.        
-0000b980: 2243 4f4d 504f 5345 5f44 4f43 4b45 525f  "COMPOSE_DOCKER_
-0000b990: 434c 495f 4255 494c 4422 3a20 312c 0a20  CLI_BUILD": 1,. 
-0000b9a0: 2020 2020 2020 2022 444f 434b 4552 5f42         "DOCKER_B
-0000b9b0: 5549 4c44 4b49 5422 3a20 312c 0a20 2020  UILDKIT": 1,.   
-0000b9c0: 2020 2020 2022 4854 5450 5f50 4f52 5422       "HTTP_PORT"
-0000b9d0: 3a20 696e 7428 686f 7374 5f74 6572 6d2e  : int(host_term.
-0000b9e0: 6672 6565 5f70 6f72 7429 2c0a 2020 2020  free_port),.    
-0000b9f0: 2020 2020 2248 5454 5053 5f50 4f52 5422      "HTTPS_PORT"
-0000ba00: 3a20 696e 7428 686f 7374 5f74 6572 6d2e  : int(host_term.
-0000ba10: 6672 6565 5f70 6f72 745f 746c 7329 2c0a  free_port_tls),.
-0000ba20: 2020 2020 2020 2020 2254 5241 4546 494b          "TRAEFIK
-0000ba30: 5f54 4147 223a 2073 7472 2874 6167 292c  _TAG": str(tag),
-0000ba40: 0a20 2020 2020 2020 2022 444f 4d41 494e  .        "DOMAIN
-0000ba50: 5f4e 414d 4522 3a20 7374 7228 736e 616b  _NAME": str(snak
-0000ba60: 655f 6e61 6d65 292c 0a20 2020 2020 2020  e_name),.       
-0000ba70: 2022 4e4f 4445 5f54 5950 4522 3a20 7374   "NODE_TYPE": st
-0000ba80: 7228 6e6f 6465 5f74 7970 652e 696e 7075  r(node_type.inpu
-0000ba90: 7429 2c0a 2020 2020 2020 2020 2254 5241  t),.        "TRA
-0000baa0: 4546 494b 5f50 5542 4c49 435f 4e45 5457  EFIK_PUBLIC_NETW
-0000bab0: 4f52 4b5f 4953 5f45 5854 4552 4e41 4c22  ORK_IS_EXTERNAL"
-0000bac0: 3a20 2246 616c 7365 222c 0a20 2020 2020  : "False",.     
-0000bad0: 2020 2022 5645 5253 494f 4e22 3a20 7665     "VERSION": ve
-0000bae0: 7273 696f 6e5f 7374 7269 6e67 2c0a 2020  rsion_string,.  
-0000baf0: 2020 2020 2020 2256 4552 5349 4f4e 5f48        "VERSION_H
-0000bb00: 4153 4822 3a20 7665 7273 696f 6e5f 6861  ASH": version_ha
-0000bb10: 7368 2c0a 2020 2020 2020 2020 2255 5345  sh,.        "USE
-0000bb20: 5f42 4c4f 425f 5354 4f52 4147 4522 3a20  _BLOB_STORAGE": 
-0000bb30: 7573 655f 626c 6f62 5f73 746f 7261 6765  use_blob_storage
-0000bb40: 2c0a 2020 2020 2020 2020 2253 5441 434b  ,.        "STACK
-0000bb50: 5f41 5049 5f4b 4559 223a 2073 7472 280a  _API_KEY": str(.
-0000bb60: 2020 2020 2020 2020 2020 2020 6765 6e65              gene
-0000bb70: 7261 7465 5f73 6563 5f72 616e 646f 6d5f  rate_sec_random_
-0000bb80: 7061 7373 776f 7264 286c 656e 6774 683d  password(length=
-0000bb90: 3438 2c20 7370 6563 6961 6c5f 6368 6172  48, special_char
-0000bba0: 733d 4661 6c73 6529 0a20 2020 2020 2020  s=False).       
-0000bbb0: 2029 2c0a 2020 2020 7d0a 0a20 2020 2069   ),.    }..    i
-0000bbc0: 6620 2270 6c61 7466 6f72 6d22 2069 6e20  f "platform" in 
-0000bbd0: 6b77 6172 6773 2061 6e64 206b 7761 7267  kwargs and kwarg
-0000bbe0: 735b 2270 6c61 7466 6f72 6d22 5d20 6973  s["platform"] is
-0000bbf0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000bc00: 2020 2065 6e76 735b 2244 4f43 4b45 525f     envs["DOCKER_
-0000bc10: 4445 4641 554c 545f 504c 4154 464f 524d  DEFAULT_PLATFORM
-0000bc20: 225d 203d 206b 7761 7267 735b 2270 6c61  "] = kwargs["pla
-0000bc30: 7466 6f72 6d22 5d0a 0a20 2020 2069 6620  tform"]..    if 
-0000bc40: 2274 6c73 2220 696e 206b 7761 7267 7320  "tls" in kwargs 
-0000bc50: 616e 6420 6b77 6172 6773 5b22 746c 7322  and kwargs["tls"
-0000bc60: 5d20 6973 2054 7275 6520 616e 6420 6c65  ] is True and le
-0000bc70: 6e28 6b77 6172 6773 5b22 6365 7274 5f73  n(kwargs["cert_s
-0000bc80: 746f 7265 5f70 6174 6822 5d29 203e 2030  tore_path"]) > 0
-0000bc90: 3a0a 2020 2020 2020 2020 656e 7673 5b22  :.        envs["
-0000bca0: 5452 4145 4649 4b5f 544c 535f 4345 5254  TRAEFIK_TLS_CERT
-0000bcb0: 5322 5d20 3d20 6b77 6172 6773 5b22 6365  S"] = kwargs["ce
-0000bcc0: 7274 5f73 746f 7265 5f70 6174 6822 5d0a  rt_store_path"].
-0000bcd0: 0a20 2020 2069 6620 280a 2020 2020 2020  .    if (.      
-0000bce0: 2020 2274 6c73 2220 696e 206b 7761 7267    "tls" in kwarg
-0000bcf0: 730a 2020 2020 2020 2020 616e 6420 6b77  s.        and kw
-0000bd00: 6172 6773 5b22 746c 7322 5d20 6973 2054  args["tls"] is T
-0000bd10: 7275 650a 2020 2020 2020 2020 616e 6420  rue.        and 
-0000bd20: 2274 6573 7422 2069 6e20 6b77 6172 6773  "test" in kwargs
-0000bd30: 0a20 2020 2020 2020 2061 6e64 206b 7761  .        and kwa
-0000bd40: 7267 735b 2274 6573 7422 5d20 6973 2054  rgs["test"] is T
-0000bd50: 7275 650a 2020 2020 293a 0a20 2020 2020  rue.    ):.     
-0000bd60: 2020 2065 6e76 735b 2249 474e 4f52 455f     envs["IGNORE_
-0000bd70: 544c 535f 4552 524f 5253 225d 203d 2022  TLS_ERRORS"] = "
-0000bd80: 5472 7565 220a 0a20 2020 2069 6620 2274  True"..    if "t
-0000bd90: 6573 7422 2069 6e20 6b77 6172 6773 2061  est" in kwargs a
-0000bda0: 6e64 206b 7761 7267 735b 2274 6573 7422  nd kwargs["test"
-0000bdb0: 5d20 6973 2054 7275 653a 0a20 2020 2020  ] is True:.     
-0000bdc0: 2020 2065 6e76 735b 2253 335f 564f 4c55     envs["S3_VOLU
-0000bdd0: 4d45 5f53 495a 455f 4d42 225d 203d 2022  ME_SIZE_MB"] = "
-0000bde0: 3130 3022 2020 2320 4769 7448 7562 2043  100"  # GitHub C
-0000bdf0: 4920 6973 2073 6d61 6c6c 0a0a 2020 2020  I is small..    
-0000be00: 6966 2022 7265 6c65 6173 6522 2069 6e20  if "release" in 
-0000be10: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
-0000be20: 656e 7673 5b22 5245 4c45 4153 4522 5d20  envs["RELEASE"] 
-0000be30: 3d20 6b77 6172 6773 5b22 7265 6c65 6173  = kwargs["releas
-0000be40: 6522 5d0a 0a20 2020 2063 6d64 203d 2022  e"]..    cmd = "
-0000be50: 220a 2020 2020 6172 6773 203d 205b 5d0a  ".    args = [].
-0000be60: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-0000be70: 656e 7673 2e69 7465 6d73 2829 3a0a 2020  envs.items():.  
-0000be80: 2020 2020 2020 6966 2069 735f 7769 6e64        if is_wind
-0000be90: 6f77 7328 293a 0a20 2020 2020 2020 2020  ows():.         
-0000bea0: 2020 2023 2070 6f77 6572 7368 656c 6c20     # powershell 
-0000beb0: 656e 7673 0a20 2020 2020 2020 2020 2020  envs.           
-0000bec0: 2071 756f 7465 6420 3d20 6622 277b 767d   quoted = f"'{v}
-0000bed0: 2722 2069 6620 6e6f 7420 6973 696e 7374  '" if not isinst
-0000bee0: 616e 6365 2876 2c20 696e 7429 2065 6c73  ance(v, int) els
-0000bef0: 6520 760a 2020 2020 2020 2020 2020 2020  e v.            
-0000bf00: 6172 6773 2e61 7070 656e 6428 6622 2465  args.append(f"$e
-0000bf10: 6e76 3a7b 6b7d 3d7b 7175 6f74 6564 7d22  nv:{k}={quoted}"
-0000bf20: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000bf30: 2020 2020 2020 2020 2020 2020 6172 6773              args
-0000bf40: 2e61 7070 656e 6428 6622 7b6b 7d3d 7b76  .append(f"{k}={v
-0000bf50: 7d22 290a 2020 2020 6966 2069 735f 7769  }").    if is_wi
-0000bf60: 6e64 6f77 7328 293a 0a20 2020 2020 2020  ndows():.       
-0000bf70: 2063 6d64 202b 3d20 223b 2022 2e6a 6f69   cmd += "; ".joi
-0000bf80: 6e28 6172 6773 290a 2020 2020 2020 2020  n(args).        
-0000bf90: 636d 6420 2b3d 2022 3b20 220a 2020 2020  cmd += "; ".    
-0000bfa0: 656c 7365 3a0a 2020 2020 2020 2020 636d  else:.        cm
-0000bfb0: 6420 2b3d 2022 2022 2e6a 6f69 6e28 6172  d += " ".join(ar
-0000bfc0: 6773 290a 0a20 2020 2069 6620 6e6f 7420  gs)..    if not 
-0000bfd0: 6275 696c 643a 0a20 2020 2020 2020 2070  build:.        p
-0000bfe0: 756c 6c5f 636d 6420 3d20 7374 7228 636d  ull_cmd = str(cm
-0000bff0: 6429 0a20 2020 2020 2020 2070 756c 6c5f  d).        pull_
-0000c000: 636d 6420 2b3d 2022 2064 6f63 6b65 7220  cmd += " docker 
-0000c010: 636f 6d70 6f73 6520 7075 6c6c 220a 0a20  compose pull".. 
-0000c020: 2020 2063 6d64 202b 3d20 2220 646f 636b     cmd += " dock
-0000c030: 6572 2063 6f6d 706f 7365 202d 7020 2220  er compose -p " 
-0000c040: 2b20 736e 616b 655f 6e61 6d65 0a0a 2020  + snake_name..  
-0000c050: 2020 6966 2022 7670 6e22 2069 6e20 6b77    if "vpn" in kw
-0000c060: 6172 6773 2061 6e64 206b 7761 7267 735b  args and kwargs[
-0000c070: 2276 706e 225d 3a0a 2020 2020 2020 2020  "vpn"]:.        
-0000c080: 636d 6420 2b3d 2022 202d 2d70 726f 6669  cmd += " --profi
-0000c090: 6c65 2076 706e 220a 0a20 2020 2069 6620  le vpn"..    if 
-0000c0a0: 7374 7228 6e6f 6465 5f74 7970 652e 696e  str(node_type.in
-0000c0b0: 7075 7429 203d 3d20 226e 6574 776f 726b  put) == "network
-0000c0c0: 223a 0a20 2020 2020 2020 2063 6d64 202b  ":.        cmd +
-0000c0d0: 3d20 2220 2d2d 7072 6f66 696c 6520 6e65  = " --profile ne
-0000c0e0: 7477 6f72 6b22 0a20 2020 2065 6c73 653a  twork".    else:
-0000c0f0: 0a20 2020 2020 2020 2063 6d64 202b 3d20  .        cmd += 
-0000c100: 2220 2d2d 7072 6f66 696c 6520 626c 6f62  " --profile blob
-0000c110: 2d73 746f 7261 6765 220a 0a20 2020 2023  -storage"..    #
-0000c120: 206e 6574 776f 726b 2066 726f 6e74 656e   network fronten
-0000c130: 6420 6469 7361 626c 6564 0a20 2020 2069  d disabled.    i
-0000c140: 6620 7374 7228 6e6f 6465 5f74 7970 652e  f str(node_type.
-0000c150: 696e 7075 7429 2021 3d20 226e 6574 776f  input) != "netwo
-0000c160: 726b 2220 616e 6420 6b77 6172 6773 5b22  rk" and kwargs["
-0000c170: 6865 6164 6c65 7373 225d 2069 7320 4661  headless"] is Fa
-0000c180: 6c73 653a 0a20 2020 2020 2020 2063 6d64  lse:.        cmd
-0000c190: 202b 3d20 2220 2d2d 7072 6f66 696c 6520   += " --profile 
-0000c1a0: 6672 6f6e 7465 6e64 220a 0a20 2020 2023  frontend"..    #
-0000c1b0: 206e 6577 2064 6f63 6b65 7220 636f 6d70   new docker comp
-0000c1c0: 6f73 6520 7265 6772 6573 7369 6f6e 2077  ose regression w
-0000c1d0: 6f72 6b20 6172 6f75 6e64 0a20 2020 2023  ork around.    #
-0000c1e0: 2064 6566 6175 6c74 5f65 6e76 203d 206f   default_env = o
-0000c1f0: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-0000c200: 7228 227e 2f2e 6861 6772 6964 2f61 7070  r("~/.hagrid/app
-0000c210: 2f2e 656e 7622 290a 2020 2020 6465 6661  /.env").    defa
-0000c220: 756c 745f 656e 7620 3d20 6622 7b47 5249  ult_env = f"{GRI
-0000c230: 445f 5352 435f 5041 5448 7d2f 2e65 6e76  D_SRC_PATH}/.env
-0000c240: 220a 2020 2020 6465 6661 756c 745f 656e  ".    default_en
-0000c250: 7673 203d 207b 7d0a 2020 2020 7769 7468  vs = {}.    with
-0000c260: 206f 7065 6e28 6465 6661 756c 745f 656e   open(default_en
-0000c270: 762c 2022 7222 2920 6173 2066 3a0a 2020  v, "r") as f:.  
-0000c280: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-0000c290: 6e20 662e 7265 6164 6c69 6e65 7328 293a  n f.readlines():
-0000c2a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c2b0: 223d 2220 696e 206c 696e 653a 0a20 2020  "=" in line:.   
-0000c2c0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000c2d0: 7473 203d 206c 696e 652e 7374 7269 7028  ts = line.strip(
-0000c2e0: 292e 7370 6c69 7428 223d 2229 0a20 2020  ).split("=").   
-0000c2f0: 2020 2020 2020 2020 2020 2020 206b 6579               key
-0000c300: 203d 2070 6172 7473 5b30 5d0a 2020 2020   = parts[0].    
-0000c310: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0000c320: 6520 3d20 2222 0a20 2020 2020 2020 2020  e = "".         
-0000c330: 2020 2020 2020 2069 6620 6c65 6e28 7061         if len(pa
-0000c340: 7274 7329 203e 2031 3a0a 2020 2020 2020  rts) > 1:.      
-0000c350: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0000c360: 6c75 6520 3d20 7061 7274 735b 315d 0a20  lue = parts[1]. 
-0000c370: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000c380: 6566 6175 6c74 5f65 6e76 735b 6b65 795d  efault_envs[key]
-0000c390: 203d 2076 616c 7565 0a20 2020 2064 6566   = value.    def
-0000c3a0: 6175 6c74 5f65 6e76 732e 7570 6461 7465  ault_envs.update
-0000c3b0: 2865 6e76 7329 0a0a 2020 2020 2320 656e  (envs)..    # en
-0000c3c0: 7620 6669 6c65 2070 6174 680a 2020 2020  v file path.    
-0000c3d0: 656e 765f 6669 6c65 5f70 6174 6820 3d20  env_file_path = 
-0000c3e0: 6f73 2e70 6174 682e 6a6f 696e 2847 5249  os.path.join(GRI
-0000c3f0: 445f 5352 435f 5041 5448 2c20 222e 656e  D_SRC_PATH, ".en
-0000c400: 7666 696c 6522 290a 0a20 2020 2023 2052  vfile")..    # R
-0000c410: 656e 6465 7220 7465 6d70 6c61 7465 7320  ender templates 
-0000c420: 6966 2063 7265 6174 696e 6720 7374 6163  if creating stac
-0000c430: 6b20 6672 6f6d 2074 6865 206d 616e 6966  k from the manif
-0000c440: 6573 745f 7465 6d70 6c61 7465 2e79 6d6c  est_template.yml
-0000c450: 0a20 2020 2069 6620 6672 6f6d 5f74 656d  .    if from_tem
-0000c460: 706c 6174 6520 616e 6420 686f 7374 5f74  plate and host_t
-0000c470: 6572 6d2e 686f 7374 2069 7320 6e6f 7420  erm.host is not 
-0000c480: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
-0000c490: 4966 2072 656c 6561 7365 2069 7320 6465  If release is de
-0000c4a0: 7665 6c6f 706d 656e 742c 2075 7064 6174  velopment, updat
-0000c4b0: 6520 7265 6c61 7469 7665 2070 6174 680a  e relative path.
-0000c4c0: 2020 2020 2020 2020 6966 2045 4449 5441          if EDITA
-0000c4d0: 424c 455f 4d4f 4445 3a0a 2020 2020 2020  BLE_MODE:.      
-0000c4e0: 2020 2020 2020 6465 6661 756c 745f 656e        default_en
-0000c4f0: 7673 5b22 5245 4c41 5449 5645 5f50 4154  vs["RELATIVE_PAT
-0000c500: 4822 5d20 3d20 222e 2e2f 220a 0a20 2020  H"] = "../"..   
-0000c510: 2020 2020 2072 656e 6465 725f 7465 6d70       render_temp
-0000c520: 6c61 7465 7328 0a20 2020 2020 2020 2020  lates(.         
-0000c530: 2020 2065 6e76 5f76 6172 733d 6465 6661     env_vars=defa
-0000c540: 756c 745f 656e 7673 2c0a 2020 2020 2020  ult_envs,.      
-0000c550: 2020 2020 2020 686f 7374 5f74 7970 653d        host_type=
-0000c560: 686f 7374 5f74 6572 6d2e 686f 7374 2c0a  host_term.host,.
-0000c570: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000c580: 2020 2065 6e76 5f66 696c 655f 7061 7468     env_file_path
-0000c590: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-0000c5a0: 4752 4944 5f53 5243 5f50 4154 482c 2052  GRID_SRC_PATH, R
-0000c5b0: 454e 4445 5245 445f 4449 522c 2022 2e65  ENDERED_DIR, ".e
-0000c5c0: 6e76 6669 6c65 2229 0a0a 2020 2020 7472  nvfile")..    tr
-0000c5d0: 793a 0a20 2020 2020 2020 2065 6e76 5f66  y:.        env_f
-0000c5e0: 696c 6520 3d20 2222 0a20 2020 2020 2020  ile = "".       
-0000c5f0: 2066 6f72 206b 2c20 7620 696e 2064 6566   for k, v in def
-0000c600: 6175 6c74 5f65 6e76 732e 6974 656d 7328  ault_envs.items(
-0000c610: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-0000c620: 6e76 5f66 696c 6520 2b3d 2066 227b 6b7d  nv_file += f"{k}
-0000c630: 3d7b 767d 5c6e 220a 0a20 2020 2020 2020  ={v}\n"..       
-0000c640: 2077 6974 6820 6f70 656e 2865 6e76 5f66   with open(env_f
-0000c650: 696c 655f 7061 7468 2c20 2277 2229 2061  ile_path, "w") a
-0000c660: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-0000c670: 2066 2e77 7269 7465 2865 6e76 5f66 696c   f.write(env_fil
-0000c680: 6529 0a0a 2020 2020 2020 2020 636d 6420  e)..        cmd 
-0000c690: 2b3d 2066 2220 2d2d 656e 762d 6669 6c65  += f" --env-file
-0000c6a0: 207b 656e 765f 6669 6c65 5f70 6174 687d   {env_file_path}
-0000c6b0: 220a 2020 2020 6578 6365 7074 2045 7863  ".    except Exc
-0000c6c0: 6570 7469 6f6e 3a20 2023 206e 6f73 6563  eption:  # nosec
-0000c6d0: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
-0000c6e0: 2020 2063 6d64 202b 3d20 2220 2d2d 6669     cmd += " --fi
-0000c6f0: 6c65 2064 6f63 6b65 722d 636f 6d70 6f73  le docker-compos
-0000c700: 652e 796d 6c22 0a20 2020 2069 6620 6275  e.yml".    if bu
-0000c710: 696c 643a 0a20 2020 2020 2020 2063 6d64  ild:.        cmd
-0000c720: 202b 3d20 2220 2d2d 6669 6c65 2064 6f63   += " --file doc
-0000c730: 6b65 722d 636f 6d70 6f73 652e 6275 696c  ker-compose.buil
-0000c740: 642e 796d 6c22 0a20 2020 2069 6620 2272  d.yml".    if "r
-0000c750: 656c 6561 7365 2220 696e 206b 7761 7267  elease" in kwarg
-0000c760: 7320 616e 6420 6b77 6172 6773 5b22 7265  s and kwargs["re
-0000c770: 6c65 6173 6522 5d20 3d3d 2022 6465 7665  lease"] == "deve
-0000c780: 6c6f 706d 656e 7422 3a0a 2020 2020 2020  lopment":.      
-0000c790: 2020 636d 6420 2b3d 2022 202d 2d66 696c    cmd += " --fil
-0000c7a0: 6520 646f 636b 6572 2d63 6f6d 706f 7365  e docker-compose
-0000c7b0: 2e64 6576 2e79 6d6c 220a 2020 2020 6966  .dev.yml".    if
-0000c7c0: 2022 746c 7322 2069 6e20 6b77 6172 6773   "tls" in kwargs
-0000c7d0: 2061 6e64 206b 7761 7267 735b 2274 6c73   and kwargs["tls
-0000c7e0: 225d 2069 7320 5472 7565 3a0a 2020 2020  "] is True:.    
-0000c7f0: 2020 2020 636d 6420 2b3d 2022 202d 2d66      cmd += " --f
-0000c800: 696c 6520 646f 636b 6572 2d63 6f6d 706f  ile docker-compo
-0000c810: 7365 2e74 6c73 2e79 6d6c 220a 2020 2020  se.tls.yml".    
-0000c820: 6966 2022 7465 7374 2220 696e 206b 7761  if "test" in kwa
-0000c830: 7267 7320 616e 6420 6b77 6172 6773 5b22  rgs and kwargs["
-0000c840: 7465 7374 225d 2069 7320 5472 7565 3a0a  test"] is True:.
-0000c850: 2020 2020 2020 2020 636d 6420 2b3d 2022          cmd += "
-0000c860: 202d 2d66 696c 6520 646f 636b 6572 2d63   --file docker-c
-0000c870: 6f6d 706f 7365 2e74 6573 742e 796d 6c22  ompose.test.yml"
-0000c880: 0a20 2020 2063 6d64 202b 3d20 2220 7570  .    cmd += " up
-0000c890: 220a 0a20 2020 2069 6620 6e6f 7420 7461  "..    if not ta
-0000c8a0: 696c 3a0a 2020 2020 2020 2020 636d 6420  il:.        cmd 
-0000c8b0: 2b3d 2022 202d 6422 0a0a 2020 2020 6966  += " -d"..    if
-0000c8c0: 2062 7569 6c64 3a0a 2020 2020 2020 2020   build:.        
-0000c8d0: 636d 6420 2b3d 2022 202d 2d62 7569 6c64  cmd += " --build
-0000c8e0: 2220 2023 2066 6f72 6365 2072 6562 7569  "  # force rebui
-0000c8f0: 6c64 0a20 2020 2065 6c73 653a 0a20 2020  ld.    else:.   
-0000c900: 2020 2020 2069 6620 6973 5f77 696e 646f       if is_windo
-0000c910: 7773 2829 3a0a 2020 2020 2020 2020 2020  ws():.          
-0000c920: 2020 636d 6420 3d20 7075 6c6c 5f63 6d64    cmd = pull_cmd
-0000c930: 202b 2022 3b20 2220 2b20 636d 640a 2020   + "; " + cmd.  
-0000c940: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c950: 2020 2020 2020 2020 636d 6420 3d20 7075          cmd = pu
-0000c960: 6c6c 5f63 6d64 202b 2022 2026 2620 2220  ll_cmd + " && " 
-0000c970: 2b20 636d 640a 0a20 2020 2072 6574 7572  + cmd..    retur
-0000c980: 6e20 636d 640a 0a0a 6465 6620 6372 6561  n cmd...def crea
-0000c990: 7465 5f6c 6175 6e63 685f 7661 6772 616e  te_launch_vagran
-0000c9a0: 745f 636d 6428 7665 7262 3a20 4772 616d  t_cmd(verb: Gram
-0000c9b0: 6d61 7256 6572 6229 202d 3e20 7374 723a  marVerb) -> str:
-0000c9c0: 0a20 2020 2068 6f73 745f 7465 726d 203d  .    host_term =
-0000c9d0: 2076 6572 622e 6765 745f 6e61 6d65 645f   verb.get_named_
-0000c9e0: 7465 726d 5f68 6f73 7467 7261 6d6d 6172  term_hostgrammar
-0000c9f0: 286e 616d 653d 2268 6f73 7422 290a 2020  (name="host").  
-0000ca00: 2020 6e6f 6465 5f6e 616d 6520 3d20 7665    node_name = ve
-0000ca10: 7262 2e67 6574 5f6e 616d 6564 5f74 6572  rb.get_named_ter
-0000ca20: 6d5f 7479 7065 286e 616d 653d 226e 6f64  m_type(name="nod
-0000ca30: 655f 6e61 6d65 2229 0a20 2020 206e 6f64  e_name").    nod
-0000ca40: 655f 7479 7065 203d 2076 6572 622e 6765  e_type = verb.ge
-0000ca50: 745f 6e61 6d65 645f 7465 726d 5f74 7970  t_named_term_typ
-0000ca60: 6528 6e61 6d65 3d22 6e6f 6465 5f74 7970  e(name="node_typ
-0000ca70: 6522 290a 0a20 2020 2073 6e61 6b65 5f6e  e")..    snake_n
-0000ca80: 616d 6520 3d20 7374 7228 6e6f 6465 5f6e  ame = str(node_n
-0000ca90: 616d 652e 736e 616b 655f 696e 7075 7429  ame.snake_input)
-0000caa0: 0a0a 2020 2020 6966 2041 5254 3a0a 2020  ..    if ART:.  
-0000cab0: 2020 2020 2020 6861 6772 6964 2829 0a0a        hagrid()..
-0000cac0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0000cad0: 2020 2022 4c61 756e 6368 696e 6720 6120     "Launching a 
-0000cae0: 220a 2020 2020 2020 2020 2b20 7374 7228  ".        + str(
-0000caf0: 6e6f 6465 5f74 7970 652e 696e 7075 7429  node_type.input)
-0000cb00: 0a20 2020 2020 2020 202b 2022 2050 7947  .        + " PyG
-0000cb10: 7269 6420 6e6f 6465 206f 6e20 706f 7274  rid node on port
-0000cb20: 2022 0a20 2020 2020 2020 202b 2073 7472   ".        + str
-0000cb30: 2868 6f73 745f 7465 726d 2e70 6f72 7429  (host_term.port)
-0000cb40: 0a20 2020 2020 2020 202b 2022 215c 6e22  .        + "!\n"
-0000cb50: 0a20 2020 2029 0a0a 2020 2020 7072 696e  .    )..    prin
-0000cb60: 7428 2220 202d 2054 5950 453a 2022 202b  t("  - TYPE: " +
-0000cb70: 2073 7472 286e 6f64 655f 7479 7065 2e69   str(node_type.i
-0000cb80: 6e70 7574 2929 0a20 2020 2070 7269 6e74  nput)).    print
-0000cb90: 2822 2020 2d20 4e41 4d45 3a20 2220 2b20  ("  - NAME: " + 
-0000cba0: 7374 7228 736e 616b 655f 6e61 6d65 2929  str(snake_name))
-0000cbb0: 0a20 2020 2070 7269 6e74 2822 2020 2d20  .    print("  - 
-0000cbc0: 504f 5254 3a20 2220 2b20 7374 7228 686f  PORT: " + str(ho
-0000cbd0: 7374 5f74 6572 6d2e 706f 7274 2929 0a20  st_term.port)). 
-0000cbe0: 2020 2023 2070 7269 6e74 2822 2020 2d20     # print("  - 
-0000cbf0: 5641 4752 414e 543a 2022 202b 2022 3122  VAGRANT: " + "1"
-0000cc00: 290a 2020 2020 2320 7072 696e 7428 2220  ).    # print(" 
-0000cc10: 202d 2056 4952 5455 414c 424f 583a 2022   - VIRTUALBOX: "
-0000cc20: 202b 2022 3122 290a 2020 2020 7072 696e   + "1").    prin
-0000cc30: 7428 225c 6e22 290a 0a20 2020 2063 6d64  t("\n")..    cmd
-0000cc40: 203d 2022 220a 2020 2020 636d 6420 2b3d   = "".    cmd +=
-0000cc50: 2027 414e 5349 424c 455f 4152 4753 3d22   'ANSIBLE_ARGS="
-0000cc60: 270a 2020 2020 636d 6420 2b3d 2066 222d  '.    cmd += f"-
-0000cc70: 6520 276e 6f64 655f 6e61 6d65 3d7b 736e  e 'node_name={sn
-0000cc80: 616b 655f 6e61 6d65 7d27 220a 2020 2020  ake_name}'".    
-0000cc90: 636d 6420 2b3d 2066 222d 6520 276e 6f64  cmd += f"-e 'nod
-0000cca0: 655f 7479 7065 3d7b 6e6f 6465 5f74 7970  e_type={node_typ
-0000ccb0: 652e 696e 7075 747d 2722 0a20 2020 2063  e.input}'".    c
-0000ccc0: 6d64 202b 3d20 2722 2027 0a20 2020 2063  md += '" '.    c
-0000ccd0: 6d64 202b 3d20 2276 6167 7261 6e74 2075  md += "vagrant u
-0000cce0: 7020 2d2d 7072 6f76 6973 696f 6e22 0a20  p --provision". 
-0000ccf0: 2020 2063 6d64 203d 2022 6364 2022 202b     cmd = "cd " +
-0000cd00: 2047 5249 445f 5352 435f 5041 5448 202b   GRID_SRC_PATH +
-0000cd10: 2022 3b22 202b 2063 6d64 0a20 2020 2072   ";" + cmd.    r
-0000cd20: 6574 7572 6e20 636d 640a 0a0a 6465 6620  eturn cmd...def 
-0000cd30: 6765 745f 6f72 5f6d 616b 655f 7265 736f  get_or_make_reso
-0000cd40: 7572 6365 5f67 726f 7570 2872 6573 6f75  urce_group(resou
-0000cd50: 7263 655f 6772 6f75 703a 2073 7472 2c20  rce_group: str, 
-0000cd60: 6c6f 6361 7469 6f6e 3a20 7374 7220 3d20  location: str = 
-0000cd70: 2277 6573 7475 7322 2920 2d3e 204e 6f6e  "westus") -> Non
-0000cd80: 653a 0a20 2020 2063 6d64 203d 2066 2261  e:.    cmd = f"a
-0000cd90: 7a20 6772 6f75 7020 7368 6f77 202d 2d72  z group show --r
-0000cda0: 6573 6f75 7263 652d 6772 6f75 7020 7b72  esource-group {r
-0000cdb0: 6573 6f75 7263 655f 6772 6f75 707d 220a  esource_group}".
-0000cdc0: 2020 2020 6578 6973 7473 203d 2054 7275      exists = Tru
-0000cdd0: 650a 2020 2020 7472 793a 0a20 2020 2020  e.    try:.     
-0000cde0: 2020 2073 7562 7072 6f63 6573 732e 6368     subprocess.ch
-0000cdf0: 6563 6b5f 6361 6c6c 2863 6d64 2c20 7368  eck_call(cmd, sh
-0000ce00: 656c 6c3d 5472 7565 2920 2023 206e 6f73  ell=True)  # nos
-0000ce10: 6563 0a20 2020 2065 7863 6570 7420 4578  ec.    except Ex
-0000ce20: 6365 7074 696f 6e3a 2020 2320 6e6f 7365  ception:  # nose
-0000ce30: 630a 2020 2020 2020 2020 2320 6772 6f75  c.        # grou
-0000ce40: 7020 646f 6573 6e27 7420 6578 6973 7420  p doesn't exist 
-0000ce50: 736f 206c 6574 7320 6372 6561 7465 2069  so lets create i
-0000ce60: 740a 2020 2020 2020 2020 6578 6973 7473  t.        exists
-0000ce70: 203d 2046 616c 7365 0a0a 2020 2020 6966   = False..    if
-0000ce80: 206e 6f74 2065 7869 7374 733a 0a20 2020   not exists:.   
-0000ce90: 2020 2020 2063 6d64 203d 2066 2261 7a20       cmd = f"az 
-0000cea0: 6772 6f75 7020 6372 6561 7465 202d 6c20  group create -l 
-0000ceb0: 7b6c 6f63 6174 696f 6e7d 202d 6e20 7b72  {location} -n {r
-0000cec0: 6573 6f75 7263 655f 6772 6f75 707d 220a  esource_group}".
-0000ced0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000cee0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0000cef0: 2243 7265 6174 696e 6720 7265 736f 7572  "Creating resour
-0000cf00: 6365 2067 726f 7570 2e5c 6e52 756e 6e69  ce group.\nRunni
-0000cf10: 6e67 3a20 7b63 6d64 7d22 290a 2020 2020  ng: {cmd}").    
-0000cf20: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
-0000cf30: 7373 2e63 6865 636b 5f63 616c 6c28 636d  ss.check_call(cm
-0000cf40: 642c 2073 6865 6c6c 3d54 7275 6529 2020  d, shell=True)  
-0000cf50: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
-0000cf60: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0000cf70: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000cf80: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000cf90: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0000cfa0: 2020 2020 6622 556e 6162 6c65 2074 6f20      f"Unable to 
-0000cfb0: 6372 6561 7465 2072 6573 6f75 7263 6520  create resource 
-0000cfc0: 6772 6f75 7020 7b72 6573 6f75 7263 655f  group {resource_
-0000cfd0: 6772 6f75 707d 2040 207b 6c6f 6361 7469  group} @ {locati
-0000cfe0: 6f6e 7d2e 207b 657d 220a 2020 2020 2020  on}. {e}".      
-0000cff0: 2020 2020 2020 290a 0a0a 6465 6620 6578        )...def ex
-0000d000: 7472 6163 745f 686f 7374 5f69 7028 7374  tract_host_ip(st
-0000d010: 646f 7574 3a20 6279 7465 7329 202d 3e20  dout: bytes) -> 
-0000d020: 4f70 7469 6f6e 616c 5b73 7472 5d3a 0a20  Optional[str]:. 
-0000d030: 2020 206f 7574 7075 7420 3d20 7374 646f     output = stdo
-0000d040: 7574 2e64 6563 6f64 6528 2275 7466 2d38  ut.decode("utf-8
-0000d050: 2229 0a0a 2020 2020 7472 793a 0a20 2020  ")..    try:.   
-0000d060: 2020 2020 206a 203d 206a 736f 6e2e 6c6f       j = json.lo
-0000d070: 6164 7328 6f75 7470 7574 290a 2020 2020  ads(output).    
-0000d080: 2020 2020 6966 2022 7075 626c 6963 4970      if "publicIp
-0000d090: 4164 6472 6573 7322 2069 6e20 6a3a 0a20  Address" in j:. 
-0000d0a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d0b0: 6e20 7374 7228 6a5b 2270 7562 6c69 6349  n str(j["publicI
-0000d0c0: 7041 6464 7265 7373 225d 290a 2020 2020  pAddress"]).    
-0000d0d0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0000d0e0: 3a20 2023 206e 6f73 6563 0a20 2020 2020  :  # nosec.     
-0000d0f0: 2020 206d 6174 6368 6572 203d 2072 2770     matcher = r'p
-0000d100: 7562 6c69 6349 7041 6464 7265 7373 223a  ublicIpAddress":
-0000d110: 5c73 2b22 282e 2b29 2227 0a20 2020 2020  \s+"(.+)"'.     
-0000d120: 2020 2069 7073 203d 2072 652e 6669 6e64     ips = re.find
-0000d130: 616c 6c28 6d61 7463 6865 722c 206f 7574  all(matcher, out
-0000d140: 7075 7429 0a20 2020 2020 2020 2069 6620  put).        if 
-0000d150: 6c65 6e28 6970 7329 203e 2030 3a0a 2020  len(ips) > 0:.  
-0000d160: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d170: 2069 7073 5b30 5d0a 0a20 2020 2072 6574   ips[0]..    ret
-0000d180: 7572 6e20 4e6f 6e65 0a0a 0a64 6566 2067  urn None...def g
-0000d190: 6574 5f76 6d5f 686f 7374 5f69 7073 286e  et_vm_host_ips(n
-0000d1a0: 6f64 655f 6e61 6d65 3a20 7374 722c 2072  ode_name: str, r
-0000d1b0: 6573 6f75 7263 655f 6772 6f75 703a 2073  esource_group: s
-0000d1c0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
-0000d1d0: 5479 7065 4c69 7374 5d3a 0a20 2020 2063  TypeList]:.    c
-0000d1e0: 6d64 203d 2066 2261 7a20 766d 206c 6973  md = f"az vm lis
-0000d1f0: 742d 6970 2d61 6464 7265 7373 6573 202d  t-ip-addresses -
-0000d200: 6720 7b72 6573 6f75 7263 655f 6772 6f75  g {resource_grou
-0000d210: 707d 202d 2d71 7565 7279 2022 0a20 2020  p} --query ".   
-0000d220: 2063 6d64 202b 3d20 6622 2222 225b 3f73   cmd += f""""[?s
-0000d230: 7461 7274 735f 7769 7468 2876 6972 7475  tarts_with(virtu
-0000d240: 616c 4d61 6368 696e 652e 6e61 6d65 2c20  alMachine.name, 
-0000d250: 277b 6e6f 6465 5f6e 616d 657d 2729 5d22  '{node_name}')]"
-0000d260: 2222 0a20 2020 2063 6d64 202b 3d20 2727  "".    cmd += ''
-0000d270: 272e 7669 7274 7561 6c4d 6163 6869 6e65  '.virtualMachine
-0000d280: 2e6e 6574 776f 726b 2e70 7562 6c69 6349  .network.publicI
-0000d290: 7041 6464 7265 7373 6573 5b30 5d2e 6970  pAddresses[0].ip
-0000d2a0: 4164 6472 6573 7322 2727 270a 2020 2020  Address"'''.    
-0000d2b0: 6f75 7470 7574 203d 2073 7562 7072 6f63  output = subproc
-0000d2c0: 6573 732e 6368 6563 6b5f 6f75 7470 7574  ess.check_output
-0000d2d0: 2863 6d64 2c20 7368 656c 6c3d 5472 7565  (cmd, shell=True
-0000d2e0: 2920 2023 206e 6f73 6563 0a20 2020 2074  )  # nosec.    t
-0000d2f0: 7279 3a0a 2020 2020 2020 2020 686f 7374  ry:.        host
-0000d300: 5f69 7073 203d 206a 736f 6e2e 6c6f 6164  _ips = json.load
-0000d310: 7328 6f75 7470 7574 290a 2020 2020 2020  s(output).      
-0000d320: 2020 7265 7475 726e 2068 6f73 745f 6970    return host_ip
-0000d330: 730a 2020 2020 6578 6365 7074 2045 7863  s.    except Exc
-0000d340: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0000d350: 2020 2020 2070 7269 6e74 2866 2246 6169       print(f"Fai
-0000d360: 6c65 6420 746f 2065 7874 7261 6374 2069  led to extract i
-0000d370: 7073 3a20 7b65 7d22 290a 0a20 2020 2072  ps: {e}")..    r
-0000d380: 6574 7572 6e20 4e6f 6e65 0a0a 0a64 6566  eturn None...def
-0000d390: 2069 735f 7661 6c69 645f 6970 2868 6f73   is_valid_ip(hos
-0000d3a0: 745f 6f72 5f69 703a 2073 7472 2920 2d3e  t_or_ip: str) ->
-0000d3b0: 2062 6f6f 6c3a 0a20 2020 206d 6174 6368   bool:.    match
-0000d3c0: 6572 203d 2072 2228 3f3a 5b30 2d39 5d7b  er = r"(?:[0-9]{
-0000d3d0: 312c 337d 5c2e 297b 337d 5b30 2d39 5d7b  1,3}\.){3}[0-9]{
-0000d3e0: 312c 337d 220a 2020 2020 6970 7320 3d20  1,3}".    ips = 
-0000d3f0: 7265 2e66 696e 6461 6c6c 286d 6174 6368  re.findall(match
-0000d400: 6572 2c20 686f 7374 5f6f 725f 6970 2e73  er, host_or_ip.s
-0000d410: 7472 6970 2829 290a 2020 2020 6966 206c  trip()).    if l
-0000d420: 656e 2869 7073 2920 3d3d 2031 3a0a 2020  en(ips) == 1:.  
-0000d430: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0000d440: 650a 2020 2020 7265 7475 726e 2046 616c  e.    return Fal
-0000d450: 7365 0a0a 0a64 6566 2065 7874 7261 6374  se...def extract
-0000d460: 5f68 6f73 745f 6970 5f67 6370 2873 7464  _host_ip_gcp(std
-0000d470: 6f75 743a 2062 7974 6573 2920 2d3e 204f  out: bytes) -> O
-0000d480: 7074 696f 6e61 6c5b 7374 725d 3a0a 2020  ptional[str]:.  
-0000d490: 2020 6f75 7470 7574 203d 2073 7464 6f75    output = stdou
-0000d4a0: 742e 6465 636f 6465 2822 7574 662d 3822  t.decode("utf-8"
-0000d4b0: 290a 0a20 2020 2074 7279 3a0a 2020 2020  )..    try:.    
-0000d4c0: 2020 2020 6d61 7463 6865 7220 3d20 7222      matcher = r"
-0000d4d0: 283f 3a5b 302d 395d 7b31 2c33 7d5c 2e29  (?:[0-9]{1,3}\.)
-0000d4e0: 7b33 7d5b 302d 395d 7b31 2c33 7d22 0a20  {3}[0-9]{1,3}". 
-0000d4f0: 2020 2020 2020 2069 7073 203d 2072 652e         ips = re.
-0000d500: 6669 6e64 616c 6c28 6d61 7463 6865 722c  findall(matcher,
-0000d510: 206f 7574 7075 7429 0a20 2020 2020 2020   output).       
-0000d520: 2069 6620 6c65 6e28 6970 7329 203d 3d20   if len(ips) == 
-0000d530: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
-0000d540: 6574 7572 6e20 6970 735b 315d 0a20 2020  eturn ips[1].   
-0000d550: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0000d560: 6e3a 2020 2320 6e6f 7365 630a 2020 2020  n:  # nosec.    
-0000d570: 2020 2020 7061 7373 0a0a 2020 2020 7265      pass..    re
-0000d580: 7475 726e 204e 6f6e 650a 0a0a 6465 6620  turn None...def 
-0000d590: 6578 7472 6163 745f 686f 7374 5f69 705f  extract_host_ip_
-0000d5a0: 6672 6f6d 5f63 6d64 2863 6d64 3a20 7374  from_cmd(cmd: st
-0000d5b0: 7229 202d 3e20 4f70 7469 6f6e 616c 5b73  r) -> Optional[s
-0000d5c0: 7472 5d3a 0a0a 2020 2020 7472 793a 0a20  tr]:..    try:. 
-0000d5d0: 2020 2020 2020 206d 6174 6368 6572 203d         matcher =
-0000d5e0: 2072 2228 3f3a 5b30 2d39 5d7b 312c 337d   r"(?:[0-9]{1,3}
-0000d5f0: 5c2e 297b 337d 5b30 2d39 5d7b 312c 337d  \.){3}[0-9]{1,3}
-0000d600: 220a 2020 2020 2020 2020 6970 7320 3d20  ".        ips = 
-0000d610: 7265 2e66 696e 6461 6c6c 286d 6174 6368  re.findall(match
-0000d620: 6572 2c20 636d 6429 0a20 2020 2020 2020  er, cmd).       
-0000d630: 2069 6620 6970 733a 0a20 2020 2020 2020   if ips:.       
-0000d640: 2020 2020 2072 6574 7572 6e20 6970 735b       return ips[
-0000d650: 305d 0a20 2020 2065 7863 6570 7420 4578  0].    except Ex
-0000d660: 6365 7074 696f 6e3a 2020 2320 6e6f 7365  ception:  # nose
-0000d670: 630a 2020 2020 2020 2020 7061 7373 0a0a  c.        pass..
-0000d680: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000d690: 0a0a 6465 6620 6368 6563 6b5f 6970 5f66  ..def check_ip_f
-0000d6a0: 6f72 5f73 7368 280a 2020 2020 686f 7374  or_ssh(.    host
-0000d6b0: 5f69 703a 2073 7472 2c20 7469 6d65 6f75  _ip: str, timeou
-0000d6c0: 743a 2069 6e74 203d 2036 3030 2c20 7761  t: int = 600, wa
-0000d6d0: 6974 5f74 696d 653a 2069 6e74 203d 2035  it_time: int = 5
-0000d6e0: 2c20 7369 6c65 6e74 3a20 626f 6f6c 203d  , silent: bool =
-0000d6f0: 2046 616c 7365 0a29 202d 3e20 626f 6f6c   False.) -> bool
-0000d700: 3a0a 0a20 2020 2069 6620 6e6f 7420 7369  :..    if not si
-0000d710: 6c65 6e74 3a0a 2020 2020 2020 2020 7072  lent:.        pr
-0000d720: 696e 7428 6622 4368 6563 6b69 6e67 2056  int(f"Checking V
-0000d730: 4d20 6174 207b 686f 7374 5f69 707d 2069  M at {host_ip} i
-0000d740: 7320 7570 2229 0a20 2020 2063 6865 636b  s up").    check
-0000d750: 7320 3d20 696e 7428 7469 6d65 6f75 7420  s = int(timeout 
-0000d760: 2f20 7761 6974 5f74 696d 6529 2020 2320  / wait_time)  # 
-0000d770: 3130 206d 696e 7574 6573 2069 6e20 3520  10 minutes in 5 
-0000d780: 7365 636f 6e64 2063 6875 6e6b 730a 2020  second chunks.  
-0000d790: 2020 6669 7273 745f 7275 6e20 3d20 5472    first_run = Tr
-0000d7a0: 7565 0a20 2020 2077 6869 6c65 2063 6865  ue.    while che
-0000d7b0: 636b 7320 3e20 303a 0a20 2020 2020 2020  cks > 0:.       
-0000d7c0: 2063 6865 636b 7320 2d3d 2031 0a20 2020   checks -= 1.   
-0000d7d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000d7e0: 2020 2020 2020 736f 636b 203d 2073 6f63        sock = soc
-0000d7f0: 6b65 742e 736f 636b 6574 2873 6f63 6b65  ket.socket(socke
-0000d800: 742e 4146 5f49 4e45 542c 2073 6f63 6b65  t.AF_INET, socke
-0000d810: 742e 534f 434b 5f53 5452 4541 4d29 0a20  t.SOCK_STREAM). 
-0000d820: 2020 2020 2020 2020 2020 2073 6f63 6b2e             sock.
-0000d830: 7365 7474 696d 656f 7574 2877 6169 745f  settimeout(wait_
-0000d840: 7469 6d65 290a 2020 2020 2020 2020 2020  time).          
-0000d850: 2020 7265 7375 6c74 203d 2073 6f63 6b2e    result = sock.
-0000d860: 636f 6e6e 6563 745f 6578 2828 686f 7374  connect_ex((host
-0000d870: 5f69 702c 2032 3229 290a 2020 2020 2020  _ip, 22)).      
-0000d880: 2020 2020 2020 736f 636b 2e63 6c6f 7365        sock.close
-0000d890: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-0000d8a0: 6620 7265 7375 6c74 203d 3d20 303a 0a20  f result == 0:. 
-0000d8b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d8c0: 6620 6e6f 7420 7369 6c65 6e74 3a0a 2020  f not silent:.  
-0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8e0: 2020 7072 696e 7428 6622 564d 2061 7420    print(f"VM at 
-0000d8f0: 7b68 6f73 745f 6970 7d20 6973 2075 7021  {host_ip} is up!
-0000d900: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000d910: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-0000d920: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d940: 2069 6620 6669 7273 745f 7275 6e3a 0a20   if first_run:. 
-0000d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d960: 2020 2069 6620 6e6f 7420 7369 6c65 6e74     if not silent
-0000d970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d980: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000d990: 2257 6169 7469 6e67 2066 6f72 2056 4d20  "Waiting for VM 
-0000d9a0: 746f 2073 7461 7274 222c 2065 6e64 3d22  to start", end="
-0000d9b0: 222c 2066 6c75 7368 3d54 7275 6529 0a20  ", flush=True). 
-0000d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9d0: 2020 2066 6972 7374 5f72 756e 203d 2046     first_run = F
-0000d9e0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000d9f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000da00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000da10: 6620 6e6f 7420 7369 6c65 6e74 3a0a 2020  f not silent:.  
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 2020 2020 2020 7072 696e 7428 222e 222c        print(".",
-0000da40: 2065 6e64 3d22 222c 2066 6c75 7368 3d54   end="", flush=T
-0000da50: 7275 6529 0a20 2020 2020 2020 2065 7863  rue).        exc
-0000da60: 6570 7420 4578 6365 7074 696f 6e3a 2020  ept Exception:  
-0000da70: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
-0000da80: 2020 2020 7061 7373 0a20 2020 2072 6574      pass.    ret
-0000da90: 7572 6e20 4661 6c73 650a 0a0a 6465 6620  urn False...def 
-0000daa0: 6d61 6b65 5f76 6d5f 617a 7572 6528 0a20  make_vm_azure(. 
-0000dab0: 2020 206e 6f64 655f 6e61 6d65 3a20 7374     node_name: st
-0000dac0: 722c 0a20 2020 2072 6573 6f75 7263 655f  r,.    resource_
-0000dad0: 6772 6f75 703a 2073 7472 2c0a 2020 2020  group: str,.    
-0000dae0: 7573 6572 6e61 6d65 3a20 7374 722c 0a20  username: str,. 
-0000daf0: 2020 2070 6173 7377 6f72 643a 204f 7074     password: Opt
-0000db00: 696f 6e61 6c5b 7374 725d 2c0a 2020 2020  ional[str],.    
-0000db10: 6b65 795f 7061 7468 3a20 4f70 7469 6f6e  key_path: Option
-0000db20: 616c 5b73 7472 5d2c 0a20 2020 2073 697a  al[str],.    siz
-0000db30: 653a 2073 7472 2c0a 2020 2020 696d 6167  e: str,.    imag
-0000db40: 655f 6e61 6d65 3a20 7374 722c 0a20 2020  e_name: str,.   
-0000db50: 206e 6f64 655f 636f 756e 743a 2069 6e74   node_count: int
-0000db60: 2c0a 2920 2d3e 2054 7970 654c 6973 743a  ,.) -> TypeList:
-0000db70: 0a20 2020 2064 6973 6b5f 7369 7a65 5f67  .    disk_size_g
-0000db80: 6220 3d20 2232 3030 220a 2020 2020 7472  b = "200".    tr
-0000db90: 793a 0a20 2020 2020 2020 2074 656d 705f  y:.        temp_
-0000dba0: 6469 7220 3d20 7465 6d70 6669 6c65 2e54  dir = tempfile.T
-0000dbb0: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-0000dbc0: 7928 290a 2020 2020 2020 2020 7075 626c  y().        publ
-0000dbd0: 6963 5f6b 6579 5f70 6174 6820 3d20 280a  ic_key_path = (.
-0000dbe0: 2020 2020 2020 2020 2020 2020 7072 6976              priv
-0000dbf0: 6174 655f 746f 5f70 7562 6c69 635f 6b65  ate_to_public_ke
-0000dc00: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
-0000dc10: 2020 2070 7269 7661 7465 5f6b 6579 5f70     private_key_p
-0000dc20: 6174 683d 6b65 795f 7061 7468 2c20 7465  ath=key_path, te
-0000dc30: 6d70 5f70 6174 683d 7465 6d70 5f64 6972  mp_path=temp_dir
-0000dc40: 2e6e 616d 652c 2075 7365 726e 616d 653d  .name, username=
-0000dc50: 7573 6572 6e61 6d65 0a20 2020 2020 2020  username.       
-0000dc60: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000dc70: 2020 2069 6620 6b65 795f 7061 7468 0a20     if key_path. 
-0000dc80: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-0000dc90: 4e6f 6e65 0a20 2020 2020 2020 2029 0a20  None.        ). 
-0000dca0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000dcb0: 696f 6e3a 2020 2320 6e6f 7365 630a 2020  ion:  # nosec.  
-0000dcc0: 2020 2020 2020 7465 6d70 5f64 6972 2e63        temp_dir.c
-0000dcd0: 6c65 616e 7570 2829 0a0a 2020 2020 6175  leanup()..    au
-0000dce0: 7468 656e 7469 6361 7469 6f6e 5f74 7970  thentication_typ
-0000dcf0: 6520 3d20 2273 7368 2220 6966 206b 6579  e = "ssh" if key
-0000dd00: 5f70 6174 6820 656c 7365 2022 7061 7373  _path else "pass
-0000dd10: 776f 7264 220a 2020 2020 636d 6420 3d20  word".    cmd = 
-0000dd20: 6622 617a 2076 6d20 6372 6561 7465 202d  f"az vm create -
-0000dd30: 6e20 7b6e 6f64 655f 6e61 6d65 7d20 2d67  n {node_name} -g
-0000dd40: 207b 7265 736f 7572 6365 5f67 726f 7570   {resource_group
-0000dd50: 7d20 2d2d 7369 7a65 207b 7369 7a65 7d20  } --size {size} 
-0000dd60: 220a 2020 2020 636d 6420 2b3d 2066 222d  ".    cmd += f"-
-0000dd70: 2d69 6d61 6765 207b 696d 6167 655f 6e61  -image {image_na
-0000dd80: 6d65 7d20 2d2d 6f73 2d64 6973 6b2d 7369  me} --os-disk-si
-0000dd90: 7a65 2d67 6220 7b64 6973 6b5f 7369 7a65  ze-gb {disk_size
-0000dda0: 5f67 627d 2022 0a20 2020 2063 6d64 202b  _gb} ".    cmd +
-0000ddb0: 3d20 6622 2d2d 7075 626c 6963 2d69 702d  = f"--public-ip-
-0000ddc0: 736b 7520 5374 616e 6461 7264 202d 2d61  sku Standard --a
-0000ddd0: 7574 6865 6e74 6963 6174 696f 6e2d 7479  uthentication-ty
-0000dde0: 7065 207b 6175 7468 656e 7469 6361 7469  pe {authenticati
-0000ddf0: 6f6e 5f74 7970 657d 202d 2d61 646d 696e  on_type} --admin
-0000de00: 2d75 7365 726e 616d 6520 7b75 7365 726e  -username {usern
-0000de10: 616d 657d 2022 0a20 2020 2063 6d64 202b  ame} ".    cmd +
-0000de20: 3d20 6622 2d2d 7373 682d 6b65 792d 7661  = f"--ssh-key-va
-0000de30: 6c75 6573 207b 7075 626c 6963 5f6b 6579  lues {public_key
-0000de40: 5f70 6174 687d 2022 2069 6620 7075 626c  _path} " if publ
-0000de50: 6963 5f6b 6579 5f70 6174 6820 656c 7365  ic_key_path else
-0000de60: 2022 220a 2020 2020 636d 6420 2b3d 2066   "".    cmd += f
-0000de70: 222d 2d61 646d 696e 2d70 6173 7377 6f72  "--admin-passwor
-0000de80: 6420 277b 7061 7373 776f 7264 7d27 2022  d '{password}' "
-0000de90: 2069 6620 7061 7373 776f 7264 2065 6c73   if password els
-0000dea0: 6520 2222 0a20 2020 2063 6d64 202b 3d20  e "".    cmd += 
-0000deb0: 6622 2d2d 636f 756e 7420 7b6e 6f64 655f  f"--count {node_
-0000dec0: 636f 756e 747d 2022 2069 6620 6e6f 6465  count} " if node
-0000ded0: 5f63 6f75 6e74 203e 2031 2065 6c73 6520  _count > 1 else 
-0000dee0: 2222 0a0a 2020 2020 686f 7374 5f69 7073  ""..    host_ips
-0000def0: 3a20 4f70 7469 6f6e 616c 5b54 7970 654c  : Optional[TypeL
-0000df00: 6973 745d 203d 205b 5d0a 2020 2020 7472  ist] = [].    tr
-0000df10: 793a 0a20 2020 2020 2020 2070 7269 6e74  y:.        print
-0000df20: 2866 2243 7265 6174 696e 6720 766d 2e5c  (f"Creating vm.\
-0000df30: 6e52 756e 6e69 6e67 3a20 7b68 6964 655f  nRunning: {hide_
-0000df40: 617a 7572 655f 766d 5f70 6173 7377 6f72  azure_vm_passwor
-0000df50: 6428 636d 6429 7d22 290a 2020 2020 2020  d(cmd)}").      
-0000df60: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
-0000df70: 636b 5f6f 7574 7075 7428 636d 642c 2073  ck_output(cmd, s
-0000df80: 6865 6c6c 3d54 7275 6529 2020 2320 6e6f  hell=True)  # no
-0000df90: 7365 630a 2020 2020 2020 2020 686f 7374  sec.        host
-0000dfa0: 5f69 7073 203d 2067 6574 5f76 6d5f 686f  _ips = get_vm_ho
-0000dfb0: 7374 5f69 7073 286e 6f64 655f 6e61 6d65  st_ips(node_name
-0000dfc0: 3d6e 6f64 655f 6e61 6d65 2c20 7265 736f  =node_name, reso
-0000dfd0: 7572 6365 5f67 726f 7570 3d72 6573 6f75  urce_group=resou
-0000dfe0: 7263 655f 6772 6f75 7029 0a20 2020 2065  rce_group).    e
-0000dff0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-0000e000: 6173 2065 3a0a 2020 2020 2020 2020 7072  as e:.        pr
-0000e010: 696e 7428 2266 6169 6c65 6422 2c20 6529  int("failed", e)
-0000e020: 0a20 2020 2066 696e 616c 6c79 3a0a 2020  .    finally:.  
-0000e030: 2020 2020 2020 7465 6d70 5f64 6972 2e63        temp_dir.c
-0000e040: 6c65 616e 7570 2829 0a0a 2020 2020 6966  leanup()..    if
-0000e050: 206e 6f74 2068 6f73 745f 6970 733a 0a20   not host_ips:. 
-0000e060: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000e070: 6570 7469 6f6e 2822 4661 696c 6564 2074  eption("Failed t
-0000e080: 6f20 6372 6561 7465 2076 6d20 6f72 2067  o create vm or g
-0000e090: 6574 2056 4d20 7075 626c 6963 2069 7022  et VM public ip"
-0000e0a0: 290a 0a20 2020 2074 7279 3a0a 2020 2020  )..    try:.    
-0000e0b0: 2020 2020 2320 636c 6561 6e20 7570 2074      # clean up t
-0000e0c0: 656d 7020 7075 626c 6963 206b 6579 0a20  emp public key. 
-0000e0d0: 2020 2020 2020 2069 6620 7075 626c 6963         if public
-0000e0e0: 5f6b 6579 5f70 6174 683a 0a20 2020 2020  _key_path:.     
-0000e0f0: 2020 2020 2020 206f 732e 756e 6c69 6e6b         os.unlink
-0000e100: 2870 7562 6c69 635f 6b65 795f 7061 7468  (public_key_path
-0000e110: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
-0000e120: 6570 7469 6f6e 3a20 2023 206e 6f73 6563  eption:  # nosec
-0000e130: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
-0000e140: 2020 2072 6574 7572 6e20 686f 7374 5f69     return host_i
-0000e150: 7073 0a0a 0a64 6566 206f 7065 6e5f 706f  ps...def open_po
-0000e160: 7274 5f76 6d5f 617a 7572 6528 0a20 2020  rt_vm_azure(.   
-0000e170: 2072 6573 6f75 7263 655f 6772 6f75 703a   resource_group:
-0000e180: 2073 7472 2c20 6e6f 6465 5f6e 616d 653a   str, node_name:
-0000e190: 2073 7472 2c20 706f 7274 5f6e 616d 653a   str, port_name:
-0000e1a0: 2073 7472 2c20 706f 7274 3a20 696e 742c   str, port: int,
-0000e1b0: 2070 7269 6f72 6974 793a 2069 6e74 0a29   priority: int.)
-0000e1c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 636d   -> None:.    cm
-0000e1d0: 6420 3d20 6622 617a 206e 6574 776f 726b  d = f"az network
-0000e1e0: 206e 7367 2072 756c 6520 6372 6561 7465   nsg rule create
-0000e1f0: 202d 2d72 6573 6f75 7263 652d 6772 6f75   --resource-grou
-0000e200: 7020 7b72 6573 6f75 7263 655f 6772 6f75  p {resource_grou
-0000e210: 707d 2022 0a20 2020 2063 6d64 202b 3d20  p} ".    cmd += 
-0000e220: 6622 2d2d 6e73 672d 6e61 6d65 207b 6e6f  f"--nsg-name {no
-0000e230: 6465 5f6e 616d 657d 4e53 4720 2d2d 6e61  de_name}NSG --na
-0000e240: 6d65 207b 706f 7274 5f6e 616d 657d 202d  me {port_name} -
-0000e250: 2d64 6573 7469 6e61 7469 6f6e 2d70 6f72  -destination-por
-0000e260: 742d 7261 6e67 6573 207b 706f 7274 7d20  t-ranges {port} 
-0000e270: 2d2d 7072 696f 7269 7479 207b 7072 696f  --priority {prio
-0000e280: 7269 7479 7d22 0a20 2020 2074 7279 3a0a  rity}".    try:.
-0000e290: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-0000e2a0: 4372 6561 7469 6e67 207b 706f 7274 5f6e  Creating {port_n
-0000e2b0: 616d 657d 207b 706f 7274 7d20 6e67 7320  ame} {port} ngs 
-0000e2c0: 7275 6c65 2e5c 6e52 756e 6e69 6e67 3a20  rule.\nRunning: 
-0000e2d0: 7b63 6d64 7d22 290a 2020 2020 2020 2020  {cmd}").        
-0000e2e0: 6f75 7470 7574 203d 2073 7562 7072 6f63  output = subproc
-0000e2f0: 6573 732e 6368 6563 6b5f 6361 6c6c 2863  ess.check_call(c
-0000e300: 6d64 2c20 7368 656c 6c3d 5472 7565 2920  md, shell=True) 
-0000e310: 2023 206e 6f73 6563 0a20 2020 2020 2020   # nosec.       
-0000e320: 2070 7269 6e74 2822 6f75 7470 7574 222c   print("output",
-0000e330: 206f 7574 7075 7429 0a20 2020 2020 2020   output).       
-0000e340: 2070 6173 730a 2020 2020 6578 6365 7074   pass.    except
-0000e350: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0000e360: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0000e370: 6661 696c 6564 222c 2065 290a 0a0a 6465  failed", e)...de
-0000e380: 6620 6372 6561 7465 5f70 726f 6a65 6374  f create_project
-0000e390: 2870 726f 6a65 6374 5f69 643a 2073 7472  (project_id: str
-0000e3a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2063  ) -> None:.    c
-0000e3b0: 6d64 203d 2066 2267 636c 6f75 6420 7072  md = f"gcloud pr
-0000e3c0: 6f6a 6563 7473 2063 7265 6174 6520 7b70  ojects create {p
-0000e3d0: 726f 6a65 6374 5f69 647d 202d 2d73 6574  roject_id} --set
-0000e3e0: 2d61 732d 6465 6661 756c 7422 0a20 2020  -as-default".   
-0000e3f0: 2074 7279 3a0a 2020 2020 2020 2020 7072   try:.        pr
-0000e400: 696e 7428 6622 4372 6561 7469 6e67 2070  int(f"Creating p
-0000e410: 726f 6a65 6374 2e5c 6e52 756e 6e69 6e67  roject.\nRunning
-0000e420: 3a20 7b63 6d64 7d22 290a 2020 2020 2020  : {cmd}").      
-0000e430: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
-0000e440: 636b 5f63 616c 6c28 636d 642c 2073 6865  ck_call(cmd, she
-0000e450: 6c6c 3d54 7275 6529 2020 2320 6e6f 7365  ll=True)  # nose
-0000e460: 630a 2020 2020 6578 6365 7074 2045 7863  c.    except Exc
-0000e470: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0000e480: 2020 2020 2070 7269 6e74 2822 6661 696c       print("fail
-0000e490: 6564 222c 2065 290a 0a20 2020 2070 7269  ed", e)..    pri
-0000e4a0: 6e74 2822 6372 6561 7465 2070 726f 6a65  nt("create proje
-0000e4b0: 6374 2063 6f6d 706c 6574 6522 290a 0a0a  ct complete")...
-0000e4c0: 6465 6620 6372 6561 7465 5f6c 6175 6e63  def create_launc
-0000e4d0: 685f 6763 705f 636d 6428 0a20 2020 2076  h_gcp_cmd(.    v
-0000e4e0: 6572 623a 2047 7261 6d6d 6172 5665 7262  erb: GrammarVerb
-0000e4f0: 2c0a 2020 2020 7072 6f6a 6563 745f 6964  ,.    project_id
-0000e500: 3a20 7374 722c 0a20 2020 207a 6f6e 653a  : str,.    zone:
-0000e510: 2073 7472 2c0a 2020 2020 6d61 6368 696e   str,.    machin
-0000e520: 655f 7479 7065 3a20 7374 722c 0a20 2020  e_type: str,.   
-0000e530: 2061 6e73 6962 6c65 5f65 7874 7261 733a   ansible_extras:
-0000e540: 2073 7472 2c0a 2020 2020 6b77 6172 6773   str,.    kwargs
-0000e550: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-0000e560: 416e 795d 2c0a 2020 2020 7265 706f 3a20  Any],.    repo: 
-0000e570: 7374 722c 0a20 2020 2062 7261 6e63 683a  str,.    branch:
-0000e580: 2073 7472 2c0a 2020 2020 6175 7468 3a20   str,.    auth: 
-0000e590: 4175 7468 4372 6564 656e 7469 616c 732c  AuthCredentials,
-0000e5a0: 0a29 202d 3e20 7374 723a 0a20 2020 2023  .) -> str:.    #
-0000e5b0: 2063 7265 6174 6520 7072 6f6a 6563 7420   create project 
-0000e5c0: 6966 2069 7420 646f 6573 6e27 7420 6578  if it doesn't ex
-0000e5d0: 6973 740a 2020 2020 6372 6561 7465 5f70  ist.    create_p
-0000e5e0: 726f 6a65 6374 2870 726f 6a65 6374 5f69  roject(project_i
-0000e5f0: 6429 0a20 2020 2023 2076 6d0a 2020 2020  d).    # vm.    
-0000e600: 6e6f 6465 5f6e 616d 6520 3d20 7665 7262  node_name = verb
-0000e610: 2e67 6574 5f6e 616d 6564 5f74 6572 6d5f  .get_named_term_
-0000e620: 7479 7065 286e 616d 653d 226e 6f64 655f  type(name="node_
-0000e630: 6e61 6d65 2229 0a20 2020 206b 6562 6162  name").    kebab
-0000e640: 5f6e 616d 6520 3d20 7374 7228 6e6f 6465  _name = str(node
-0000e650: 5f6e 616d 652e 6b65 6261 625f 696e 7075  _name.kebab_inpu
-0000e660: 7429 0a20 2020 2064 6973 6b5f 7369 7a65  t).    disk_size
-0000e670: 5f67 6220 3d20 2232 3030 220a 2020 2020  _gb = "200".    
-0000e680: 686f 7374 5f69 7020 3d20 6d61 6b65 5f67  host_ip = make_g
-0000e690: 6370 5f76 6d28 0a20 2020 2020 2020 2076  cp_vm(.        v
-0000e6a0: 6d5f 6e61 6d65 3d6b 6562 6162 5f6e 616d  m_name=kebab_nam
-0000e6b0: 652c 0a20 2020 2020 2020 2070 726f 6a65  e,.        proje
-0000e6c0: 6374 5f69 643d 7072 6f6a 6563 745f 6964  ct_id=project_id
-0000e6d0: 2c0a 2020 2020 2020 2020 7a6f 6e65 3d7a  ,.        zone=z
-0000e6e0: 6f6e 652c 0a20 2020 2020 2020 206d 6163  one,.        mac
-0000e6f0: 6869 6e65 5f74 7970 653d 6d61 6368 696e  hine_type=machin
-0000e700: 655f 7479 7065 2c0a 2020 2020 2020 2020  e_type,.        
-0000e710: 6469 736b 5f73 697a 655f 6762 3d64 6973  disk_size_gb=dis
-0000e720: 6b5f 7369 7a65 5f67 622c 0a20 2020 2029  k_size_gb,.    )
-0000e730: 0a0a 2020 2020 2320 6765 7420 6f6c 6420  ..    # get old 
-0000e740: 686f 7374 0a20 2020 2068 6f73 745f 7465  host.    host_te
-0000e750: 726d 203d 2076 6572 622e 6765 745f 6e61  rm = verb.get_na
-0000e760: 6d65 645f 7465 726d 5f68 6f73 7467 7261  med_term_hostgra
-0000e770: 6d6d 6172 286e 616d 653d 2268 6f73 7422  mmar(name="host"
-0000e780: 290a 0a20 2020 2068 6f73 745f 7570 203d  )..    host_up =
-0000e790: 2063 6865 636b 5f69 705f 666f 725f 7373   check_ip_for_ss
-0000e7a0: 6828 686f 7374 5f69 703d 686f 7374 5f69  h(host_ip=host_i
-0000e7b0: 7029 0a20 2020 2069 6620 6e6f 7420 686f  p).    if not ho
-0000e7c0: 7374 5f75 703a 0a20 2020 2020 2020 2072  st_up:.        r
-0000e7d0: 6169 7365 2045 7863 6570 7469 6f6e 2866  aise Exception(f
-0000e7e0: 2253 6f6d 6574 6869 6e67 2077 656e 7420  "Something went 
-0000e7f0: 7772 6f6e 6720 6c61 756e 6368 696e 6720  wrong launching 
-0000e800: 7468 6520 564d 2061 7420 4950 3a20 7b68  the VM at IP: {h
-0000e810: 6f73 745f 6970 7d2e 2229 0a0a 2020 2020  ost_ip}.")..    
-0000e820: 6966 2022 7072 6f76 6973 696f 6e22 2069  if "provision" i
-0000e830: 6e20 6b77 6172 6773 2061 6e64 206e 6f74  n kwargs and not
-0000e840: 206b 7761 7267 735b 2270 726f 7669 7369   kwargs["provisi
-0000e850: 6f6e 225d 3a0a 2020 2020 2020 2020 7072  on"]:.        pr
-0000e860: 696e 7428 2253 6b69 7070 696e 6720 6175  int("Skipping au
-0000e870: 746f 6d61 7469 6320 7072 6f76 6973 696f  tomatic provisio
-0000e880: 6e69 6e67 2e22 290a 2020 2020 2020 2020  ning.").        
-0000e890: 7072 696e 7428 2256 4d20 6372 6561 7465  print("VM create
-0000e8a0: 6420 7769 7468 3a22 290a 2020 2020 2020  d with:").      
-0000e8b0: 2020 7072 696e 7428 6622 4950 3a20 7b68    print(f"IP: {h
-0000e8c0: 6f73 745f 6970 7d22 290a 2020 2020 2020  ost_ip}").      
-0000e8d0: 2020 7072 696e 7428 6622 5573 6572 3a20    print(f"User: 
-0000e8e0: 7b61 7574 682e 7573 6572 6e61 6d65 7d22  {auth.username}"
-0000e8f0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0000e900: 6622 4b65 793a 207b 6175 7468 2e6b 6579  f"Key: {auth.key
-0000e910: 5f70 6174 687d 2229 0a20 2020 2020 2020  _path}").       
-0000e920: 2070 7269 6e74 2822 5c6e 436f 6e6e 6563   print("\nConnec
-0000e930: 7420 7769 7468 3a22 290a 2020 2020 2020  t with:").      
-0000e940: 2020 7072 696e 7428 6622 7373 6820 2d69    print(f"ssh -i
-0000e950: 207b 6175 7468 2e6b 6579 5f70 6174 687d   {auth.key_path}
-0000e960: 207b 6175 7468 2e75 7365 726e 616d 657d   {auth.username}
-0000e970: 407b 686f 7374 5f69 707d 2229 0a20 2020  @{host_ip}").   
-0000e980: 2020 2020 2073 7973 2e65 7869 7428 3029       sys.exit(0)
-0000e990: 0a0a 2020 2020 2320 7265 706c 6163 650a  ..    # replace.
-0000e9a0: 2020 2020 686f 7374 5f74 6572 6d2e 7061      host_term.pa
-0000e9b0: 7273 655f 696e 7075 7428 686f 7374 5f69  rse_input(host_i
-0000e9c0: 7029 0a20 2020 2076 6572 622e 7365 745f  p).    verb.set_
-0000e9d0: 6e61 6d65 645f 7465 726d 5f74 7970 6528  named_term_type(
-0000e9e0: 6e61 6d65 3d22 686f 7374 222c 206e 6577  name="host", new
-0000e9f0: 5f74 6572 6d3d 686f 7374 5f74 6572 6d29  _term=host_term)
-0000ea00: 0a0a 2020 2020 6578 7472 615f 6b77 6172  ..    extra_kwar
-0000ea10: 6773 203d 207b 0a20 2020 2020 2020 2022  gs = {.        "
-0000ea20: 7265 706f 223a 2072 6570 6f2c 0a20 2020  repo": repo,.   
-0000ea30: 2020 2020 2022 6272 616e 6368 223a 2062       "branch": b
-0000ea40: 7261 6e63 682c 0a20 2020 2020 2020 2022  ranch,.        "
-0000ea50: 6175 7468 5f74 7970 6522 3a20 226b 6579  auth_type": "key
-0000ea60: 222c 0a20 2020 2020 2020 2022 616e 7369  ",.        "ansi
-0000ea70: 626c 655f 6578 7472 6173 223a 2061 6e73  ble_extras": ans
-0000ea80: 6962 6c65 5f65 7874 7261 732c 0a20 2020  ible_extras,.   
-0000ea90: 207d 0a20 2020 206b 7761 7267 732e 7570   }.    kwargs.up
-0000eaa0: 6461 7465 2865 7874 7261 5f6b 7761 7267  date(extra_kwarg
-0000eab0: 7329 0a0a 2020 2020 2320 7072 6f76 6973  s)..    # provis
-0000eac0: 696f 6e0a 2020 2020 7265 7475 726e 2063  ion.    return c
-0000ead0: 7265 6174 655f 6c61 756e 6368 5f63 7573  reate_launch_cus
-0000eae0: 746f 6d5f 636d 6428 7665 7262 3d76 6572  tom_cmd(verb=ver
-0000eaf0: 622c 2061 7574 683d 6175 7468 2c20 6b77  b, auth=auth, kw
-0000eb00: 6172 6773 3d6b 7761 7267 7329 0a0a 0a64  args=kwargs)...d
-0000eb10: 6566 206d 616b 655f 6763 705f 766d 280a  ef make_gcp_vm(.
-0000eb20: 2020 2020 766d 5f6e 616d 653a 2073 7472      vm_name: str
-0000eb30: 2c20 7072 6f6a 6563 745f 6964 3a20 7374  , project_id: st
-0000eb40: 722c 207a 6f6e 653a 2073 7472 2c20 6d61  r, zone: str, ma
-0000eb50: 6368 696e 655f 7479 7065 3a20 7374 722c  chine_type: str,
-0000eb60: 2064 6973 6b5f 7369 7a65 5f67 623a 2073   disk_size_gb: s
-0000eb70: 7472 0a29 202d 3e20 7374 723a 0a20 2020  tr.) -> str:.   
-0000eb80: 2063 7265 6174 655f 636d 6420 3d20 2267   create_cmd = "g
-0000eb90: 636c 6f75 6420 636f 6d70 7574 6520 696e  cloud compute in
-0000eba0: 7374 616e 6365 7320 6372 6561 7465 220a  stances create".
-0000ebb0: 2020 2020 6e65 7477 6f72 6b5f 7365 7474      network_sett
-0000ebc0: 696e 6773 203d 2022 6e65 7477 6f72 6b3d  ings = "network=
-0000ebd0: 6465 6661 756c 742c 6e65 7477 6f72 6b2d  default,network-
-0000ebe0: 7469 6572 3d50 5245 4d49 554d 220a 2020  tier=PREMIUM".  
-0000ebf0: 2020 6d61 696e 7465 6e61 6e63 655f 706f    maintenance_po
-0000ec00: 6c69 6379 203d 2022 4d49 4752 4154 4522  licy = "MIGRATE"
-0000ec10: 0a20 2020 2073 636f 7065 7320 3d20 5b0a  .    scopes = [.
-0000ec20: 2020 2020 2020 2020 2268 7474 7073 3a2f          "https:/
-0000ec30: 2f77 7777 2e67 6f6f 676c 6561 7069 732e  /www.googleapis.
-0000ec40: 636f 6d2f 6175 7468 2f64 6576 7374 6f72  com/auth/devstor
-0000ec50: 6167 652e 7265 6164 5f6f 6e6c 7922 2c0a  age.read_only",.
-0000ec60: 2020 2020 2020 2020 2268 7474 7073 3a2f          "https:/
-0000ec70: 2f77 7777 2e67 6f6f 676c 6561 7069 732e  /www.googleapis.
-0000ec80: 636f 6d2f 6175 7468 2f6c 6f67 6769 6e67  com/auth/logging
-0000ec90: 2e77 7269 7465 222c 0a20 2020 2020 2020  .write",.       
-0000eca0: 2022 6874 7470 733a 2f2f 7777 772e 676f   "https://www.go
-0000ecb0: 6f67 6c65 6170 6973 2e63 6f6d 2f61 7574  ogleapis.com/aut
-0000ecc0: 682f 6d6f 6e69 746f 7269 6e67 2e77 7269  h/monitoring.wri
-0000ecd0: 7465 222c 0a20 2020 2020 2020 2022 6874  te",.        "ht
-0000ece0: 7470 733a 2f2f 7777 772e 676f 6f67 6c65  tps://www.google
-0000ecf0: 6170 6973 2e63 6f6d 2f61 7574 682f 7365  apis.com/auth/se
-0000ed00: 7276 6963 6563 6f6e 7472 6f6c 222c 0a20  rvicecontrol",. 
-0000ed10: 2020 2020 2020 2022 6874 7470 733a 2f2f         "https://
-0000ed20: 7777 772e 676f 6f67 6c65 6170 6973 2e63  www.googleapis.c
-0000ed30: 6f6d 2f61 7574 682f 7365 7276 6963 652e  om/auth/service.
-0000ed40: 6d61 6e61 6765 6d65 6e74 2e72 6561 646f  management.reado
-0000ed50: 6e6c 7922 2c0a 2020 2020 2020 2020 2268  nly",.        "h
-0000ed60: 7474 7073 3a2f 2f77 7777 2e67 6f6f 676c  ttps://www.googl
-0000ed70: 6561 7069 732e 636f 6d2f 6175 7468 2f74  eapis.com/auth/t
-0000ed80: 7261 6365 2e61 7070 656e 6422 2c0a 2020  race.append",.  
-0000ed90: 2020 5d0a 2020 2020 7461 6773 203d 2022    ].    tags = "
-0000eda0: 6874 7470 2d73 6572 7665 722c 6874 7470  http-server,http
-0000edb0: 732d 7365 7276 6572 220a 2020 2020 6469  s-server".    di
-0000edc0: 736b 5f69 6d61 6765 203d 2022 7072 6f6a  sk_image = "proj
-0000edd0: 6563 7473 2f75 6275 6e74 752d 6f73 2d63  ects/ubuntu-os-c
-0000ede0: 6c6f 7564 2f67 6c6f 6261 6c2f 696d 6167  loud/global/imag
-0000edf0: 6573 2f75 6275 6e74 752d 3230 3034 2d66  es/ubuntu-2004-f
-0000ee00: 6f63 616c 2d76 3230 3232 3033 3038 220a  ocal-v20220308".
-0000ee10: 2020 2020 6469 736b 203d 2028 0a20 2020      disk = (.   
-0000ee20: 2020 2020 2066 2261 7574 6f2d 6465 6c65       f"auto-dele
-0000ee30: 7465 3d79 6573 2c62 6f6f 743d 7965 732c  te=yes,boot=yes,
-0000ee40: 6465 7669 6365 2d6e 616d 653d 7b76 6d5f  device-name={vm_
-0000ee50: 6e61 6d65 7d2c 696d 6167 653d 7b64 6973  name},image={dis
-0000ee60: 6b5f 696d 6167 657d 2c22 0a20 2020 2020  k_image},".     
-0000ee70: 2020 202b 2066 226d 6f64 653d 7277 2c73     + f"mode=rw,s
-0000ee80: 697a 653d 7b64 6973 6b5f 7369 7a65 5f67  ize={disk_size_g
-0000ee90: 627d 2c74 7970 653d 7064 2d73 7364 220a  b},type=pd-ssd".
-0000eea0: 2020 2020 290a 2020 2020 7365 6375 7269      ).    securi
-0000eeb0: 7479 5f66 6c61 6773 203d 2028 0a20 2020  ty_flags = (.   
-0000eec0: 2020 2020 2022 2d2d 6e6f 2d73 6869 656c       "--no-shiel
-0000eed0: 6465 642d 7365 6375 7265 2d62 6f6f 7420  ded-secure-boot 
-0000eee0: 2d2d 7368 6965 6c64 6564 2d76 7470 6d20  --shielded-vtpm 
-0000eef0: 220a 2020 2020 2020 2020 2b20 222d 2d73  ".        + "--s
-0000ef00: 6869 656c 6465 642d 696e 7465 6772 6974  hielded-integrit
-0000ef10: 792d 6d6f 6e69 746f 7269 6e67 202d 2d72  y-monitoring --r
-0000ef20: 6573 6572 7661 7469 6f6e 2d61 6666 696e  eservation-affin
-0000ef30: 6974 793d 616e 7922 0a20 2020 2029 0a0a  ity=any".    )..
-0000ef40: 2020 2020 636d 6420 3d20 280a 2020 2020      cmd = (.    
-0000ef50: 2020 2020 6622 7b63 7265 6174 655f 636d      f"{create_cm
-0000ef60: 647d 207b 766d 5f6e 616d 657d 2022 0a20  d} {vm_name} ". 
-0000ef70: 2020 2020 2020 202b 2066 222d 2d70 726f         + f"--pro
-0000ef80: 6a65 6374 3d7b 7072 6f6a 6563 745f 6964  ject={project_id
-0000ef90: 7d20 220a 2020 2020 2020 2020 2b20 6622  } ".        + f"
-0000efa0: 2d2d 7a6f 6e65 3d7b 7a6f 6e65 7d20 220a  --zone={zone} ".
-0000efb0: 2020 2020 2020 2020 2b20 6622 2d2d 6d61          + f"--ma
-0000efc0: 6368 696e 652d 7479 7065 3d7b 6d61 6368  chine-type={mach
-0000efd0: 696e 655f 7479 7065 7d20 220a 2020 2020  ine_type} ".    
-0000efe0: 2020 2020 2b20 6622 2d2d 6372 6561 7465      + f"--create
-0000eff0: 2d64 6973 6b3d 7b64 6973 6b7d 2022 0a20  -disk={disk} ". 
-0000f000: 2020 2020 2020 202b 2066 222d 2d6e 6574         + f"--net
-0000f010: 776f 726b 2d69 6e74 6572 6661 6365 3d7b  work-interface={
-0000f020: 6e65 7477 6f72 6b5f 7365 7474 696e 6773  network_settings
-0000f030: 7d20 220a 2020 2020 2020 2020 2b20 6622  } ".        + f"
-0000f040: 2d2d 6d61 696e 7465 6e61 6e63 652d 706f  --maintenance-po
-0000f050: 6c69 6379 3d7b 6d61 696e 7465 6e61 6e63  licy={maintenanc
-0000f060: 655f 706f 6c69 6379 7d20 220a 2020 2020  e_policy} ".    
-0000f070: 2020 2020 2b20 6622 2d2d 7363 6f70 6573      + f"--scopes
-0000f080: 3d7b 272c 272e 6a6f 696e 2873 636f 7065  ={','.join(scope
-0000f090: 7329 7d20 2d2d 7461 6773 3d7b 7461 6773  s)} --tags={tags
-0000f0a0: 7d20 220a 2020 2020 2020 2020 2b20 6622  } ".        + f"
-0000f0b0: 7b73 6563 7572 6974 795f 666c 6167 737d  {security_flags}
-0000f0c0: 220a 2020 2020 290a 0a20 2020 2068 6f73  ".    )..    hos
-0000f0d0: 745f 6970 203d 204e 6f6e 650a 2020 2020  t_ip = None.    
-0000f0e0: 7472 793a 0a20 2020 2020 2020 2070 7269  try:.        pri
-0000f0f0: 6e74 2866 2243 7265 6174 696e 6720 766d  nt(f"Creating vm
-0000f100: 2e5c 6e52 756e 6e69 6e67 3a20 7b63 6d64  .\nRunning: {cmd
-0000f110: 7d22 290a 2020 2020 2020 2020 6f75 7470  }").        outp
-0000f120: 7574 203d 2073 7562 7072 6f63 6573 732e  ut = subprocess.
-0000f130: 6368 6563 6b5f 6f75 7470 7574 2863 6d64  check_output(cmd
-0000f140: 2c20 7368 656c 6c3d 5472 7565 2920 2023  , shell=True)  #
-0000f150: 206e 6f73 6563 0a20 2020 2020 2020 2068   nosec.        h
-0000f160: 6f73 745f 6970 203d 2065 7874 7261 6374  ost_ip = extract
-0000f170: 5f68 6f73 745f 6970 5f67 6370 2873 7464  _host_ip_gcp(std
-0000f180: 6f75 743d 6f75 7470 7574 290a 2020 2020  out=output).    
-0000f190: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0000f1a0: 2061 7320 653a 0a20 2020 2020 2020 2070   as e:.        p
-0000f1b0: 7269 6e74 2822 6661 696c 6564 222c 2065  rint("failed", e
-0000f1c0: 290a 0a20 2020 2069 6620 686f 7374 5f69  )..    if host_i
-0000f1d0: 7020 6973 204e 6f6e 653a 0a20 2020 2020  p is None:.     
-0000f1e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000f1f0: 6f6e 2822 4661 696c 6564 2074 6f20 6372  on("Failed to cr
-0000f200: 6561 7465 2076 6d20 6f72 2067 6574 2056  eate vm or get V
-0000f210: 4d20 7075 626c 6963 2069 7022 290a 0a20  M public ip").. 
-0000f220: 2020 2072 6574 7572 6e20 686f 7374 5f69     return host_i
-0000f230: 700a 0a0a 6465 6620 6372 6561 7465 5f6c  p...def create_l
-0000f240: 6175 6e63 685f 617a 7572 655f 636d 6428  aunch_azure_cmd(
-0000f250: 0a20 2020 2076 6572 623a 2047 7261 6d6d  .    verb: Gramm
-0000f260: 6172 5665 7262 2c0a 2020 2020 7265 736f  arVerb,.    reso
-0000f270: 7572 6365 5f67 726f 7570 3a20 7374 722c  urce_group: str,
-0000f280: 0a20 2020 206c 6f63 6174 696f 6e3a 2073  .    location: s
-0000f290: 7472 2c0a 2020 2020 7369 7a65 3a20 7374  tr,.    size: st
-0000f2a0: 722c 0a20 2020 2075 7365 726e 616d 653a  r,.    username:
-0000f2b0: 2073 7472 2c0a 2020 2020 7061 7373 776f   str,.    passwo
-0000f2c0: 7264 3a20 4f70 7469 6f6e 616c 5b73 7472  rd: Optional[str
-0000f2d0: 5d2c 0a20 2020 206b 6579 5f70 6174 683a  ],.    key_path:
-0000f2e0: 204f 7074 696f 6e61 6c5b 7374 725d 2c0a   Optional[str],.
-0000f2f0: 2020 2020 7265 706f 3a20 7374 722c 0a20      repo: str,. 
-0000f300: 2020 2062 7261 6e63 683a 2073 7472 2c0a     branch: str,.
-0000f310: 2020 2020 6175 7468 3a20 4175 7468 4372      auth: AuthCr
-0000f320: 6564 656e 7469 616c 732c 0a20 2020 2061  edentials,.    a
-0000f330: 6e73 6962 6c65 5f65 7874 7261 733a 2073  nsible_extras: s
-0000f340: 7472 2c0a 2020 2020 6b77 6172 6773 3a20  tr,.    kwargs: 
-0000f350: 5479 7065 4469 6374 5b73 7472 2c20 416e  TypeDict[str, An
-0000f360: 795d 2c0a 2920 2d3e 2054 7970 654c 6973  y],.) -> TypeLis
-0000f370: 745b 7374 725d 3a0a 0a20 2020 2067 6574  t[str]:..    get
-0000f380: 5f6f 725f 6d61 6b65 5f72 6573 6f75 7263  _or_make_resourc
-0000f390: 655f 6772 6f75 7028 7265 736f 7572 6365  e_group(resource
-0000f3a0: 5f67 726f 7570 3d72 6573 6f75 7263 655f  _group=resource_
-0000f3b0: 6772 6f75 702c 206c 6f63 6174 696f 6e3d  group, location=
-0000f3c0: 6c6f 6361 7469 6f6e 290a 0a20 2020 206e  location)..    n
-0000f3d0: 6f64 655f 636f 756e 7420 3d20 6b77 6172  ode_count = kwar
-0000f3e0: 6773 2e67 6574 2822 6e6f 6465 5f63 6f75  gs.get("node_cou
-0000f3f0: 6e74 222c 2031 290a 2020 2020 7072 696e  nt", 1).    prin
-0000f400: 7428 2254 6f74 616c 2056 4d73 2074 6f20  t("Total VMs to 
-0000f410: 6372 6561 7465 3a20 222c 206e 6f64 655f  create: ", node_
-0000f420: 636f 756e 7429 0a0a 2020 2020 2320 766d  count)..    # vm
-0000f430: 0a20 2020 206e 6f64 655f 6e61 6d65 203d  .    node_name =
-0000f440: 2076 6572 622e 6765 745f 6e61 6d65 645f   verb.get_named_
-0000f450: 7465 726d 5f74 7970 6528 6e61 6d65 3d22  term_type(name="
-0000f460: 6e6f 6465 5f6e 616d 6522 290a 2020 2020  node_name").    
-0000f470: 736e 616b 655f 6e61 6d65 203d 2073 7472  snake_name = str
-0000f480: 286e 6f64 655f 6e61 6d65 2e73 6e61 6b65  (node_name.snake
-0000f490: 5f69 6e70 7574 290a 2020 2020 696d 6167  _input).    imag
-0000f4a0: 655f 6e61 6d65 203d 2067 6574 5f61 7a75  e_name = get_azu
-0000f4b0: 7265 5f69 6d61 6765 286b 7761 7267 735b  re_image(kwargs[
-0000f4c0: 2269 6d61 6765 5f6e 616d 6522 5d29 0a20  "image_name"]). 
-0000f4d0: 2020 2068 6f73 745f 6970 7320 3d20 6d61     host_ips = ma
-0000f4e0: 6b65 5f76 6d5f 617a 7572 6528 0a20 2020  ke_vm_azure(.   
-0000f4f0: 2020 2020 2073 6e61 6b65 5f6e 616d 652c       snake_name,
-0000f500: 0a20 2020 2020 2020 2072 6573 6f75 7263  .        resourc
-0000f510: 655f 6772 6f75 702c 0a20 2020 2020 2020  e_group,.       
-0000f520: 2075 7365 726e 616d 652c 0a20 2020 2020   username,.     
-0000f530: 2020 2070 6173 7377 6f72 642c 0a20 2020     password,.   
-0000f540: 2020 2020 206b 6579 5f70 6174 682c 0a20       key_path,. 
-0000f550: 2020 2020 2020 2073 697a 652c 0a20 2020         size,.   
-0000f560: 2020 2020 2069 6d61 6765 5f6e 616d 652c       image_name,
-0000f570: 0a20 2020 2020 2020 206e 6f64 655f 636f  .        node_co
-0000f580: 756e 742c 0a20 2020 2029 0a0a 2020 2020  unt,.    )..    
-0000f590: 2320 6f70 656e 2070 6f72 7420 3830 0a20  # open port 80. 
-0000f5a0: 2020 206f 7065 6e5f 706f 7274 5f76 6d5f     open_port_vm_
-0000f5b0: 617a 7572 6528 0a20 2020 2020 2020 2072  azure(.        r
-0000f5c0: 6573 6f75 7263 655f 6772 6f75 703d 7265  esource_group=re
-0000f5d0: 736f 7572 6365 5f67 726f 7570 2c0a 2020  source_group,.  
-0000f5e0: 2020 2020 2020 6e6f 6465 5f6e 616d 653d        node_name=
-0000f5f0: 736e 616b 655f 6e61 6d65 2c0a 2020 2020  snake_name,.    
-0000f600: 2020 2020 706f 7274 5f6e 616d 653d 2248      port_name="H
-0000f610: 5454 5022 2c0a 2020 2020 2020 2020 706f  TTP",.        po
-0000f620: 7274 3d38 302c 0a20 2020 2020 2020 2070  rt=80,.        p
-0000f630: 7269 6f72 6974 793d 3530 302c 0a20 2020  riority=500,.   
-0000f640: 2029 0a0a 2020 2020 2320 6f70 656e 2070   )..    # open p
-0000f650: 6f72 7420 3434 330a 2020 2020 6f70 656e  ort 443.    open
-0000f660: 5f70 6f72 745f 766d 5f61 7a75 7265 280a  _port_vm_azure(.
-0000f670: 2020 2020 2020 2020 7265 736f 7572 6365          resource
-0000f680: 5f67 726f 7570 3d72 6573 6f75 7263 655f  _group=resource_
-0000f690: 6772 6f75 702c 0a20 2020 2020 2020 206e  group,.        n
-0000f6a0: 6f64 655f 6e61 6d65 3d73 6e61 6b65 5f6e  ode_name=snake_n
-0000f6b0: 616d 652c 0a20 2020 2020 2020 2070 6f72  ame,.        por
-0000f6c0: 745f 6e61 6d65 3d22 4854 5450 5322 2c0a  t_name="HTTPS",.
-0000f6d0: 2020 2020 2020 2020 706f 7274 3d34 3433          port=443
-0000f6e0: 2c0a 2020 2020 2020 2020 7072 696f 7269  ,.        priori
-0000f6f0: 7479 3d35 3031 2c0a 2020 2020 290a 0a20  ty=501,.    ).. 
-0000f700: 2020 2069 6620 6b77 6172 6773 5b22 6a75     if kwargs["ju
-0000f710: 7079 7465 7222 5d3a 0a20 2020 2020 2020  pyter"]:.       
-0000f720: 2023 206f 7065 6e20 706f 7274 2038 3838   # open port 888
-0000f730: 380a 2020 2020 2020 2020 6f70 656e 5f70  8.        open_p
-0000f740: 6f72 745f 766d 5f61 7a75 7265 280a 2020  ort_vm_azure(.  
-0000f750: 2020 2020 2020 2020 2020 7265 736f 7572            resour
-0000f760: 6365 5f67 726f 7570 3d72 6573 6f75 7263  ce_group=resourc
-0000f770: 655f 6772 6f75 702c 0a20 2020 2020 2020  e_group,.       
-0000f780: 2020 2020 206e 6f64 655f 6e61 6d65 3d73       node_name=s
-0000f790: 6e61 6b65 5f6e 616d 652c 0a20 2020 2020  nake_name,.     
-0000f7a0: 2020 2020 2020 2070 6f72 745f 6e61 6d65         port_name
-0000f7b0: 3d22 4a75 7079 7465 7222 2c0a 2020 2020  ="Jupyter",.    
-0000f7c0: 2020 2020 2020 2020 706f 7274 3d38 3838          port=888
-0000f7d0: 382c 0a20 2020 2020 2020 2020 2020 2070  8,.            p
-0000f7e0: 7269 6f72 6974 793d 3530 322c 0a20 2020  riority=502,.   
-0000f7f0: 2020 2020 2029 0a0a 2020 2020 6c61 756e       )..    laun
-0000f800: 6368 5f63 6d64 733a 2054 7970 654c 6973  ch_cmds: TypeLis
-0000f810: 745b 7374 725d 203d 205b 5d0a 0a20 2020  t[str] = []..   
-0000f820: 2066 6f72 2068 6f73 745f 6970 2069 6e20   for host_ip in 
-0000f830: 686f 7374 5f69 7073 3a0a 2020 2020 2020  host_ips:.      
-0000f840: 2020 2320 6765 7420 6f6c 6420 686f 7374    # get old host
-0000f850: 0a20 2020 2020 2020 2068 6f73 745f 7465  .        host_te
-0000f860: 726d 203d 2076 6572 622e 6765 745f 6e61  rm = verb.get_na
-0000f870: 6d65 645f 7465 726d 5f68 6f73 7467 7261  med_term_hostgra
-0000f880: 6d6d 6172 286e 616d 653d 2268 6f73 7422  mmar(name="host"
-0000f890: 290a 0a20 2020 2020 2020 2023 2072 6570  )..        # rep
-0000f8a0: 6c61 6365 0a20 2020 2020 2020 2068 6f73  lace.        hos
-0000f8b0: 745f 7465 726d 2e70 6172 7365 5f69 6e70  t_term.parse_inp
-0000f8c0: 7574 2868 6f73 745f 6970 290a 2020 2020  ut(host_ip).    
-0000f8d0: 2020 2020 7665 7262 2e73 6574 5f6e 616d      verb.set_nam
-0000f8e0: 6564 5f74 6572 6d5f 7479 7065 286e 616d  ed_term_type(nam
-0000f8f0: 653d 2268 6f73 7422 2c20 6e65 775f 7465  e="host", new_te
-0000f900: 726d 3d68 6f73 745f 7465 726d 290a 0a20  rm=host_term).. 
-0000f910: 2020 2020 2020 2069 6620 2270 726f 7669         if "provi
-0000f920: 7369 6f6e 2220 696e 206b 7761 7267 7320  sion" in kwargs 
-0000f930: 616e 6420 6e6f 7420 6b77 6172 6773 5b22  and not kwargs["
-0000f940: 7072 6f76 6973 696f 6e22 5d3a 0a20 2020  provision"]:.   
-0000f950: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000f960: 536b 6970 7069 6e67 2061 7574 6f6d 6174  Skipping automat
-0000f970: 6963 2070 726f 7669 7369 6f6e 696e 672e  ic provisioning.
-0000f980: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
-0000f990: 7269 6e74 2822 564d 2063 7265 6174 6564  rint("VM created
-0000f9a0: 2077 6974 683a 2229 0a20 2020 2020 2020   with:").       
-0000f9b0: 2020 2020 2070 7269 6e74 2866 224e 616d       print(f"Nam
-0000f9c0: 653a 207b 736e 616b 655f 6e61 6d65 7d22  e: {snake_name}"
-0000f9d0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0000f9e0: 696e 7428 6622 4950 3a20 7b68 6f73 745f  int(f"IP: {host_
-0000f9f0: 6970 7d22 290a 2020 2020 2020 2020 2020  ip}").          
-0000fa00: 2020 7072 696e 7428 6622 5573 6572 3a20    print(f"User: 
-0000fa10: 7b75 7365 726e 616d 657d 2229 0a20 2020  {username}").   
-0000fa20: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0000fa30: 2250 6173 7377 6f72 643a 207b 7061 7373  "Password: {pass
-0000fa40: 776f 7264 7d22 290a 2020 2020 2020 2020  word}").        
-0000fa50: 2020 2020 7072 696e 7428 6622 4b65 793a      print(f"Key:
-0000fa60: 207b 6b65 795f 7061 7468 7d22 290a 2020   {key_path}").  
-0000fa70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000fa80: 225c 6e43 6f6e 6e65 6374 2077 6974 683a  "\nConnect with:
-0000fa90: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0000faa0: 6620 6b77 6172 6773 5b22 6175 7468 5f74  f kwargs["auth_t
-0000fab0: 7970 6522 5d20 3d3d 2022 6b65 7922 3a0a  ype"] == "key":.
-0000fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fad0: 7072 696e 7428 6622 7373 6820 2d69 207b  print(f"ssh -i {
-0000fae0: 6b65 795f 7061 7468 7d20 7b75 7365 726e  key_path} {usern
-0000faf0: 616d 657d 407b 686f 7374 5f69 707d 2229  ame}@{host_ip}")
-0000fb00: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000fb10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000fb20: 2020 2070 7269 6e74 2866 2273 7368 207b     print(f"ssh {
-0000fb30: 7573 6572 6e61 6d65 7d40 7b68 6f73 745f  username}@{host_
-0000fb40: 6970 7d22 290a 2020 2020 2020 2020 656c  ip}").        el
-0000fb50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000fb60: 6578 7472 615f 6b77 6172 6773 203d 207b  extra_kwargs = {
-0000fb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb80: 2022 7265 706f 223a 2072 6570 6f2c 0a20   "repo": repo,. 
-0000fb90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fba0: 6272 616e 6368 223a 2062 7261 6e63 682c  branch": branch,
-0000fbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fbc0: 2022 616e 7369 626c 655f 6578 7472 6173   "ansible_extras
-0000fbd0: 223a 2061 6e73 6962 6c65 5f65 7874 7261  ": ansible_extra
-0000fbe0: 732c 0a20 2020 2020 2020 2020 2020 207d  s,.            }
-0000fbf0: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
-0000fc00: 7267 732e 7570 6461 7465 2865 7874 7261  rgs.update(extra
-0000fc10: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
-0000fc20: 2020 2020 2020 2320 7072 6f76 6973 696f        # provisio
-0000fc30: 6e0a 2020 2020 2020 2020 2020 2020 686f  n.            ho
-0000fc40: 7374 5f75 7020 3d20 6368 6563 6b5f 6970  st_up = check_ip
-0000fc50: 5f66 6f72 5f73 7368 2868 6f73 745f 6970  _for_ssh(host_ip
-0000fc60: 3d68 6f73 745f 6970 290a 2020 2020 2020  =host_ip).      
-0000fc70: 2020 2020 2020 6966 206e 6f74 2068 6f73        if not hos
-0000fc80: 745f 7570 3a0a 2020 2020 2020 2020 2020  t_up:.          
-0000fc90: 2020 2020 2020 7072 696e 7428 6622 5761        print(f"Wa
-0000fca0: 726e 696e 673a 207b 686f 7374 5f69 707d  rning: {host_ip}
-0000fcb0: 2073 7368 206e 6f74 2061 7661 696c 6162   ssh not availab
-0000fcc0: 6c65 2079 6574 2229 0a20 2020 2020 2020  le yet").       
-0000fcd0: 2020 2020 206c 6175 6e63 685f 636d 6420       launch_cmd 
-0000fce0: 3d20 6372 6561 7465 5f6c 6175 6e63 685f  = create_launch_
-0000fcf0: 6375 7374 6f6d 5f63 6d64 2876 6572 623d  custom_cmd(verb=
-0000fd00: 7665 7262 2c20 6175 7468 3d61 7574 682c  verb, auth=auth,
-0000fd10: 206b 7761 7267 733d 6b77 6172 6773 290a   kwargs=kwargs).
-0000fd20: 2020 2020 2020 2020 2020 2020 6c61 756e              laun
-0000fd30: 6368 5f63 6d64 732e 6170 7065 6e64 286c  ch_cmds.append(l
-0000fd40: 6175 6e63 685f 636d 6429 0a0a 2020 2020  aunch_cmd)..    
-0000fd50: 7265 7475 726e 206c 6175 6e63 685f 636d  return launch_cm
-0000fd60: 6473 0a0a 0a64 6566 2063 7265 6174 655f  ds...def create_
-0000fd70: 616e 7369 626c 655f 6c61 6e64 5f63 6d64  ansible_land_cmd
-0000fd80: 280a 2020 2020 7665 7262 3a20 4772 616d  (.    verb: Gram
-0000fd90: 6d61 7256 6572 622c 2061 7574 683a 204f  marVerb, auth: O
-0000fda0: 7074 696f 6e61 6c5b 4175 7468 4372 6564  ptional[AuthCred
-0000fdb0: 656e 7469 616c 735d 2c20 6b77 6172 6773  entials], kwargs
-0000fdc0: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-0000fdd0: 416e 795d 0a29 202d 3e20 7374 723a 0a20  Any].) -> str:. 
-0000fde0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fdf0: 686f 7374 5f74 6572 6d20 3d20 7665 7262  host_term = verb
-0000fe00: 2e67 6574 5f6e 616d 6564 5f74 6572 6d5f  .get_named_term_
-0000fe10: 686f 7374 6772 616d 6d61 7228 6e61 6d65  hostgrammar(name
-0000fe20: 3d22 686f 7374 2229 0a20 2020 2020 2020  ="host").       
-0000fe30: 2070 7269 6e74 2822 4c61 6e64 696e 6720   print("Landing 
-0000fe40: 5079 4772 6964 206e 6f64 6520 6f6e 2070  PyGrid node on p
-0000fe50: 6f72 7420 2220 2b20 7374 7228 686f 7374  ort " + str(host
-0000fe60: 5f74 6572 6d2e 706f 7274 2920 2b20 2221  _term.port) + "!
-0000fe70: 5c6e 2229 0a0a 2020 2020 2020 2020 7072  \n")..        pr
-0000fe80: 696e 7428 2220 202d 2050 4f52 543a 2022  int("  - PORT: "
-0000fe90: 202b 2073 7472 2868 6f73 745f 7465 726d   + str(host_term
-0000fea0: 2e70 6f72 7429 290a 2020 2020 2020 2020  .port)).        
-0000feb0: 7072 696e 7428 225c 6e22 290a 0a20 2020  print("\n")..   
-0000fec0: 2020 2020 2070 6c61 7962 6f6f 6b5f 7061       playbook_pa
-0000fed0: 7468 203d 2047 5249 445f 5352 435f 5041  th = GRID_SRC_PA
-0000fee0: 5448 202b 2022 2f61 6e73 6962 6c65 2f73  TH + "/ansible/s
-0000fef0: 6974 652e 796d 6c22 0a20 2020 2020 2020  ite.yml".       
-0000ff00: 2061 6e73 6962 6c65 5f63 6667 5f70 6174   ansible_cfg_pat
-0000ff10: 6820 3d20 4752 4944 5f53 5243 5f50 4154  h = GRID_SRC_PAT
-0000ff20: 4820 2b20 222f 616e 7369 626c 652e 6366  H + "/ansible.cf
-0000ff30: 6722 0a20 2020 2020 2020 2061 7574 6820  g".        auth 
-0000ff40: 3d20 6361 7374 2841 7574 6843 7265 6465  = cast(AuthCrede
-0000ff50: 6e74 6961 6c73 2c20 6175 7468 290a 0a20  ntials, auth).. 
-0000ff60: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0000ff70: 2e70 6174 682e 6578 6973 7473 2870 6c61  .path.exists(pla
-0000ff80: 7962 6f6f 6b5f 7061 7468 293a 0a20 2020  ybook_path):.   
-0000ff90: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0000ffa0: 2243 616e 2774 2066 696e 6420 706c 6179  "Can't find play
-0000ffb0: 626f 6f6b 2073 6974 652e 796d 6c20 6174  book site.yml at
-0000ffc0: 3a20 7b70 6c61 7962 6f6f 6b5f 7061 7468  : {playbook_path
-0000ffd0: 7d22 290a 2020 2020 2020 2020 636d 6420  }").        cmd 
-0000ffe0: 3d20 6622 414e 5349 424c 455f 434f 4e46  = f"ANSIBLE_CONF
-0000fff0: 4947 3d7b 616e 7369 626c 655f 6366 675f  IG={ansible_cfg_
-00010000: 7061 7468 7d20 616e 7369 626c 652d 706c  path} ansible-pl
-00010010: 6179 626f 6f6b 2022 0a20 2020 2020 2020  aybook ".       
-00010020: 2069 6620 686f 7374 5f74 6572 6d2e 686f   if host_term.ho
-00010030: 7374 203d 3d20 226c 6f63 616c 686f 7374  st == "localhost
-00010040: 223a 0a20 2020 2020 2020 2020 2020 2063  ":.            c
-00010050: 6d64 202b 3d20 222d 2d63 6f6e 6e65 6374  md += "--connect
-00010060: 696f 6e3d 6c6f 6361 6c20 220a 2020 2020  ion=local ".    
-00010070: 2020 2020 636d 6420 2b3d 2066 222d 6920      cmd += f"-i 
-00010080: 7b68 6f73 745f 7465 726d 2e68 6f73 747d  {host_term.host}
-00010090: 2c20 7b70 6c61 7962 6f6f 6b5f 7061 7468  , {playbook_path
-000100a0: 7d22 0a20 2020 2020 2020 2069 6620 686f  }".        if ho
-000100b0: 7374 5f74 6572 6d2e 686f 7374 2021 3d20  st_term.host != 
-000100c0: 226c 6f63 616c 686f 7374 2220 616e 6420  "localhost" and 
-000100d0: 6b77 6172 6773 5b22 6175 7468 5f74 7970  kwargs["auth_typ
-000100e0: 6522 5d20 3d3d 2022 6b65 7922 3a0a 2020  e"] == "key":.  
-000100f0: 2020 2020 2020 2020 2020 636d 6420 2b3d            cmd +=
-00010100: 2066 2220 2d2d 7072 6976 6174 652d 6b65   f" --private-ke
-00010110: 7920 7b61 7574 682e 6b65 795f 7061 7468  y {auth.key_path
-00010120: 7d20 2d2d 7573 6572 207b 6175 7468 2e75  } --user {auth.u
-00010130: 7365 726e 616d 657d 220a 2020 2020 2020  sername}".      
-00010140: 2020 656c 6966 2068 6f73 745f 7465 726d    elif host_term
-00010150: 2e68 6f73 7420 213d 2022 6c6f 6361 6c68  .host != "localh
-00010160: 6f73 7422 2061 6e64 206b 7761 7267 735b  ost" and kwargs[
-00010170: 2261 7574 685f 7479 7065 225d 203d 3d20  "auth_type"] == 
-00010180: 2270 6173 7377 6f72 6422 3a0a 2020 2020  "password":.    
-00010190: 2020 2020 2020 2020 636d 6420 2b3d 2066          cmd += f
-000101a0: 2220 2d63 2070 6172 616d 696b 6f20 2d2d  " -c paramiko --
-000101b0: 7573 6572 207b 6175 7468 2e75 7365 726e  user {auth.usern
-000101c0: 616d 657d 220a 0a20 2020 2020 2020 2041  ame}"..        A
-000101d0: 4e53 4942 4c45 5f41 5247 5320 3d20 7b22  NSIBLE_ARGS = {"
-000101e0: 696e 7374 616c 6c22 3a20 2266 616c 7365  install": "false
-000101f0: 227d 0a0a 2020 2020 2020 2020 6966 2068  "}..        if h
-00010200: 6f73 745f 7465 726d 2e68 6f73 7420 213d  ost_term.host !=
-00010210: 2022 6c6f 6361 6c68 6f73 7422 2061 6e64   "localhost" and
-00010220: 206b 7761 7267 735b 2261 7574 685f 7479   kwargs["auth_ty
-00010230: 7065 225d 203d 3d20 2270 6173 7377 6f72  pe"] == "passwor
-00010240: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
-00010250: 414e 5349 424c 455f 4152 4753 5b22 616e  ANSIBLE_ARGS["an
-00010260: 7369 626c 655f 7373 685f 7061 7373 225d  sible_ssh_pass"]
-00010270: 203d 206b 7761 7267 735b 2270 6173 7377   = kwargs["passw
-00010280: 6f72 6422 5d0a 0a20 2020 2020 2020 2069  ord"]..        i
-00010290: 6620 686f 7374 5f74 6572 6d2e 686f 7374  f host_term.host
-000102a0: 203d 3d20 226c 6f63 616c 686f 7374 223a   == "localhost":
-000102b0: 0a20 2020 2020 2020 2020 2020 2041 4e53  .            ANS
-000102c0: 4942 4c45 5f41 5247 535b 226c 6f63 616c  IBLE_ARGS["local
-000102d0: 225d 203d 2022 7472 7565 220a 0a20 2020  "] = "true"..   
-000102e0: 2020 2020 2069 6620 2261 6e73 6962 6c65       if "ansible
-000102f0: 5f65 7874 7261 7322 2069 6e20 6b77 6172  _extras" in kwar
-00010300: 6773 2061 6e64 206b 7761 7267 735b 2261  gs and kwargs["a
-00010310: 6e73 6962 6c65 5f65 7874 7261 7322 5d20  nsible_extras"] 
-00010320: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-00010330: 2020 206f 7074 696f 6e73 203d 206b 7761     options = kwa
-00010340: 7267 735b 2261 6e73 6962 6c65 5f65 7874  rgs["ansible_ext
-00010350: 7261 7322 5d2e 7370 6c69 7428 222c 2229  ras"].split(",")
-00010360: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00010370: 206f 7074 696f 6e20 696e 206f 7074 696f   option in optio
-00010380: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00010390: 2020 2020 7061 7274 7320 3d20 6f70 7469      parts = opti
-000103a0: 6f6e 2e73 7472 6970 2829 2e73 706c 6974  on.strip().split
-000103b0: 2822 3d22 290a 2020 2020 2020 2020 2020  ("=").          
-000103c0: 2020 2020 2020 6966 206c 656e 2870 6172        if len(par
-000103d0: 7473 2920 3d3d 2032 3a0a 2020 2020 2020  ts) == 2:.      
-000103e0: 2020 2020 2020 2020 2020 2020 2020 414e                AN
-000103f0: 5349 424c 455f 4152 4753 5b70 6172 7473  SIBLE_ARGS[parts
-00010400: 5b30 5d5d 203d 2070 6172 7473 5b31 5d0a  [0]] = parts[1].
-00010410: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-00010420: 7620 696e 2041 4e53 4942 4c45 5f41 5247  v in ANSIBLE_ARG
-00010430: 532e 6974 656d 7328 293a 0a20 2020 2020  S.items():.     
-00010440: 2020 2020 2020 2063 6d64 202b 3d20 6622         cmd += f"
-00010450: 202d 6520 5c22 7b6b 7d3d 277b 767d 275c   -e \"{k}='{v}'\
-00010460: 2222 0a0a 2020 2020 2020 2020 636d 6420  ""..        cmd 
-00010470: 3d20 2263 6420 2220 2b20 4752 4944 5f53  = "cd " + GRID_S
-00010480: 5243 5f50 4154 4820 2b20 223b 2220 2b20  RC_PATH + ";" + 
-00010490: 636d 640a 2020 2020 2020 2020 7265 7475  cmd.        retu
-000104a0: 726e 2063 6d64 0a20 2020 2065 7863 6570  rn cmd.    excep
-000104b0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000104c0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-000104d0: 6622 4661 696c 6564 2074 6f20 636f 6e73  f"Failed to cons
-000104e0: 7472 7563 7420 6375 7374 6f6d 2064 6570  truct custom dep
-000104f0: 6c6f 796d 656e 7420 636d 643a 207b 636d  loyment cmd: {cm
-00010500: 647d 2e20 7b65 7d22 290a 2020 2020 2020  d}. {e}").      
-00010510: 2020 7261 6973 6520 650a 0a0a 6465 6620    raise e...def 
-00010520: 6372 6561 7465 5f6c 6175 6e63 685f 6375  create_launch_cu
-00010530: 7374 6f6d 5f63 6d64 280a 2020 2020 7665  stom_cmd(.    ve
-00010540: 7262 3a20 4772 616d 6d61 7256 6572 622c  rb: GrammarVerb,
-00010550: 2061 7574 683a 204f 7074 696f 6e61 6c5b   auth: Optional[
-00010560: 4175 7468 4372 6564 656e 7469 616c 735d  AuthCredentials]
-00010570: 2c20 6b77 6172 6773 3a20 5479 7065 4469  , kwargs: TypeDi
-00010580: 6374 5b73 7472 2c20 416e 795d 0a29 202d  ct[str, Any].) -
-00010590: 3e20 7374 723a 0a20 2020 2074 7279 3a0a  > str:.    try:.
-000105a0: 2020 2020 2020 2020 686f 7374 5f74 6572          host_ter
-000105b0: 6d20 3d20 7665 7262 2e67 6574 5f6e 616d  m = verb.get_nam
-000105c0: 6564 5f74 6572 6d5f 686f 7374 6772 616d  ed_term_hostgram
-000105d0: 6d61 7228 6e61 6d65 3d22 686f 7374 2229  mar(name="host")
-000105e0: 0a20 2020 2020 2020 206e 6f64 655f 6e61  .        node_na
-000105f0: 6d65 203d 2076 6572 622e 6765 745f 6e61  me = verb.get_na
-00010600: 6d65 645f 7465 726d 5f74 7970 6528 6e61  med_term_type(na
-00010610: 6d65 3d22 6e6f 6465 5f6e 616d 6522 290a  me="node_name").
-00010620: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00010630: 6520 3d20 7665 7262 2e67 6574 5f6e 616d  e = verb.get_nam
-00010640: 6564 5f74 6572 6d5f 7479 7065 286e 616d  ed_term_type(nam
-00010650: 653d 226e 6f64 655f 7479 7065 2229 0a20  e="node_type"). 
-00010660: 2020 2020 2020 2023 2073 6f75 7263 655f         # source_
-00010670: 7465 726d 203d 2076 6572 622e 6765 745f  term = verb.get_
-00010680: 6e61 6d65 645f 7465 726d 5f74 7970 6528  named_term_type(
-00010690: 6e61 6d65 3d22 736f 7572 6365 2229 0a0a  name="source")..
-000106a0: 2020 2020 2020 2020 736e 616b 655f 6e61          snake_na
-000106b0: 6d65 203d 2073 7472 286e 6f64 655f 6e61  me = str(node_na
-000106c0: 6d65 2e73 6e61 6b65 5f69 6e70 7574 290a  me.snake_input).
-000106d0: 0a20 2020 2020 2020 2069 6620 4152 543a  .        if ART:
-000106e0: 0a20 2020 2020 2020 2020 2020 2068 6167  .            hag
-000106f0: 7269 6428 290a 0a20 2020 2020 2020 2070  rid()..        p
-00010700: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-00010710: 2020 224c 6175 6e63 6869 6e67 2061 2022    "Launching a "
-00010720: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
-00010730: 7472 286e 6f64 655f 7479 7065 2e69 6e70  tr(node_type.inp
-00010740: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
-00010750: 2b20 2220 5079 4772 6964 206e 6f64 6520  + " PyGrid node 
-00010760: 6f6e 2070 6f72 7420 220a 2020 2020 2020  on port ".      
-00010770: 2020 2020 2020 2b20 7374 7228 686f 7374        + str(host
-00010780: 5f74 6572 6d2e 706f 7274 290a 2020 2020  _term.port).    
-00010790: 2020 2020 2020 2020 2b20 2221 5c6e 220a          + "!\n".
-000107a0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000107b0: 2020 2070 7269 6e74 2822 2020 2d20 5459     print("  - TY
-000107c0: 5045 3a20 2220 2b20 7374 7228 6e6f 6465  PE: " + str(node
-000107d0: 5f74 7970 652e 696e 7075 7429 290a 2020  _type.input)).  
-000107e0: 2020 2020 2020 7072 696e 7428 2220 202d        print("  -
-000107f0: 204e 414d 453a 2022 202b 2073 7472 2873   NAME: " + str(s
-00010800: 6e61 6b65 5f6e 616d 6529 290a 2020 2020  nake_name)).    
-00010810: 2020 2020 7072 696e 7428 2220 202d 2050      print("  - P
-00010820: 4f52 543a 2022 202b 2073 7472 2868 6f73  ORT: " + str(hos
-00010830: 745f 7465 726d 2e70 6f72 7429 290a 2020  t_term.port)).  
-00010840: 2020 2020 2020 7072 696e 7428 225c 6e22        print("\n"
-00010850: 290a 0a20 2020 2020 2020 2070 6c61 7962  )..        playb
-00010860: 6f6f 6b5f 7061 7468 203d 2047 5249 445f  ook_path = GRID_
-00010870: 5352 435f 5041 5448 202b 2022 2f61 6e73  SRC_PATH + "/ans
-00010880: 6962 6c65 2f73 6974 652e 796d 6c22 0a20  ible/site.yml". 
-00010890: 2020 2020 2020 2061 6e73 6962 6c65 5f63         ansible_c
-000108a0: 6667 5f70 6174 6820 3d20 4752 4944 5f53  fg_path = GRID_S
-000108b0: 5243 5f50 4154 4820 2b20 222f 616e 7369  RC_PATH + "/ansi
-000108c0: 626c 652e 6366 6722 0a20 2020 2020 2020  ble.cfg".       
-000108d0: 2061 7574 6820 3d20 6361 7374 2841 7574   auth = cast(Aut
-000108e0: 6843 7265 6465 6e74 6961 6c73 2c20 6175  hCredentials, au
-000108f0: 7468 290a 0a20 2020 2020 2020 2069 6620  th)..        if 
-00010900: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00010910: 7473 2870 6c61 7962 6f6f 6b5f 7061 7468  ts(playbook_path
-00010920: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00010930: 7269 6e74 2866 2243 616e 2774 2066 696e  rint(f"Can't fin
-00010940: 6420 706c 6179 626f 6f6b 2073 6974 652e  d playbook site.
-00010950: 796d 6c20 6174 3a20 7b70 6c61 7962 6f6f  yml at: {playboo
-00010960: 6b5f 7061 7468 7d22 290a 2020 2020 2020  k_path}").      
-00010970: 2020 636d 6420 3d20 6622 414e 5349 424c    cmd = f"ANSIBL
-00010980: 455f 434f 4e46 4947 3d7b 616e 7369 626c  E_CONFIG={ansibl
-00010990: 655f 6366 675f 7061 7468 7d20 616e 7369  e_cfg_path} ansi
-000109a0: 626c 652d 706c 6179 626f 6f6b 2022 0a20  ble-playbook ". 
-000109b0: 2020 2020 2020 2069 6620 686f 7374 5f74         if host_t
-000109c0: 6572 6d2e 686f 7374 203d 3d20 226c 6f63  erm.host == "loc
-000109d0: 616c 686f 7374 223a 0a20 2020 2020 2020  alhost":.       
-000109e0: 2020 2020 2063 6d64 202b 3d20 222d 2d63       cmd += "--c
-000109f0: 6f6e 6e65 6374 696f 6e3d 6c6f 6361 6c20  onnection=local 
-00010a00: 220a 2020 2020 2020 2020 636d 6420 2b3d  ".        cmd +=
-00010a10: 2066 222d 6920 7b68 6f73 745f 7465 726d   f"-i {host_term
-00010a20: 2e68 6f73 747d 2c20 7b70 6c61 7962 6f6f  .host}, {playboo
-00010a30: 6b5f 7061 7468 7d22 0a20 2020 2020 2020  k_path}".       
-00010a40: 2069 6620 686f 7374 5f74 6572 6d2e 686f   if host_term.ho
-00010a50: 7374 2021 3d20 226c 6f63 616c 686f 7374  st != "localhost
-00010a60: 2220 616e 6420 6b77 6172 6773 5b22 6175  " and kwargs["au
-00010a70: 7468 5f74 7970 6522 5d20 3d3d 2022 6b65  th_type"] == "ke
-00010a80: 7922 3a0a 2020 2020 2020 2020 2020 2020  y":.            
-00010a90: 636d 6420 2b3d 2066 2220 2d2d 7072 6976  cmd += f" --priv
-00010aa0: 6174 652d 6b65 7920 7b61 7574 682e 6b65  ate-key {auth.ke
-00010ab0: 795f 7061 7468 7d20 2d2d 7573 6572 207b  y_path} --user {
-00010ac0: 6175 7468 2e75 7365 726e 616d 657d 220a  auth.username}".
-00010ad0: 2020 2020 2020 2020 656c 6966 2068 6f73          elif hos
-00010ae0: 745f 7465 726d 2e68 6f73 7420 213d 2022  t_term.host != "
-00010af0: 6c6f 6361 6c68 6f73 7422 2061 6e64 206b  localhost" and k
-00010b00: 7761 7267 735b 2261 7574 685f 7479 7065  wargs["auth_type
-00010b10: 225d 203d 3d20 2270 6173 7377 6f72 6422  "] == "password"
-00010b20: 3a0a 2020 2020 2020 2020 2020 2020 636d  :.            cm
-00010b30: 6420 2b3d 2066 2220 2d63 2070 6172 616d  d += f" -c param
-00010b40: 696b 6f20 2d2d 7573 6572 207b 6175 7468  iko --user {auth
-00010b50: 2e75 7365 726e 616d 657d 220a 0a20 2020  .username}"..   
-00010b60: 2020 2020 2076 6572 7369 6f6e 5f73 7472       version_str
-00010b70: 696e 6720 3d20 6b77 6172 6773 5b22 7461  ing = kwargs["ta
-00010b80: 6722 5d0a 2020 2020 2020 2020 6966 2076  g"].        if v
-00010b90: 6572 7369 6f6e 5f73 7472 696e 6720 6973  ersion_string is
-00010ba0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00010bb0: 2020 2076 6572 7369 6f6e 5f73 7472 696e     version_strin
-00010bc0: 6720 3d20 226c 6f63 616c 220a 0a20 2020  g = "local"..   
-00010bd0: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
-00010be0: 5320 3d20 7b0a 2020 2020 2020 2020 2020  S = {.          
-00010bf0: 2020 226e 6f64 655f 7479 7065 223a 206e    "node_type": n
-00010c00: 6f64 655f 7479 7065 2e69 6e70 7574 2c0a  ode_type.input,.
-00010c10: 2020 2020 2020 2020 2020 2020 226e 6f64              "nod
-00010c20: 655f 6e61 6d65 223a 2073 6e61 6b65 5f6e  e_name": snake_n
-00010c30: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00010c40: 2022 6769 7468 7562 5f72 6570 6f22 3a20   "github_repo": 
-00010c50: 6b77 6172 6773 5b22 7265 706f 225d 2c0a  kwargs["repo"],.
-00010c60: 2020 2020 2020 2020 2020 2020 2272 6570              "rep
-00010c70: 6f5f 6272 616e 6368 223a 206b 7761 7267  o_branch": kwarg
-00010c80: 735b 2262 7261 6e63 6822 5d2c 0a20 2020  s["branch"],.   
-00010c90: 2020 2020 2020 2020 2022 646f 636b 6572           "docker
-00010ca0: 5f74 6167 223a 2076 6572 7369 6f6e 5f73  _tag": version_s
-00010cb0: 7472 696e 672c 0a20 2020 2020 2020 207d  tring,.        }
-00010cc0: 0a0a 2020 2020 2020 2020 6966 2068 6f73  ..        if hos
-00010cd0: 745f 7465 726d 2e68 6f73 7420 213d 2022  t_term.host != "
-00010ce0: 6c6f 6361 6c68 6f73 7422 2061 6e64 206b  localhost" and k
-00010cf0: 7761 7267 735b 2261 7574 685f 7479 7065  wargs["auth_type
-00010d00: 225d 203d 3d20 2270 6173 7377 6f72 6422  "] == "password"
-00010d10: 3a0a 2020 2020 2020 2020 2020 2020 414e  :.            AN
-00010d20: 5349 424c 455f 4152 4753 5b22 616e 7369  SIBLE_ARGS["ansi
-00010d30: 626c 655f 7373 685f 7061 7373 225d 203d  ble_ssh_pass"] =
-00010d40: 206b 7761 7267 735b 2270 6173 7377 6f72   kwargs["passwor
-00010d50: 6422 5d0a 0a20 2020 2020 2020 2069 6620  d"]..        if 
-00010d60: 686f 7374 5f74 6572 6d2e 686f 7374 203d  host_term.host =
-00010d70: 3d20 226c 6f63 616c 686f 7374 223a 0a20  = "localhost":. 
-00010d80: 2020 2020 2020 2020 2020 2041 4e53 4942             ANSIB
-00010d90: 4c45 5f41 5247 535b 226c 6f63 616c 225d  LE_ARGS["local"]
-00010da0: 203d 2022 7472 7565 220a 0a20 2020 2020   = "true"..     
-00010db0: 2020 2069 6620 6b77 6172 6773 5b22 746c     if kwargs["tl
-00010dc0: 7322 5d20 6973 2054 7275 653a 0a20 2020  s"] is True:.   
-00010dd0: 2020 2020 2020 2020 2041 4e53 4942 4c45           ANSIBLE
-00010de0: 5f41 5247 535b 2274 6c73 225d 203d 2022  _ARGS["tls"] = "
-00010df0: 7472 7565 220a 0a20 2020 2020 2020 2069  true"..        i
-00010e00: 6620 2272 656c 6561 7365 2220 696e 206b  f "release" in k
-00010e10: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
-00010e20: 2020 2041 4e53 4942 4c45 5f41 5247 535b     ANSIBLE_ARGS[
-00010e30: 2272 656c 6561 7365 225d 203d 206b 7761  "release"] = kwa
-00010e40: 7267 735b 2272 656c 6561 7365 225d 0a0a  rgs["release"]..
-00010e50: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00010e60: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-00010e70: 2274 6c73 225d 2069 7320 5472 7565 0a20  "tls"] is True. 
-00010e80: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
-00010e90: 6365 7274 5f73 746f 7265 5f70 6174 6822  cert_store_path"
-00010ea0: 2069 6e20 6b77 6172 6773 0a20 2020 2020   in kwargs.     
-00010eb0: 2020 2020 2020 2061 6e64 206c 656e 286b         and len(k
-00010ec0: 7761 7267 735b 2263 6572 745f 7374 6f72  wargs["cert_stor
-00010ed0: 655f 7061 7468 225d 2920 3e20 300a 2020  e_path"]) > 0.  
-00010ee0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00010ef0: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
-00010f00: 535b 2263 6572 745f 7374 6f72 655f 7061  S["cert_store_pa
-00010f10: 7468 225d 203d 206b 7761 7267 735b 2263  th"] = kwargs["c
-00010f20: 6572 745f 7374 6f72 655f 7061 7468 225d  ert_store_path"]
-00010f30: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
-00010f40: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00010f50: 735b 2274 6c73 225d 2069 7320 5472 7565  s["tls"] is True
-00010f60: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00010f70: 2022 7570 6c6f 6164 5f74 6c73 5f6b 6579   "upload_tls_key
-00010f80: 2220 696e 206b 7761 7267 730a 2020 2020  " in kwargs.    
-00010f90: 2020 2020 2020 2020 616e 6420 6c65 6e28          and len(
-00010fa0: 6b77 6172 6773 5b22 7570 6c6f 6164 5f74  kwargs["upload_t
-00010fb0: 6c73 5f6b 6579 225d 2920 3e20 300a 2020  ls_key"]) > 0.  
-00010fc0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00010fd0: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
-00010fe0: 535b 2275 706c 6f61 645f 746c 735f 6b65  S["upload_tls_ke
-00010ff0: 7922 5d20 3d20 6b77 6172 6773 5b22 7570  y"] = kwargs["up
-00011000: 6c6f 6164 5f74 6c73 5f6b 6579 225d 0a0a  load_tls_key"]..
-00011010: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00011020: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-00011030: 2274 6c73 225d 2069 7320 5472 7565 0a20  "tls"] is True. 
-00011040: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
-00011050: 7570 6c6f 6164 5f74 6c73 5f63 6572 7422  upload_tls_cert"
-00011060: 2069 6e20 6b77 6172 6773 0a20 2020 2020   in kwargs.     
-00011070: 2020 2020 2020 2061 6e64 206c 656e 286b         and len(k
-00011080: 7761 7267 735b 2275 706c 6f61 645f 746c  wargs["upload_tl
-00011090: 735f 6365 7274 225d 2920 3e20 300a 2020  s_cert"]) > 0.  
-000110a0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-000110b0: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
-000110c0: 535b 2275 706c 6f61 645f 746c 735f 6365  S["upload_tls_ce
-000110d0: 7274 225d 203d 206b 7761 7267 735b 2275  rt"] = kwargs["u
-000110e0: 706c 6f61 645f 746c 735f 6365 7274 225d  pload_tls_cert"]
-000110f0: 0a0a 2020 2020 2020 2020 6966 206b 7761  ..        if kwa
-00011100: 7267 735b 226a 7570 7974 6572 225d 2069  rgs["jupyter"] i
-00011110: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
-00011120: 2020 2020 414e 5349 424c 455f 4152 4753      ANSIBLE_ARGS
-00011130: 5b22 6a75 7079 7465 7222 5d20 3d20 2274  ["jupyter"] = "t
-00011140: 7275 6522 0a20 2020 2020 2020 2020 2020  rue".           
-00011150: 2041 4e53 4942 4c45 5f41 5247 535b 226a   ANSIBLE_ARGS["j
-00011160: 7570 7974 6572 5f74 6f6b 656e 225d 203d  upyter_token"] =
-00011170: 2067 656e 6572 6174 655f 7365 635f 7261   generate_sec_ra
-00011180: 6e64 6f6d 5f70 6173 7377 6f72 6428 0a20  ndom_password(. 
-00011190: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000111a0: 656e 6774 683d 3438 2c20 7570 7065 725f  ength=48, upper_
-000111b0: 6361 7365 3d46 616c 7365 2c20 7370 6563  case=False, spec
-000111c0: 6961 6c5f 6368 6172 733d 4661 6c73 650a  ial_chars=False.
-000111d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000111e0: 2020 2020 2020 2069 6620 2261 6e73 6962         if "ansib
-000111f0: 6c65 5f65 7874 7261 7322 2069 6e20 6b77  le_extras" in kw
-00011200: 6172 6773 2061 6e64 206b 7761 7267 735b  args and kwargs[
-00011210: 2261 6e73 6962 6c65 5f65 7874 7261 7322  "ansible_extras"
-00011220: 5d20 213d 2022 223a 0a20 2020 2020 2020  ] != "":.       
-00011230: 2020 2020 206f 7074 696f 6e73 203d 206b       options = k
-00011240: 7761 7267 735b 2261 6e73 6962 6c65 5f65  wargs["ansible_e
-00011250: 7874 7261 7322 5d2e 7370 6c69 7428 222c  xtras"].split(",
-00011260: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
-00011270: 6f72 206f 7074 696f 6e20 696e 206f 7074  or option in opt
-00011280: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
-00011290: 2020 2020 2020 7061 7274 7320 3d20 6f70        parts = op
-000112a0: 7469 6f6e 2e73 7472 6970 2829 2e73 706c  tion.strip().spl
-000112b0: 6974 2822 3d22 290a 2020 2020 2020 2020  it("=").        
-000112c0: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
-000112d0: 6172 7473 2920 3d3d 2032 3a0a 2020 2020  arts) == 2:.    
-000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112f0: 414e 5349 424c 455f 4152 4753 5b70 6172  ANSIBLE_ARGS[par
-00011300: 7473 5b30 5d5d 203d 2070 6172 7473 5b31  ts[0]] = parts[1
-00011310: 5d0a 0a20 2020 2020 2020 2023 2069 6620  ]..        # if 
-00011320: 6d6f 6465 203d 3d20 2264 6570 6c6f 7922  mode == "deploy"
-00011330: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-00011340: 414e 5349 424c 455f 4152 4753 5b22 6465  ANSIBLE_ARGS["de
-00011350: 706c 6f79 225d 203d 2022 7472 7565 220a  ploy"] = "true".
-00011360: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-00011370: 7620 696e 2041 4e53 4942 4c45 5f41 5247  v in ANSIBLE_ARG
-00011380: 532e 6974 656d 7328 293a 0a20 2020 2020  S.items():.     
-00011390: 2020 2020 2020 2063 6d64 202b 3d20 6622         cmd += f"
-000113a0: 202d 6520 5c22 7b6b 7d3d 277b 767d 275c   -e \"{k}='{v}'\
-000113b0: 2222 0a0a 2020 2020 2020 2020 636d 6420  ""..        cmd 
-000113c0: 3d20 2263 6420 2220 2b20 4752 4944 5f53  = "cd " + GRID_S
-000113d0: 5243 5f50 4154 4820 2b20 223b 2220 2b20  RC_PATH + ";" + 
-000113e0: 636d 640a 2020 2020 2020 2020 7265 7475  cmd.        retu
-000113f0: 726e 2063 6d64 0a20 2020 2065 7863 6570  rn cmd.    excep
-00011400: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00011410: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00011420: 6622 4661 696c 6564 2074 6f20 636f 6e73  f"Failed to cons
-00011430: 7472 7563 7420 6375 7374 6f6d 2064 6570  truct custom dep
-00011440: 6c6f 796d 656e 7420 636d 643a 207b 636d  loyment cmd: {cm
-00011450: 647d 2e20 7b65 7d22 290a 2020 2020 2020  d}. {e}").      
-00011460: 2020 7261 6973 6520 650a 0a0a 6465 6620    raise e...def 
-00011470: 6372 6561 7465 5f6c 616e 645f 636d 6428  create_land_cmd(
-00011480: 7665 7262 3a20 4772 616d 6d61 7256 6572  verb: GrammarVer
-00011490: 622c 206b 7761 7267 733a 2054 7970 6544  b, kwargs: TypeD
-000114a0: 6963 745b 7374 722c 2041 6e79 5d29 202d  ict[str, Any]) -
-000114b0: 3e20 7374 723a 0a20 2020 2068 6f73 745f  > str:.    host_
-000114c0: 7465 726d 203d 2076 6572 622e 6765 745f  term = verb.get_
-000114d0: 6e61 6d65 645f 7465 726d 5f68 6f73 7467  named_term_hostg
-000114e0: 7261 6d6d 6172 286e 616d 653d 2268 6f73  rammar(name="hos
-000114f0: 7422 290a 2020 2020 686f 7374 203d 2068  t").    host = h
-00011500: 6f73 745f 7465 726d 2e68 6f73 7420 6966  ost_term.host if
-00011510: 2068 6f73 745f 7465 726d 2e68 6f73 7420   host_term.host 
-00011520: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00011530: 2022 220a 0a20 2020 2069 6620 686f 7374   ""..    if host
-00011540: 2069 6e20 5b22 646f 636b 6572 225d 3a0a   in ["docker"]:.
-00011550: 2020 2020 2020 2020 7461 7267 6574 203d          target =
-00011560: 2076 6572 622e 6765 745f 6e61 6d65 645f   verb.get_named_
-00011570: 7465 726d 5f67 7261 6d6d 6172 2822 6e6f  term_grammar("no
-00011580: 6465 5f6e 616d 6522 292e 696e 7075 740a  de_name").input.
-00011590: 2020 2020 2020 2020 6966 2074 6172 6765          if targe
-000115a0: 7420 3d3d 2022 616c 6c22 3a0a 2020 2020  t == "all":.    
-000115b0: 2020 2020 2020 2020 2320 7375 6270 726f          # subpro
-000115c0: 6365 7373 2e63 616c 6c28 2264 6f63 6b65  cess.call("docke
-000115d0: 7220 726d 2060 646f 636b 6572 2070 7320  r rm `docker ps 
-000115e0: 2d61 7160 202d 2d66 6f72 6365 222c 2073  -aq` --force", s
-000115f0: 6865 6c6c 3d54 7275 6529 2023 206e 6f73  hell=True) # nos
-00011600: 6563 0a20 2020 2020 2020 2020 2020 2072  ec.            r
-00011610: 6574 7572 6e20 2264 6f63 6b65 7220 726d  eturn "docker rm
-00011620: 2060 646f 636b 6572 2070 7320 2d61 7160   `docker ps -aq`
-00011630: 202d 2d66 6f72 6365 220a 0a20 2020 2020   --force"..     
-00011640: 2020 2076 6572 7369 6f6e 203d 2063 6865     version = che
-00011650: 636b 5f64 6f63 6b65 725f 7665 7273 696f  ck_docker_versio
-00011660: 6e28 290a 2020 2020 2020 2020 6966 2076  n().        if v
-00011670: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-00011680: 2020 2020 7265 7475 726e 2063 7265 6174      return creat
-00011690: 655f 6c61 6e64 5f64 6f63 6b65 725f 636d  e_land_docker_cm
-000116a0: 6428 7665 7262 3d76 6572 6229 0a20 2020  d(verb=verb).   
-000116b0: 2065 6c69 6620 686f 7374 203d 3d20 226c   elif host == "l
-000116c0: 6f63 616c 686f 7374 2220 6f72 2069 735f  ocalhost" or is_
-000116d0: 7661 6c69 645f 6970 2868 6f73 7429 3a0a  valid_ip(host):.
-000116e0: 2020 2020 2020 2020 7061 7273 6564 5f6b          parsed_k
-000116f0: 7761 7267 7320 3d20 7b7d 0a20 2020 2020  wargs = {}.     
-00011700: 2020 2069 6620 4445 5045 4e44 454e 4349     if DEPENDENCI
-00011710: 4553 5b22 616e 7369 626c 652d 706c 6179  ES["ansible-play
-00011720: 626f 6f6b 225d 3a0a 2020 2020 2020 2020  book"]:.        
-00011730: 2020 2020 6966 2068 6f73 7420 213d 2022      if host != "
-00011740: 6c6f 6361 6c68 6f73 7422 3a0a 2020 2020  localhost":.    
-00011750: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-00011760: 6564 5f6b 7761 7267 735b 2275 7365 726e  ed_kwargs["usern
-00011770: 616d 6522 5d20 3d20 6173 6b28 0a20 2020  ame"] = ask(.   
-00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011790: 2071 7565 7374 696f 6e3d 5175 6573 7469   question=Questi
-000117a0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000117b0: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-000117c0: 6e61 6d65 3d22 7573 6572 6e61 6d65 222c  name="username",
-000117d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000117e0: 2020 2020 2020 2020 2071 7565 7374 696f           questio
-000117f0: 6e3d 6622 5573 6572 6e61 6d65 2066 6f72  n=f"Username for
-00011800: 207b 686f 7374 7d20 7769 7468 2073 7564   {host} with sud
-00011810: 6f20 7072 6976 6c65 6467 6573 3f22 2c0a  o privledges?",.
-00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011830: 2020 2020 2020 2020 6465 6661 756c 743d          default=
-00011840: 6172 675f 6361 6368 652e 7573 6572 6e61  arg_cache.userna
-00011850: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00011860: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
-00011870: 3d22 7374 7269 6e67 222c 0a20 2020 2020  ="string",.     
-00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011890: 2020 2063 6163 6865 3d54 7275 652c 0a20     cache=True,. 
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-000118c0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-000118d0: 3d6b 7761 7267 732c 0a20 2020 2020 2020  =kwargs,.       
-000118e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000118f0: 2020 2020 2020 2020 2020 2070 6172 7365             parse
-00011900: 645f 6b77 6172 6773 5b22 6175 7468 5f74  d_kwargs["auth_t
-00011910: 7970 6522 5d20 3d20 6173 6b28 0a20 2020  ype"] = ask(.   
-00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011930: 2071 7565 7374 696f 6e3d 5175 6573 7469   question=Questi
-00011940: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00011950: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-00011960: 6e61 6d65 3d22 6175 7468 5f74 7970 6522  name="auth_type"
-00011970: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011980: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-00011990: 6f6e 3d22 446f 2079 6f75 2077 616e 7420  on="Do you want 
-000119a0: 746f 206c 6f67 696e 2077 6974 6820 6120  to login with a 
-000119b0: 6b65 7920 6f72 2070 6173 7377 6f72 6422  key or password"
-000119c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000119d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000119e0: 743d 6172 675f 6361 6368 652e 6175 7468  t=arg_cache.auth
-000119f0: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
-00011a00: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00011a10: 696e 643d 226f 7074 696f 6e22 2c0a 2020  ind="option",.  
-00011a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a30: 2020 2020 2020 6f70 7469 6f6e 733d 5b22        options=["
-00011a40: 6b65 7922 2c20 2270 6173 7377 6f72 6422  key", "password"
-00011a50: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00011a60: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00011a70: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00011a80: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00011a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011aa0: 2020 6b77 6172 6773 3d6b 7761 7267 732c    kwargs=kwargs,
-00011ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ac0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00011ad0: 2020 2069 6620 7061 7273 6564 5f6b 7761     if parsed_kwa
-00011ae0: 7267 735b 2261 7574 685f 7479 7065 225d  rgs["auth_type"]
-00011af0: 203d 3d20 226b 6579 223a 0a20 2020 2020   == "key":.     
-00011b00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00011b10: 6172 7365 645f 6b77 6172 6773 5b22 6b65  arsed_kwargs["ke
-00011b20: 795f 7061 7468 225d 203d 2061 736b 280a  y_path"] = ask(.
-00011b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b40: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
-00011b50: 3d51 7565 7374 696f 6e28 0a20 2020 2020  =Question(.     
-00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b70: 2020 2020 2020 2076 6172 5f6e 616d 653d         var_name=
-00011b80: 226b 6579 5f70 6174 6822 2c0a 2020 2020  "key_path",.    
-00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ba0: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
-00011bb0: 3d66 2250 7269 7661 7465 206b 6579 2074  =f"Private key t
-00011bc0: 6f20 6163 6365 7373 207b 7061 7273 6564  o access {parsed
-00011bd0: 5f6b 7761 7267 735b 2775 7365 726e 616d  _kwargs['usernam
-00011be0: 6527 5d7d 407b 686f 7374 7d3f 222c 0a20  e']}@{host}?",. 
-00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c00: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00011c10: 6c74 3d61 7267 5f63 6163 6865 2e6b 6579  lt=arg_cache.key
-00011c20: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c40: 2020 206b 696e 643d 2270 6174 6822 2c0a     kind="path",.
-00011c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c60: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-00011c70: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00011ca0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00011cb0: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
-00011cc0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00011cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ce0: 656c 6966 2070 6172 7365 645f 6b77 6172  elif parsed_kwar
-00011cf0: 6773 5b22 6175 7468 5f74 7970 6522 5d20  gs["auth_type"] 
-00011d00: 3d3d 2022 7061 7373 776f 7264 223a 0a20  == "password":. 
-00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d20: 2020 2070 6172 7365 645f 6b77 6172 6773     parsed_kwargs
-00011d30: 5b22 7061 7373 776f 7264 225d 203d 2061  ["password"] = a
-00011d40: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
-00011d50: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-00011d60: 7469 6f6e 3d51 7565 7374 696f 6e28 0a20  tion=Question(. 
-00011d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d80: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
-00011d90: 616d 653d 2270 6173 7377 6f72 6422 2c0a  ame="password",.
-00011da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011db0: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-00011dc0: 7469 6f6e 3d66 2250 6173 7377 6f72 6420  tion=f"Password 
-00011dd0: 666f 7220 7b70 6172 7365 645f 6b77 6172  for {parsed_kwar
-00011de0: 6773 5b27 7573 6572 6e61 6d65 275d 7d40  gs['username']}@
-00011df0: 7b68 6f73 747d 3f22 2c0a 2020 2020 2020  {host}?",.      
-00011e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e10: 2020 2020 2020 6b69 6e64 3d22 7061 7373        kind="pass
-00011e20: 776f 7264 222c 0a20 2020 2020 2020 2020  word",.         
-00011e30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00011e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011e50: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00011e60: 3d6b 7761 7267 732c 0a20 2020 2020 2020  =kwargs,.       
-00011e70: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00011e80: 2020 2020 2020 2020 2020 2020 6175 7468              auth
-00011e90: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00011ea0: 2020 2020 6966 2068 6f73 7420 213d 2022      if host != "
-00011eb0: 6c6f 6361 6c68 6f73 7422 3a0a 2020 2020  localhost":.    
-00011ec0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00011ed0: 6172 7365 645f 6b77 6172 6773 5b22 6175  arsed_kwargs["au
-00011ee0: 7468 5f74 7970 6522 5d20 3d3d 2022 6b65  th_type"] == "ke
-00011ef0: 7922 3a0a 2020 2020 2020 2020 2020 2020  y":.            
-00011f00: 2020 2020 2020 2020 6175 7468 203d 2041          auth = A
-00011f10: 7574 6843 7265 6465 6e74 6961 6c73 280a  uthCredentials(.
-00011f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f30: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
-00011f40: 3d70 6172 7365 645f 6b77 6172 6773 5b22  =parsed_kwargs["
-00011f50: 7573 6572 6e61 6d65 225d 2c0a 2020 2020  username"],.    
-00011f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f70: 2020 2020 6b65 795f 7061 7468 3d70 6172      key_path=par
-00011f80: 7365 645f 6b77 6172 6773 5b22 6b65 795f  sed_kwargs["key_
-00011f90: 7061 7468 225d 2c0a 2020 2020 2020 2020  path"],.        
-00011fa0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00011fb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00011fc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00011fd0: 2020 2020 2020 2020 6175 7468 203d 2041          auth = A
-00011fe0: 7574 6843 7265 6465 6e74 6961 6c73 280a  uthCredentials(.
-00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012000: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
-00012010: 3d70 6172 7365 645f 6b77 6172 6773 5b22  =parsed_kwargs["
-00012020: 7573 6572 6e61 6d65 225d 2c0a 2020 2020  username"],.    
-00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012040: 2020 2020 6b65 795f 7061 7468 3d70 6172      key_path=par
-00012050: 7365 645f 6b77 6172 6773 5b22 7061 7373  sed_kwargs["pass
-00012060: 776f 7264 225d 2c0a 2020 2020 2020 2020  word"],.        
-00012070: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00012080: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00012090: 206e 6f74 2061 7574 682e 7661 6c69 643a   not auth.valid:
-000120a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000120b0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000120c0: 7469 6f6e 2866 224c 6f67 696e 2043 7265  tion(f"Login Cre
-000120d0: 6465 6e74 6961 6c73 2061 7265 206e 6f74  dentials are not
-000120e0: 2076 616c 6964 2e20 7b61 7574 687d 2229   valid. {auth}")
-000120f0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00012100: 7365 645f 6b77 6172 6773 5b22 616e 7369  sed_kwargs["ansi
-00012110: 626c 655f 6578 7472 6173 225d 203d 206b  ble_extras"] = k
-00012120: 7761 7267 735b 2261 6e73 6962 6c65 5f65  wargs["ansible_e
-00012130: 7874 7261 7322 5d0a 2020 2020 2020 2020  xtras"].        
-00012140: 2020 2020 7265 7475 726e 2063 7265 6174      return creat
-00012150: 655f 616e 7369 626c 655f 6c61 6e64 5f63  e_ansible_land_c
-00012160: 6d64 2876 6572 623d 7665 7262 2c20 6175  md(verb=verb, au
-00012170: 7468 3d61 7574 682c 206b 7761 7267 733d  th=auth, kwargs=
-00012180: 7061 7273 6564 5f6b 7761 7267 7329 0a20  parsed_kwargs). 
-00012190: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000121a0: 2020 2020 2020 2020 2065 7272 6f72 7320           errors 
-000121b0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-000121c0: 2069 6620 6e6f 7420 4445 5045 4e44 454e   if not DEPENDEN
-000121d0: 4349 4553 5b22 616e 7369 626c 652d 706c  CIES["ansible-pl
-000121e0: 6179 626f 6f6b 225d 3a0a 2020 2020 2020  aybook"]:.      
-000121f0: 2020 2020 2020 2020 2020 6572 726f 7273            errors
-00012200: 2e61 7070 656e 6428 2261 6e73 6962 6c65  .append("ansible
-00012210: 2d70 6c61 7962 6f6f 6b22 290a 2020 2020  -playbook").    
-00012220: 2020 2020 2020 2020 7261 6973 6520 4d69          raise Mi
-00012230: 7373 696e 6744 6570 656e 6465 6e63 7928  ssingDependency(
-00012240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012250: 2066 224c 6175 6e63 6869 6e67 2061 2043   f"Launching a C
-00012260: 7573 746f 6d20 564d 2072 6571 7569 7265  ustom VM require
-00012270: 733a 207b 2720 272e 6a6f 696e 2865 7272  s: {' '.join(err
-00012280: 6f72 7329 7d22 0a20 2020 2020 2020 2020  ors)}".         
-00012290: 2020 2029 0a0a 2020 2020 686f 7374 5f6f     )..    host_o
-000122a0: 7074 696f 6e73 203d 2022 2c20 222e 6a6f  ptions = ", ".jo
-000122b0: 696e 2861 6c6c 6f77 6564 5f68 6f73 7473  in(allowed_hosts
-000122c0: 290a 2020 2020 7261 6973 6520 4d69 7373  ).    raise Miss
-000122d0: 696e 6744 6570 656e 6465 6e63 7928 0a20  ingDependency(. 
-000122e0: 2020 2020 2020 2066 224c 6175 6e63 6820         f"Launch 
-000122f0: 7265 7175 6972 6573 2061 2063 6f72 7265  requires a corre
-00012300: 6374 2068 6f73 7420 6f70 7469 6f6e 2c20  ct host option, 
-00012310: 7472 793a 207b 686f 7374 5f6f 7074 696f  try: {host_optio
-00012320: 6e73 7d22 0a20 2020 2029 0a0a 0a64 6566  ns}".    )...def
-00012330: 2063 7265 6174 655f 6c61 6e64 5f64 6f63   create_land_doc
-00012340: 6b65 725f 636d 6428 7665 7262 3a20 4772  ker_cmd(verb: Gr
-00012350: 616d 6d61 7256 6572 6229 202d 3e20 7374  ammarVerb) -> st
-00012360: 723a 0a20 2020 206e 6f64 655f 6e61 6d65  r:.    node_name
-00012370: 203d 2076 6572 622e 6765 745f 6e61 6d65   = verb.get_name
-00012380: 645f 7465 726d 5f74 7970 6528 6e61 6d65  d_term_type(name
-00012390: 3d22 6e6f 6465 5f6e 616d 6522 290a 2020  ="node_name").  
-000123a0: 2020 736e 616b 655f 6e61 6d65 203d 2073    snake_name = s
-000123b0: 7472 286e 6f64 655f 6e61 6d65 2e73 6e61  tr(node_name.sna
-000123c0: 6b65 5f69 6e70 7574 290a 0a20 2020 2063  ke_input)..    c
-000123d0: 6d64 203d 2022 220a 2020 2020 636d 6420  md = "".    cmd 
-000123e0: 2b3d 2022 646f 636b 6572 2063 6f6d 706f  += "docker compo
-000123f0: 7365 220a 2020 2020 636d 6420 2b3d 2027  se".    cmd += '
-00012400: 202d 2d66 696c 6520 2264 6f63 6b65 722d   --file "docker-
-00012410: 636f 6d70 6f73 652e 796d 6c22 270a 2020  compose.yml"'.  
-00012420: 2020 636d 6420 2b3d 2027 202d 2d70 726f    cmd += ' --pro
-00012430: 6a65 6374 2d6e 616d 6520 2227 202b 2073  ject-name "' + s
-00012440: 6e61 6b65 5f6e 616d 6520 2b20 2722 270a  nake_name + '"'.
-00012450: 2020 2020 636d 6420 2b3d 2022 2064 6f77      cmd += " dow
-00012460: 6e22 0a0a 2020 2020 636d 6420 3d20 2263  n"..    cmd = "c
-00012470: 6420 2220 2b20 4752 4944 5f53 5243 5f50  d " + GRID_SRC_P
-00012480: 4154 4820 2b20 223b 6578 706f 7274 2024  ATH + ";export $
-00012490: 2863 6174 202e 656e 7620 7c20 7365 6420  (cat .env | sed 
-000124a0: 2773 2f23 2e2a 2f2f 6727 207c 2078 6172  's/#.*//g' | xar
-000124b0: 6773 293b 2220 2b20 636d 640a 2020 2020  gs);" + cmd.    
-000124c0: 7265 7475 726e 2063 6d64 0a0a 0a40 636c  return cmd...@cl
-000124d0: 6963 6b2e 636f 6d6d 616e 6428 6865 6c70  ick.command(help
-000124e0: 3d22 5374 6f70 2061 2072 756e 6e69 6e67  ="Stop a running
-000124f0: 2050 7947 7269 6420 646f 6d61 696e 2f6e   PyGrid domain/n
-00012500: 6574 776f 726b 206e 6f64 652e 2229 0a40  etwork node.").@
-00012510: 636c 6963 6b2e 6172 6775 6d65 6e74 2822  click.argument("
-00012520: 6172 6773 222c 2074 7970 653d 7374 722c  args", type=str,
-00012530: 206e 6172 6773 3d2d 3129 0a40 636c 6963   nargs=-1).@clic
-00012540: 6b2e 6f70 7469 6f6e 280a 2020 2020 222d  k.option(.    "-
-00012550: 2d63 6d64 222c 0a20 2020 2064 6566 6175  -cmd",.    defau
-00012560: 6c74 3d22 6661 6c73 6522 2c0a 2020 2020  lt="false",.    
-00012570: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
-00012580: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
-00012590: 2020 6865 6c70 3d22 4f70 7469 6f6e 616c    help="Optional
-000125a0: 3a20 7072 696e 7420 7468 6520 636d 6420  : print the cmd 
-000125b0: 7769 7468 6f75 7420 7275 6e6e 696e 6720  without running 
-000125c0: 6974 222c 0a29 0a40 636c 6963 6b2e 6f70  it",.).@click.op
-000125d0: 7469 6f6e 280a 2020 2020 222d 2d61 6e73  tion(.    "--ans
-000125e0: 6962 6c65 5f65 7874 7261 7322 2c0a 2020  ible_extras",.  
-000125f0: 2020 6465 6661 756c 743d 2222 2c0a 2020    default="",.  
-00012600: 2020 7479 7065 3d73 7472 2c0a 290a 4063    type=str,.).@c
-00012610: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
-00012620: 2022 2d2d 6275 696c 645f 7372 6322 2c0a   "--build_src",.
-00012630: 2020 2020 6465 6661 756c 743d 4445 4641      default=DEFA
-00012640: 554c 545f 4252 414e 4348 2c0a 2020 2020  ULT_BRANCH,.    
-00012650: 7265 7175 6972 6564 3d46 616c 7365 2c0a  required=False,.
-00012660: 2020 2020 7479 7065 3d73 7472 2c0a 2020      type=str,.  
-00012670: 2020 6865 6c70 3d22 4f70 7469 6f6e 616c    help="Optional
-00012680: 3a20 6769 7420 6272 616e 6368 2074 6f20  : git branch to 
-00012690: 7573 6520 666f 7220 6c61 756e 6368 202f  use for launch /
-000126a0: 2062 7569 6c64 206f 7065 7261 7469 6f6e   build operation
-000126b0: 7322 2c0a 290a 4063 6c69 636b 2e6f 7074  s",.).@click.opt
-000126c0: 696f 6e28 0a20 2020 2022 2d2d 7369 6c65  ion(.    "--sile
-000126d0: 6e74 222c 0a20 2020 2069 735f 666c 6167  nt",.    is_flag
-000126e0: 3d54 7275 652c 0a20 2020 2068 656c 703d  =True,.    help=
-000126f0: 224f 7074 696f 6e61 6c3a 2070 7265 7665  "Optional: preve
-00012700: 6e74 206c 6f74 7320 6f66 206c 616e 6420  nt lots of land 
-00012710: 6f75 7470 7574 222c 0a29 0a40 636c 6963  output",.).@clic
-00012720: 6b2e 6f70 7469 6f6e 280a 2020 2020 222d  k.option(.    "-
-00012730: 2d66 6f72 6365 222c 0a20 2020 2069 735f  -force",.    is_
-00012740: 666c 6167 3d54 7275 652c 0a20 2020 2068  flag=True,.    h
-00012750: 656c 703d 224f 7074 696f 6e61 6c3a 2062  elp="Optional: b
-00012760: 7970 6173 7320 7468 6520 7072 6f6d 7074  ypass the prompt
-00012770: 2064 7572 696e 6720 6861 6772 6964 206c   during hagrid l
-00012780: 616e 6420 222c 0a29 0a64 6566 206c 616e  and ",.).def lan
-00012790: 6428 6172 6773 3a20 5479 7065 5475 706c  d(args: TypeTupl
-000127a0: 655b 7374 725d 2c20 2a2a 6b77 6172 6773  e[str], **kwargs
-000127b0: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
-000127c0: 416e 795d 2920 2d3e 204e 6f6e 653a 0a20  Any]) -> None:. 
-000127d0: 2020 2076 6572 6220 3d20 6765 745f 6c61     verb = get_la
-000127e0: 6e64 5f76 6572 6228 290a 2020 2020 7369  nd_verb().    si
-000127f0: 6c65 6e74 203d 2062 6f6f 6c28 6b77 6172  lent = bool(kwar
-00012800: 6773 5b22 7369 6c65 6e74 225d 2920 6966  gs["silent"]) if
-00012810: 2022 7369 6c65 6e74 2220 696e 206b 7761   "silent" in kwa
-00012820: 7267 7320 656c 7365 2046 616c 7365 0a20  rgs else False. 
-00012830: 2020 2066 6f72 6365 203d 2062 6f6f 6c28     force = bool(
-00012840: 6b77 6172 6773 5b22 666f 7263 6522 5d29  kwargs["force"])
-00012850: 2069 6620 2266 6f72 6365 2220 696e 206b   if "force" in k
-00012860: 7761 7267 7320 656c 7365 2046 616c 7365  wargs else False
-00012870: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00012880: 2020 6772 616d 6d61 7220 3d20 7061 7273    grammar = pars
-00012890: 655f 6772 616d 6d61 7228 6172 6773 3d61  e_grammar(args=a
-000128a0: 7267 732c 2076 6572 623d 7665 7262 290a  rgs, verb=verb).
-000128b0: 2020 2020 2020 2020 7665 7262 2e6c 6f61          verb.loa
-000128c0: 645f 6772 616d 6d61 7228 6772 616d 6d61  d_grammar(gramma
-000128d0: 723d 6772 616d 6d61 7229 0a20 2020 2065  r=grammar).    e
-000128e0: 7863 6570 7420 4261 6447 7261 6d6d 6172  xcept BadGrammar
-000128f0: 2061 7320 653a 0a20 2020 2020 2020 2070   as e:.        p
-00012900: 7269 6e74 2865 290a 2020 2020 2020 2020  rint(e).        
-00012910: 7265 7475 726e 0a0a 2020 2020 7472 793a  return..    try:
-00012920: 0a20 2020 2020 2020 2075 7064 6174 655f  .        update_
-00012930: 7265 706f 2872 6570 6f3d 4749 545f 5245  repo(repo=GIT_RE
-00012940: 504f 2c20 6272 616e 6368 3d73 7472 286b  PO, branch=str(k
-00012950: 7761 7267 735b 2262 7569 6c64 5f73 7263  wargs["build_src
-00012960: 225d 2929 0a20 2020 2065 7863 6570 7420  "])).    except 
-00012970: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-00012980: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00012990: 4661 696c 6564 2074 6f20 7570 6461 7465  Failed to update
-000129a0: 2072 6570 6f2e 207b 657d 2229 0a0a 2020   repo. {e}")..  
-000129b0: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
-000129c0: 6d64 203d 2063 7265 6174 655f 6c61 6e64  md = create_land
-000129d0: 5f63 6d64 2876 6572 623d 7665 7262 2c20  _cmd(verb=verb, 
-000129e0: 6b77 6172 6773 3d6b 7761 7267 7329 0a20  kwargs=kwargs). 
-000129f0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00012a00: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00012a10: 2020 7072 696e 7428 6622 7b65 7d22 290a    print(f"{e}").
-00012a20: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00012a30: 2020 2020 7461 7267 6574 203d 2076 6572      target = ver
-00012a40: 622e 6765 745f 6e61 6d65 645f 7465 726d  b.get_named_term
-00012a50: 5f67 7261 6d6d 6172 2822 6e6f 6465 5f6e  _grammar("node_n
-00012a60: 616d 6522 292e 696e 7075 740a 0a20 2020  ame").input..   
-00012a70: 2069 6620 6e6f 7420 666f 7263 653a 0a20   if not force:. 
-00012a80: 2020 2020 2020 205f 6c61 6e64 5f64 6f6d         _land_dom
-00012a90: 6169 6e20 3d20 6173 6b28 0a20 2020 2020  ain = ask(.     
-00012aa0: 2020 2020 2020 2051 7565 7374 696f 6e28         Question(
-00012ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ac0: 2076 6172 5f6e 616d 653d 225f 6c61 6e64   var_name="_land
-00012ad0: 5f64 6f6d 6169 6e22 2c0a 2020 2020 2020  _domain",.      
-00012ae0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-00012af0: 6f6e 3d66 2241 7265 2079 6f75 2073 7572  on=f"Are you sur
-00012b00: 6520 796f 7520 7761 6e74 2074 6f20 6c61  e you want to la
-00012b10: 6e64 207b 7461 7267 6574 7d20 2879 2f6e  nd {target} (y/n
-00012b20: 2922 2c0a 2020 2020 2020 2020 2020 2020  )",.            
-00012b30: 2020 2020 6b69 6e64 3d22 7965 736e 6f22      kind="yesno"
-00012b40: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
-00012b50: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
-00012b60: 7267 733d 7b7d 2c0a 2020 2020 2020 2020  rgs={},.        
-00012b70: 290a 0a20 2020 2069 6620 666f 7263 6520  )..    if force 
-00012b80: 6f72 205f 6c61 6e64 5f64 6f6d 6169 6e20  or _land_domain 
-00012b90: 3d3d 2022 7922 3a0a 2020 2020 2020 2020  == "y":.        
-00012ba0: 6966 2022 636d 6422 206e 6f74 2069 6e20  if "cmd" not in 
-00012bb0: 6b77 6172 6773 206f 7220 7374 725f 746f  kwargs or str_to
-00012bc0: 5f62 6f6f 6c28 6361 7374 2873 7472 2c20  _bool(cast(str, 
-00012bd0: 6b77 6172 6773 5b22 636d 6422 5d29 2920  kwargs["cmd"])) 
-00012be0: 6973 2046 616c 7365 3a0a 2020 2020 2020  is False:.      
-00012bf0: 2020 2020 2020 6966 206e 6f74 2073 696c        if not sil
-00012c00: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-00012c10: 2020 2020 2070 7269 6e74 2822 5275 6e6e       print("Runn
-00012c20: 696e 673a 205c 6e22 2c20 636d 6429 0a20  ing: \n", cmd). 
-00012c30: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c50: 6966 2073 696c 656e 743a 0a20 2020 2020  if silent:.     
-00012c60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00012c70: 726f 6365 7373 203d 2073 7562 7072 6f63  rocess = subproc
-00012c80: 6573 732e 506f 7065 6e28 2020 2320 6e6f  ess.Popen(  # no
-00012c90: 7365 630a 2020 2020 2020 2020 2020 2020  sec.            
-00012ca0: 2020 2020 2020 2020 2020 2020 636d 642c              cmd,
-00012cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012cc0: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
-00012cd0: 7375 6270 726f 6365 7373 2e50 4950 452c  subprocess.PIPE,
-00012ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012cf0: 2020 2020 2020 2020 2073 7464 6572 723d           stderr=
-00012d00: 7375 6270 726f 6365 7373 2e50 4950 452c  subprocess.PIPE,
-00012d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d20: 2020 2020 2020 2020 2063 7764 3d47 5249           cwd=GRI
-00012d30: 445f 5352 435f 5041 5448 2c0a 2020 2020  D_SRC_PATH,.    
-00012d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d50: 2020 2020 7368 656c 6c3d 5472 7565 2c0a      shell=True,.
-00012d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00012d80: 2020 2020 2020 2020 2020 7072 6f63 6573            proces
-00012d90: 732e 636f 6d6d 756e 6963 6174 6528 290a  s.communicate().
-00012da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012db0: 2020 2020 2070 7269 6e74 2866 2248 4147       print(f"HAG
-00012dc0: 7269 6420 6c61 6e64 207b 7461 7267 6574  rid land {target
-00012dd0: 7d20 636f 6d70 6c65 7465 2122 290a 2020  } complete!").  
-00012de0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00012df0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012e00: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
-00012e10: 7373 2e63 616c 6c28 636d 642c 2073 6865  ss.call(cmd, she
-00012e20: 6c6c 3d54 7275 652c 2063 7764 3d47 5249  ll=True, cwd=GRI
-00012e30: 445f 5352 435f 5041 5448 2920 2023 206e  D_SRC_PATH)  # n
-00012e40: 6f73 6563 0a20 2020 2020 2020 2020 2020  osec.           
-00012e50: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00012e60: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00012e70: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00012e80: 4661 696c 6564 2074 6f20 7275 6e20 636d  Failed to run cm
-00012e90: 643a 207b 636d 647d 2e20 7b65 7d22 290a  d: {cmd}. {e}").
-00012ea0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012eb0: 2020 7072 696e 7428 2248 6167 7269 6420    print("Hagrid 
-00012ec0: 6c61 6e64 2061 626f 7274 6564 2e22 290a  land aborted.").
-00012ed0: 0a0a 636c 692e 6164 645f 636f 6d6d 616e  ..cli.add_comman
-00012ee0: 6428 6c61 756e 6368 290a 636c 692e 6164  d(launch).cli.ad
-00012ef0: 645f 636f 6d6d 616e 6428 6c61 6e64 290a  d_command(land).
-00012f00: 636c 692e 6164 645f 636f 6d6d 616e 6428  cli.add_command(
-00012f10: 636c 6561 6e29 0a0a 0a40 636c 6963 6b2e  clean)...@click.
-00012f20: 636f 6d6d 616e 6428 6865 6c70 3d22 5368  command(help="Sh
-00012f30: 6f77 2048 4147 7269 6420 6465 6275 6720  ow HAGrid debug 
-00012f40: 696e 666f 726d 6174 696f 6e22 290a 4063  information").@c
-00012f50: 6c69 636b 2e61 7267 756d 656e 7428 2261  lick.argument("a
-00012f60: 7267 7322 2c20 7479 7065 3d73 7472 2c20  rgs", type=str, 
-00012f70: 6e61 7267 733d 2d31 290a 6465 6620 6465  nargs=-1).def de
-00012f80: 6275 6728 6172 6773 3a20 5479 7065 5475  bug(args: TypeTu
-00012f90: 706c 655b 7374 725d 2c20 2a2a 6b77 6172  ple[str], **kwar
-00012fa0: 6773 3a20 5479 7065 4469 6374 5b73 7472  gs: TypeDict[str
-00012fb0: 2c20 416e 795d 2920 2d3e 204e 6f6e 653a  , Any]) -> None:
-00012fc0: 0a20 2020 2064 6562 7567 5f69 6e66 6f20  .    debug_info 
-00012fd0: 3d20 6761 7468 6572 5f64 6562 7567 2829  = gather_debug()
-00012fe0: 0a20 2020 2070 7269 6e74 2822 5c6e 5c6e  .    print("\n\n
-00012ff0: 5768 656e 2072 6570 6f72 7469 6e67 2062  When reporting b
-00013000: 7567 732c 2070 6c65 6173 6520 636f 7079  ugs, please copy
-00013010: 2065 7665 7279 7468 696e 6720 6265 7477   everything betw
-00013020: 6565 6e20 7468 6520 6c69 6e65 732e 2229  een the lines.")
-00013030: 0a20 2020 2070 7269 6e74 2822 3d3d 3d3d  .    print("====
-00013040: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00013050: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00013060: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00013070: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 5c6e  ==============\n
-00013080: 2229 0a20 2020 2070 7269 6e74 286a 736f  ").    print(jso
-00013090: 6e2e 6475 6d70 7328 6465 6275 675f 696e  n.dumps(debug_in
-000130a0: 666f 2929 0a20 2020 2070 7269 6e74 2822  fo)).    print("
-000130b0: 5c6e 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  \n==============
-000130c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000130d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000130e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000130f0: 3d3d 3d5c 6e5c 6e22 290a 0a0a 636c 692e  ===\n\n")...cli.
-00013100: 6164 645f 636f 6d6d 616e 6428 6465 6275  add_command(debu
-00013110: 6729 0a0a 0a44 4546 4155 4c54 5f48 4541  g)...DEFAULT_HEA
-00013120: 4c54 485f 4348 4543 4b53 203d 205b 2268  LTH_CHECKS = ["h
-00013130: 6f73 7422 2c20 2255 4920 28ce b265 7461  ost", "UI (..eta
-00013140: 2922 2c20 2261 7069 222c 2022 7373 6822  )", "api", "ssh"
-00013150: 2c20 226a 7570 7974 6572 225d 0a48 4541  , "jupyter"].HEA
-00013160: 4c54 485f 4348 4543 4b5f 4655 4e43 5449  LTH_CHECK_FUNCTI
-00013170: 4f4e 5320 3d20 7b0a 2020 2020 2268 6f73  ONS = {.    "hos
-00013180: 7422 3a20 6368 6563 6b5f 686f 7374 2c0a  t": check_host,.
-00013190: 2020 2020 2255 4920 28ce b265 7461 2922      "UI (..eta)"
-000131a0: 3a20 6368 6563 6b5f 6c6f 6769 6e5f 7061  : check_login_pa
-000131b0: 6765 2c0a 2020 2020 2261 7069 223a 2063  ge,.    "api": c
-000131c0: 6865 636b 5f61 7069 5f6d 6574 6164 6174  heck_api_metadat
-000131d0: 612c 0a20 2020 2022 7373 6822 3a20 6368  a,.    "ssh": ch
-000131e0: 6563 6b5f 6970 5f66 6f72 5f73 7368 2c0a  eck_ip_for_ssh,.
-000131f0: 2020 2020 226a 7570 7974 6572 223a 2063      "jupyter": c
-00013200: 6865 636b 5f6a 7570 7974 6572 5f73 6572  heck_jupyter_ser
-00013210: 7665 722c 0a7d 0a0a 4845 414c 5448 5f43  ver,.}..HEALTH_C
-00013220: 4845 434b 5f49 434f 4e53 203d 207b 0a20  HECK_ICONS = {. 
-00013230: 2020 2022 686f 7374 223a 2022 f09f 948c     "host": "....
-00013240: 222c 0a20 2020 2022 5549 2028 ceb2 6574  ",.    "UI (..et
-00013250: 6129 223a 2022 f09f 96b1 222c 0a20 2020  a)": "....",.   
-00013260: 2022 6170 6922 3a20 22e2 9a99 efb8 8f22   "api": "......"
-00013270: 2c0a 2020 2020 2273 7368 223a 2022 f09f  ,.    "ssh": "..
-00013280: 9490 222c 0a20 2020 2022 6a75 7079 7465  ..",.    "jupyte
-00013290: 7222 3a20 22f0 9f93 9722 2c0a 7d0a 0a48  r": "....",.}..H
-000132a0: 4541 4c54 485f 4348 4543 4b5f 5552 4c53  EALTH_CHECK_URLS
-000132b0: 203d 207b 0a20 2020 2022 686f 7374 223a   = {.    "host":
-000132c0: 2022 7b69 705f 6164 6472 6573 737d 222c   "{ip_address}",
-000132d0: 0a20 2020 2022 5549 2028 ceb2 6574 6129  .    "UI (..eta)
-000132e0: 223a 2022 6874 7470 3a2f 2f7b 6970 5f61  ": "http://{ip_a
-000132f0: 6464 7265 7373 7d2f 6c6f 6769 6e22 2c0a  ddress}/login",.
-00013300: 2020 2020 2261 7069 223a 2022 6874 7470      "api": "http
-00013310: 3a2f 2f7b 6970 5f61 6464 7265 7373 7d2f  ://{ip_address}/
-00013320: 6170 692f 7631 2f6f 7065 6e61 7069 2e6a  api/v1/openapi.j
-00013330: 736f 6e22 2c0a 2020 2020 2273 7368 223a  son",.    "ssh":
-00013340: 2022 6861 6772 6964 2073 7368 207b 6970   "hagrid ssh {ip
-00013350: 5f61 6464 7265 7373 7d22 2c0a 2020 2020  _address}",.    
-00013360: 226a 7570 7974 6572 223a 2022 6874 7470  "jupyter": "http
-00013370: 3a2f 2f7b 6970 5f61 6464 7265 7373 7d3a  ://{ip_address}:
-00013380: 3838 3838 222c 0a7d 0a0a 0a64 6566 2063  8888",.}...def c
-00013390: 6865 636b 5f68 6f73 745f 6865 616c 7468  heck_host_health
-000133a0: 2869 705f 6164 6472 6573 733a 2073 7472  (ip_address: str
-000133b0: 2c20 6b65 7973 3a20 5479 7065 4c69 7374  , keys: TypeList
-000133c0: 5b73 7472 5d29 202d 3e20 5479 7065 4469  [str]) -> TypeDi
-000133d0: 6374 5b73 7472 2c20 626f 6f6c 5d3a 0a20  ct[str, bool]:. 
-000133e0: 2020 2073 7461 7475 7320 3d20 7b7d 0a20     status = {}. 
-000133f0: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
-00013400: 7973 3a0a 2020 2020 2020 2020 6675 6e63  ys:.        func
-00013410: 3a20 4361 6c6c 6162 6c65 203d 2048 4541  : Callable = HEA
-00013420: 4c54 485f 4348 4543 4b5f 4655 4e43 5449  LTH_CHECK_FUNCTI
-00013430: 4f4e 535b 6b65 795d 2020 2320 7479 7065  ONS[key]  # type
-00013440: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-00013450: 2073 7461 7475 735b 6b65 795d 203d 2066   status[key] = f
-00013460: 756e 6328 6970 5f61 6464 7265 7373 2c20  unc(ip_address, 
-00013470: 7369 6c65 6e74 3d54 7275 6529 0a20 2020  silent=True).   
-00013480: 2072 6574 7572 6e20 7374 6174 7573 0a0a   return status..
-00013490: 0a64 6566 2069 636f 6e5f 7374 6174 7573  .def icon_status
-000134a0: 2873 7461 7475 733a 2062 6f6f 6c29 202d  (status: bool) -
-000134b0: 3e20 7374 723a 0a20 2020 2072 6574 7572  > str:.    retur
-000134c0: 6e20 22e2 9c85 2220 6966 2073 7461 7475  n "..." if statu
-000134d0: 7320 656c 7365 2022 e29d 8c22 0a0a 0a64  s else "..."...d
-000134e0: 6566 2067 6574 5f68 6561 6c74 685f 6368  ef get_health_ch
-000134f0: 6563 6b73 2869 705f 6164 6472 6573 733a  ecks(ip_address:
-00013500: 2073 7472 2920 2d3e 2054 7970 6554 7570   str) -> TypeTup
-00013510: 6c65 5b62 6f6f 6c2c 2054 7970 654c 6973  le[bool, TypeLis
-00013520: 745b 5479 7065 4c69 7374 5b73 7472 5d5d  t[TypeList[str]]
-00013530: 5d3a 0a20 2020 206b 6579 7320 3d20 6c69  ]:.    keys = li
-00013540: 7374 2844 4546 4155 4c54 5f48 4541 4c54  st(DEFAULT_HEALT
-00013550: 485f 4348 4543 4b53 290a 2020 2020 6966  H_CHECKS).    if
-00013560: 2022 6c6f 6361 6c68 6f73 7422 2069 6e20   "localhost" in 
-00013570: 6970 5f61 6464 7265 7373 3a0a 2020 2020  ip_address:.    
-00013580: 2020 2020 6e65 775f 6b65 7973 203d 205b      new_keys = [
-00013590: 5d0a 2020 2020 2020 2020 666f 7220 6b65  ].        for ke
-000135a0: 7920 696e 206b 6579 733a 0a20 2020 2020  y in keys:.     
-000135b0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-000135c0: 7420 696e 205b 2268 6f73 7422 2c20 226a  t in ["host", "j
-000135d0: 7570 7974 6572 222c 2022 7373 6822 5d3a  upyter", "ssh"]:
-000135e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000135f0: 206e 6577 5f6b 6579 732e 6170 7065 6e64   new_keys.append
-00013600: 286b 6579 290a 2020 2020 2020 2020 6b65  (key).        ke
-00013610: 7973 203d 206e 6577 5f6b 6579 730a 0a20  ys = new_keys.. 
-00013620: 2020 2068 6561 6c74 685f 7374 6174 7573     health_status
-00013630: 203d 2063 6865 636b 5f68 6f73 745f 6865   = check_host_he
-00013640: 616c 7468 2869 705f 6164 6472 6573 733d  alth(ip_address=
-00013650: 6970 5f61 6464 7265 7373 2c20 6b65 7973  ip_address, keys
-00013660: 3d6b 6579 7329 0a20 2020 2063 6f6d 706c  =keys).    compl
-00013670: 6574 655f 7374 6174 7573 203d 2061 6c6c  ete_status = all
-00013680: 2868 6561 6c74 685f 7374 6174 7573 2e76  (health_status.v
-00013690: 616c 7565 7328 2929 0a0a 2020 2020 2320  alues())..    # 
-000136a0: 6669 6e64 2070 6f72 7420 6672 6f6d 2069  find port from i
-000136b0: 705f 6164 6472 6573 730a 2020 2020 7472  p_address.    tr
-000136c0: 793a 0a20 2020 2020 2020 2070 6f72 7420  y:.        port 
-000136d0: 3d20 696e 7428 6970 5f61 6464 7265 7373  = int(ip_address
-000136e0: 2e73 706c 6974 2822 3a22 295b 315d 290a  .split(":")[1]).
-000136f0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00013700: 7469 6f6e 3a0a 2020 2020 2020 2020 2320  tion:.        # 
-00013710: 6465 6661 756c 7420 746f 2038 300a 2020  default to 80.  
-00013720: 2020 2020 2020 706f 7274 203d 2038 300a        port = 80.
-00013730: 0a20 2020 2023 2075 726c 2074 6f20 6469  .    # url to di
-00013740: 7370 6c61 7920 6261 7365 6420 6f6e 2072  splay based on r
-00013750: 756e 6e69 6e67 2065 6e76 6972 6f6e 6d65  unning environme
-00013760: 6e74 0a20 2020 2064 6973 706c 6179 5f75  nt.    display_u
-00013770: 726c 203d 2067 6974 706f 645f 7572 6c28  rl = gitpod_url(
-00013780: 706f 7274 292e 7370 6c69 7428 222f 2f22  port).split("//"
-00013790: 295b 315d 2069 6620 6973 5f67 6974 706f  )[1] if is_gitpo
-000137a0: 6428 2920 656c 7365 2069 705f 6164 6472  d() else ip_addr
-000137b0: 6573 730a 0a20 2020 2023 2066 6967 7572  ess..    # figur
-000137c0: 6520 6f75 7420 686f 7720 746f 2061 6464  e out how to add
-000137d0: 2074 6869 7320 6261 636b 3f0a 2020 2020   this back?.    
-000137e0: 2320 636f 6e73 6f6c 652e 7072 696e 7428  # console.print(
-000137f0: 225b 626f 6c64 206d 6167 656e 7461 5d43  "[bold magenta]C
-00013800: 6865 636b 696e 6720 686f 7374 3a5b 2f62  hecking host:[/b
-00013810: 6f6c 6420 6d61 6765 6e74 615d 222c 2069  old magenta]", i
-00013820: 705f 6164 6472 6573 732c 2022 3a6d 6167  p_address, ":mag
-00013830: 653a 2229 0a20 2020 2074 6162 6c65 5f63  e:").    table_c
-00013840: 6f6e 7465 6e74 7320 3d20 5b5d 0a20 2020  ontents = [].   
-00013850: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00013860: 696e 2068 6561 6c74 685f 7374 6174 7573  in health_status
-00013870: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00013880: 2020 7461 626c 655f 636f 6e74 656e 7473    table_contents
-00013890: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-000138a0: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
-000138b0: 2020 2020 2020 2048 4541 4c54 485f 4348         HEALTH_CH
-000138c0: 4543 4b5f 4943 4f4e 535b 6b65 795d 2c0a  ECK_ICONS[key],.
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-000138f0: 2020 2020 2048 4541 4c54 485f 4348 4543       HEALTH_CHEC
-00013900: 4b5f 5552 4c53 5b6b 6579 5d2e 7265 706c  K_URLS[key].repl
-00013910: 6163 6528 227b 6970 5f61 6464 7265 7373  ace("{ip_address
-00013920: 7d22 2c20 6469 7370 6c61 795f 7572 6c29  }", display_url)
-00013930: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013940: 2020 6963 6f6e 5f73 7461 7475 7328 7661    icon_status(va
-00013950: 6c75 6529 2c0a 2020 2020 2020 2020 2020  lue),.          
-00013960: 2020 5d0a 2020 2020 2020 2020 290a 0a20    ].        ).. 
-00013970: 2020 2072 6574 7572 6e20 636f 6d70 6c65     return comple
-00013980: 7465 5f73 7461 7475 732c 2074 6162 6c65  te_status, table
-00013990: 5f63 6f6e 7465 6e74 730a 0a0a 6465 6620  _contents...def 
-000139a0: 6372 6561 7465 5f63 6865 636b 5f74 6162  create_check_tab
-000139b0: 6c65 280a 2020 2020 7461 626c 655f 636f  le(.    table_co
-000139c0: 6e74 656e 7473 3a20 5479 7065 4c69 7374  ntents: TypeList
-000139d0: 5b54 7970 654c 6973 745b 7374 725d 5d2c  [TypeList[str]],
-000139e0: 2074 696d 655f 6c65 6674 3a20 696e 7420   time_left: int 
-000139f0: 3d20 300a 2920 2d3e 2072 6963 682e 7461  = 0.) -> rich.ta
-00013a00: 626c 652e 5461 626c 653a 0a20 2020 2074  ble.Table:.    t
-00013a10: 6162 6c65 203d 2072 6963 682e 7461 626c  able = rich.tabl
-00013a20: 652e 5461 626c 6528 290a 2020 2020 7461  e.Table().    ta
-00013a30: 626c 652e 6164 645f 636f 6c75 6d6e 2822  ble.add_column("
-00013a40: 5079 4772 6964 222c 2073 7479 6c65 3d22  PyGrid", style="
-00013a50: 6d61 6765 6e74 6122 290a 2020 2020 7461  magenta").    ta
-00013a60: 626c 652e 6164 645f 636f 6c75 6d6e 2822  ble.add_column("
-00013a70: 496e 666f 222c 206a 7573 7469 6679 3d22  Info", justify="
-00013a80: 6c65 6674 222c 206f 7665 7266 6c6f 773d  left", overflow=
-00013a90: 2266 6f6c 6422 290a 2020 2020 7469 6d65  "fold").    time
-00013aa0: 5f6c 6566 745f 7374 7220 3d20 2222 2069  _left_str = "" i
-00013ab0: 6620 7469 6d65 5f6c 6566 7420 3d3d 2030  f time_left == 0
-00013ac0: 2065 6c73 6520 7374 7228 7469 6d65 5f6c   else str(time_l
-00013ad0: 6566 7429 0a20 2020 2074 6162 6c65 2e61  eft).    table.a
-00013ae0: 6464 5f63 6f6c 756d 6e28 7469 6d65 5f6c  dd_column(time_l
-00013af0: 6566 745f 7374 722c 206a 7573 7469 6679  eft_str, justify
-00013b00: 3d22 6c65 6674 2229 0a20 2020 2066 6f72  ="left").    for
-00013b10: 2072 6f77 2069 6e20 7461 626c 655f 636f   row in table_co
-00013b20: 6e74 656e 7473 3a0a 2020 2020 2020 2020  ntents:.        
-00013b30: 7461 626c 652e 6164 645f 726f 7728 726f  table.add_row(ro
-00013b40: 775b 315d 2c20 726f 775b 325d 2c20 726f  w[1], row[2], ro
-00013b50: 775b 335d 290a 2020 2020 7265 7475 726e  w[3]).    return
-00013b60: 2074 6162 6c65 0a0a 0a40 636c 6963 6b2e   table...@click.
-00013b70: 636f 6d6d 616e 6428 6865 6c70 3d22 4368  command(help="Ch
-00013b80: 6563 6b20 6865 616c 7468 206f 6620 616e  eck health of an
-00013b90: 2049 5020 6164 6472 6573 732f 6164 6472   IP address/addr
-00013ba0: 6573 7365 7320 6f72 2061 2072 6573 6f75  esses or a resou
-00013bb0: 7263 6520 6772 6f75 7022 290a 4063 6c69  rce group").@cli
-00013bc0: 636b 2e61 7267 756d 656e 7428 2269 705f  ck.argument("ip_
-00013bd0: 6164 6472 6573 7365 7322 2c20 7479 7065  addresses", type
-00013be0: 3d73 7472 2c20 6e61 7267 733d 2d31 290a  =str, nargs=-1).
-00013bf0: 4063 6c69 636b 2e6f 7074 696f 6e28 0a20  @click.option(. 
-00013c00: 2020 2022 2d2d 7761 6974 222c 0a20 2020     "--wait",.   
-00013c10: 2069 735f 666c 6167 3d54 7275 652c 0a20   is_flag=True,. 
-00013c20: 2020 2068 656c 703d 224f 7074 696f 6e61     help="Optiona
-00013c30: 6c3a 2077 6169 7420 756e 7469 6c20 6368  l: wait until ch
-00013c40: 6563 6b73 2070 6173 7322 2c0a 290a 4063  ecks pass",.).@c
-00013c50: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
-00013c60: 2022 2d2d 7369 6c65 6e74 222c 0a20 2020   "--silent",.   
-00013c70: 2069 735f 666c 6167 3d54 7275 652c 0a20   is_flag=True,. 
-00013c80: 2020 2068 656c 703d 224f 7074 696f 6e61     help="Optiona
-00013c90: 6c3a 2064 6f6e 2774 2072 6566 7265 7368  l: don't refresh
-00013ca0: 206f 7574 7075 7420 6475 7269 6e67 2077   output during w
-00013cb0: 6169 7422 2c0a 290a 6465 6620 6368 6563  ait",.).def chec
-00013cc0: 6b28 0a20 2020 2069 705f 6164 6472 6573  k(.    ip_addres
-00013cd0: 7365 733a 2054 7970 654c 6973 745b 7374  ses: TypeList[st
-00013ce0: 725d 2c20 7761 6974 3a20 626f 6f6c 203d  r], wait: bool =
-00013cf0: 2046 616c 7365 2c20 7369 6c65 6e74 3a20   False, silent: 
-00013d00: 626f 6f6c 203d 2046 616c 7365 0a29 202d  bool = False.) -
-00013d10: 3e20 4e6f 6e65 3a0a 2020 2020 636f 6e73  > None:.    cons
-00013d20: 6f6c 6520 3d20 7269 6368 2e67 6574 5f63  ole = rich.get_c
-00013d30: 6f6e 736f 6c65 2829 0a20 2020 2069 6620  onsole().    if 
-00013d40: 6c65 6e28 6970 5f61 6464 7265 7373 6573  len(ip_addresses
-00013d50: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00013d60: 6865 6164 6572 7320 3d20 7b22 5573 6572  headers = {"User
-00013d70: 2d41 6765 6e74 223a 2022 6375 726c 2f37  -Agent": "curl/7
-00013d80: 2e37 392e 3122 7d0a 2020 2020 2020 2020  .79.1"}.        
-00013d90: 7072 696e 7428 2244 6574 6563 7469 6e67  print("Detecting
-00013da0: 2045 7874 6572 6e61 6c20 4950 2e2e 2e22   External IP..."
-00013db0: 290a 2020 2020 2020 2020 6970 5f72 6573  ).        ip_res
-00013dc0: 203d 2072 6571 7565 7374 732e 6765 7428   = requests.get(
-00013dd0: 2268 7474 7073 3a2f 2f69 6663 6f6e 6669  "https://ifconfi
-00013de0: 672e 636f 222c 2068 6561 6465 7273 3d68  g.co", headers=h
-00013df0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
-00013e00: 6970 5f61 6464 7265 7373 203d 2069 705f  ip_address = ip_
-00013e10: 7265 732e 7465 7874 2e73 7472 6970 2829  res.text.strip()
-00013e20: 0a20 2020 2020 2020 2069 705f 6164 6472  .        ip_addr
-00013e30: 6573 7365 7320 3d20 5b69 705f 6164 6472  esses = [ip_addr
-00013e40: 6573 735d 0a0a 2020 2020 6966 206c 656e  ess]..    if len
-00013e50: 2869 705f 6164 6472 6573 7365 7329 203d  (ip_addresses) =
-00013e60: 3d20 313a 0a20 2020 2020 2020 2069 705f  = 1:.        ip_
-00013e70: 6164 6472 6573 7320 3d20 6970 5f61 6464  address = ip_add
-00013e80: 7265 7373 6573 5b30 5d0a 2020 2020 2020  resses[0].      
-00013e90: 2020 7374 6174 7573 2c20 7461 626c 655f    status, table_
-00013ea0: 636f 6e74 656e 7473 203d 2067 6574 5f68  contents = get_h
-00013eb0: 6561 6c74 685f 6368 6563 6b73 2869 705f  ealth_checks(ip_
-00013ec0: 6164 6472 6573 733d 6970 5f61 6464 7265  address=ip_addre
-00013ed0: 7373 290a 2020 2020 2020 2020 7461 626c  ss).        tabl
-00013ee0: 6520 3d20 6372 6561 7465 5f63 6865 636b  e = create_check
-00013ef0: 5f74 6162 6c65 2874 6162 6c65 5f63 6f6e  _table(table_con
-00013f00: 7465 6e74 733d 7461 626c 655f 636f 6e74  tents=table_cont
-00013f10: 656e 7473 290a 2020 2020 2020 2020 6d61  ents).        ma
-00013f20: 785f 7469 6d65 6f75 7420 3d20 3630 300a  x_timeout = 600.
-00013f30: 2020 2020 2020 2020 6966 2077 6169 7420          if wait 
-00013f40: 616e 6420 6e6f 7420 7374 6174 7573 3a0a  and not status:.
-00013f50: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00013f60: 6520 3d20 6372 6561 7465 5f63 6865 636b  e = create_check
-00013f70: 5f74 6162 6c65 280a 2020 2020 2020 2020  _table(.        
-00013f80: 2020 2020 2020 2020 7461 626c 655f 636f          table_co
-00013f90: 6e74 656e 7473 3d74 6162 6c65 5f63 6f6e  ntents=table_con
-00013fa0: 7465 6e74 732c 2074 696d 655f 6c65 6674  tents, time_left
-00013fb0: 3d6d 6178 5f74 696d 656f 7574 0a20 2020  =max_timeout.   
-00013fc0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00013fd0: 2020 2020 2020 2069 6620 7369 6c65 6e74         if silent
-00013fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013ff0: 2020 7072 696e 7428 2243 6865 636b 696e    print("Checkin
-00014000: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
-00014010: 2020 2077 6869 6c65 206e 6f74 2073 7461     while not sta
-00014020: 7475 733a 0a20 2020 2020 2020 2020 2020  tus:.           
-00014030: 2020 2020 2069 6620 6e6f 7420 7369 6c65       if not sile
-00014040: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-00014050: 2020 2020 2020 2020 7769 7468 204c 6976          with Liv
-00014060: 6528 7461 626c 652c 2072 6566 7265 7368  e(table, refresh
-00014070: 5f70 6572 5f73 6563 6f6e 643d 342c 2073  _per_second=4, s
-00014080: 6372 6565 6e3d 5472 7565 2920 6173 206c  creen=True) as l
-00014090: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
-000140a0: 2020 2020 2020 2020 2020 2020 206d 6178               max
-000140b0: 5f74 696d 656f 7574 202d 3d20 310a 2020  _timeout -= 1.  
-000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140d0: 2020 2020 2020 6966 206d 6178 5f74 696d        if max_tim
-000140e0: 656f 7574 2025 2035 203d 3d20 303a 0a20  eout % 5 == 0:. 
-000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014100: 2020 2020 2020 2020 2020 2073 7461 7475             statu
-00014110: 732c 2074 6162 6c65 5f63 6f6e 7465 6e74  s, table_content
-00014120: 7320 3d20 6765 745f 6865 616c 7468 5f63  s = get_health_c
-00014130: 6865 636b 7328 6970 5f61 6464 7265 7373  hecks(ip_address
-00014140: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014150: 2020 2020 2020 2020 2020 7461 626c 6520            table 
-00014160: 3d20 6372 6561 7465 5f63 6865 636b 5f74  = create_check_t
-00014170: 6162 6c65 280a 2020 2020 2020 2020 2020  able(.          
-00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014190: 2020 7461 626c 655f 636f 6e74 656e 7473    table_contents
-000141a0: 3d74 6162 6c65 5f63 6f6e 7465 6e74 732c  =table_contents,
-000141b0: 2074 696d 655f 6c65 6674 3d6d 6178 5f74   time_left=max_t
-000141c0: 696d 656f 7574 0a20 2020 2020 2020 2020  imeout.         
-000141d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000141e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000141f0: 2020 2020 2020 2020 206c 6976 652e 7570           live.up
-00014200: 6461 7465 2874 6162 6c65 290a 2020 2020  date(table).    
-00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014220: 2020 2020 6966 2073 7461 7475 733a 0a20      if status:. 
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00014250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014260: 2020 2020 2020 2020 2074 696d 652e 736c           time.sl
-00014270: 6565 7028 3129 0a20 2020 2020 2020 2020  eep(1).         
-00014280: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 206d 6178 5f74 696d 656f 7574 202d 3d20   max_timeout -= 
-000142b0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000142c0: 2020 2020 2020 6966 206d 6178 5f74 696d        if max_tim
-000142d0: 656f 7574 2025 2035 203d 3d20 303a 0a20  eout % 5 == 0:. 
-000142e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142f0: 2020 2020 2020 2073 7461 7475 732c 2074         status, t
-00014300: 6162 6c65 5f63 6f6e 7465 6e74 7320 3d20  able_contents = 
-00014310: 6765 745f 6865 616c 7468 5f63 6865 636b  get_health_check
-00014320: 7328 6970 5f61 6464 7265 7373 290a 2020  s(ip_address).  
-00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014340: 2020 7461 626c 6520 3d20 6372 6561 7465    table = create
-00014350: 5f63 6865 636b 5f74 6162 6c65 280a 2020  _check_table(.  
-00014360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014370: 2020 2020 2020 7461 626c 655f 636f 6e74        table_cont
-00014380: 656e 7473 3d74 6162 6c65 5f63 6f6e 7465  ents=table_conte
-00014390: 6e74 732c 2074 696d 655f 6c65 6674 3d6d  nts, time_left=m
-000143a0: 6178 5f74 696d 656f 7574 0a20 2020 2020  ax_timeout.     
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000143c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000143d0: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
-000143e0: 3129 0a20 2020 2020 2020 2063 6f6e 736f  1).        conso
-000143f0: 6c65 2e70 7269 6e74 2874 6162 6c65 290a  le.print(table).
-00014400: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00014410: 2020 666f 7220 6970 5f61 6464 7265 7373    for ip_address
-00014420: 2069 6e20 6970 5f61 6464 7265 7373 6573   in ip_addresses
-00014430: 3a0a 2020 2020 2020 2020 2020 2020 5f2c  :.            _,
-00014440: 2074 6162 6c65 5f63 6f6e 7465 6e74 7320   table_contents 
-00014450: 3d20 6765 745f 6865 616c 7468 5f63 6865  = get_health_che
-00014460: 636b 7328 6970 5f61 6464 7265 7373 290a  cks(ip_address).
-00014470: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00014480: 6520 3d20 6372 6561 7465 5f63 6865 636b  e = create_check
-00014490: 5f74 6162 6c65 2874 6162 6c65 5f63 6f6e  _table(table_con
-000144a0: 7465 6e74 733d 7461 626c 655f 636f 6e74  tents=table_cont
-000144b0: 656e 7473 290a 2020 2020 2020 2020 2020  ents).          
-000144c0: 2020 636f 6e73 6f6c 652e 7072 696e 7428    console.print(
-000144d0: 7461 626c 6529 0a0a 0a63 6c69 2e61 6464  table)...cli.add
-000144e0: 5f63 6f6d 6d61 6e64 2863 6865 636b 290a  _command(check).
-000144f0: 0a0a 2320 6164 6420 4861 6772 6964 2069  ..# add Hagrid i
-00014500: 6e66 6f20 746f 2074 6865 2063 6c69 0a40  nfo to the cli.@
-00014510: 636c 6963 6b2e 636f 6d6d 616e 6428 6865  click.command(he
-00014520: 6c70 3d22 5368 6f77 2048 4147 7269 6420  lp="Show HAGrid 
-00014530: 696e 666f 2229 0a64 6566 2076 6572 7369  info").def versi
-00014540: 6f6e 2829 202d 3e20 4e6f 6e65 3a0a 2020  on() -> None:.  
-00014550: 2020 7072 696e 7428 6622 4841 4772 6964    print(f"HAGrid
-00014560: 2076 6572 7369 6f6e 3a20 7b5f 5f76 6572   version: {__ver
-00014570: 7369 6f6e 5f5f 7d22 290a 0a0a 636c 692e  sion__}")...cli.
-00014580: 6164 645f 636f 6d6d 616e 6428 7665 7273  add_command(vers
-00014590: 696f 6e29 0a0a 0a64 6566 2072 756e 5f71  ion)...def run_q
-000145a0: 7569 636b 7374 6172 7428 0a20 2020 2075  uickstart(.    u
-000145b0: 726c 3a20 4f70 7469 6f6e 616c 5b73 7472  rl: Optional[str
-000145c0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 7379  ] = None,.    sy
-000145d0: 6674 3a20 7374 7220 3d20 226c 6174 6573  ft: str = "lates
-000145e0: 7422 2c0a 2020 2020 7265 7365 743a 2062  t",.    reset: b
-000145f0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00014600: 2071 7569 6574 3a20 626f 6f6c 203d 2046   quiet: bool = F
-00014610: 616c 7365 2c0a 2020 2020 7072 653a 2062  alse,.    pre: b
-00014620: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00014630: 2074 6573 743a 2062 6f6f 6c20 3d20 4661   test: bool = Fa
-00014640: 6c73 652c 0a20 2020 2072 6570 6f3a 2073  lse,.    repo: s
-00014650: 7472 203d 2044 4546 4155 4c54 5f52 4550  tr = DEFAULT_REP
-00014660: 4f2c 0a20 2020 2062 7261 6e63 683a 2073  O,.    branch: s
-00014670: 7472 203d 2044 4546 4155 4c54 5f42 5241  tr = DEFAULT_BRA
-00014680: 4e43 482c 0a20 2020 2063 6f6d 6d69 743a  NCH,.    commit:
-00014690: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-000146a0: 204e 6f6e 652c 0a20 2020 2070 7974 686f   None,.    pytho
-000146b0: 6e3a 204f 7074 696f 6e61 6c5b 7374 725d  n: Optional[str]
-000146c0: 203d 204e 6f6e 652c 0a29 202d 3e20 4e6f   = None,.) -> No
-000146d0: 6e65 3a0a 2020 2020 7472 793a 0a20 2020  ne:.    try:.   
-000146e0: 2020 2020 2064 6972 6563 746f 7279 203d       directory =
-000146f0: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-00014700: 7365 7228 227e 2f2e 6861 6772 6964 2f71  ser("~/.hagrid/q
-00014710: 7569 636b 7374 6172 742f 2229 0a20 2020  uickstart/").   
-00014720: 2020 2020 2063 6f6e 6669 726d 5f72 6573       confirm_res
-00014730: 6574 203d 204e 6f6e 650a 2020 2020 2020  et = None.      
-00014740: 2020 6966 2072 6573 6574 3a0a 2020 2020    if reset:.    
-00014750: 2020 2020 2020 2020 6966 206e 6f74 2071          if not q
-00014760: 7569 6574 3a0a 2020 2020 2020 2020 2020  uiet:.          
-00014770: 2020 2020 2020 636f 6e66 6972 6d5f 7265        confirm_re
-00014780: 7365 7420 3d20 636c 6963 6b2e 636f 6e66  set = click.conf
-00014790: 6972 6d28 0a20 2020 2020 2020 2020 2020  irm(.           
-000147a0: 2020 2020 2020 2020 2022 5468 6973 2077           "This w
-000147b0: 696c 6c20 6372 6561 7465 2061 206e 6577  ill create a new
-000147c0: 2071 7569 636b 7374 6172 7420 7669 7274   quickstart virt
-000147d0: 7561 6c65 6e76 2061 6e64 2072 6569 6e73  ualenv and reins
-000147e0: 7461 6c6c 2053 7966 7420 616e 6420 220a  tall Syft and ".
-000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014800: 2020 2020 224a 7570 7974 6572 2e20 4172      "Jupyter. Ar
-00014810: 6520 796f 7520 7375 7265 2079 6f75 2077  e you sure you w
-00014820: 616e 7420 746f 2063 6f6e 7469 6e75 653f  ant to continue?
-00014830: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014840: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00014850: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014860: 2020 2020 2020 636f 6e66 6972 6d5f 7265        confirm_re
-00014870: 7365 7420 3d20 5472 7565 0a20 2020 2020  set = True.     
-00014880: 2020 2069 6620 636f 6e66 6972 6d5f 7265     if confirm_re
-00014890: 7365 7420 6973 2046 616c 7365 3a0a 2020  set is False:.  
-000148a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000148b0: 0a0a 2020 2020 2020 2020 6966 2072 6573  ..        if res
-000148c0: 6574 2061 6e64 2063 6f6e 6669 726d 5f72  et and confirm_r
-000148d0: 6573 6574 206f 7220 6e6f 7420 6f73 2e70  eset or not os.p
-000148e0: 6174 682e 6973 6469 7228 6469 7265 6374  ath.isdir(direct
-000148f0: 6f72 7929 3a0a 2020 2020 2020 2020 2020  ory):.          
-00014900: 2020 7175 6963 6b73 7461 7274 5f73 6574    quickstart_set
-00014910: 7570 280a 2020 2020 2020 2020 2020 2020  up(.            
-00014920: 2020 2020 6469 7265 6374 6f72 793d 6469      directory=di
-00014930: 7265 6374 6f72 792c 0a20 2020 2020 2020  rectory,.       
-00014940: 2020 2020 2020 2020 2073 7966 745f 7665           syft_ve
-00014950: 7273 696f 6e3d 7379 6674 2c0a 2020 2020  rsion=syft,.    
-00014960: 2020 2020 2020 2020 2020 2020 7265 7365              rese
-00014970: 743d 7265 7365 742c 0a20 2020 2020 2020  t=reset,.       
-00014980: 2020 2020 2020 2020 2070 7265 3d70 7265           pre=pre
-00014990: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000149a0: 2020 7079 7468 6f6e 3d70 7974 686f 6e2c    python=python,
-000149b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000149c0: 2020 2020 2020 2064 6f77 6e6c 6f61 6465         downloade
-000149d0: 645f 6669 6c65 7320 3d20 5b5d 0a20 2020  d_files = [].   
-000149e0: 2020 2020 2069 6620 7572 6c3a 0a20 2020       if url:.   
-000149f0: 2020 2020 2020 2020 2064 6f77 6e6c 6f61           downloa
-00014a00: 6465 645f 6669 6c65 7320 3d20 6665 7463  ded_files = fetc
-00014a10: 685f 6e6f 7465 626f 6f6b 735f 666f 725f  h_notebooks_for_
-00014a20: 7572 6c28 0a20 2020 2020 2020 2020 2020  url(.           
-00014a30: 2020 2020 2075 726c 3d75 726c 2c0a 2020       url=url,.  
-00014a40: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00014a50: 7265 6374 6f72 793d 6469 7265 6374 6f72  rectory=director
-00014a60: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-00014a70: 2020 2072 6573 6574 3d72 6573 6574 2c0a     reset=reset,.
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 7265 706f 3d72 6570 6f2c 0a20 2020 2020  repo=repo,.     
-00014aa0: 2020 2020 2020 2020 2020 2062 7261 6e63             branc
-00014ab0: 683d 6272 616e 6368 2c0a 2020 2020 2020  h=branch,.      
-00014ac0: 2020 2020 2020 2020 2020 636f 6d6d 6974            commit
-00014ad0: 3d63 6f6d 6d69 742c 0a20 2020 2020 2020  =commit,.       
-00014ae0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00014af0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014b00: 2066 696c 655f 7061 7468 203d 2061 6464   file_path = add
-00014b10: 5f69 6e74 726f 5f6e 6f74 6562 6f6f 6b28  _intro_notebook(
-00014b20: 6469 7265 6374 6f72 793d 6469 7265 6374  directory=direct
-00014b30: 6f72 792c 2072 6573 6574 3d72 6573 6574  ory, reset=reset
-00014b40: 290a 2020 2020 2020 2020 2020 2020 646f  ).            do
-00014b50: 776e 6c6f 6164 6564 5f66 696c 6573 2e61  wnloaded_files.a
-00014b60: 7070 656e 6428 6669 6c65 5f70 6174 6829  ppend(file_path)
-00014b70: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00014b80: 2864 6f77 6e6c 6f61 6465 645f 6669 6c65  (downloaded_file
-00014b90: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-00014ba0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00014bb0: 7469 6f6e 2866 2255 6e61 626c 6520 746f  tion(f"Unable to
-00014bc0: 2066 696e 6420 6669 6c65 7320 6174 3a20   find files at: 
-00014bd0: 7b75 726c 7d22 290a 2020 2020 2020 2020  {url}").        
-00014be0: 6669 6c65 5f70 6174 6820 3d20 736f 7274  file_path = sort
-00014bf0: 6564 2864 6f77 6e6c 6f61 6465 645f 6669  ed(downloaded_fi
-00014c00: 6c65 7329 5b30 5d0a 0a20 2020 2020 2020  les)[0]..       
-00014c10: 2023 2061 6464 2076 6972 7475 616c 656e   # add virtualen
-00014c20: 7620 7061 7468 0a20 2020 2020 2020 2065  v path.        e
-00014c30: 6e76 6972 6f6e 203d 206f 732e 656e 7669  nviron = os.envi
-00014c40: 726f 6e2e 636f 7079 2829 0a20 2020 2020  ron.copy().     
-00014c50: 2020 206f 735f 6269 6e5f 7061 7468 203d     os_bin_path =
-00014c60: 2022 5363 7269 7074 7322 2069 6620 6973   "Scripts" if is
-00014c70: 5f77 696e 646f 7773 2829 2065 6c73 6520  _windows() else 
-00014c80: 2262 696e 220a 2020 2020 2020 2020 7665  "bin".        ve
-00014c90: 6e76 5f64 6972 203d 2064 6972 6563 746f  nv_dir = directo
-00014ca0: 7279 202b 2022 2e76 656e 7622 0a20 2020  ry + ".venv".   
-00014cb0: 2020 2020 2065 6e76 6972 6f6e 5b22 5041       environ["PA
-00014cc0: 5448 225d 203d 2076 656e 765f 6469 7220  TH"] = venv_dir 
-00014cd0: 2b20 6f73 2e73 6570 202b 206f 735f 6269  + os.sep + os_bi
-00014ce0: 6e5f 7061 7468 202b 206f 732e 7061 7468  n_path + os.path
-00014cf0: 7365 7020 2b20 656e 7669 726f 6e5b 2250  sep + environ["P
-00014d00: 4154 4822 5d0a 2020 2020 2020 2020 6a75  ATH"].        ju
-00014d10: 7079 7465 725f 6269 6e61 7279 203d 2022  pyter_binary = "
-00014d20: 6a75 7079 7465 722e 6578 6522 2069 6620  jupyter.exe" if 
-00014d30: 6973 5f77 696e 646f 7773 2829 2065 6c73  is_windows() els
-00014d40: 6520 226a 7570 7974 6572 220a 2020 2020  e "jupyter".    
-00014d50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00014d60: 2020 2020 2070 7269 6e74 2866 2252 756e       print(f"Run
-00014d70: 6e69 6e67 204a 7570 7974 6572 204c 6162  ning Jupyter Lab
-00014d80: 2069 6e3a 207b 6469 7265 6374 6f72 797d   in: {directory}
-00014d90: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
-00014da0: 6d64 203d 2028 0a20 2020 2020 2020 2020  md = (.         
-00014db0: 2020 2020 2020 2076 656e 765f 6469 720a         venv_dir.
-00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dd0: 2b20 6f73 2e73 6570 0a20 2020 2020 2020  + os.sep.       
-00014de0: 2020 2020 2020 2020 202b 206f 735f 6269           + os_bi
-00014df0: 6e5f 7061 7468 0a20 2020 2020 2020 2020  n_path.         
-00014e00: 2020 2020 2020 202b 206f 732e 7365 700a         + os.sep.
-00014e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e20: 2b20 6622 7b6a 7570 7974 6572 5f62 696e  + f"{jupyter_bin
-00014e30: 6172 797d 206c 6162 202d 2d69 7020 302e  ary} lab --ip 0.
-00014e40: 302e 302e 3020 2d2d 6e6f 7465 626f 6f6b  0.0.0 --notebook
-00014e50: 2d64 6972 3d7b 6469 7265 6374 6f72 797d  -dir={directory}
-00014e60: 207b 6669 6c65 5f70 6174 687d 220a 2020   {file_path}".  
-00014e70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00014e80: 2020 2020 2020 2020 6966 2074 6573 743a          if test:
-00014e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ea0: 206a 7570 7974 6572 5f70 6174 6820 3d20   jupyter_path = 
-00014eb0: 7665 6e76 5f64 6972 202b 206f 732e 7365  venv_dir + os.se
-00014ec0: 7020 2b20 6f73 5f62 696e 5f70 6174 6820  p + os_bin_path 
-00014ed0: 2b20 6f73 2e73 6570 202b 206a 7570 7974  + os.sep + jupyt
-00014ee0: 6572 5f62 696e 6172 790a 2020 2020 2020  er_binary.      
-00014ef0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00014f00: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00014f10: 6a75 7079 7465 725f 7061 7468 293a 0a20  jupyter_path):. 
-00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f30: 2020 2070 7269 6e74 2866 2246 6169 6c65     print(f"Faile
-00014f40: 6420 746f 2069 6e73 7461 6c6c 204a 7570  d to install Jup
-00014f50: 7974 6572 2069 6e20 7061 7468 3a20 7b6a  yter in path: {j
-00014f60: 7570 7974 6572 5f70 6174 687d 2229 0a20  upyter_path}"). 
-00014f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f80: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00014f90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00014fa0: 7269 6e74 2866 224a 7570 7974 6572 2065  rint(f"Jupyter e
-00014fb0: 7869 7374 7320 6174 3a20 7b6a 7570 7974  xists at: {jupyt
-00014fc0: 6572 5f70 6174 687d 2e20 4349 2054 6573  er_path}. CI Tes
-00014fd0: 7420 6d6f 6465 2065 7869 7469 6e67 2e22  t mode exiting."
-00014fe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014ff0: 2020 7379 732e 6578 6974 2830 290a 0a20    sys.exit(0).. 
-00015000: 2020 2020 2020 2020 2020 2064 6973 6162             disab
-00015010: 6c65 5f74 6f6f 6c62 6172 5f65 7874 656e  le_toolbar_exten
-00015020: 7369 6f6e 203d 2028 0a20 2020 2020 2020  sion = (.       
-00015030: 2020 2020 2020 2020 2076 656e 765f 6469           venv_di
-00015040: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00015050: 2020 2b20 6f73 2e73 6570 0a20 2020 2020    + os.sep.     
-00015060: 2020 2020 2020 2020 2020 202b 206f 735f             + os_
-00015070: 6269 6e5f 7061 7468 0a20 2020 2020 2020  bin_path.       
-00015080: 2020 2020 2020 2020 202b 206f 732e 7365           + os.se
-00015090: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-000150a0: 2020 2b20 6622 7b6a 7570 7974 6572 5f62    + f"{jupyter_b
-000150b0: 696e 6172 797d 206c 6162 6578 7465 6e73  inary} labextens
-000150c0: 696f 6e20 6469 7361 626c 6520 406a 7570  ion disable @jup
-000150d0: 7974 6572 6c61 622f 6365 6c6c 2d74 6f6f  yterlab/cell-too
-000150e0: 6c62 6172 2d65 7874 656e 7369 6f6e 220a  lbar-extension".
-000150f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00015100: 2020 2020 2020 2020 2020 2073 7562 7072             subpr
-00015110: 6f63 6573 732e 7275 6e28 2020 2320 6e6f  ocess.run(  # no
-00015120: 7365 630a 2020 2020 2020 2020 2020 2020  sec.            
-00015130: 2020 2020 6469 7361 626c 655f 746f 6f6c      disable_tool
-00015140: 6261 725f 6578 7465 6e73 696f 6e2e 7370  bar_extension.sp
-00015150: 6c69 7428 2220 2229 2c20 6377 643d 6469  lit(" "), cwd=di
-00015160: 7265 6374 6f72 792c 2065 6e76 3d65 6e76  rectory, env=env
-00015170: 6972 6f6e 0a20 2020 2020 2020 2020 2020  iron.           
-00015180: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00015190: 4f4e 5f50 4f53 4958 203d 2022 706f 7369  ON_POSIX = "posi
-000151a0: 7822 2069 6e20 7379 732e 6275 696c 7469  x" in sys.builti
-000151b0: 6e5f 6d6f 6475 6c65 5f6e 616d 6573 0a0a  n_module_names..
-000151c0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-000151d0: 656e 7175 6575 655f 6f75 7470 7574 286f  enqueue_output(o
-000151e0: 7574 3a20 416e 792c 2071 7565 7565 3a20  ut: Any, queue: 
-000151f0: 5175 6575 6529 202d 3e20 4e6f 6e65 3a0a  Queue) -> None:.
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 666f 7220 6c69 6e65 2069 6e20 6974 6572  for line in iter
-00015220: 286f 7574 2e72 6561 646c 696e 652c 2062  (out.readline, b
-00015230: 2222 293a 0a20 2020 2020 2020 2020 2020  ""):.           
-00015240: 2020 2020 2020 2020 2071 7565 7565 2e70           queue.p
-00015250: 7574 286c 696e 6529 0a20 2020 2020 2020  ut(line).       
-00015260: 2020 2020 2020 2020 206f 7574 2e63 6c6f           out.clo
-00015270: 7365 2829 0a0a 2020 2020 2020 2020 2020  se()..          
-00015280: 2020 7072 6f63 203d 2073 7562 7072 6f63    proc = subproc
-00015290: 6573 732e 506f 7065 6e28 2020 2320 6e6f  ess.Popen(  # no
-000152a0: 7365 630a 2020 2020 2020 2020 2020 2020  sec.            
-000152b0: 2020 2020 636d 642e 7370 6c69 7428 2220      cmd.split(" 
-000152c0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-000152d0: 2020 2020 6377 643d 6469 7265 6374 6f72      cwd=director
-000152e0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-000152f0: 2020 2065 6e76 3d65 6e76 6972 6f6e 2c0a     env=environ,.
-00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015310: 7374 646f 7574 3d73 7562 7072 6f63 6573  stdout=subproces
-00015320: 732e 5049 5045 2c0a 2020 2020 2020 2020  s.PIPE,.        
-00015330: 2020 2020 2020 2020 7374 6465 7272 3d73          stderr=s
-00015340: 7562 7072 6f63 6573 732e 5049 5045 2c0a  ubprocess.PIPE,.
-00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015360: 636c 6f73 655f 6664 733d 4f4e 5f50 4f53  close_fds=ON_POS
-00015370: 4958 2c0a 2020 2020 2020 2020 2020 2020  IX,.            
-00015380: 290a 2020 2020 2020 2020 2020 2020 7175  ).            qu
-00015390: 6575 653a 2051 7565 7565 203d 2051 7565  eue: Queue = Que
-000153a0: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-000153b0: 2074 6872 6561 645f 3120 3d20 5468 7265   thread_1 = Thre
-000153c0: 6164 2874 6172 6765 743d 656e 7175 6575  ad(target=enqueu
-000153d0: 655f 6f75 7470 7574 2c20 6172 6773 3d28  e_output, args=(
-000153e0: 7072 6f63 2e73 7464 6f75 742c 2071 7565  proc.stdout, que
-000153f0: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
-00015400: 2074 6872 6561 645f 3220 3d20 5468 7265   thread_2 = Thre
-00015410: 6164 2874 6172 6765 743d 656e 7175 6575  ad(target=enqueu
-00015420: 655f 6f75 7470 7574 2c20 6172 6773 3d28  e_output, args=(
-00015430: 7072 6f63 2e73 7464 6572 722c 2071 7565  proc.stderr, que
-00015440: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
-00015450: 2074 6872 6561 645f 312e 6461 656d 6f6e   thread_1.daemon
-00015460: 203d 2054 7275 6520 2023 2074 6872 6561   = True  # threa
-00015470: 6420 6469 6573 2077 6974 6820 7468 6520  d dies with the 
-00015480: 7072 6f67 7261 6d0a 2020 2020 2020 2020  program.        
-00015490: 2020 2020 7468 7265 6164 5f31 2e73 7461      thread_1.sta
-000154a0: 7274 2829 0a20 2020 2020 2020 2020 2020  rt().           
-000154b0: 2074 6872 6561 645f 322e 6461 656d 6f6e   thread_2.daemon
-000154c0: 203d 2054 7275 6520 2023 2074 6872 6561   = True  # threa
-000154d0: 6420 6469 6573 2077 6974 6820 7468 6520  d dies with the 
-000154e0: 7072 6f67 7261 6d0a 2020 2020 2020 2020  program.        
-000154f0: 2020 2020 7468 7265 6164 5f32 2e73 7461      thread_2.sta
-00015500: 7274 2829 0a0a 2020 2020 2020 2020 2020  rt()..          
-00015510: 2020 6469 7370 6c61 795f 7572 6c20 3d20    display_url = 
-00015520: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00015530: 2023 206b 6565 706e 2072 6561 6469 6e67   # keepn reading
-00015540: 2074 6865 2071 7565 7565 206f 6620 7374   the queue of st
-00015550: 646f 7574 202b 2073 7464 6572 720a 2020  dout + stderr.  
-00015560: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00015570: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-00015580: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00015590: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000155a0: 6620 6e6f 7420 6469 7370 6c61 795f 7572  f not display_ur
-000155b0: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
-000155c0: 2020 2020 2020 2020 2020 2023 2074 7279             # try
-000155d0: 2074 6f20 7265 6164 2074 6865 206c 696e   to read the lin
-000155e0: 6520 616e 6420 6578 7472 6163 7420 6120  e and extract a 
-000155f0: 6a75 7079 7465 7220 7572 6c0a 2020 2020  jupyter url.    
-00015600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015610: 2020 2020 6c69 6e65 203d 2071 7565 7565      line = queue
-00015620: 2e67 6574 2829 0a20 2020 2020 2020 2020  .get().         
-00015630: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00015640: 6973 706c 6179 5f75 726c 203d 2065 7874  isplay_url = ext
-00015650: 7261 6374 5f6a 7570 7974 6572 5f75 726c  ract_jupyter_url
-00015660: 286c 696e 652e 6465 636f 6465 2822 7574  (line.decode("ut
-00015670: 662d 3822 2929 0a20 2020 2020 2020 2020  f-8")).         
-00015680: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015690: 6620 6469 7370 6c61 795f 7572 6c3a 0a20  f display_url:. 
-000156a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156b0: 2020 2020 2020 2020 2020 2064 6973 706c             displ
-000156c0: 6179 5f6a 7570 7974 6572 5f75 726c 2875  ay_jupyter_url(u
-000156d0: 726c 5f70 6172 7473 3d64 6973 706c 6179  rl_parts=display
-000156e0: 5f75 726c 290a 2020 2020 2020 2020 2020  _url).          
-000156f0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00015700: 626f 6172 6449 6e74 6572 7275 7074 3a0a  boardInterrupt:.
-00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015720: 2020 2020 7072 6f63 2e6b 696c 6c28 2920      proc.kill() 
-00015730: 2023 206d 616b 6520 7375 7265 206a 7570   # make sure jup
-00015740: 7974 6572 2067 6574 7320 6b69 6c6c 6564  yter gets killed
-00015750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015760: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00015770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015780: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00015790: 6e3a 2020 2320 6e6f 7365 630a 2020 2020  n:  # nosec.    
-000157a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157b0: 7061 7373 2020 2320 6e6f 7365 630a 2020  pass  # nosec.  
-000157c0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000157d0: 626f 6172 6449 6e74 6572 7275 7074 3a0a  boardInterrupt:.
-000157e0: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-000157f0: 2e6b 696c 6c28 2920 2023 206d 616b 6520  .kill()  # make 
-00015800: 7375 7265 206a 7570 7974 6572 2067 6574  sure jupyter get
-00015810: 7320 6b69 6c6c 6564 0a20 2020 2020 2020  s killed.       
-00015820: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00015830: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
-00015840: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00015850: 2020 2020 7072 696e 7428 6622 4572 726f      print(f"Erro
-00015860: 7220 7275 6e6e 696e 6720 7175 6963 6b73  r running quicks
-00015870: 7461 7274 3a20 7b65 7d22 290a 2020 2020  tart: {e}").    
-00015880: 2020 2020 7261 6973 6520 650a 0a0a 4063      raise e...@c
-00015890: 6c69 636b 2e63 6f6d 6d61 6e64 2868 656c  lick.command(hel
-000158a0: 703d 224c 6175 6e63 6820 6120 5379 6674  p="Launch a Syft
-000158b0: 202b 204a 7570 7974 6572 2053 6573 7369   + Jupyter Sessi
-000158c0: 6f6e 2077 6974 6820 6120 4e6f 7465 626f  on with a Notebo
-000158d0: 6f6b 2055 524c 202f 2050 6174 6822 290a  ok URL / Path").
-000158e0: 4063 6c69 636b 2e61 7267 756d 656e 7428  @click.argument(
-000158f0: 2275 726c 222c 2074 7970 653d 7374 722c  "url", type=str,
-00015900: 2072 6571 7569 7265 643d 4661 6c73 6529   required=False)
-00015910: 0a40 636c 6963 6b2e 6f70 7469 6f6e 280a  .@click.option(.
-00015920: 2020 2020 222d 2d72 6573 6574 222c 0a20      "--reset",. 
-00015930: 2020 2069 735f 666c 6167 3d54 7275 652c     is_flag=True,
-00015940: 0a20 2020 2073 686f 775f 6465 6661 756c  .    show_defaul
-00015950: 743d 5472 7565 2c0a 2020 2020 6465 6661  t=True,.    defa
-00015960: 756c 743d 4661 6c73 652c 0a20 2020 2068  ult=False,.    h
-00015970: 656c 703d 2246 6f72 6365 2068 6167 7269  elp="Force hagri
-00015980: 6420 7175 6963 6b73 7461 7274 2074 6f20  d quickstart to 
-00015990: 7365 7475 7020 6120 6672 6573 6820 7669  setup a fresh vi
-000159a0: 7274 7561 6c65 6e76 222c 0a29 0a40 636c  rtualenv",.).@cl
-000159b0: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-000159c0: 222d 2d73 7966 7422 2c0a 2020 2020 6465  "--syft",.    de
-000159d0: 6661 756c 743d 226c 6174 6573 7422 2c0a  fault="latest",.
-000159e0: 2020 2020 6865 6c70 3d22 4368 6f6f 7365      help="Choose
-000159f0: 2061 2073 7966 7420 7665 7273 696f 6e20   a syft version 
-00015a00: 6f72 206a 7573 7420 7573 6520 6c61 7465  or just use late
-00015a10: 7374 222c 0a29 0a40 636c 6963 6b2e 6f70  st",.).@click.op
-00015a20: 7469 6f6e 280a 2020 2020 222d 2d71 7569  tion(.    "--qui
-00015a30: 6574 222c 0a20 2020 2069 735f 666c 6167  et",.    is_flag
-00015a40: 3d54 7275 652c 0a20 2020 2073 686f 775f  =True,.    show_
-00015a50: 6465 6661 756c 743d 5472 7565 2c0a 2020  default=True,.  
-00015a60: 2020 6465 6661 756c 743d 4661 6c73 652c    default=False,
-00015a70: 0a20 2020 2068 656c 703d 2253 696c 656e  .    help="Silen
-00015a80: 6365 2063 6f6e 6669 726d 6174 696f 6e20  ce confirmation 
-00015a90: 7072 6f6d 7074 7322 2c0a 290a 4063 6c69  prompts",.).@cli
-00015aa0: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
-00015ab0: 2d2d 7072 6522 2c0a 2020 2020 6973 5f66  --pre",.    is_f
-00015ac0: 6c61 673d 5472 7565 2c0a 2020 2020 7368  lag=True,.    sh
-00015ad0: 6f77 5f64 6566 6175 6c74 3d54 7275 652c  ow_default=True,
-00015ae0: 0a20 2020 2064 6566 6175 6c74 3d46 616c  .    default=Fal
-00015af0: 7365 2c0a 2020 2020 6865 6c70 3d22 496e  se,.    help="In
-00015b00: 7374 616c 6c20 7072 652d 7265 6c65 6173  stall pre-releas
-00015b10: 6520 7665 7273 696f 6e73 206f 6620 7379  e versions of sy
-00015b20: 6674 222c 0a29 0a40 636c 6963 6b2e 6f70  ft",.).@click.op
-00015b30: 7469 6f6e 280a 2020 2020 222d 2d70 7974  tion(.    "--pyt
-00015b40: 686f 6e22 2c0a 2020 2020 6465 6661 756c  hon",.    defaul
-00015b50: 743d 4e6f 6e65 2c0a 2020 2020 6865 6c70  t=None,.    help
-00015b60: 3d22 5370 6563 6966 7920 7468 6520 7061  ="Specify the pa
-00015b70: 7468 2074 6f20 7768 6963 6820 7079 7468  th to which pyth
-00015b80: 6f6e 2074 6f20 7573 6522 2c0a 290a 4063  on to use",.).@c
-00015b90: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
-00015ba0: 2022 2d2d 7465 7374 222c 0a20 2020 2064   "--test",.    d
-00015bb0: 6566 6175 6c74 3d46 616c 7365 2c0a 2020  efault=False,.  
-00015bc0: 2020 6973 5f66 6c61 673d 5472 7565 2c0a    is_flag=True,.
-00015bd0: 2020 2020 6865 6c70 3d22 4349 2054 6573      help="CI Tes
-00015be0: 7420 4d6f 6465 2c20 646f 6e27 7420 6861  t Mode, don't ha
-00015bf0: 6e67 206f 6e20 4a75 7079 7465 7222 2c0a  ng on Jupyter",.
-00015c00: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
-00015c10: 0a20 2020 2022 2d2d 7265 706f 222c 0a20  .    "--repo",. 
-00015c20: 2020 2064 6566 6175 6c74 3d44 4546 4155     default=DEFAU
-00015c30: 4c54 5f52 4550 4f2c 0a20 2020 2068 656c  LT_REPO,.    hel
-00015c40: 703d 2243 686f 6f73 6520 6120 7265 706f  p="Choose a repo
-00015c50: 2074 6f20 6665 7463 6820 7468 6520 6e6f   to fetch the no
-00015c60: 7465 626f 6f6b 2066 726f 6d20 6f72 206a  tebook from or j
-00015c70: 7573 7420 7573 6520 4f70 656e 4d69 6e65  ust use OpenMine
-00015c80: 642f 5079 5379 6674 222c 0a29 0a40 636c  d/PySyft",.).@cl
-00015c90: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-00015ca0: 222d 2d62 7261 6e63 6822 2c0a 2020 2020  "--branch",.    
-00015cb0: 6465 6661 756c 743d 4445 4641 554c 545f  default=DEFAULT_
-00015cc0: 4252 414e 4348 2c0a 2020 2020 6865 6c70  BRANCH,.    help
-00015cd0: 3d22 4368 6f6f 7365 2061 2062 7261 6e63  ="Choose a branc
-00015ce0: 6820 746f 2066 6574 6368 2066 726f 6d20  h to fetch from 
-00015cf0: 6f72 206a 7573 7420 7573 6520 6465 7622  or just use dev"
-00015d00: 2c0a 290a 4063 6c69 636b 2e6f 7074 696f  ,.).@click.optio
-00015d10: 6e28 0a20 2020 2022 2d2d 636f 6d6d 6974  n(.    "--commit
-00015d20: 222c 0a20 2020 2068 656c 703d 2243 686f  ",.    help="Cho
-00015d30: 6f73 6520 6120 7370 6563 6966 6963 2063  ose a specific c
-00015d40: 6f6d 6d69 7420 746f 2066 6574 6368 2074  ommit to fetch t
-00015d50: 6865 206e 6f74 6562 6f6f 6b20 6672 6f6d  he notebook from
-00015d60: 222c 0a29 0a64 6566 2071 7569 636b 7374  ",.).def quickst
-00015d70: 6172 745f 636c 6928 0a20 2020 2075 726c  art_cli(.    url
-00015d80: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00015d90: 3d20 4e6f 6e65 2c0a 2020 2020 7379 6674  = None,.    syft
-00015da0: 3a20 7374 7220 3d20 226c 6174 6573 7422  : str = "latest"
-00015db0: 2c0a 2020 2020 7265 7365 743a 2062 6f6f  ,.    reset: boo
-00015dc0: 6c20 3d20 4661 6c73 652c 0a20 2020 2071  l = False,.    q
-00015dd0: 7569 6574 3a20 626f 6f6c 203d 2046 616c  uiet: bool = Fal
-00015de0: 7365 2c0a 2020 2020 7072 653a 2062 6f6f  se,.    pre: boo
-00015df0: 6c20 3d20 4661 6c73 652c 0a20 2020 2074  l = False,.    t
-00015e00: 6573 743a 2062 6f6f 6c20 3d20 4661 6c73  est: bool = Fals
-00015e10: 652c 0a20 2020 2072 6570 6f3a 2073 7472  e,.    repo: str
-00015e20: 203d 2044 4546 4155 4c54 5f52 4550 4f2c   = DEFAULT_REPO,
-00015e30: 0a20 2020 2062 7261 6e63 683a 2073 7472  .    branch: str
-00015e40: 203d 2044 4546 4155 4c54 5f42 5241 4e43   = DEFAULT_BRANC
-00015e50: 482c 0a20 2020 2063 6f6d 6d69 743a 204f  H,.    commit: O
-00015e60: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00015e70: 6f6e 652c 0a20 2020 2070 7974 686f 6e3a  one,.    python:
-00015e80: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00015e90: 204e 6f6e 652c 0a29 202d 3e20 4e6f 6e65   None,.) -> None
-00015ea0: 3a0a 2020 2020 7265 7475 726e 2072 756e  :.    return run
-00015eb0: 5f71 7569 636b 7374 6172 7428 0a20 2020  _quickstart(.   
-00015ec0: 2020 2020 2075 726c 3d75 726c 2c0a 2020       url=url,.  
-00015ed0: 2020 2020 2020 7379 6674 3d73 7966 742c        syft=syft,
-00015ee0: 0a20 2020 2020 2020 2072 6573 6574 3d72  .        reset=r
-00015ef0: 6573 6574 2c0a 2020 2020 2020 2020 7175  eset,.        qu
-00015f00: 6965 743d 7175 6965 742c 0a20 2020 2020  iet=quiet,.     
-00015f10: 2020 2070 7265 3d70 7265 2c0a 2020 2020     pre=pre,.    
-00015f20: 2020 2020 7465 7374 3d74 6573 742c 0a20      test=test,. 
-00015f30: 2020 2020 2020 2072 6570 6f3d 7265 706f         repo=repo
-00015f40: 2c0a 2020 2020 2020 2020 6272 616e 6368  ,.        branch
-00015f50: 3d62 7261 6e63 682c 0a20 2020 2020 2020  =branch,.       
-00015f60: 2063 6f6d 6d69 743d 636f 6d6d 6974 2c0a   commit=commit,.
-00015f70: 2020 2020 2020 2020 7079 7468 6f6e 3d70          python=p
-00015f80: 7974 686f 6e2c 0a20 2020 2029 0a0a 0a63  ython,.    )...c
-00015f90: 6c69 2e61 6464 5f63 6f6d 6d61 6e64 2871  li.add_command(q
-00015fa0: 7569 636b 7374 6172 745f 636c 692c 2022  uickstart_cli, "
-00015fb0: 7175 6963 6b73 7461 7274 2229 0a0a 0a64  quickstart")...d
-00015fc0: 6566 2064 6973 706c 6179 5f6a 7570 7974  ef display_jupyt
-00015fd0: 6572 5f75 726c 2875 726c 5f70 6172 7473  er_url(url_parts
-00015fe0: 3a20 5475 706c 655b 7374 722c 2073 7472  : Tuple[str, str
-00015ff0: 2c20 696e 745d 2920 2d3e 204e 6f6e 653a  , int]) -> None:
-00016000: 0a20 2020 2075 726c 203d 2075 726c 5f70  .    url = url_p
-00016010: 6172 7473 5b30 5d0a 2020 2020 6966 2069  arts[0].    if i
-00016020: 735f 6769 7470 6f64 2829 3a0a 2020 2020  s_gitpod():.    
-00016030: 2020 2020 7061 7274 7320 3d20 7572 6c70      parts = urlp
-00016040: 6172 7365 2875 726c 290a 2020 2020 2020  arse(url).      
-00016050: 2020 7175 6572 7920 3d20 6765 7461 7474    query = getatt
-00016060: 7228 7061 7274 732c 2022 7175 6572 7922  r(parts, "query"
-00016070: 2c20 2222 290a 2020 2020 2020 2020 7572  , "").        ur
-00016080: 6c20 3d20 6769 7470 6f64 5f75 726c 2870  l = gitpod_url(p
-00016090: 6f72 743d 7572 6c5f 7061 7274 735b 325d  ort=url_parts[2]
-000160a0: 2920 2b20 223f 2220 2b20 7175 6572 790a  ) + "?" + query.
-000160b0: 0a20 2020 2070 7269 6e74 280a 2020 2020  .    print(.    
-000160c0: 2020 2020 6622 4a75 7079 7465 7220 5365      f"Jupyter Se
-000160d0: 7276 6572 2069 7320 7275 6e6e 696e 6720  rver is running 
-000160e0: 6174 3a5c 6e7b 7572 6c7d 5c6e 220a 2020  at:\n{url}\n".  
-000160f0: 2020 2020 2020 2b20 2255 7365 2043 6f6e        + "Use Con
-00016100: 7472 6f6c 2d43 2074 6f20 7374 6f70 2074  trol-C to stop t
-00016110: 6869 7320 7365 7276 6572 2061 6e64 2073  his server and s
-00016120: 6875 7420 646f 776e 2061 6c6c 206b 6572  hut down all ker
-00016130: 6e65 6c73 2e22 0a20 2020 2029 0a0a 0a64  nels.".    )...d
-00016140: 6566 2065 7874 7261 6374 5f6a 7570 7974  ef extract_jupyt
-00016150: 6572 5f75 726c 286c 696e 653a 2073 7472  er_url(line: str
-00016160: 2920 2d3e 204f 7074 696f 6e61 6c5b 5475  ) -> Optional[Tu
-00016170: 706c 655b 7374 722c 2073 7472 2c20 696e  ple[str, str, in
-00016180: 745d 5d3a 0a20 2020 206a 7570 7974 6572  t]]:.    jupyter
-00016190: 5f72 6567 6578 203d 2072 225e 2e2a 2868  _regex = r"^.*(h
-000161a0: 7474 702e 2a31 3237 2e2a 2922 0a20 2020  ttp.*127.*)".   
-000161b0: 2074 7279 3a0a 2020 2020 2020 2020 6d61   try:.        ma
-000161c0: 7463 6865 7320 3d20 7265 2e6d 6174 6368  tches = re.match
-000161d0: 286a 7570 7974 6572 5f72 6567 6578 2c20  (jupyter_regex, 
-000161e0: 6c69 6e65 290a 2020 2020 2020 2020 6966  line).        if
-000161f0: 206d 6174 6368 6573 2069 7320 6e6f 7420   matches is not 
-00016200: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016210: 2020 7572 6c20 3d20 6d61 7463 6865 732e    url = matches.
-00016220: 6772 6f75 7028 3129 2e73 7472 6970 2829  group(1).strip()
-00016230: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00016240: 7473 203d 2075 726c 7061 7273 6528 7572  ts = urlparse(ur
-00016250: 6c29 0a20 2020 2020 2020 2020 2020 2068  l).            h
-00016260: 6f73 745f 6f72 5f69 705f 7061 7274 7320  ost_or_ip_parts 
-00016270: 3d20 7061 7274 732e 6e65 746c 6f63 2e73  = parts.netloc.s
-00016280: 706c 6974 2822 3a22 290a 2020 2020 2020  plit(":").      
-00016290: 2020 2020 2020 2320 6e65 746c 6f63 2069        # netloc i
-000162a0: 7320 686f 7374 3a70 6f72 740a 2020 2020  s host:port.    
-000162b0: 2020 2020 2020 2020 706f 7274 203d 2038          port = 8
-000162c0: 3838 380a 2020 2020 2020 2020 2020 2020  888.            
-000162d0: 6966 206c 656e 2868 6f73 745f 6f72 5f69  if len(host_or_i
-000162e0: 705f 7061 7274 7329 203e 2031 3a0a 2020  p_parts) > 1:.  
-000162f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00016300: 7274 203d 2069 6e74 2868 6f73 745f 6f72  rt = int(host_or
-00016310: 5f69 705f 7061 7274 735b 315d 290a 2020  _ip_parts[1]).  
-00016320: 2020 2020 2020 2020 2020 686f 7374 5f6f            host_o
-00016330: 725f 6970 203d 2068 6f73 745f 6f72 5f69  r_ip = host_or_i
-00016340: 705f 7061 7274 735b 305d 0a20 2020 2020  p_parts[0].     
-00016350: 2020 2020 2020 2072 6574 7572 6e20 2875         return (u
-00016360: 726c 2c20 686f 7374 5f6f 725f 6970 2c20  rl, host_or_ip, 
-00016370: 706f 7274 290a 2020 2020 6578 6365 7074  port).    except
-00016380: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00016390: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-000163a0: 6661 696c 6564 2074 6f20 7061 7273 6520  failed to parse 
-000163b0: 6a75 7079 7465 7220 7572 6c22 2c20 6529  jupyter url", e)
-000163c0: 0a20 2020 2072 6574 7572 6e20 4e6f 6e65  .    return None
-000163d0: 0a0a 0a64 6566 2071 7569 636b 7374 6172  ...def quickstar
-000163e0: 745f 7365 7475 7028 0a20 2020 2064 6972  t_setup(.    dir
-000163f0: 6563 746f 7279 3a20 7374 722c 0a20 2020  ectory: str,.   
-00016400: 2073 7966 745f 7665 7273 696f 6e3a 2073   syft_version: s
-00016410: 7472 2c0a 2020 2020 7265 7365 743a 2062  tr,.    reset: b
-00016420: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00016430: 2070 7265 3a20 626f 6f6c 203d 2046 616c   pre: bool = Fal
-00016440: 7365 2c0a 2020 2020 7079 7468 6f6e 3a20  se,.    python: 
-00016450: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00016460: 4e6f 6e65 2c0a 2920 2d3e 204e 6f6e 653a  None,.) -> None:
-00016470: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00016480: 2020 6f73 2e6d 616b 6564 6972 7328 6469    os.makedirs(di
-00016490: 7265 6374 6f72 792c 2065 7869 7374 5f6f  rectory, exist_o
-000164a0: 6b3d 5472 7565 290a 2020 2020 2020 2020  k=True).        
-000164b0: 7669 7274 7561 6c5f 656e 765f 6469 7220  virtual_env_dir 
-000164c0: 3d20 6f73 2e70 6174 682e 6162 7370 6174  = os.path.abspat
-000164d0: 6828 6469 7265 6374 6f72 7920 2b20 222e  h(directory + ".
-000164e0: 7665 6e76 2f22 290a 2020 2020 2020 2020  venv/").        
-000164f0: 6966 2072 6573 6574 2061 6e64 206f 732e  if reset and os.
-00016500: 7061 7468 2e65 7869 7374 7328 7669 7274  path.exists(virt
-00016510: 7561 6c5f 656e 765f 6469 7229 3a0a 2020  ual_env_dir):.  
-00016520: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
-00016530: 2e72 6d74 7265 6528 7669 7274 7561 6c5f  .rmtree(virtual_
-00016540: 656e 765f 6469 7229 0a20 2020 2020 2020  env_dir).       
-00016550: 2065 6e76 203d 2056 6972 7475 616c 456e   env = VirtualEn
-00016560: 7669 726f 6e6d 656e 7428 7669 7274 7561  vironment(virtua
-00016570: 6c5f 656e 765f 6469 722c 2070 7974 686f  l_env_dir, pytho
-00016580: 6e3d 7079 7468 6f6e 290a 0a20 2020 2020  n=python)..     
-00016590: 2020 2023 2075 7067 7261 6465 2070 6970     # upgrade pip
-000165a0: 0a20 2020 2020 2020 2065 6e76 2e69 6e73  .        env.ins
-000165b0: 7461 6c6c 2822 7069 7022 2c20 6f70 7469  tall("pip", opti
-000165c0: 6f6e 733d 5b22 2d55 225d 290a 2020 2020  ons=["-U"]).    
-000165d0: 2020 2020 656e 762e 696e 7374 616c 6c28      env.install(
-000165e0: 2270 6163 6b61 6769 6e67 222c 206f 7074  "packaging", opt
-000165f0: 696f 6e73 3d5b 222d 5522 5d29 0a0a 2020  ions=["-U"])..  
-00016600: 2020 2020 2020 7072 696e 7428 2249 6e73        print("Ins
-00016610: 7461 6c6c 696e 6720 4a75 7079 7465 7220  talling Jupyter 
-00016620: 4c61 6273 2229 0a20 2020 2020 2020 2065  Labs").        e
-00016630: 6e76 2e69 6e73 7461 6c6c 2822 6a75 7079  nv.install("jupy
-00016640: 7465 726c 6162 2229 0a20 2020 2020 2020  terlab").       
-00016650: 2065 6e76 2e69 6e73 7461 6c6c 2822 6970   env.install("ip
-00016660: 7977 6964 6765 7473 2229 0a0a 2020 2020  ywidgets")..    
-00016670: 2020 2020 6966 2045 4449 5441 424c 455f      if EDITABLE_
-00016680: 4d4f 4445 3a0a 2020 2020 2020 2020 2020  MODE:.          
-00016690: 2020 2320 6c6f 6361 6c5f 7379 6674 5f64    # local_syft_d
-000166a0: 6972 203d 2050 6174 6828 6f73 2e70 6174  ir = Path(os.pat
-000166b0: 682e 6162 7370 6174 6828 5061 7468 2868  h.abspath(Path(h
-000166c0: 6167 7269 645f 726f 6f74 2829 2920 2f20  agrid_root()) / 
-000166d0: 222e 2e2f 7379 6674 2229 290a 2020 2020  "../syft")).    
-000166e0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-000166f0: 2249 6e73 7461 6c6c 696e 6720 5379 6674  "Installing Syft
-00016700: 2069 6e20 4564 6974 6162 6c65 204d 6f64   in Editable Mod
-00016710: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00016720: 2320 656e 762e 696e 7374 616c 6c28 222d  # env.install("-
-00016730: 6520 2220 2b20 7374 7228 6c6f 6361 6c5f  e " + str(local_
-00016740: 7379 6674 5f64 6972 2929 0a20 2020 2020  syft_dir)).     
-00016750: 2020 2020 2020 206c 6f63 616c 5f68 6167         local_hag
-00016760: 7269 645f 6469 7220 3d20 5061 7468 286f  rid_dir = Path(o
-00016770: 732e 7061 7468 2e61 6273 7061 7468 2850  s.path.abspath(P
-00016780: 6174 6828 6861 6772 6964 5f72 6f6f 7428  ath(hagrid_root(
-00016790: 2929 202f 2022 2e2e 2f68 6167 7269 6422  )) / "../hagrid"
-000167a0: 2929 0a20 2020 2020 2020 2020 2020 2070  )).            p
-000167b0: 7269 6e74 2822 496e 7374 616c 6c69 6e67  rint("Installing
-000167c0: 2048 4147 7269 6420 696e 2045 6469 7461   HAGrid in Edita
-000167d0: 626c 6520 4d6f 6465 222c 2073 7472 286c  ble Mode", str(l
-000167e0: 6f63 616c 5f68 6167 7269 645f 6469 7229  ocal_hagrid_dir)
-000167f0: 290a 2020 2020 2020 2020 2020 2020 656e  ).            en
-00016800: 762e 696e 7374 616c 6c28 222d 6520 2220  v.install("-e " 
-00016810: 2b20 7374 7228 6c6f 6361 6c5f 6861 6772  + str(local_hagr
-00016820: 6964 5f64 6972 2929 0a20 2020 2020 2020  id_dir)).       
-00016830: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016840: 2020 2023 206f 7074 696f 6e73 203d 205b     # options = [
-00016850: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
-00016860: 6f70 7469 6f6e 732e 6170 7065 6e64 2822  options.append("
-00016870: 2d2d 666f 7263 6522 290a 2020 2020 2020  --force").      
-00016880: 2020 2020 2020 2320 6966 2073 7966 745f        # if syft_
-00016890: 7665 7273 696f 6e20 3d3d 2022 6c61 7465  version == "late
-000168a0: 7374 223a 0a20 2020 2020 2020 2020 2020  st":.           
-000168b0: 2023 2020 2020 2073 7966 745f 7665 7273   #     syft_vers
-000168c0: 696f 6e20 3d20 4c41 5445 5354 5f53 5441  ion = LATEST_STA
-000168d0: 424c 455f 5359 4654 0a20 2020 2020 2020  BLE_SYFT.       
-000168e0: 2020 2020 2023 2020 2020 2070 6163 6b61       #     packa
-000168f0: 6765 203d 2066 2273 7966 743e 3d7b 7379  ge = f"syft>={sy
-00016900: 6674 5f76 6572 7369 6f6e 7d22 0a20 2020  ft_version}".   
-00016910: 2020 2020 2020 2020 2023 2020 2020 2069           #     i
-00016920: 6620 7072 653a 0a20 2020 2020 2020 2020  f pre:.         
-00016930: 2020 2023 2020 2020 2020 2020 2070 6163     #         pac
-00016940: 6b61 6765 203d 2066 227b 7061 636b 6167  kage = f"{packag
-00016950: 657d 2e64 6576 3022 2020 2320 666f 7263  e}.dev0"  # forc
-00016960: 6520 7072 6520 7265 6c65 6173 650a 2020  e pre release.  
-00016970: 2020 2020 2020 2020 2020 2320 656c 7365            # else
-00016980: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00016990: 2020 2020 7061 636b 6167 6520 3d20 6622      package = f"
-000169a0: 7379 6674 3d3d 7b73 7966 745f 7665 7273  syft=={syft_vers
-000169b0: 696f 6e7d 220a 0a20 2020 2020 2020 2020  ion}"..         
-000169c0: 2020 2023 2069 6620 7072 653a 0a20 2020     # if pre:.   
-000169d0: 2020 2020 2020 2020 2023 2020 2020 206f           #     o
-000169e0: 7074 696f 6e73 2e61 7070 656e 6428 222d  ptions.append("-
-000169f0: 2d70 7265 2229 0a20 2020 2020 2020 2020  -pre").         
-00016a00: 2020 2023 2020 2020 2070 7269 6e74 2866     #     print(f
-00016a10: 2249 6e73 7461 6c6c 696e 6720 7b70 6163  "Installing {pac
-00016a20: 6b61 6765 7d20 2d2d 7072 6522 290a 2020  kage} --pre").  
-00016a30: 2020 2020 2020 2020 2020 2320 656c 7365            # else
-00016a40: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00016a50: 2020 2020 7072 696e 7428 6622 496e 7374      print(f"Inst
-00016a60: 616c 6c69 6e67 207b 7061 636b 6167 657d  alling {package}
-00016a70: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00016a80: 2065 6e76 2e69 6e73 7461 6c6c 2870 6163   env.install(pac
-00016a90: 6b61 6765 2c20 6f70 7469 6f6e 733d 6f70  kage, options=op
-00016aa0: 7469 6f6e 7329 0a20 2020 2020 2020 2020  tions).         
-00016ab0: 2020 2070 7269 6e74 2822 496e 7374 616c     print("Instal
-00016ac0: 6c69 6e67 2068 6167 7269 6422 290a 2020  ling hagrid").  
-00016ad0: 2020 2020 2020 2020 2020 656e 762e 696e            env.in
-00016ae0: 7374 616c 6c28 2268 6167 7269 6422 2c20  stall("hagrid", 
-00016af0: 6f70 7469 6f6e 733d 5b22 2d55 225d 290a  options=["-U"]).
-00016b00: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00016b10: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00016b20: 2020 2070 7269 6e74 2822 6661 696c 6564     print("failed
-00016b30: 222c 2065 290a 2020 2020 2020 2020 7261  ", e).        ra
-00016b40: 6973 6520 650a 0a0a 6465 6620 6164 645f  ise e...def add_
-00016b50: 696e 7472 6f5f 6e6f 7465 626f 6f6b 2864  intro_notebook(d
-00016b60: 6972 6563 746f 7279 3a20 7374 722c 2072  irectory: str, r
-00016b70: 6573 6574 3a20 626f 6f6c 203d 2046 616c  eset: bool = Fal
-00016b80: 7365 2920 2d3e 2073 7472 3a0a 2020 2020  se) -> str:.    
-00016b90: 6669 6c65 7320 3d20 6f73 2e6c 6973 7464  files = os.listd
-00016ba0: 6972 2864 6972 6563 746f 7279 290a 2020  ir(directory).  
-00016bb0: 2020 7472 793a 0a20 2020 2020 2020 2066    try:.        f
-00016bc0: 696c 6573 2e72 656d 6f76 6528 222e 7665  iles.remove(".ve
-00016bd0: 6e76 2229 0a20 2020 2065 7863 6570 7420  nv").    except 
-00016be0: 4578 6365 7074 696f 6e3a 2020 2320 6e6f  Exception:  # no
-00016bf0: 7365 630a 2020 2020 2020 2020 7061 7373  sec.        pass
-00016c00: 0a0a 2020 2020 6669 6c65 6e61 6d65 7320  ..    filenames 
-00016c10: 3d20 5b22 3030 2d71 7569 636b 7374 6172  = ["00-quickstar
-00016c20: 742e 6970 796e 6222 2c20 2230 312d 696e  t.ipynb", "01-in
-00016c30: 7374 616c 6c2d 7769 7a61 7264 2e69 7079  stall-wizard.ipy
-00016c40: 6e62 225d 0a0a 2020 2020 6966 206c 656e  nb"]..    if len
-00016c50: 2866 696c 6573 2920 3d3d 2030 206f 7220  (files) == 0 or 
-00016c60: 7265 7365 743a 0a20 2020 2020 2020 2069  reset:.        i
-00016c70: 6620 4544 4954 4142 4c45 5f4d 4f44 453a  f EDITABLE_MODE:
-00016c80: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-00016c90: 616c 5f73 7263 5f64 6972 203d 2050 6174  al_src_dir = Pat
-00016ca0: 6828 6f73 2e70 6174 682e 6162 7370 6174  h(os.path.abspat
-00016cb0: 6828 5061 7468 2868 6167 7269 645f 726f  h(Path(hagrid_ro
-00016cc0: 6f74 2829 2920 2f20 222e 2e2f 2e2e 2f22  ot()) / "../../"
-00016cd0: 2929 0a20 2020 2020 2020 2020 2020 2066  )).            f
-00016ce0: 6f72 2066 696c 656e 616d 6520 696e 2066  or filename in f
-00016cf0: 696c 656e 616d 6573 3a0a 2020 2020 2020  ilenames:.      
-00016d00: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-00016d10: 6174 6820 3d20 6f73 2e70 6174 682e 6162  ath = os.path.ab
-00016d20: 7370 6174 6828 6622 7b64 6972 6563 746f  spath(f"{directo
-00016d30: 7279 7d2f 7b66 696c 656e 616d 657d 2229  ry}/{filename}")
-00016d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016d50: 2073 6875 7469 6c2e 636f 7079 6669 6c65   shutil.copyfile
-00016d60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00016d70: 2020 2020 2020 6c6f 6361 6c5f 7372 635f        local_src_
-00016d80: 6469 7220 2f20 6622 6e6f 7465 626f 6f6b  dir / f"notebook
-00016d90: 732f 7175 6963 6b73 7461 7274 2f7b 6669  s/quickstart/{fi
-00016da0: 6c65 6e61 6d65 7d22 2c0a 2020 2020 2020  lename}",.      
-00016db0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00016dc0: 6c65 5f70 6174 682c 0a20 2020 2020 2020  le_path,.       
-00016dd0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00016de0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00016df0: 2020 2020 2066 6f72 2066 696c 656e 616d       for filenam
-00016e00: 6520 696e 2066 696c 656e 616d 6573 3a0a  e in filenames:.
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 7572 6c20 3d20 280a 2020 2020 2020 2020  url = (.        
-00016e30: 2020 2020 2020 2020 2020 2020 2268 7474              "htt
-00016e40: 7073 3a2f 2f72 6177 2e67 6974 6875 6275  ps://raw.githubu
-00016e50: 7365 7263 6f6e 7465 6e74 2e63 6f6d 2f4f  sercontent.com/O
-00016e60: 7065 6e4d 696e 6564 2f50 7953 7966 742f  penMined/PySyft/
-00016e70: 6465 762f 220a 2020 2020 2020 2020 2020  dev/".          
-00016e80: 2020 2020 2020 2020 2020 2b20 6622 6e6f            + f"no
-00016e90: 7465 626f 6f6b 732f 7175 6963 6b73 7461  tebooks/quicksta
-00016ea0: 7274 2f7b 6669 6c65 6e61 6d65 7d22 0a20  rt/{filename}". 
-00016eb0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00016ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ed0: 2066 696c 655f 7061 7468 2c20 5f2c 205f   file_path, _, _
-00016ee0: 203d 2071 7569 636b 7374 6172 745f 646f   = quickstart_do
-00016ef0: 776e 6c6f 6164 5f6e 6f74 6562 6f6f 6b28  wnload_notebook(
-00016f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f10: 2020 2020 2075 726c 3d75 726c 2c20 6469       url=url, di
-00016f20: 7265 6374 6f72 793d 6469 7265 6374 6f72  rectory=director
-00016f30: 792c 2072 6573 6574 3d72 6573 6574 0a20  y, reset=reset. 
-00016f40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00016f50: 0a20 2020 2069 6620 6172 675f 6361 6368  .    if arg_cach
-00016f60: 652e 696e 7374 616c 6c5f 7769 7a61 7264  e.install_wizard
-00016f70: 5f63 6f6d 706c 6574 653a 0a20 2020 2020  _complete:.     
-00016f80: 2020 2066 696c 656e 616d 6520 3d20 6669     filename = fi
-00016f90: 6c65 6e61 6d65 735b 305d 0a20 2020 2065  lenames[0].    e
-00016fa0: 6c73 653a 0a20 2020 2020 2020 2066 696c  lse:.        fil
-00016fb0: 656e 616d 6520 3d20 6669 6c65 6e61 6d65  ename = filename
-00016fc0: 735b 315d 0a20 2020 2072 6574 7572 6e20  s[1].    return 
-00016fd0: 6f73 2e70 6174 682e 6162 7370 6174 6828  os.path.abspath(
-00016fe0: 6622 7b64 6972 6563 746f 7279 7d2f 7b66  f"{directory}/{f
-00016ff0: 696c 656e 616d 657d 2229 0a0a 0a40 636c  ilename}")...@cl
-00017000: 6963 6b2e 636f 6d6d 616e 6428 6865 6c70  ick.command(help
-00017010: 3d22 5761 6c6b 2074 6865 2050 6174 6822  ="Walk the Path"
-00017020: 290a 4063 6c69 636b 2e6f 7074 696f 6e28  ).@click.option(
-00017030: 0a20 2020 2022 2d2d 7265 706f 222c 0a20  .    "--repo",. 
-00017040: 2020 2064 6566 6175 6c74 3d44 4546 4155     default=DEFAU
-00017050: 4c54 5f52 4550 4f2c 0a20 2020 2068 656c  LT_REPO,.    hel
-00017060: 703d 2243 686f 6f73 6520 6120 7265 706f  p="Choose a repo
-00017070: 2074 6f20 6665 7463 6820 7468 6520 6e6f   to fetch the no
-00017080: 7465 626f 6f6b 2066 726f 6d20 6f72 206a  tebook from or j
-00017090: 7573 7420 7573 6520 4f70 656e 4d69 6e65  ust use OpenMine
-000170a0: 642f 5079 5379 6674 222c 0a29 0a40 636c  d/PySyft",.).@cl
-000170b0: 6963 6b2e 6f70 7469 6f6e 280a 2020 2020  ick.option(.    
-000170c0: 222d 2d62 7261 6e63 6822 2c0a 2020 2020  "--branch",.    
-000170d0: 6465 6661 756c 743d 4445 4641 554c 545f  default=DEFAULT_
-000170e0: 4252 414e 4348 2c0a 2020 2020 6865 6c70  BRANCH,.    help
-000170f0: 3d22 4368 6f6f 7365 2061 2062 7261 6e63  ="Choose a branc
-00017100: 6820 746f 2066 6574 6368 2066 726f 6d20  h to fetch from 
-00017110: 6f72 206a 7573 7420 7573 6520 6465 7622  or just use dev"
-00017120: 2c0a 290a 4063 6c69 636b 2e6f 7074 696f  ,.).@click.optio
-00017130: 6e28 0a20 2020 2022 2d2d 636f 6d6d 6974  n(.    "--commit
-00017140: 222c 0a20 2020 2068 656c 703d 2243 686f  ",.    help="Cho
-00017150: 6f73 6520 6120 7370 6563 6966 6963 2063  ose a specific c
-00017160: 6f6d 6d69 7420 746f 2066 6574 6368 2074  ommit to fetch t
-00017170: 6865 206e 6f74 6562 6f6f 6b20 6672 6f6d  he notebook from
-00017180: 222c 0a29 0a64 6566 2064 6167 6f62 6168  ",.).def dagobah
-00017190: 280a 2020 2020 7265 706f 3a20 7374 7220  (.    repo: str 
-000171a0: 3d20 4445 4641 554c 545f 5245 504f 2c0a  = DEFAULT_REPO,.
-000171b0: 2020 2020 6272 616e 6368 3a20 7374 7220      branch: str 
-000171c0: 3d20 4445 4641 554c 545f 4252 414e 4348  = DEFAULT_BRANCH
-000171d0: 2c0a 2020 2020 636f 6d6d 6974 3a20 4f70  ,.    commit: Op
-000171e0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-000171f0: 6e65 2c0a 2920 2d3e 204e 6f6e 653a 0a20  ne,.) -> None:. 
-00017200: 2020 2072 6574 7572 6e20 7275 6e5f 7175     return run_qu
-00017210: 6963 6b73 7461 7274 2875 726c 3d22 7061  ickstart(url="pa
-00017220: 6461 7761 6e22 2c20 7265 706f 3d72 6570  dawan", repo=rep
-00017230: 6f2c 2062 7261 6e63 683d 6272 616e 6368  o, branch=branch
-00017240: 2c20 636f 6d6d 6974 3d63 6f6d 6d69 7429  , commit=commit)
-00017250: 0a0a 0a63 6c69 2e61 6464 5f63 6f6d 6d61  ...cli.add_comma
-00017260: 6e64 2864 6167 6f62 6168 290a 0a0a 6465  nd(dagobah)...de
-00017270: 6620 7373 685f 696e 746f 5f72 656d 6f74  f ssh_into_remot
-00017280: 655f 6d61 6368 696e 6528 0a20 2020 2068  e_machine(.    h
-00017290: 6f73 745f 6970 3a20 7374 722c 0a20 2020  ost_ip: str,.   
-000172a0: 2075 7365 726e 616d 653a 2073 7472 2c0a   username: str,.
-000172b0: 2020 2020 6175 7468 5f74 7970 653a 2073      auth_type: s
-000172c0: 7472 2c0a 2020 2020 7072 6976 6174 655f  tr,.    private_
-000172d0: 6b65 795f 7061 7468 3a20 4f70 7469 6f6e  key_path: Option
-000172e0: 616c 5b73 7472 5d2c 0a20 2020 2063 6d64  al[str],.    cmd
-000172f0: 3a20 7374 7220 3d20 2222 2c0a 2920 2d3e  : str = "",.) ->
-00017300: 204e 6f6e 653a 0a20 2020 2022 2222 4163   None:.    """Ac
-00017310: 6365 7373 206f 7220 6578 6563 7574 6520  cess or execute 
-00017320: 636f 6d6d 616e 6420 6f6e 2074 6865 2072  command on the r
-00017330: 656d 6f74 6520 6d61 6368 696e 652e 0a0a  emote machine...
-00017340: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00017350: 2020 686f 7374 5f69 7020 2873 7472 293a    host_ip (str):
-00017360: 2069 7020 6164 6472 6573 7320 6f66 2074   ip address of t
-00017370: 6865 2056 4d0a 2020 2020 2020 2020 7072  he VM.        pr
-00017380: 6976 6174 655f 6b65 795f 7061 7468 2028  ivate_key_path (
-00017390: 7374 7229 3a20 7072 6976 6174 6520 6b65  str): private ke
-000173a0: 7920 6f66 2074 6865 2056 4d0a 2020 2020  y of the VM.    
-000173b0: 2020 2020 7573 6572 6e61 6d65 2028 7374      username (st
-000173c0: 7229 3a20 7573 6572 6e61 6d65 206f 6e20  r): username on 
-000173d0: 7468 6520 564d 0a20 2020 2020 2020 2063  the VM.        c
-000173e0: 6d64 2028 7374 722c 206f 7074 696f 6e61  md (str, optiona
-000173f0: 6c29 3a20 436f 6d6d 616e 6420 746f 2065  l): Command to e
-00017400: 7865 6375 7465 206f 6e20 7468 6520 7265  xecute on the re
-00017410: 6d6f 7465 206d 6163 6869 6e65 2e20 4465  mote machine. De
-00017420: 6661 756c 7473 2074 6f20 2222 2e0a 2020  faults to ""..  
-00017430: 2020 2222 220a 2020 2020 7472 793a 0a20    """.    try:. 
-00017440: 2020 2020 2020 2069 6620 6175 7468 5f74         if auth_t
-00017450: 7970 6520 3d3d 2022 6b65 7922 3a0a 2020  ype == "key":.  
-00017460: 2020 2020 2020 2020 2020 7375 6270 726f            subpro
-00017470: 6365 7373 2e63 616c 6c28 2020 2320 6e6f  cess.call(  # no
-00017480: 7365 630a 2020 2020 2020 2020 2020 2020  sec.            
-00017490: 2020 2020 5b22 7373 6822 2c20 222d 6922      ["ssh", "-i"
-000174a0: 2c20 6622 7b70 7269 7661 7465 5f6b 6579  , f"{private_key
-000174b0: 5f70 6174 687d 222c 2066 227b 7573 6572  _path}", f"{user
-000174c0: 6e61 6d65 7d40 7b68 6f73 745f 6970 7d22  name}@{host_ip}"
-000174d0: 2c20 636d 645d 0a20 2020 2020 2020 2020  , cmd].         
-000174e0: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-000174f0: 6620 6175 7468 5f74 7970 6520 3d3d 2022  f auth_type == "
-00017500: 7061 7373 776f 7264 223a 0a20 2020 2020  password":.     
-00017510: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
-00017520: 732e 6361 6c6c 285b 2273 7368 222c 2066  s.call(["ssh", f
-00017530: 227b 7573 6572 6e61 6d65 7d40 7b68 6f73  "{username}@{hos
-00017540: 745f 6970 7d22 2c20 636d 645d 2920 2023  t_ip}", cmd])  #
-00017550: 206e 6f73 6563 0a20 2020 2065 7863 6570   nosec.    excep
-00017560: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00017570: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00017580: 650a 0a0a 4063 6c69 636b 2e63 6f6d 6d61  e...@click.comma
-00017590: 6e64 2868 656c 703d 2253 5348 2069 6e74  nd(help="SSH int
-000175a0: 6f20 7468 6520 4950 2061 6464 7265 7373  o the IP address
-000175b0: 206f 7220 6120 7265 736f 7572 6365 2067   or a resource g
-000175c0: 726f 7570 2229 0a40 636c 6963 6b2e 6172  roup").@click.ar
-000175d0: 6775 6d65 6e74 2822 6970 5f61 6464 7265  gument("ip_addre
-000175e0: 7373 222c 2074 7970 653d 7374 7229 0a40  ss", type=str).@
-000175f0: 636c 6963 6b2e 6f70 7469 6f6e 280a 2020  click.option(.  
-00017600: 2020 222d 2d63 6d64 222c 0a20 2020 2074    "--cmd",.    t
-00017610: 7970 653d 7374 722c 0a20 2020 2072 6571  ype=str,.    req
-00017620: 7569 7265 643d 4661 6c73 652c 0a20 2020  uired=False,.   
-00017630: 2064 6566 6175 6c74 3d22 222c 0a20 2020   default="",.   
-00017640: 2068 656c 703d 224f 7074 696f 6e61 6c3a   help="Optional:
-00017650: 2063 6f6d 6d61 6e64 2074 6f20 6578 6563   command to exec
-00017660: 7574 6520 6f6e 2074 6865 2072 656d 6f74  ute on the remot
-00017670: 6520 6d61 6368 696e 652e 222c 0a29 0a64  e machine.",.).d
-00017680: 6566 2073 7368 2869 705f 6164 6472 6573  ef ssh(ip_addres
-00017690: 733a 2073 7472 2c20 636d 643a 2073 7472  s: str, cmd: str
-000176a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 206b  ) -> None:.    k
-000176b0: 7761 7267 733a 2054 7970 6544 6963 7420  wargs: TypeDict 
-000176c0: 3d20 7b7d 0a20 2020 206b 6579 5f70 6174  = {}.    key_pat
-000176d0: 683a 204f 7074 696f 6e61 6c5b 7374 725d  h: Optional[str]
-000176e0: 203d 204e 6f6e 650a 0a20 2020 2069 6620   = None..    if 
-000176f0: 6368 6563 6b5f 6970 5f66 6f72 5f73 7368  check_ip_for_ssh
-00017700: 2869 705f 6164 6472 6573 732c 2074 696d  (ip_address, tim
-00017710: 656f 7574 3d31 302c 2073 696c 656e 743d  eout=10, silent=
-00017720: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00017730: 7573 6572 6e61 6d65 203d 2061 736b 280a  username = ask(.
-00017740: 2020 2020 2020 2020 2020 2020 7175 6573              ques
-00017750: 7469 6f6e 3d51 7565 7374 696f 6e28 0a20  tion=Question(. 
-00017760: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00017770: 6172 5f6e 616d 653d 2261 7a75 7265 5f75  ar_name="azure_u
-00017780: 7365 726e 616d 6522 2c0a 2020 2020 2020  sername",.      
-00017790: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-000177a0: 6f6e 3d22 5768 6174 2069 7320 7468 6520  on="What is the 
-000177b0: 7573 6572 6e61 6d65 2066 6f72 2074 6865  username for the
-000177c0: 2056 4d3f 222c 0a20 2020 2020 2020 2020   VM?",.         
-000177d0: 2020 2020 2020 2064 6566 6175 6c74 3d61         default=a
-000177e0: 7267 5f63 6163 6865 2e61 7a75 7265 5f75  rg_cache.azure_u
-000177f0: 7365 726e 616d 652c 0a20 2020 2020 2020  sername,.       
-00017800: 2020 2020 2020 2020 206b 696e 643d 2273           kind="s
-00017810: 7472 696e 6722 2c0a 2020 2020 2020 2020  tring",.        
-00017820: 2020 2020 2020 2020 6361 6368 653d 5472          cache=Tr
-00017830: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00017840: 292c 0a20 2020 2020 2020 2020 2020 206b  ),.            k
-00017850: 7761 7267 733d 6b77 6172 6773 2c0a 2020  wargs=kwargs,.  
-00017860: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00017870: 6175 7468 5f74 7970 6520 3d20 6173 6b28  auth_type = ask(
-00017880: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
-00017890: 7374 696f 6e3d 5175 6573 7469 6f6e 280a  stion=Question(.
-000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178b0: 7661 725f 6e61 6d65 3d22 6175 7468 5f74  var_name="auth_t
-000178c0: 7970 6522 2c0a 2020 2020 2020 2020 2020  ype",.          
-000178d0: 2020 2020 2020 7175 6573 7469 6f6e 3d22        question="
-000178e0: 446f 2079 6f75 2077 616e 7420 746f 206c  Do you want to l
-000178f0: 6f67 696e 2077 6974 6820 6120 6b65 7920  ogin with a key 
-00017900: 6f72 2070 6173 7377 6f72 6422 2c0a 2020  or password",.  
-00017910: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00017920: 6661 756c 743d 6172 675f 6361 6368 652e  fault=arg_cache.
-00017930: 6175 7468 5f74 7970 652c 0a20 2020 2020  auth_type,.     
-00017940: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
-00017950: 226f 7074 696f 6e22 2c0a 2020 2020 2020  "option",.      
-00017960: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
-00017970: 733d 5b22 6b65 7922 2c20 2270 6173 7377  s=["key", "passw
-00017980: 6f72 6422 5d2c 0a20 2020 2020 2020 2020  ord"],.         
-00017990: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
-000179a0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-000179b0: 2c0a 2020 2020 2020 2020 2020 2020 6b77  ,.            kw
-000179c0: 6172 6773 3d6b 7761 7267 732c 0a20 2020  args=kwargs,.   
-000179d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000179e0: 6966 2061 7574 685f 7479 7065 203d 3d20  if auth_type == 
-000179f0: 226b 6579 223a 0a20 2020 2020 2020 2020  "key":.         
-00017a00: 2020 206b 6579 5f70 6174 6820 3d20 6173     key_path = as
-00017a10: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
-00017a20: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
-00017a30: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00017a40: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
-00017a50: 6d65 3d22 617a 7572 655f 6b65 795f 7061  me="azure_key_pa
-00017a60: 7468 222c 0a20 2020 2020 2020 2020 2020  th",.           
-00017a70: 2020 2020 2020 2020 2071 7565 7374 696f           questio
-00017a80: 6e3d 2241 6273 6f6c 7574 6520 7061 7468  n="Absolute path
-00017a90: 2074 6f20 7468 6520 7072 6976 6174 6520   to the private 
-00017aa0: 6b65 7920 6f66 2074 6865 2056 4d3f 222c  key of the VM?",
-00017ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ac0: 2020 2020 2064 6566 6175 6c74 3d61 7267       default=arg
-00017ad0: 5f63 6163 6865 2e61 7a75 7265 5f6b 6579  _cache.azure_key
-00017ae0: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-00017af0: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
-00017b00: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
-00017b10: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00017b20: 6368 653d 5472 7565 2c0a 2020 2020 2020  che=True,.      
-00017b30: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00017b40: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00017b50: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
-00017b60: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00017b70: 2020 2023 2053 5348 2069 6e74 6f20 7468     # SSH into th
-00017b80: 6520 7265 6d6f 7465 2061 6e64 2065 7865  e remote and exe
-00017b90: 6375 7465 2074 6865 2063 6f6d 6d61 6e64  cute the command
-00017ba0: 0a20 2020 2020 2020 2073 7368 5f69 6e74  .        ssh_int
-00017bb0: 6f5f 7265 6d6f 7465 5f6d 6163 6869 6e65  o_remote_machine
-00017bc0: 280a 2020 2020 2020 2020 2020 2020 686f  (.            ho
-00017bd0: 7374 5f69 703d 6970 5f61 6464 7265 7373  st_ip=ip_address
-00017be0: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-00017bf0: 6572 6e61 6d65 3d75 7365 726e 616d 652c  ername=username,
-00017c00: 0a20 2020 2020 2020 2020 2020 2061 7574  .            aut
-00017c10: 685f 7479 7065 3d61 7574 685f 7479 7065  h_type=auth_type
-00017c20: 2c0a 2020 2020 2020 2020 2020 2020 7072  ,.            pr
-00017c30: 6976 6174 655f 6b65 795f 7061 7468 3d6b  ivate_key_path=k
-00017c40: 6579 5f70 6174 682c 0a20 2020 2020 2020  ey_path,.       
-00017c50: 2020 2020 2063 6d64 3d63 6d64 2c0a 2020       cmd=cmd,.  
-00017c60: 2020 2020 2020 290a 0a0a 636c 692e 6164        )...cli.ad
-00017c70: 645f 636f 6d6d 616e 6428 7373 6829 0a    d_command(ssh).
+0000a930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a940: 2020 6966 2061 7574 6f5f 6765 6e65 7261    if auto_genera
+0000a950: 7465 5f70 6173 7377 6f72 6420 3d3d 2022  te_password == "
+0000a960: 7922 3a20 2023 206e 6f73 6563 0a20 2020  y":  # nosec.   
+0000a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a980: 2070 6172 7365 645f 6b77 6172 6773 5b22   parsed_kwargs["
+0000a990: 7061 7373 776f 7264 225d 203d 2067 656e  password"] = gen
+0000a9a0: 6572 6174 655f 7365 635f 7261 6e64 6f6d  erate_sec_random
+0000a9b0: 5f70 6173 7377 6f72 6428 6c65 6e67 7468  _password(length
+0000a9c0: 3d31 3629 0a20 2020 2020 2020 2020 2020  =16).           
+0000a9d0: 2020 2020 2065 6c69 6620 6175 746f 5f67       elif auto_g
+0000a9e0: 656e 6572 6174 655f 7061 7373 776f 7264  enerate_password
+0000a9f0: 203d 3d20 226e 223a 2020 2320 6e6f 7365   == "n":  # nose
+0000aa00: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+0000aa10: 2020 2020 2020 7061 7273 6564 5f6b 7761        parsed_kwa
+0000aa20: 7267 735b 2270 6173 7377 6f72 6422 5d20  rgs["password"] 
+0000aa30: 3d20 6173 6b28 0a20 2020 2020 2020 2020  = ask(.         
+0000aa40: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000aa50: 7565 7374 696f 6e3d 5175 6573 7469 6f6e  uestion=Question
+0000aa60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000aa70: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000aa80: 725f 6e61 6d65 3d22 7061 7373 776f 7264  r_name="password
+0000aa90: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000aab0: 7565 7374 696f 6e3d 6622 5061 7373 776f  uestion=f"Passwo
+0000aac0: 7264 2066 6f72 207b 7573 6572 6e61 6d65  rd for {username
+0000aad0: 7d40 7b68 6f73 747d 3f22 2c0a 2020 2020  }@{host}?",.    
+0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aaf0: 2020 2020 2020 2020 6b69 6e64 3d22 7061          kind="pa
+0000ab00: 7373 776f 7264 222c 0a20 2020 2020 2020  ssword",.       
+0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab20: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0000ab30: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000ab40: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
+0000ab50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ab60: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000ab70: 706f 203d 2061 736b 280a 2020 2020 2020  po = ask(.      
+0000ab80: 2020 2020 2020 2020 2020 5175 6573 7469            Questi
+0000ab90: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000aba0: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
+0000abb0: 3d22 617a 7572 655f 7265 706f 222c 0a20  ="azure_repo",. 
+0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abd0: 2020 2071 7565 7374 696f 6e3d 2252 6570     question="Rep
+0000abe0: 6f20 746f 2066 6574 6368 2073 6f75 7263  o to fetch sourc
+0000abf0: 6520 6672 6f6d 3f22 2c0a 2020 2020 2020  e from?",.      
+0000ac00: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000ac10: 6661 756c 743d 6172 675f 6361 6368 655b  fault=arg_cache[
+0000ac20: 2261 7a75 7265 5f72 6570 6f22 5d2c 0a20  "azure_repo"],. 
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac40: 2020 206b 696e 643d 2273 7472 696e 6722     kind="string"
+0000ac50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ac60: 2020 2020 2020 6361 6368 653d 5472 7565        cache=True
+0000ac70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ac80: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0000ac90: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
+0000aca0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+0000acb0: 290a 2020 2020 2020 2020 2020 2020 6272  ).            br
+0000acc0: 616e 6368 203d 2061 736b 280a 2020 2020  anch = ask(.    
+0000acd0: 2020 2020 2020 2020 2020 2020 5175 6573              Ques
+0000ace0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+0000acf0: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
+0000ad00: 6d65 3d22 617a 7572 655f 6272 616e 6368  me="azure_branch
+0000ad10: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000ad20: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000ad30: 2242 7261 6e63 6820 746f 206d 6f6e 6974  "Branch to monit
+0000ad40: 6f72 2066 6f72 2075 7064 6174 6573 3f22  or for updates?"
+0000ad50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ad60: 2020 2020 2020 6465 6661 756c 743d 6172        default=ar
+0000ad70: 675f 6361 6368 655b 2261 7a75 7265 5f62  g_cache["azure_b
+0000ad80: 7261 6e63 6822 5d2c 0a20 2020 2020 2020  ranch"],.       
+0000ad90: 2020 2020 2020 2020 2020 2020 206b 696e               kin
+0000ada0: 643d 2273 7472 696e 6722 2c0a 2020 2020  d="string",.    
+0000adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adc0: 6361 6368 653d 5472 7565 2c0a 2020 2020  cache=True,.    
+0000add0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000adf0: 7761 7267 733d 6b77 6172 6773 2c0a 2020  wargs=kwargs,.  
+0000ae00: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000ae10: 2020 2020 2020 2020 2075 7365 5f62 7261           use_bra
+0000ae20: 6e63 6828 6272 616e 6368 3d62 7261 6e63  nch(branch=branc
+0000ae30: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
+0000ae40: 7061 7373 776f 7264 203d 2070 6172 7365  password = parse
+0000ae50: 645f 6b77 6172 6773 2e67 6574 2822 7061  d_kwargs.get("pa
+0000ae60: 7373 776f 7264 2229 0a0a 2020 2020 2020  ssword")..      
+0000ae70: 2020 2020 2020 6175 7468 203d 2041 7574        auth = Aut
+0000ae80: 6843 7265 6465 6e74 6961 6c73 280a 2020  hCredentials(.  
+0000ae90: 2020 2020 2020 2020 2020 2020 2020 7573                us
+0000aea0: 6572 6e61 6d65 3d75 7365 726e 616d 652c  ername=username,
+0000aeb0: 206b 6579 5f70 6174 683d 6b65 795f 7061   key_path=key_pa
+0000aec0: 7468 2c20 7061 7373 776f 7264 3d70 6173  th, password=pas
+0000aed0: 7377 6f72 640a 2020 2020 2020 2020 2020  sword.          
+0000aee0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0000aef0: 2069 6620 6e6f 7420 6175 7468 2e76 616c   if not auth.val
+0000af00: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+0000af10: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000af20: 696f 6e28 6622 4c6f 6769 6e20 4372 6564  ion(f"Login Cred
+0000af30: 656e 7469 616c 7320 6172 6520 6e6f 7420  entials are not 
+0000af40: 7661 6c69 642e 207b 6175 7468 7d22 290a  valid. {auth}").
+0000af50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000af60: 7572 6e20 6372 6561 7465 5f6c 6175 6e63  urn create_launc
+0000af70: 685f 617a 7572 655f 636d 6428 0a20 2020  h_azure_cmd(.   
+0000af80: 2020 2020 2020 2020 2020 2020 2076 6572               ver
+0000af90: 623d 7665 7262 2c0a 2020 2020 2020 2020  b=verb,.        
+0000afa0: 2020 2020 2020 2020 7265 736f 7572 6365          resource
+0000afb0: 5f67 726f 7570 3d72 6573 6f75 7263 655f  _group=resource_
+0000afc0: 6772 6f75 702c 0a20 2020 2020 2020 2020  group,.         
+0000afd0: 2020 2020 2020 206c 6f63 6174 696f 6e3d         location=
+0000afe0: 6c6f 6361 7469 6f6e 2c0a 2020 2020 2020  location,.      
+0000aff0: 2020 2020 2020 2020 2020 7369 7a65 3d73            size=s
+0000b000: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0000b010: 2020 2020 2075 7365 726e 616d 653d 7573       username=us
+0000b020: 6572 6e61 6d65 2c0a 2020 2020 2020 2020  ername,.        
+0000b030: 2020 2020 2020 2020 7061 7373 776f 7264          password
+0000b040: 3d70 6173 7377 6f72 642c 0a20 2020 2020  =password,.     
+0000b050: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
+0000b060: 6174 683d 6b65 795f 7061 7468 2c0a 2020  ath=key_path,.  
+0000b070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000b080: 706f 3d72 6570 6f2c 0a20 2020 2020 2020  po=repo,.       
+0000b090: 2020 2020 2020 2020 2062 7261 6e63 683d           branch=
+0000b0a0: 6272 616e 6368 2c0a 2020 2020 2020 2020  branch,.        
+0000b0b0: 2020 2020 2020 2020 6175 7468 3d61 7574          auth=aut
+0000b0c0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0000b0d0: 2020 2061 6e73 6962 6c65 5f65 7874 7261     ansible_extra
+0000b0e0: 733d 6b77 6172 6773 5b22 616e 7369 626c  s=kwargs["ansibl
+0000b0f0: 655f 6578 7472 6173 225d 2c0a 2020 2020  e_extras"],.    
+0000b100: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000b110: 6773 3d70 6172 7365 645f 6b77 6172 6773  gs=parsed_kwargs
+0000b120: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000b130: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000b140: 2020 2020 2020 2020 2020 6572 726f 7273            errors
+0000b150: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0000b160: 2020 6966 206e 6f74 2044 4550 454e 4445    if not DEPENDE
+0000b170: 4e43 4945 535b 2261 6e73 6962 6c65 2d70  NCIES["ansible-p
+0000b180: 6c61 7962 6f6f 6b22 5d3a 0a20 2020 2020  laybook"]:.     
+0000b190: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0000b1a0: 732e 6170 7065 6e64 2822 616e 7369 626c  s.append("ansibl
+0000b1b0: 652d 706c 6179 626f 6f6b 2229 0a20 2020  e-playbook").   
+0000b1c0: 2020 2020 2020 2020 206d 7367 203d 2022           msg = "
+0000b1d0: 5c6e 4552 524f 5221 2121 204d 4953 5349  \nERROR!!! MISSI
+0000b1e0: 4e47 2044 4550 454e 4445 4e43 5921 2121  NG DEPENDENCY!!!
+0000b1f0: 220a 2020 2020 2020 2020 2020 2020 6d73  ".            ms
+0000b200: 6720 2b3d 2066 225c 6e5c 6e4c 6175 6e63  g += f"\n\nLaunc
+0000b210: 6869 6e67 2061 2043 6c6f 7564 2056 4d20  hing a Cloud VM 
+0000b220: 7265 7175 6972 6573 3a20 7b27 2027 2e6a  requires: {' '.j
+0000b230: 6f69 6e28 6572 726f 7273 297d 220a 2020  oin(errors)}".  
+0000b240: 2020 2020 2020 2020 2020 6d73 6720 2b3d            msg +=
+0000b250: 2022 5c6e 5c6e 506c 6561 7365 2066 6f6c   "\n\nPlease fol
+0000b260: 6c6f 7720 696e 7374 616c 6c61 7469 6f6e  low installation
+0000b270: 2069 6e73 7472 7563 7469 6f6e 733a 2022   instructions: "
+0000b280: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+0000b290: 202b 3d20 2268 7474 7073 3a2f 2f64 6f63   += "https://doc
+0000b2a0: 732e 616e 7369 626c 652e 636f 6d2f 616e  s.ansible.com/an
+0000b2b0: 7369 626c 652f 6c61 7465 7374 2f69 6e73  sible/latest/ins
+0000b2c0: 7461 6c6c 6174 696f 6e5f 6775 6964 652f  tallation_guide/
+0000b2d0: 696e 7472 6f5f 696e 7374 616c 6c61 7469  intro_installati
+0000b2e0: 6f6e 2e68 746d 6c23 220a 2020 2020 2020  on.html#".      
+0000b2f0: 2020 2020 2020 6d73 6720 2b3d 2022 5c6e        msg += "\n
+0000b300: 5c6e 4e6f 7465 3a20 7765 2776 6520 666f  \nNote: we've fo
+0000b310: 756e 6420 7468 6520 2763 6f6e 6461 2720  und the 'conda' 
+0000b320: 6261 7365 6420 696e 7374 616c 6c61 7469  based installati
+0000b330: 6f6e 2069 6e73 7472 7563 7469 6f6e 7320  on instructions 
+0000b340: 746f 2077 6f72 6b20 6265 7374 220a 2020  to work best".  
+0000b350: 2020 2020 2020 2020 2020 6d73 6720 2b3d            msg +=
+0000b360: 2022 2028 652e 672e 2073 6f6d 6574 6869   " (e.g. somethi
+0000b370: 6e67 206c 6b65 2027 636f 6e64 6120 696e  ng lke 'conda in
+0000b380: 7374 616c 6c20 2d63 2063 6f6e 6461 2d66  stall -c conda-f
+0000b390: 6f72 6765 2061 6e73 6962 6c65 2729 2e20  orge ansible'). 
+0000b3a0: 220a 2020 2020 2020 2020 2020 2020 6d73  ".            ms
+0000b3b0: 6720 2b3d 2022 5468 6520 7069 7020 6261  g += "The pip ba
+0000b3c0: 7365 6420 696e 7374 7275 6374 696f 6e73  sed instructions
+0000b3d0: 2073 6565 6d20 746f 2062 6520 6120 6269   seem to be a bi
+0000b3e0: 7420 6275 6767 7920 6966 2079 6f75 2772  t buggy if you'r
+0000b3f0: 6520 7573 696e 6720 6120 636f 6e64 6120  e using a conda 
+0000b400: 656e 7669 726f 6e6d 656e 7422 0a20 2020  environment".   
+0000b410: 2020 2020 2020 2020 206d 7367 202b 3d20           msg += 
+0000b420: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
+0000b430: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
+0000b440: 7065 6e64 656e 6379 286d 7367 290a 0a20  pendency(msg).. 
+0000b450: 2020 2065 6c69 6620 686f 7374 2069 6e20     elif host in 
+0000b460: 5b22 6763 7022 5d3a 0a20 2020 2020 2020  ["gcp"]:.       
+0000b470: 2063 6865 636b 5f67 636c 6f75 645f 636c   check_gcloud_cl
+0000b480: 695f 696e 7374 616c 6c65 6428 290a 0a20  i_installed().. 
+0000b490: 2020 2020 2020 2077 6869 6c65 206e 6f74         while not
+0000b4a0: 2063 6865 636b 5f67 636c 6f75 645f 6175   check_gcloud_au
+0000b4b0: 7468 6564 2829 3a0a 2020 2020 2020 2020  thed():.        
+0000b4c0: 2020 2020 7072 696e 7428 2259 6f75 206e      print("You n
+0000b4d0: 6565 6420 746f 206c 6f67 2069 6e74 6f20  eed to log into 
+0000b4e0: 476f 6f67 6c65 2043 6c6f 7564 2229 0a20  Google Cloud"). 
+0000b4f0: 2020 2020 2020 2020 2020 206c 6f67 696e             login
+0000b500: 5f67 636c 6f75 6428 290a 0a20 2020 2020  _gcloud()..     
+0000b510: 2020 2069 6620 4445 5045 4e44 454e 4349     if DEPENDENCI
+0000b520: 4553 5b22 616e 7369 626c 652d 706c 6179  ES["ansible-play
+0000b530: 626f 6f6b 225d 3a0a 2020 2020 2020 2020  book"]:.        
+0000b540: 2020 2020 7072 6f6a 6563 745f 6964 203d      project_id =
+0000b550: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
+0000b560: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
+0000b570: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+0000b580: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000b590: 5f6e 616d 653d 2267 6370 5f70 726f 6a65  _name="gcp_proje
+0000b5a0: 6374 5f69 6422 2c0a 2020 2020 2020 2020  ct_id",.        
+0000b5b0: 2020 2020 2020 2020 2020 2020 7175 6573              ques
+0000b5c0: 7469 6f6e 3d22 5768 6174 2050 524f 4a45  tion="What PROJE
+0000b5d0: 4354 2049 4420 646f 2079 6f75 2077 616e  CT ID do you wan
+0000b5e0: 7420 746f 2075 7365 3f22 2c0a 2020 2020  t to use?",.    
+0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b600: 6465 6661 756c 743d 6172 675f 6361 6368  default=arg_cach
+0000b610: 655b 2267 6370 5f70 726f 6a65 6374 5f69  e["gcp_project_i
+0000b620: 6422 5d2c 0a20 2020 2020 2020 2020 2020  d"],.           
+0000b630: 2020 2020 2020 2020 206b 696e 643d 2273           kind="s
+0000b640: 7472 696e 6722 2c0a 2020 2020 2020 2020  tring",.        
+0000b650: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+0000b660: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0000b670: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+0000b680: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0000b690: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
+0000b6a0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000b6b0: 2020 2020 207a 6f6e 6520 3d20 6173 6b28       zone = ask(
+0000b6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b6d0: 2071 7565 7374 696f 6e3d 5175 6573 7469   question=Questi
+0000b6e0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000b6f0: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
+0000b700: 3d22 6763 705f 7a6f 6e65 222c 0a20 2020  ="gcp_zone",.   
+0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b720: 2071 7565 7374 696f 6e3d 2257 6861 7420   question="What 
+0000b730: 7a6f 6e65 2064 6f20 796f 7520 7761 6e74  zone do you want
+0000b740: 2079 6f75 7220 564d 2069 6e3f 222c 0a20   your VM in?",. 
+0000b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b760: 2020 2064 6566 6175 6c74 3d61 7267 5f63     default=arg_c
+0000b770: 6163 6865 5b22 6763 705f 7a6f 6e65 225d  ache["gcp_zone"]
+0000b780: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b790: 2020 2020 2020 6b69 6e64 3d22 7374 7269        kind="stri
+0000b7a0: 6e67 222c 0a20 2020 2020 2020 2020 2020  ng",.           
+0000b7b0: 2020 2020 2020 2020 2063 6163 6865 3d54           cache=T
+0000b7c0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000b7d0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0000b7e0: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
+0000b7f0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0000b800: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0000b810: 2020 6d61 6368 696e 655f 7479 7065 203d    machine_type =
+0000b820: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
+0000b830: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
+0000b840: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+0000b850: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000b860: 5f6e 616d 653d 2267 6370 5f6d 6163 6869  _name="gcp_machi
+0000b870: 6e65 5f74 7970 6522 2c0a 2020 2020 2020  ne_type",.      
+0000b880: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0000b890: 6573 7469 6f6e 3d22 5768 6174 2073 697a  estion="What siz
+0000b8a0: 6520 6d61 6368 696e 653f 222c 0a20 2020  e machine?",.   
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2064 6566 6175 6c74 3d61 7267 5f63 6163   default=arg_cac
+0000b8d0: 6865 5b22 6763 705f 6d61 6368 696e 655f  he["gcp_machine_
+0000b8e0: 7479 7065 225d 2c0a 2020 2020 2020 2020  type"],.        
+0000b8f0: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
+0000b900: 3d22 7374 7269 6e67 222c 0a20 2020 2020  ="string",.     
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b920: 6163 6865 3d54 7275 652c 0a20 2020 2020  ache=True,.     
+0000b930: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+0000b940: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
+0000b950: 6172 6773 3d6b 7761 7267 732c 0a20 2020  args=kwargs,.   
+0000b960: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000b970: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
+0000b980: 203d 2061 736b 280a 2020 2020 2020 2020   = ask(.        
+0000b990: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
+0000b9a0: 3d51 7565 7374 696f 6e28 0a20 2020 2020  =Question(.     
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000b9c0: 6172 5f6e 616d 653d 2267 6370 5f75 7365  ar_name="gcp_use
+0000b9d0: 726e 616d 6522 2c0a 2020 2020 2020 2020  rname",.        
+0000b9e0: 2020 2020 2020 2020 2020 2020 7175 6573              ques
+0000b9f0: 7469 6f6e 3d22 5768 6174 2069 7320 796f  tion="What is yo
+0000ba00: 7572 2073 6865 6c6c 2075 7365 726e 616d  ur shell usernam
+0000ba10: 653f 222c 0a20 2020 2020 2020 2020 2020  e?",.           
+0000ba20: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0000ba30: 3d61 7267 5f63 6163 6865 5b22 6763 705f  =arg_cache["gcp_
+0000ba40: 7573 6572 6e61 6d65 225d 2c0a 2020 2020  username"],.    
+0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba60: 6b69 6e64 3d22 7374 7269 6e67 222c 0a20  kind="string",. 
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba80: 2020 2063 6163 6865 3d54 7275 652c 0a20     cache=True,. 
+0000ba90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000baa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bab0: 2020 6b77 6172 6773 3d6b 7761 7267 732c    kwargs=kwargs,
+0000bac0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0000bad0: 2020 2020 2020 2020 2020 2020 6b65 795f              key_
+0000bae0: 7061 7468 5f71 7565 7374 696f 6e20 3d20  path_question = 
+0000baf0: 5175 6573 7469 6f6e 280a 2020 2020 2020  Question(.      
+0000bb00: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
+0000bb10: 6d65 3d22 6763 705f 6b65 795f 7061 7468  me="gcp_key_path
+0000bb20: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bb30: 2020 2071 7565 7374 696f 6e3d 6622 5072     question=f"Pr
+0000bb40: 6976 6174 6520 6b65 7920 746f 2061 6363  ivate key to acc
+0000bb50: 6573 7320 7573 6572 407b 686f 7374 7d3f  ess user@{host}?
+0000bb60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bb70: 2020 2064 6566 6175 6c74 3d61 7267 5f63     default=arg_c
+0000bb80: 6163 6865 5b22 6763 705f 6b65 795f 7061  ache["gcp_key_pa
+0000bb90: 7468 225d 2c0a 2020 2020 2020 2020 2020  th"],.          
+0000bba0: 2020 2020 2020 6b69 6e64 3d22 7061 7468        kind="path
+0000bbb0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bbc0: 2020 2063 6163 6865 3d54 7275 652c 0a20     cache=True,. 
+0000bbd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000bbe0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000bbf0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0000bc00: 795f 7061 7468 203d 2061 736b 280a 2020  y_path = ask(.  
+0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc20: 2020 6b65 795f 7061 7468 5f71 7565 7374    key_path_quest
+0000bc30: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0000bc40: 2020 2020 2020 2020 206b 7761 7267 733d           kwargs=
+0000bc50: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+0000bc60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000bc70: 2020 2020 2020 6578 6365 7074 2051 7565        except Que
+0000bc80: 7374 696f 6e49 6e70 7574 5061 7468 4572  stionInputPathEr
+0000bc90: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000bca0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000bcb0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0000bcc0: 2020 206b 6579 5f70 6174 6820 3d20 7374     key_path = st
+0000bcd0: 7228 6529 2e73 706c 6974 2822 6973 206e  r(e).split("is n
+0000bce0: 6f74 2061 2076 616c 6964 2070 6174 6822  ot a valid path"
+0000bcf0: 295b 305d 2e73 7472 6970 2829 0a0a 2020  )[0].strip()..  
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 6372                cr
+0000bd10: 6561 7465 5f6b 6579 5f71 7565 7374 696f  eate_key_questio
+0000bd20: 6e20 3d20 5175 6573 7469 6f6e 280a 2020  n = Question(.  
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd40: 2020 7661 725f 6e61 6d65 3d22 6763 705f    var_name="gcp_
+0000bd50: 6b65 795f 7061 7468 222c 0a20 2020 2020  key_path",.     
+0000bd60: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000bd70: 7565 7374 696f 6e3d 6622 4b65 7920 7b6b  uestion=f"Key {k
+0000bd80: 6579 5f70 6174 687d 2064 6f65 7320 6e6f  ey_path} does no
+0000bd90: 7420 6578 6973 742e 2044 6f20 796f 7520  t exist. Do you 
+0000bda0: 7761 6e74 2067 636c 6f75 6420 746f 206d  want gcloud to m
+0000bdb0: 616b 6520 6974 3f20 2879 2f6e 2922 2c0a  ake it? (y/n)",.
+0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdd0: 2020 2020 6465 6661 756c 743d 2279 222c      default="y",
+0000bde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bdf0: 2020 2020 206b 696e 643d 2279 6573 6e6f       kind="yesno
+0000be00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000be10: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000be20: 2020 2020 2063 7265 6174 655f 6b65 7920       create_key 
+0000be30: 3d20 6173 6b28 0a20 2020 2020 2020 2020  = ask(.         
+0000be40: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+0000be50: 655f 6b65 795f 7175 6573 7469 6f6e 2c0a  e_key_question,.
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be70: 2020 2020 6b77 6172 6773 3d6b 7761 7267      kwargs=kwarg
+0000be80: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000be90: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000bea0: 2020 2020 2069 6620 6372 6561 7465 5f6b       if create_k
+0000beb0: 6579 203d 3d20 2279 223a 0a20 2020 2020  ey == "y":.     
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000bed0: 6579 5f70 6174 6820 3d20 6765 6e65 7261  ey_path = genera
+0000bee0: 7465 5f67 636c 6f75 645f 6b65 795f 6174  te_gcloud_key_at
+0000bef0: 5f70 6174 6828 6b65 795f 7061 7468 3d6b  _path(key_path=k
+0000bf00: 6579 5f70 6174 6829 0a20 2020 2020 2020  ey_path).       
+0000bf10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf30: 2020 2072 6169 7365 2051 7565 7374 696f     raise Questio
+0000bf40: 6e49 6e70 7574 4572 726f 7228 0a20 2020  nInputError(.   
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf60: 2020 2020 2022 556e 6162 6c65 2074 6f20       "Unable to 
+0000bf70: 6372 6561 7465 2056 4d20 7769 7468 6f75  create VM withou
+0000bf80: 7420 6120 7072 6976 6174 6520 6b65 7922  t a private key"
+0000bf90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfa0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000bfb0: 2020 2020 7265 706f 203d 2061 736b 280a      repo = ask(.
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfd0: 5175 6573 7469 6f6e 280a 2020 2020 2020  Question(.      
+0000bfe0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000bff0: 725f 6e61 6d65 3d22 6763 705f 7265 706f  r_name="gcp_repo
+0000c000: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000c010: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000c020: 2252 6570 6f20 746f 2066 6574 6368 2073  "Repo to fetch s
+0000c030: 6f75 7263 6520 6672 6f6d 3f22 2c0a 2020  ource from?",.  
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 2020 6465 6661 756c 743d 6172 675f 6361    default=arg_ca
+0000c060: 6368 655b 2267 6370 5f72 6570 6f22 5d2c  che["gcp_repo"],
+0000c070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c080: 2020 2020 206b 696e 643d 2273 7472 696e       kind="strin
+0000c090: 6722 2c0a 2020 2020 2020 2020 2020 2020  g",.            
+0000c0a0: 2020 2020 2020 2020 6361 6368 653d 5472          cache=Tr
+0000c0b0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000c0c0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0000c0d0: 2020 2020 2020 206b 7761 7267 733d 6b77         kwargs=kw
+0000c0e0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0000c0f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000c100: 6272 616e 6368 203d 2061 736b 280a 2020  branch = ask(.  
+0000c110: 2020 2020 2020 2020 2020 2020 2020 5175                Qu
+0000c120: 6573 7469 6f6e 280a 2020 2020 2020 2020  estion(.        
+0000c130: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+0000c140: 6e61 6d65 3d22 6763 705f 6272 616e 6368  name="gcp_branch
+0000c150: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000c160: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000c170: 2242 7261 6e63 6820 746f 206d 6f6e 6974  "Branch to monit
+0000c180: 6f72 2066 6f72 2075 7064 6174 6573 3f22  or for updates?"
+0000c190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000c1a0: 2020 2020 2020 6465 6661 756c 743d 6172        default=ar
+0000c1b0: 675f 6361 6368 655b 2267 6370 5f62 7261  g_cache["gcp_bra
+0000c1c0: 6e63 6822 5d2c 0a20 2020 2020 2020 2020  nch"],.         
+0000c1d0: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
+0000c1e0: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
+0000c1f0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0000c200: 6368 653d 5472 7565 2c0a 2020 2020 2020  che=True,.      
+0000c210: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+0000c220: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+0000c230: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
+0000c240: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000c250: 2020 2020 2020 2075 7365 5f62 7261 6e63         use_branc
+0000c260: 6828 6272 616e 6368 3d62 7261 6e63 6829  h(branch=branch)
+0000c270: 0a0a 2020 2020 2020 2020 2020 2020 6175  ..            au
+0000c280: 7468 203d 2041 7574 6843 7265 6465 6e74  th = AuthCredent
+0000c290: 6961 6c73 2875 7365 726e 616d 653d 7573  ials(username=us
+0000c2a0: 6572 6e61 6d65 2c20 6b65 795f 7061 7468  ername, key_path
+0000c2b0: 3d6b 6579 5f70 6174 6829 0a0a 2020 2020  =key_path)..    
+0000c2c0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000c2d0: 7265 6174 655f 6c61 756e 6368 5f67 6370  reate_launch_gcp
+0000c2e0: 5f63 6d64 280a 2020 2020 2020 2020 2020  _cmd(.          
+0000c2f0: 2020 2020 2020 7665 7262 3d76 6572 622c        verb=verb,
+0000c300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c310: 2070 726f 6a65 6374 5f69 643d 7072 6f6a   project_id=proj
+0000c320: 6563 745f 6964 2c0a 2020 2020 2020 2020  ect_id,.        
+0000c330: 2020 2020 2020 2020 7a6f 6e65 3d7a 6f6e          zone=zon
+0000c340: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000c350: 2020 206d 6163 6869 6e65 5f74 7970 653d     machine_type=
+0000c360: 6d61 6368 696e 655f 7479 7065 2c0a 2020  machine_type,.  
+0000c370: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000c380: 706f 3d72 6570 6f2c 0a20 2020 2020 2020  po=repo,.       
+0000c390: 2020 2020 2020 2020 2061 7574 683d 6175           auth=au
+0000c3a0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000c3b0: 2020 2020 6272 616e 6368 3d62 7261 6e63      branch=branc
+0000c3c0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0000c3d0: 2020 2061 6e73 6962 6c65 5f65 7874 7261     ansible_extra
+0000c3e0: 733d 6b77 6172 6773 5b22 616e 7369 626c  s=kwargs["ansibl
+0000c3f0: 655f 6578 7472 6173 225d 2c0a 2020 2020  e_extras"],.    
+0000c400: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000c410: 6773 3d70 6172 7365 645f 6b77 6172 6773  gs=parsed_kwargs
+0000c420: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000c430: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000c440: 2020 2020 2020 2020 2020 6572 726f 7273            errors
+0000c450: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0000c460: 2020 6966 206e 6f74 2044 4550 454e 4445    if not DEPENDE
+0000c470: 4e43 4945 535b 2261 6e73 6962 6c65 2d70  NCIES["ansible-p
+0000c480: 6c61 7962 6f6f 6b22 5d3a 0a20 2020 2020  laybook"]:.     
+0000c490: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0000c4a0: 732e 6170 7065 6e64 2822 616e 7369 626c  s.append("ansibl
+0000c4b0: 652d 706c 6179 626f 6f6b 2229 0a20 2020  e-playbook").   
+0000c4c0: 2020 2020 2020 2020 206d 7367 203d 2022           msg = "
+0000c4d0: 5c6e 4552 524f 5221 2121 204d 4953 5349  \nERROR!!! MISSI
+0000c4e0: 4e47 2044 4550 454e 4445 4e43 5921 2121  NG DEPENDENCY!!!
+0000c4f0: 220a 2020 2020 2020 2020 2020 2020 6d73  ".            ms
+0000c500: 6720 2b3d 2066 225c 6e5c 6e4c 6175 6e63  g += f"\n\nLaunc
+0000c510: 6869 6e67 2061 2043 6c6f 7564 2056 4d20  hing a Cloud VM 
+0000c520: 7265 7175 6972 6573 3a20 7b27 2027 2e6a  requires: {' '.j
+0000c530: 6f69 6e28 6572 726f 7273 297d 220a 2020  oin(errors)}".  
+0000c540: 2020 2020 2020 2020 2020 6d73 6720 2b3d            msg +=
+0000c550: 2022 5c6e 5c6e 506c 6561 7365 2066 6f6c   "\n\nPlease fol
+0000c560: 6c6f 7720 696e 7374 616c 6c61 7469 6f6e  low installation
+0000c570: 2069 6e73 7472 7563 7469 6f6e 733a 2022   instructions: "
+0000c580: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+0000c590: 202b 3d20 2268 7474 7073 3a2f 2f64 6f63   += "https://doc
+0000c5a0: 732e 616e 7369 626c 652e 636f 6d2f 616e  s.ansible.com/an
+0000c5b0: 7369 626c 652f 6c61 7465 7374 2f69 6e73  sible/latest/ins
+0000c5c0: 7461 6c6c 6174 696f 6e5f 6775 6964 652f  tallation_guide/
+0000c5d0: 696e 7472 6f5f 696e 7374 616c 6c61 7469  intro_installati
+0000c5e0: 6f6e 2e68 746d 6c23 220a 2020 2020 2020  on.html#".      
+0000c5f0: 2020 2020 2020 6d73 6720 2b3d 2022 5c6e        msg += "\n
+0000c600: 5c6e 4e6f 7465 3a20 7765 2776 6520 666f  \nNote: we've fo
+0000c610: 756e 6420 7468 6520 2763 6f6e 6461 2720  und the 'conda' 
+0000c620: 6261 7365 6420 696e 7374 616c 6c61 7469  based installati
+0000c630: 6f6e 2069 6e73 7472 7563 7469 6f6e 7320  on instructions 
+0000c640: 746f 2077 6f72 6b20 6265 7374 220a 2020  to work best".  
+0000c650: 2020 2020 2020 2020 2020 6d73 6720 2b3d            msg +=
+0000c660: 2022 2028 652e 672e 2073 6f6d 6574 6869   " (e.g. somethi
+0000c670: 6e67 206c 6b65 2027 636f 6e64 6120 696e  ng lke 'conda in
+0000c680: 7374 616c 6c20 2d63 2063 6f6e 6461 2d66  stall -c conda-f
+0000c690: 6f72 6765 2061 6e73 6962 6c65 2729 2e20  orge ansible'). 
+0000c6a0: 220a 2020 2020 2020 2020 2020 2020 6d73  ".            ms
+0000c6b0: 6720 2b3d 2022 5468 6520 7069 7020 6261  g += "The pip ba
+0000c6c0: 7365 6420 696e 7374 7275 6374 696f 6e73  sed instructions
+0000c6d0: 2073 6565 6d20 746f 2062 6520 6120 6269   seem to be a bi
+0000c6e0: 7420 6275 6767 7920 6966 2079 6f75 2772  t buggy if you'r
+0000c6f0: 6520 7573 696e 6720 6120 636f 6e64 6120  e using a conda 
+0000c700: 656e 7669 726f 6e6d 656e 7422 0a20 2020  environment".   
+0000c710: 2020 2020 2020 2020 206d 7367 202b 3d20           msg += 
+0000c720: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
+0000c730: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
+0000c740: 7065 6e64 656e 6379 286d 7367 290a 0a20  pendency(msg).. 
+0000c750: 2020 2065 6c69 6620 686f 7374 2069 6e20     elif host in 
+0000c760: 5b22 6177 7322 5d3a 0a20 2020 2020 2020  ["aws"]:.       
+0000c770: 2063 6865 636b 5f61 7773 5f63 6c69 5f69   check_aws_cli_i
+0000c780: 6e73 7461 6c6c 6564 2829 0a0a 2020 2020  nstalled()..    
+0000c790: 2020 2020 6966 2044 4550 454e 4445 4e43      if DEPENDENC
+0000c7a0: 4945 535b 2261 6e73 6962 6c65 2d70 6c61  IES["ansible-pla
+0000c7b0: 7962 6f6f 6b22 5d3a 0a20 2020 2020 2020  ybook"]:.       
+0000c7c0: 2020 2020 2061 7773 5f72 6567 696f 6e20       aws_region 
+0000c7d0: 3d20 6173 6b28 0a20 2020 2020 2020 2020  = ask(.         
+0000c7e0: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000c7f0: 5175 6573 7469 6f6e 280a 2020 2020 2020  Question(.      
+0000c800: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000c810: 725f 6e61 6d65 3d22 6177 735f 7265 6769  r_name="aws_regi
+0000c820: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
+0000c830: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+0000c840: 6e3d 2249 6e20 7768 6174 2072 6567 696f  n="In what regio
+0000c850: 6e20 646f 2079 6f75 2077 616e 7420 746f  n do you want to
+0000c860: 2064 6570 6c6f 7920 7468 6520 4543 3220   deploy the EC2 
+0000c870: 696e 7374 616e 6365 3f22 2c0a 2020 2020  instance?",.    
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 6465 6661 756c 743d 6172 675f 6361 6368  default=arg_cach
+0000c8a0: 655b 2261 7773 5f72 6567 696f 6e22 5d2c  e["aws_region"],
+0000c8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c8c0: 2020 2020 206b 696e 643d 2273 7472 696e       kind="strin
+0000c8d0: 6722 2c0a 2020 2020 2020 2020 2020 2020  g",.            
+0000c8e0: 2020 2020 2020 2020 6361 6368 653d 5472          cache=Tr
+0000c8f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000c900: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0000c910: 2020 2020 2020 206b 7761 7267 733d 6b77         kwargs=kw
+0000c920: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0000c930: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000c940: 6177 735f 7365 6375 7269 7479 5f67 726f  aws_security_gro
+0000c950: 7570 5f6e 616d 6520 3d20 6173 6b28 0a20  up_name = ask(. 
+0000c960: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000c970: 7565 7374 696f 6e3d 5175 6573 7469 6f6e  uestion=Question
+0000c980: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c990: 2020 2020 2020 7661 725f 6e61 6d65 3d22        var_name="
+0000c9a0: 6177 735f 7365 6375 7269 7479 5f67 726f  aws_security_gro
+0000c9b0: 7570 5f6e 616d 6522 2c0a 2020 2020 2020  up_name",.      
+0000c9c0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0000c9d0: 6573 7469 6f6e 3d22 4e61 6d65 206f 6620  estion="Name of 
+0000c9e0: 7468 6520 7365 6375 7269 7479 2067 726f  the security gro
+0000c9f0: 7570 2074 6f20 6265 2063 7265 6174 6564  up to be created
+0000ca00: 3f22 2c0a 2020 2020 2020 2020 2020 2020  ?",.            
+0000ca10: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+0000ca20: 6172 675f 6361 6368 655b 2261 7773 5f73  arg_cache["aws_s
+0000ca30: 6563 7572 6974 795f 6772 6f75 705f 6e61  ecurity_group_na
+0000ca40: 6d65 225d 2c0a 2020 2020 2020 2020 2020  me"],.          
+0000ca50: 2020 2020 2020 2020 2020 6b69 6e64 3d22            kind="
+0000ca60: 7374 7269 6e67 222c 0a20 2020 2020 2020  string",.       
+0000ca70: 2020 2020 2020 2020 2020 2020 2063 6163               cac
+0000ca80: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
+0000ca90: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+0000caa0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000cab0: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
+0000cac0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cad0: 2020 2020 2061 7773 5f73 6563 7572 6974       aws_securit
+0000cae0: 795f 6772 6f75 705f 6369 6472 203d 2061  y_group_cidr = a
+0000caf0: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
+0000cb00: 2020 2020 7175 6573 7469 6f6e 3d51 7565      question=Que
+0000cb10: 7374 696f 6e28 0a20 2020 2020 2020 2020  stion(.         
+0000cb20: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
+0000cb30: 616d 653d 2261 7773 5f73 6563 7572 6974  ame="aws_securit
+0000cb40: 795f 6772 6f75 705f 6369 6472 222c 0a20  y_group_cidr",. 
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 2020 2071 7565 7374 696f 6e3d 2257 6861     question="Wha
+0000cb70: 7420 4950 2061 6464 7265 7373 6573 2074  t IP addresses t
+0000cb80: 6f20 616c 6c6f 7720 666f 7220 696e 636f  o allow for inco
+0000cb90: 6d69 6e67 206e 6574 776f 726b 2074 7261  ming network tra
+0000cba0: 6666 6963 3f20 506c 6561 7365 2075 7365  ffic? Please use
+0000cbb0: 2043 4944 5220 6e6f 7461 7469 6f6e 222c   CIDR notation",
+0000cbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cbd0: 2020 2020 2064 6566 6175 6c74 3d61 7267       default=arg
+0000cbe0: 5f63 6163 6865 5b22 6177 735f 7365 6375  _cache["aws_secu
+0000cbf0: 7269 7479 5f67 726f 7570 5f63 6964 7222  rity_group_cidr"
+0000cc00: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000cc10: 2020 2020 2020 206b 696e 643d 2273 7472         kind="str
+0000cc20: 696e 6722 2c0a 2020 2020 2020 2020 2020  ing",.          
+0000cc30: 2020 2020 2020 2020 2020 6361 6368 653d            cache=
+0000cc40: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000cc50: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0000cc60: 2020 2020 2020 2020 206b 7761 7267 733d           kwargs=
+0000cc70: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+0000cc80: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000cc90: 2020 6563 325f 696e 7374 616e 6365 5f74    ec2_instance_t
+0000cca0: 7970 6520 3d20 6173 6b28 0a20 2020 2020  ype = ask(.     
+0000ccb0: 2020 2020 2020 2020 2020 2071 7565 7374             quest
+0000ccc0: 696f 6e3d 5175 6573 7469 6f6e 280a 2020  ion=Question(.  
+0000ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cce0: 2020 7661 725f 6e61 6d65 3d22 6177 735f    var_name="aws_
+0000ccf0: 6563 325f 696e 7374 616e 6365 5f74 7970  ec2_instance_typ
+0000cd00: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+0000cd10: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
+0000cd20: 3d22 5768 6174 2045 4332 2069 6e73 7461  ="What EC2 insta
+0000cd30: 6e63 6520 7479 7065 2064 6f20 796f 7520  nce type do you 
+0000cd40: 7761 6e74 2074 6f20 6465 706c 6f79 3f22  want to deploy?"
+0000cd50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cd60: 2020 2020 2020 6465 6661 756c 743d 6172        default=ar
+0000cd70: 675f 6361 6368 655b 2261 7773 5f65 6332  g_cache["aws_ec2
+0000cd80: 5f69 6e73 7461 6e63 655f 7479 7065 225d  _instance_type"]
+0000cd90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cda0: 2020 2020 2020 6b69 6e64 3d22 7374 7269        kind="stri
+0000cdb0: 6e67 222c 0a20 2020 2020 2020 2020 2020  ng",.           
+0000cdc0: 2020 2020 2020 2020 2063 6163 6865 3d54           cache=T
+0000cdd0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000cde0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0000cdf0: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
+0000ce00: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0000ce10: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0000ce20: 2020 6177 735f 6b65 795f 6e61 6d65 203d    aws_key_name =
+0000ce30: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
+0000ce40: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
+0000ce50: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+0000ce60: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000ce70: 5f6e 616d 653d 2261 7773 5f6b 6579 5f6e  _name="aws_key_n
+0000ce80: 616d 6522 2c0a 2020 2020 2020 2020 2020  ame",.          
+0000ce90: 2020 2020 2020 2020 2020 7175 6573 7469            questi
+0000cea0: 6f6e 3d22 456e 7465 7220 7468 6520 6e61  on="Enter the na
+0000ceb0: 6d65 206f 6620 7468 6520 6b65 7920 7061  me of the key pa
+0000cec0: 6972 2074 6f20 7573 6520 746f 2063 6f6e  ir to use to con
+0000ced0: 6e65 6374 2074 6f20 7468 6520 4543 3220  nect to the EC2 
+0000cee0: 696e 7374 616e 6365 222c 0a20 2020 2020  instance",.     
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000cf00: 696e 643d 2273 7472 696e 6722 2c0a 2020  ind="string",.  
+0000cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf20: 2020 6361 6368 653d 5472 7565 2c0a 2020    cache=True,.  
+0000cf30: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+0000cf40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cf50: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
+0000cf60: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000cf70: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
+0000cf80: 6174 685f 716e 5f73 7472 203d 2028 0a20  ath_qn_str = (. 
+0000cf90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000cfa0: 506c 6561 7365 2070 726f 7669 6465 2074  Please provide t
+0000cfb0: 6865 2070 6174 6820 6f66 2074 6865 2070  he path of the p
+0000cfc0: 7269 7661 7465 206b 6579 2074 6f20 636f  rivate key to co
+0000cfd0: 6e6e 6563 7420 746f 2074 6865 2069 6e73  nnect to the ins
+0000cfe0: 7461 6e63 6522 0a20 2020 2020 2020 2020  tance".         
+0000cff0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000d000: 206b 6579 5f70 6174 685f 716e 5f73 7472   key_path_qn_str
+0000d010: 202b 3d20 2220 2869 6620 6974 2064 6f65   += " (if it doe
+0000d020: 7320 6e6f 7420 6578 6973 742c 2074 6869  s not exist, thi
+0000d030: 7320 7061 7468 2063 6f72 7265 7370 6f6e  s path correspon
+0000d040: 6473 2074 6f20 220a 2020 2020 2020 2020  ds to ".        
+0000d050: 2020 2020 6b65 795f 7061 7468 5f71 6e5f      key_path_qn_
+0000d060: 7374 7220 2b3d 2022 7768 6572 6520 796f  str += "where yo
+0000d070: 7520 7761 6e74 2074 6f20 7374 6f72 6520  u want to store 
+0000d080: 7468 6520 6b65 7920 7570 6f6e 2063 7265  the key upon cre
+0000d090: 6174 696f 6e29 220a 2020 2020 2020 2020  ation)".        
+0000d0a0: 2020 2020 6b65 795f 7061 7468 5f71 7565      key_path_que
+0000d0b0: 7374 696f 6e20 3d20 5175 6573 7469 6f6e  stion = Question
+0000d0c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d0d0: 2020 7661 725f 6e61 6d65 3d22 6177 735f    var_name="aws_
+0000d0e0: 6b65 795f 7061 7468 222c 0a20 2020 2020  key_path",.     
+0000d0f0: 2020 2020 2020 2020 2020 2071 7565 7374             quest
+0000d100: 696f 6e3d 6b65 795f 7061 7468 5f71 6e5f  ion=key_path_qn_
+0000d110: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+0000d120: 2020 2020 206b 696e 643d 2270 6174 6822       kind="path"
+0000d130: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d140: 2020 6361 6368 653d 5472 7565 2c0a 2020    cache=True,.  
+0000d150: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d160: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000d170: 2020 2020 2020 2020 2020 2020 206b 6579               key
+0000d180: 5f70 6174 6820 3d20 6173 6b28 0a20 2020  _path = ask(.   
+0000d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1a0: 206b 6579 5f70 6174 685f 7175 6573 7469   key_path_questi
+0000d1b0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000d1c0: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
+0000d1d0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0000d1e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000d1f0: 2020 2020 2065 7863 6570 7420 5175 6573       except Ques
+0000d200: 7469 6f6e 496e 7075 7450 6174 6845 7272  tionInputPathErr
+0000d210: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+0000d220: 2020 2020 2020 2020 2070 7269 6e74 2865           print(e
+0000d230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d240: 2020 6b65 795f 7061 7468 203d 2073 7472    key_path = str
+0000d250: 2865 292e 7370 6c69 7428 2269 7320 6e6f  (e).split("is no
+0000d260: 7420 6120 7661 6c69 6420 7061 7468 2229  t a valid path")
+0000d270: 5b30 5d2e 7374 7269 7028 290a 0a20 2020  [0].strip()..   
+0000d280: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+0000d290: 6174 655f 6b65 795f 7175 6573 7469 6f6e  ate_key_question
+0000d2a0: 203d 2051 7565 7374 696f 6e28 0a20 2020   = Question(.   
+0000d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2c0: 2076 6172 5f6e 616d 653d 2261 7773 5f6b   var_name="aws_k
+0000d2d0: 6579 5f70 6174 6822 2c0a 2020 2020 2020  ey_path",.      
+0000d2e0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0000d2f0: 6573 7469 6f6e 3d66 224b 6579 207b 6b65  estion=f"Key {ke
+0000d300: 795f 7061 7468 7d20 646f 6573 206e 6f74  y_path} does not
+0000d310: 2065 7869 7374 2e20 446f 2079 6f75 2077   exist. Do you w
+0000d320: 616e 7420 4157 5320 746f 206d 616b 6520  ant AWS to make 
+0000d330: 6974 3f20 2879 2f6e 2922 2c0a 2020 2020  it? (y/n)",.    
+0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d350: 6465 6661 756c 743d 2279 222c 0a20 2020  default="y",.   
+0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d370: 206b 696e 643d 2279 6573 6e6f 222c 0a20   kind="yesno",. 
+0000d380: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3a0: 2063 7265 6174 655f 6b65 7920 3d20 6173   create_key = as
+0000d3b0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+0000d3c0: 2020 2020 2020 2063 7265 6174 655f 6b65         create_ke
+0000d3d0: 795f 7175 6573 7469 6f6e 2c0a 2020 2020  y_question,.    
+0000d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3f0: 6b77 6172 6773 3d6b 7761 7267 732c 0a20  kwargs=kwargs,. 
+0000d400: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d420: 2069 6620 6372 6561 7465 5f6b 6579 203d   if create_key =
+0000d430: 3d20 2279 223a 0a20 2020 2020 2020 2020  = "y":.         
+0000d440: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
+0000d450: 6174 6820 3d20 6765 6e65 7261 7465 5f61  ath = generate_a
+0000d460: 7773 5f6b 6579 5f61 745f 7061 7468 280a  ws_key_at_path(.
+0000d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d480: 2020 2020 2020 2020 6b65 795f 7061 7468          key_path
+0000d490: 3d6b 6579 5f70 6174 682c 206b 6579 5f6e  =key_path, key_n
+0000d4a0: 616d 653d 6177 735f 6b65 795f 6e61 6d65  ame=aws_key_name
+0000d4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d4c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d4d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4f0: 2072 6169 7365 2051 7565 7374 696f 6e49   raise QuestionI
+0000d500: 6e70 7574 4572 726f 7228 0a20 2020 2020  nputError(.     
+0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 2020 2022 556e 6162 6c65 2074 6f20 6372     "Unable to cr
+0000d530: 6561 7465 2045 4332 2069 6e73 7461 6e63  eate EC2 instanc
+0000d540: 6520 7769 7468 6f75 7420 6b65 7922 0a20  e without key". 
+0000d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d560: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0000d570: 2020 7265 706f 203d 2061 736b 280a 2020    repo = ask(.  
+0000d580: 2020 2020 2020 2020 2020 2020 2020 5175                Qu
+0000d590: 6573 7469 6f6e 280a 2020 2020 2020 2020  estion(.        
+0000d5a0: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+0000d5b0: 6e61 6d65 3d22 6177 735f 7265 706f 222c  name="aws_repo",
+0000d5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d5d0: 2020 2020 2071 7565 7374 696f 6e3d 2252       question="R
+0000d5e0: 6570 6f20 746f 2066 6574 6368 2073 6f75  epo to fetch sou
+0000d5f0: 7263 6520 6672 6f6d 3f22 2c0a 2020 2020  rce from?",.    
+0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d610: 6465 6661 756c 743d 6172 675f 6361 6368  default=arg_cach
+0000d620: 655b 2261 7773 5f72 6570 6f22 5d2c 0a20  e["aws_repo"],. 
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d640: 2020 206b 696e 643d 2273 7472 696e 6722     kind="string"
+0000d650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d660: 2020 2020 2020 6361 6368 653d 5472 7565        cache=True
+0000d670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d680: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0000d690: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
+0000d6a0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+0000d6b0: 290a 2020 2020 2020 2020 2020 2020 6272  ).            br
+0000d6c0: 616e 6368 203d 2061 736b 280a 2020 2020  anch = ask(.    
+0000d6d0: 2020 2020 2020 2020 2020 2020 5175 6573              Ques
+0000d6e0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+0000d6f0: 2020 2020 2020 2020 2020 7661 725f 6e61            var_na
+0000d700: 6d65 3d22 6177 735f 6272 616e 6368 222c  me="aws_branch",
+0000d710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d720: 2020 2020 2071 7565 7374 696f 6e3d 2242       question="B
+0000d730: 7261 6e63 6820 746f 206d 6f6e 6974 6f72  ranch to monitor
+0000d740: 2066 6f72 2075 7064 6174 6573 3f22 2c0a   for updates?",.
+0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d760: 2020 2020 6465 6661 756c 743d 6172 675f      default=arg_
+0000d770: 6361 6368 655b 2261 7773 5f62 7261 6e63  cache["aws_branc
+0000d780: 6822 5d2c 0a20 2020 2020 2020 2020 2020  h"],.           
+0000d790: 2020 2020 2020 2020 206b 696e 643d 2273           kind="s
+0000d7a0: 7472 696e 6722 2c0a 2020 2020 2020 2020  tring",.        
+0000d7b0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+0000d7c0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0000d7d0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+0000d7e0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0000d7f0: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
+0000d800: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000d810: 2020 2020 2075 7365 5f62 7261 6e63 6828       use_branch(
+0000d820: 6272 616e 6368 3d62 7261 6e63 6829 0a0a  branch=branch)..
+0000d830: 2020 2020 2020 2020 2020 2020 7573 6572              user
+0000d840: 6e61 6d65 203d 2061 7267 5f63 6163 6865  name = arg_cache
+0000d850: 5b22 6177 735f 6563 325f 696e 7374 616e  ["aws_ec2_instan
+0000d860: 6365 5f75 7365 726e 616d 6522 5d0a 2020  ce_username"].  
+0000d870: 2020 2020 2020 2020 2020 6175 7468 203d            auth =
+0000d880: 2041 7574 6843 7265 6465 6e74 6961 6c73   AuthCredentials
+0000d890: 2875 7365 726e 616d 653d 7573 6572 6e61  (username=userna
+0000d8a0: 6d65 2c20 6b65 795f 7061 7468 3d6b 6579  me, key_path=key
+0000d8b0: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
+0000d8c0: 2020 2020 7265 7475 726e 2063 7265 6174      return creat
+0000d8d0: 655f 6c61 756e 6368 5f61 7773 5f63 6d64  e_launch_aws_cmd
+0000d8e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d8f0: 2020 7665 7262 3d76 6572 622c 0a20 2020    verb=verb,.   
+0000d900: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+0000d910: 696f 6e3d 6177 735f 7265 6769 6f6e 2c0a  ion=aws_region,.
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d930: 6563 325f 696e 7374 616e 6365 5f74 7970  ec2_instance_typ
+0000d940: 653d 6563 325f 696e 7374 616e 6365 5f74  e=ec2_instance_t
+0000d950: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000d960: 2020 2020 2073 6563 7572 6974 795f 6772       security_gr
+0000d970: 6f75 705f 6e61 6d65 3d61 7773 5f73 6563  oup_name=aws_sec
+0000d980: 7572 6974 795f 6772 6f75 705f 6e61 6d65  urity_group_name
+0000d990: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d9a0: 2020 6177 735f 7365 6375 7269 7479 5f67    aws_security_g
+0000d9b0: 726f 7570 5f63 6964 723d 6177 735f 7365  roup_cidr=aws_se
+0000d9c0: 6375 7269 7479 5f67 726f 7570 5f63 6964  curity_group_cid
+0000d9d0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000d9e0: 2020 206b 6579 5f70 6174 683d 6b65 795f     key_path=key_
+0000d9f0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+0000da00: 2020 2020 2020 6b65 795f 6e61 6d65 3d61        key_name=a
+0000da10: 7773 5f6b 6579 5f6e 616d 652c 0a20 2020  ws_key_name,.   
+0000da20: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+0000da30: 6f3d 7265 706f 2c0a 2020 2020 2020 2020  o=repo,.        
+0000da40: 2020 2020 2020 2020 6272 616e 6368 3d62          branch=b
+0000da50: 7261 6e63 682c 0a20 2020 2020 2020 2020  ranch,.         
+0000da60: 2020 2020 2020 2061 6e73 6962 6c65 5f65         ansible_e
+0000da70: 7874 7261 733d 6b77 6172 6773 5b22 616e  xtras=kwargs["an
+0000da80: 7369 626c 655f 6578 7472 6173 225d 2c0a  sible_extras"],.
+0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daa0: 6b77 6172 6773 3d70 6172 7365 645f 6b77  kwargs=parsed_kw
+0000dab0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0000dac0: 2020 2020 2020 616d 695f 6964 3d61 7267        ami_id=arg
+0000dad0: 5f63 6163 6865 5b22 6177 735f 696d 6167  _cache["aws_imag
+0000dae0: 655f 6964 225d 2c0a 2020 2020 2020 2020  e_id"],.        
+0000daf0: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
+0000db00: 3d75 7365 726e 616d 652c 0a20 2020 2020  =username,.     
+0000db10: 2020 2020 2020 2020 2020 2061 7574 683d             auth=
+0000db20: 6175 7468 2c0a 2020 2020 2020 2020 2020  auth,.          
+0000db30: 2020 290a 0a20 2020 2020 2020 2065 6c73    )..        els
+0000db40: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+0000db50: 7272 6f72 7320 3d20 5b5d 0a20 2020 2020  rrors = [].     
+0000db60: 2020 2020 2020 2069 6620 6e6f 7420 4445         if not DE
+0000db70: 5045 4e44 454e 4349 4553 5b22 616e 7369  PENDENCIES["ansi
+0000db80: 626c 652d 706c 6179 626f 6f6b 225d 3a0a  ble-playbook"]:.
+0000db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dba0: 6572 726f 7273 2e61 7070 656e 6428 2261  errors.append("a
+0000dbb0: 6e73 6962 6c65 2d70 6c61 7962 6f6f 6b22  nsible-playbook"
+0000dbc0: 290a 2020 2020 2020 2020 2020 2020 6d73  ).            ms
+0000dbd0: 6720 3d20 225c 6e45 5252 4f52 2121 2120  g = "\nERROR!!! 
+0000dbe0: 4d49 5353 494e 4720 4445 5045 4e44 454e  MISSING DEPENDEN
+0000dbf0: 4359 2121 2122 0a20 2020 2020 2020 2020  CY!!!".         
+0000dc00: 2020 206d 7367 202b 3d20 6622 5c6e 5c6e     msg += f"\n\n
+0000dc10: 4c61 756e 6368 696e 6720 6120 436c 6f75  Launching a Clou
+0000dc20: 6420 564d 2072 6571 7569 7265 733a 207b  d VM requires: {
+0000dc30: 2720 272e 6a6f 696e 2865 7272 6f72 7329  ' '.join(errors)
+0000dc40: 7d22 0a20 2020 2020 2020 2020 2020 206d  }".            m
+0000dc50: 7367 202b 3d20 225c 6e5c 6e50 6c65 6173  sg += "\n\nPleas
+0000dc60: 6520 666f 6c6c 6f77 2069 6e73 7461 6c6c  e follow install
+0000dc70: 6174 696f 6e20 696e 7374 7275 6374 696f  ation instructio
+0000dc80: 6e73 3a20 220a 2020 2020 2020 2020 2020  ns: ".          
+0000dc90: 2020 6d73 6720 2b3d 2022 6874 7470 733a    msg += "https:
+0000dca0: 2f2f 646f 6373 2e61 6e73 6962 6c65 2e63  //docs.ansible.c
+0000dcb0: 6f6d 2f61 6e73 6962 6c65 2f6c 6174 6573  om/ansible/lates
+0000dcc0: 742f 696e 7374 616c 6c61 7469 6f6e 5f67  t/installation_g
+0000dcd0: 7569 6465 2f69 6e74 726f 5f69 6e73 7461  uide/intro_insta
+0000dce0: 6c6c 6174 696f 6e2e 6874 6d6c 2322 0a20  llation.html#". 
+0000dcf0: 2020 2020 2020 2020 2020 206d 7367 202b             msg +
+0000dd00: 3d20 225c 6e5c 6e4e 6f74 653a 2077 6527  = "\n\nNote: we'
+0000dd10: 7665 2066 6f75 6e64 2074 6865 2027 636f  ve found the 'co
+0000dd20: 6e64 6127 2062 6173 6564 2069 6e73 7461  nda' based insta
+0000dd30: 6c6c 6174 696f 6e20 696e 7374 7275 6374  llation instruct
+0000dd40: 696f 6e73 2074 6f20 776f 726b 2062 6573  ions to work bes
+0000dd50: 7422 0a20 2020 2020 2020 2020 2020 206d  t".            m
+0000dd60: 7367 202b 3d20 2220 2865 2e67 2e20 736f  sg += " (e.g. so
+0000dd70: 6d65 7468 696e 6720 6c6b 6520 2763 6f6e  mething lke 'con
+0000dd80: 6461 2069 6e73 7461 6c6c 202d 6320 636f  da install -c co
+0000dd90: 6e64 612d 666f 7267 6520 616e 7369 626c  nda-forge ansibl
+0000dda0: 6527 292e 2022 0a20 2020 2020 2020 2020  e'). ".         
+0000ddb0: 2020 206d 7367 202b 3d20 2254 6865 2070     msg += "The p
+0000ddc0: 6970 2062 6173 6564 2069 6e73 7472 7563  ip based instruc
+0000ddd0: 7469 6f6e 7320 7365 656d 2074 6f20 6265  tions seem to be
+0000dde0: 2061 2062 6974 2062 7567 6779 2069 6620   a bit buggy if 
+0000ddf0: 796f 7527 7265 2075 7369 6e67 2061 2063  you're using a c
+0000de00: 6f6e 6461 2065 6e76 6972 6f6e 6d65 6e74  onda environment
+0000de10: 220a 2020 2020 2020 2020 2020 2020 6d73  ".            ms
+0000de20: 6720 2b3d 2022 5c6e 220a 2020 2020 2020  g += "\n".      
+0000de30: 2020 2020 2020 7261 6973 6520 4d69 7373        raise Miss
+0000de40: 696e 6744 6570 656e 6465 6e63 7928 6d73  ingDependency(ms
+0000de50: 6729 0a20 2020 2065 6c73 653a 0a20 2020  g).    else:.   
+0000de60: 2020 2020 2069 6620 4445 5045 4e44 454e       if DEPENDEN
+0000de70: 4349 4553 5b22 616e 7369 626c 652d 706c  CIES["ansible-pl
+0000de80: 6179 626f 6f6b 225d 3a0a 2020 2020 2020  aybook"]:.      
+0000de90: 2020 2020 2020 6966 2068 6f73 7420 213d        if host !=
+0000dea0: 2022 6c6f 6361 6c68 6f73 7422 3a0a 2020   "localhost":.  
+0000deb0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000dec0: 7273 6564 5f6b 7761 7267 735b 2275 7365  rsed_kwargs["use
+0000ded0: 726e 616d 6522 5d20 3d20 6173 6b28 0a20  rname"] = ask(. 
+0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000def0: 2020 2071 7565 7374 696f 6e3d 5175 6573     question=Ques
+0000df00: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+0000df10: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000df20: 725f 6e61 6d65 3d22 7573 6572 6e61 6d65  r_name="username
+0000df30: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000df40: 2020 2020 2020 2020 2020 2071 7565 7374             quest
+0000df50: 696f 6e3d 6622 5573 6572 6e61 6d65 2066  ion=f"Username f
+0000df60: 6f72 207b 686f 7374 7d20 7769 7468 2073  or {host} with s
+0000df70: 7564 6f20 7072 6976 6c65 6467 6573 3f22  udo privledges?"
+0000df80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000df90: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+0000dfa0: 743d 6172 675f 6361 6368 655b 2275 7365  t=arg_cache["use
+0000dfb0: 726e 616d 6522 5d2c 0a20 2020 2020 2020  rname"],.       
+0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfd0: 206b 696e 643d 2273 7472 696e 6722 2c0a   kind="string",.
+0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dff0: 2020 2020 2020 2020 6361 6368 653d 5472          cache=Tr
+0000e000: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000e010: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+0000e020: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000e030: 7761 7267 733d 6b77 6172 6773 2c0a 2020  wargs=kwargs,.  
+0000e040: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e060: 7061 7273 6564 5f6b 7761 7267 735b 2261  parsed_kwargs["a
+0000e070: 7574 685f 7479 7065 225d 203d 2061 736b  uth_type"] = ask
+0000e080: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e090: 2020 2020 2020 7175 6573 7469 6f6e 3d51        question=Q
+0000e0a0: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+0000e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0c0: 2076 6172 5f6e 616d 653d 2261 7574 685f   var_name="auth_
+0000e0d0: 7479 7065 222c 0a20 2020 2020 2020 2020  type",.         
+0000e0e0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000e0f0: 7565 7374 696f 6e3d 2244 6f20 796f 7520  uestion="Do you 
+0000e100: 7761 6e74 2074 6f20 6c6f 6769 6e20 7769  want to login wi
+0000e110: 7468 2061 206b 6579 206f 7220 7061 7373  th a key or pass
+0000e120: 776f 7264 222c 0a20 2020 2020 2020 2020  word",.         
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000e140: 6566 6175 6c74 3d61 7267 5f63 6163 6865  efault=arg_cache
+0000e150: 5b22 6175 7468 5f74 7970 6522 5d2c 0a20  ["auth_type"],. 
+0000e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e170: 2020 2020 2020 206b 696e 643d 226f 7074         kind="opt
+0000e180: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000e190: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+0000e1a0: 7469 6f6e 733d 5b22 6b65 7922 2c20 2270  tions=["key", "p
+0000e1b0: 6173 7377 6f72 6422 5d2c 0a20 2020 2020  assword"],.     
+0000e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1d0: 2020 2063 6163 6865 3d54 7275 652c 0a20     cache=True,. 
+0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1f0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+0000e200: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0000e210: 3d6b 7761 7267 732c 0a20 2020 2020 2020  =kwargs,.       
+0000e220: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e230: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+0000e240: 7273 6564 5f6b 7761 7267 735b 2261 7574  rsed_kwargs["aut
+0000e250: 685f 7479 7065 225d 203d 3d20 226b 6579  h_type"] == "key
+0000e260: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000e270: 2020 2020 2020 2070 6172 7365 645f 6b77         parsed_kw
+0000e280: 6172 6773 5b22 6b65 795f 7061 7468 225d  args["key_path"]
+0000e290: 203d 2061 736b 280a 2020 2020 2020 2020   = ask(.        
+0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2b0: 7175 6573 7469 6f6e 3d51 7565 7374 696f  question=Questio
+0000e2c0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000e2e0: 6172 5f6e 616d 653d 226b 6579 5f70 6174  ar_name="key_pat
+0000e2f0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+0000e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e310: 7175 6573 7469 6f6e 3d66 2250 7269 7661  question=f"Priva
+0000e320: 7465 206b 6579 2074 6f20 6163 6365 7373  te key to access
+0000e330: 207b 7061 7273 6564 5f6b 7761 7267 735b   {parsed_kwargs[
+0000e340: 2775 7365 726e 616d 6527 5d7d 407b 686f  'username']}@{ho
+0000e350: 7374 7d3f 222c 0a20 2020 2020 2020 2020  st}?",.         
+0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e370: 2020 2064 6566 6175 6c74 3d61 7267 5f63     default=arg_c
+0000e380: 6163 6865 5b22 6b65 795f 7061 7468 225d  ache["key_path"]
+0000e390: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e3a0: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
+0000e3b0: 6e64 3d22 7061 7468 222c 0a20 2020 2020  nd="path",.     
+0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3d0: 2020 2020 2020 2063 6163 6865 3d54 7275         cache=Tru
+0000e3e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000e3f0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+0000e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e410: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
+0000e420: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
+0000e430: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e440: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000e450: 7061 7273 6564 5f6b 7761 7267 735b 2261  parsed_kwargs["a
+0000e460: 7574 685f 7479 7065 225d 203d 3d20 2270  uth_type"] == "p
+0000e470: 6173 7377 6f72 6422 3a0a 2020 2020 2020  assword":.      
+0000e480: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000e490: 7273 6564 5f6b 7761 7267 735b 2270 6173  rsed_kwargs["pas
+0000e4a0: 7377 6f72 6422 5d20 3d20 6173 6b28 0a20  sword"] = ask(. 
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000e4d0: 5175 6573 7469 6f6e 280a 2020 2020 2020  Question(.      
+0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4f0: 2020 2020 2020 7661 725f 6e61 6d65 3d22        var_name="
+0000e500: 7061 7373 776f 7264 222c 0a20 2020 2020  password",.     
+0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e520: 2020 2020 2020 2071 7565 7374 696f 6e3d         question=
+0000e530: 6622 5061 7373 776f 7264 2066 6f72 207b  f"Password for {
+0000e540: 7061 7273 6564 5f6b 7761 7267 735b 2775  parsed_kwargs['u
+0000e550: 7365 726e 616d 6527 5d7d 407b 686f 7374  sername']}@{host
+0000e560: 7d3f 222c 0a20 2020 2020 2020 2020 2020  }?",.           
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e580: 206b 696e 643d 2270 6173 7377 6f72 6422   kind="password"
+0000e590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e5a0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5c0: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
+0000e5d0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+0000e5e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000e5f0: 2020 2020 2020 2070 6172 7365 645f 6b77         parsed_kw
+0000e600: 6172 6773 5b22 7265 706f 225d 203d 2061  args["repo"] = a
+0000e610: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
+0000e620: 2020 2020 7175 6573 7469 6f6e 3d51 7565      question=Que
+0000e630: 7374 696f 6e28 0a20 2020 2020 2020 2020  stion(.         
+0000e640: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
+0000e650: 616d 653d 2272 6570 6f22 2c0a 2020 2020  ame="repo",.    
+0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e670: 7175 6573 7469 6f6e 3d22 5265 706f 2074  question="Repo t
+0000e680: 6f20 6665 7463 6820 736f 7572 6365 2066  o fetch source f
+0000e690: 726f 6d3f 222c 0a20 2020 2020 2020 2020  rom?",.         
+0000e6a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+0000e6b0: 6c74 3d61 7267 5f63 6163 6865 5b22 7265  lt=arg_cache["re
+0000e6c0: 706f 225d 2c0a 2020 2020 2020 2020 2020  po"],.          
+0000e6d0: 2020 2020 2020 2020 2020 6b69 6e64 3d22            kind="
+0000e6e0: 7374 7269 6e67 222c 0a20 2020 2020 2020  string",.       
+0000e6f0: 2020 2020 2020 2020 2020 2020 2063 6163               cac
+0000e700: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
+0000e710: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+0000e720: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000e730: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
+0000e740: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000e750: 2020 2020 2020 7061 7273 6564 5f6b 7761        parsed_kwa
+0000e760: 7267 735b 2262 7261 6e63 6822 5d20 3d20  rgs["branch"] = 
+0000e770: 6173 6b28 0a20 2020 2020 2020 2020 2020  ask(.           
+0000e780: 2020 2020 2051 7565 7374 696f 6e28 0a20       Question(. 
+0000e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7a0: 2020 2076 6172 5f6e 616d 653d 2262 7261     var_name="bra
+0000e7b0: 6e63 6822 2c0a 2020 2020 2020 2020 2020  nch",.          
+0000e7c0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
+0000e7d0: 6f6e 3d22 4272 616e 6368 2074 6f20 6d6f  on="Branch to mo
+0000e7e0: 6e69 746f 7220 666f 7220 7570 6461 7465  nitor for update
+0000e7f0: 733f 222c 0a20 2020 2020 2020 2020 2020  s?",.           
+0000e800: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0000e810: 3d61 7267 5f63 6163 6865 5b22 6272 616e  =arg_cache["bran
+0000e820: 6368 225d 2c0a 2020 2020 2020 2020 2020  ch"],.          
+0000e830: 2020 2020 2020 2020 2020 6b69 6e64 3d22            kind="
+0000e840: 7374 7269 6e67 222c 0a20 2020 2020 2020  string",.       
+0000e850: 2020 2020 2020 2020 2020 2020 2063 6163               cac
+0000e860: 6865 3d54 7275 652c 0a20 2020 2020 2020  he=True,.       
+0000e870: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+0000e880: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000e890: 6773 3d6b 7761 7267 732c 0a20 2020 2020  gs=kwargs,.     
+0000e8a0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000e8b0: 2020 2020 2020 6175 7468 203d 204e 6f6e        auth = Non
+0000e8c0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0000e8d0: 2068 6f73 7420 213d 2022 6c6f 6361 6c68   host != "localh
+0000e8e0: 6f73 7422 3a0a 2020 2020 2020 2020 2020  ost":.          
+0000e8f0: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
+0000e900: 6b77 6172 6773 5b22 6175 7468 5f74 7970  kwargs["auth_typ
+0000e910: 6522 5d20 3d3d 2022 6b65 7922 3a0a 2020  e"] == "key":.  
+0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e930: 2020 6175 7468 203d 2041 7574 6843 7265    auth = AuthCre
+0000e940: 6465 6e74 6961 6c73 280a 2020 2020 2020  dentials(.      
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e960: 2020 7573 6572 6e61 6d65 3d70 6172 7365    username=parse
+0000e970: 645f 6b77 6172 6773 5b22 7573 6572 6e61  d_kwargs["userna
+0000e980: 6d65 225d 2c0a 2020 2020 2020 2020 2020  me"],.          
+0000e990: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0000e9a0: 795f 7061 7468 3d70 6172 7365 645f 6b77  y_path=parsed_kw
+0000e9b0: 6172 6773 5b22 6b65 795f 7061 7468 225d  args["key_path"]
+0000e9c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e9d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000e9e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea00: 2020 6175 7468 203d 2041 7574 6843 7265    auth = AuthCre
+0000ea10: 6465 6e74 6961 6c73 280a 2020 2020 2020  dentials(.      
+0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea30: 2020 7573 6572 6e61 6d65 3d70 6172 7365    username=parse
+0000ea40: 645f 6b77 6172 6773 5b22 7573 6572 6e61  d_kwargs["userna
+0000ea50: 6d65 225d 2c0a 2020 2020 2020 2020 2020  me"],.          
+0000ea60: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0000ea70: 795f 7061 7468 3d70 6172 7365 645f 6b77  y_path=parsed_kw
+0000ea80: 6172 6773 5b22 7061 7373 776f 7264 225d  args["password"]
+0000ea90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000eaa0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000eab0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
+0000eac0: 7574 682e 7661 6c69 643a 0a20 2020 2020  uth.valid:.     
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000eae0: 6169 7365 2045 7863 6570 7469 6f6e 2866  aise Exception(f
+0000eaf0: 224c 6f67 696e 2043 7265 6465 6e74 6961  "Login Credentia
+0000eb00: 6c73 2061 7265 206e 6f74 2076 616c 6964  ls are not valid
+0000eb10: 2e20 7b61 7574 687d 2229 0a20 2020 2020  . {auth}").     
+0000eb20: 2020 2020 2020 2070 6172 7365 645f 6b77         parsed_kw
+0000eb30: 6172 6773 5b22 616e 7369 626c 655f 6578  args["ansible_ex
+0000eb40: 7472 6173 225d 203d 206b 7761 7267 735b  tras"] = kwargs[
+0000eb50: 2261 6e73 6962 6c65 5f65 7874 7261 7322  "ansible_extras"
+0000eb60: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
+0000eb70: 7475 726e 2063 7265 6174 655f 6c61 756e  turn create_laun
+0000eb80: 6368 5f63 7573 746f 6d5f 636d 6428 7665  ch_custom_cmd(ve
+0000eb90: 7262 3d76 6572 622c 2061 7574 683d 6175  rb=verb, auth=au
+0000eba0: 7468 2c20 6b77 6172 6773 3d70 6172 7365  th, kwargs=parse
+0000ebb0: 645f 6b77 6172 6773 290a 2020 2020 2020  d_kwargs).      
+0000ebc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ebd0: 2020 2020 6572 726f 7273 203d 205b 5d0a      errors = [].
+0000ebe0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000ebf0: 6f74 2044 4550 454e 4445 4e43 4945 535b  ot DEPENDENCIES[
+0000ec00: 2261 6e73 6962 6c65 2d70 6c61 7962 6f6f  "ansible-playboo
+0000ec10: 6b22 5d3a 0a20 2020 2020 2020 2020 2020  k"]:.           
+0000ec20: 2020 2020 2065 7272 6f72 732e 6170 7065       errors.appe
+0000ec30: 6e64 2822 616e 7369 626c 652d 706c 6179  nd("ansible-play
+0000ec40: 626f 6f6b 2229 0a20 2020 2020 2020 2020  book").         
+0000ec50: 2020 2072 6169 7365 204d 6973 7369 6e67     raise Missing
+0000ec60: 4465 7065 6e64 656e 6379 280a 2020 2020  Dependency(.    
+0000ec70: 2020 2020 2020 2020 2020 2020 6622 4c61              f"La
+0000ec80: 756e 6368 696e 6720 6120 4375 7374 6f6d  unching a Custom
+0000ec90: 2056 4d20 7265 7175 6972 6573 3a20 7b27   VM requires: {'
+0000eca0: 2027 2e6a 6f69 6e28 6572 726f 7273 297d   '.join(errors)}
+0000ecb0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+0000ecc0: 0a20 2020 2068 6f73 745f 6f70 7469 6f6e  .    host_option
+0000ecd0: 7320 3d20 222c 2022 2e6a 6f69 6e28 616c  s = ", ".join(al
+0000ece0: 6c6f 7765 645f 686f 7374 7329 0a20 2020  lowed_hosts).   
+0000ecf0: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
+0000ed00: 7065 6e64 656e 6379 280a 2020 2020 2020  pendency(.      
+0000ed10: 2020 6622 4c61 756e 6368 2072 6571 7569    f"Launch requi
+0000ed20: 7265 7320 6120 636f 7272 6563 7420 686f  res a correct ho
+0000ed30: 7374 206f 7074 696f 6e2c 2074 7279 3a20  st option, try: 
+0000ed40: 7b68 6f73 745f 6f70 7469 6f6e 737d 220a  {host_options}".
+0000ed50: 2020 2020 290a 0a0a 6465 6620 7075 6c6c      )...def pull
+0000ed60: 5f63 6f6d 6d61 6e64 2863 6d64 3a20 7374  _command(cmd: st
+0000ed70: 722c 206b 7761 7267 733a 2054 7970 6544  r, kwargs: TypeD
+0000ed80: 6963 745b 7374 722c 2041 6e79 5d29 202d  ict[str, Any]) -
+0000ed90: 3e20 5479 7065 4c69 7374 5b73 7472 5d3a  > TypeList[str]:
+0000eda0: 0a20 2020 2070 756c 6c5f 636d 6420 3d20  .    pull_cmd = 
+0000edb0: 7374 7228 636d 6429 0a20 2020 2069 6620  str(cmd).    if 
+0000edc0: 6b77 6172 6773 5b22 7265 6c65 6173 6522  kwargs["release"
+0000edd0: 5d20 3d3d 2022 7072 6f64 7563 7469 6f6e  ] == "production
+0000ede0: 223a 0a20 2020 2020 2020 2070 756c 6c5f  ":.        pull_
+0000edf0: 636d 6420 2b3d 2022 202d 2d66 696c 6520  cmd += " --file 
+0000ee00: 646f 636b 6572 2d63 6f6d 706f 7365 2e79  docker-compose.y
+0000ee10: 6d6c 220a 2020 2020 656c 7365 3a0a 2020  ml".    else:.  
+0000ee20: 2020 2020 2020 7075 6c6c 5f63 6d64 202b        pull_cmd +
+0000ee30: 3d20 2220 2d2d 6669 6c65 2064 6f63 6b65  = " --file docke
+0000ee40: 722d 636f 6d70 6f73 652e 7075 6c6c 2e79  r-compose.pull.y
+0000ee50: 6d6c 220a 2020 2020 7075 6c6c 5f63 6d64  ml".    pull_cmd
+0000ee60: 202b 3d20 2220 7075 6c6c 202d 2d69 676e   += " pull --ign
+0000ee70: 6f72 652d 7075 6c6c 2d66 6169 6c75 7265  ore-pull-failure
+0000ee80: 7322 2020 2320 6967 6e6f 7265 206d 6973  s"  # ignore mis
+0000ee90: 7369 6e67 2076 6572 7369 6f6e 2066 726f  sing version fro
+0000eea0: 6d20 446f 636b 6572 6875 620a 2020 2020  m Dockerhub.    
+0000eeb0: 7265 7475 726e 205b 7075 6c6c 5f63 6d64  return [pull_cmd
+0000eec0: 5d0a 0a0a 6465 6620 6275 696c 645f 636f  ]...def build_co
+0000eed0: 6d6d 616e 6428 636d 643a 2073 7472 2920  mmand(cmd: str) 
+0000eee0: 2d3e 2054 7970 654c 6973 745b 7374 725d  -> TypeList[str]
+0000eef0: 3a0a 2020 2020 6275 696c 645f 636d 6420  :.    build_cmd 
+0000ef00: 3d20 7374 7228 636d 6429 0a20 2020 2062  = str(cmd).    b
+0000ef10: 7569 6c64 5f63 6d64 202b 3d20 2220 2d2d  uild_cmd += " --
+0000ef20: 6669 6c65 2064 6f63 6b65 722d 636f 6d70  file docker-comp
+0000ef30: 6f73 652e 6275 696c 642e 796d 6c22 0a20  ose.build.yml". 
+0000ef40: 2020 2062 7569 6c64 5f63 6d64 202b 3d20     build_cmd += 
+0000ef50: 2220 6275 696c 6422 0a20 2020 2072 6574  " build".    ret
+0000ef60: 7572 6e20 5b62 7569 6c64 5f63 6d64 5d0a  urn [build_cmd].
+0000ef70: 0a0a 6465 6620 6465 706c 6f79 5f63 6f6d  ..def deploy_com
+0000ef80: 6d61 6e64 2863 6d64 3a20 7374 722c 2074  mand(cmd: str, t
+0000ef90: 6169 6c3a 2062 6f6f 6c2c 2072 656c 6561  ail: bool, relea
+0000efa0: 7365 5f74 7970 653a 2073 7472 2920 2d3e  se_type: str) ->
+0000efb0: 2054 7970 654c 6973 745b 7374 725d 3a0a   TypeList[str]:.
+0000efc0: 2020 2020 7570 5f63 6d64 203d 2073 7472      up_cmd = str
+0000efd0: 2863 6d64 290a 2020 2020 7570 5f63 6d64  (cmd).    up_cmd
+0000efe0: 202b 3d20 2220 2d2d 6669 6c65 2064 6f63   += " --file doc
+0000eff0: 6b65 722d 636f 6d70 6f73 652e 6465 762e  ker-compose.dev.
+0000f000: 796d 6c22 2069 6620 7265 6c65 6173 655f  yml" if release_
+0000f010: 7479 7065 203d 3d20 2264 6576 656c 6f70  type == "develop
+0000f020: 6d65 6e74 2220 656c 7365 2022 220a 2020  ment" else "".  
+0000f030: 2020 7570 5f63 6d64 202b 3d20 2220 7570    up_cmd += " up
+0000f040: 220a 2020 2020 6966 206e 6f74 2074 6169  ".    if not tai
+0000f050: 6c3a 0a20 2020 2020 2020 2075 705f 636d  l:.        up_cm
+0000f060: 6420 2b3d 2022 202d 6422 0a20 2020 2072  d += " -d".    r
+0000f070: 6574 7572 6e20 5b75 705f 636d 645d 0a0a  eturn [up_cmd]..
+0000f080: 0a64 6566 2063 7265 6174 655f 6c61 756e  .def create_laun
+0000f090: 6368 5f64 6f63 6b65 725f 636d 6428 0a20  ch_docker_cmd(. 
+0000f0a0: 2020 2076 6572 623a 2047 7261 6d6d 6172     verb: Grammar
+0000f0b0: 5665 7262 2c0a 2020 2020 646f 636b 6572  Verb,.    docker
+0000f0c0: 5f76 6572 7369 6f6e 3a20 7374 722c 0a20  _version: str,. 
+0000f0d0: 2020 206b 7761 7267 733a 2054 7970 6544     kwargs: TypeD
+0000f0e0: 6963 745b 7374 722c 2041 6e79 5d2c 0a20  ict[str, Any],. 
+0000f0f0: 2020 2074 6169 6c3a 2062 6f6f 6c20 3d20     tail: bool = 
+0000f100: 5472 7565 2c0a 2020 2020 7369 6c65 6e74  True,.    silent
+0000f110: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000f120: 2920 2d3e 2054 7970 6544 6963 745b 7374  ) -> TypeDict[st
+0000f130: 722c 2054 7970 654c 6973 745b 7374 725d  r, TypeList[str]
+0000f140: 5d3a 0a20 2020 2068 6f73 745f 7465 726d  ]:.    host_term
+0000f150: 203d 2076 6572 622e 6765 745f 6e61 6d65   = verb.get_name
+0000f160: 645f 7465 726d 5f68 6f73 7467 7261 6d6d  d_term_hostgramm
+0000f170: 6172 286e 616d 653d 2268 6f73 7422 290a  ar(name="host").
+0000f180: 2020 2020 6e6f 6465 5f6e 616d 6520 3d20      node_name = 
+0000f190: 7665 7262 2e67 6574 5f6e 616d 6564 5f74  verb.get_named_t
+0000f1a0: 6572 6d5f 7479 7065 286e 616d 653d 226e  erm_type(name="n
+0000f1b0: 6f64 655f 6e61 6d65 2229 0a20 2020 206e  ode_name").    n
+0000f1c0: 6f64 655f 7479 7065 203d 2076 6572 622e  ode_type = verb.
+0000f1d0: 6765 745f 6e61 6d65 645f 7465 726d 5f74  get_named_term_t
+0000f1e0: 7970 6528 6e61 6d65 3d22 6e6f 6465 5f74  ype(name="node_t
+0000f1f0: 7970 6522 290a 0a20 2020 2073 6e61 6b65  ype")..    snake
+0000f200: 5f6e 616d 6520 3d20 7374 7228 6e6f 6465  _name = str(node
+0000f210: 5f6e 616d 652e 736e 616b 655f 696e 7075  _name.snake_inpu
+0000f220: 7429 0a20 2020 2074 6167 203d 206e 616d  t).    tag = nam
+0000f230: 655f 7461 6728 6e61 6d65 3d73 7472 286e  e_tag(name=str(n
+0000f240: 6f64 655f 6e61 6d65 2e69 6e70 7574 2929  ode_name.input))
+0000f250: 0a0a 2020 2020 6966 2041 5254 2061 6e64  ..    if ART and
+0000f260: 206e 6f74 2073 696c 656e 743a 0a20 2020   not silent:.   
+0000f270: 2020 2020 2068 6167 7269 6428 290a 0a20       hagrid().. 
+0000f280: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0000f290: 2020 224c 6175 6e63 6869 6e67 2061 2050    "Launching a P
+0000f2a0: 7947 7269 6420 220a 2020 2020 2020 2020  yGrid ".        
+0000f2b0: 2b20 7374 7228 6e6f 6465 5f74 7970 652e  + str(node_type.
+0000f2c0: 696e 7075 7429 2e63 6170 6974 616c 697a  input).capitaliz
+0000f2d0: 6528 290a 2020 2020 2020 2020 2b20 2220  e().        + " 
+0000f2e0: 6e6f 6465 206f 6e20 706f 7274 2022 0a20  node on port ". 
+0000f2f0: 2020 2020 2020 202b 2073 7472 2868 6f73         + str(hos
+0000f300: 745f 7465 726d 2e66 7265 655f 706f 7274  t_term.free_port
+0000f310: 290a 2020 2020 2020 2020 2b20 2221 5c6e  ).        + "!\n
+0000f320: 220a 2020 2020 290a 0a20 2020 2076 6572  ".    )..    ver
+0000f330: 7369 6f6e 5f73 7472 696e 6720 3d20 6b77  sion_string = kw
+0000f340: 6172 6773 5b22 7461 6722 5d0a 2020 2020  args["tag"].    
+0000f350: 7665 7273 696f 6e5f 6861 7368 203d 2022  version_hash = "
+0000f360: 646f 636b 6572 6875 6222 0a20 2020 2062  dockerhub".    b
+0000f370: 7569 6c64 203d 206b 7761 7267 735b 2262  uild = kwargs["b
+0000f380: 7569 6c64 225d 0a20 2020 2066 726f 6d5f  uild"].    from_
+0000f390: 7465 6d70 6c61 7465 203d 206b 7761 7267  template = kwarg
+0000f3a0: 735b 2266 726f 6d5f 7465 6d70 6c61 7465  s["from_template
+0000f3b0: 225d 0a0a 2020 2020 2320 6966 2069 6e20  "]..    # if in 
+0000f3c0: 6465 7665 6c6f 706d 656e 7420 6d6f 6465  development mode
+0000f3d0: 2c20 6765 6e65 7261 7465 2061 2076 6572  , generate a ver
+0000f3e0: 7369 6f6e 5f73 7472 696e 6720 7768 6963  sion_string whic
+0000f3f0: 6820 6973 2065 6974 6865 720a 2020 2020  h is either.    
+0000f400: 2320 7468 6520 6f6e 6520 796f 7520 696e  # the one you in
+0000f410: 7075 7465 6420 636f 6e63 6174 656e 6174  puted concatenat
+0000f420: 6564 2077 6974 6820 2d64 6576 206f 7220  ed with -dev or 
+0000f430: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
+0000f440: 7468 6520 5645 5253 494f 4e20 6669 6c65  the VERSION file
+0000f450: 0a20 2020 2069 6620 2272 656c 6561 7365  .    if "release
+0000f460: 2220 696e 206b 7761 7267 7320 616e 6420  " in kwargs and 
+0000f470: 6b77 6172 6773 5b22 7265 6c65 6173 6522  kwargs["release"
+0000f480: 5d20 3d3d 2022 6465 7665 6c6f 706d 656e  ] == "developmen
+0000f490: 7422 3a0a 2020 2020 2020 2020 2320 666f  t":.        # fo
+0000f4a0: 7263 6520 7665 7273 696f 6e20 746f 2068  rce version to h
+0000f4b0: 6176 6520 2d64 6576 2061 7420 7468 6520  ave -dev at the 
+0000f4c0: 656e 6420 696e 2064 6576 206d 6f64 650a  end in dev mode.
+0000f4d0: 2020 2020 2020 2020 2320 6475 7269 6e67          # during
+0000f4e0: 2064 6576 656c 6f70 6d65 6e74 2077 6520   development we 
+0000f4f0: 6361 6e20 7573 6520 7468 6520 6c61 7465  can use the late
+0000f500: 7374 2062 6574 6120 7665 7273 696f 6e0a  st beta version.
+0000f510: 2020 2020 2020 2020 6966 2076 6572 7369          if versi
+0000f520: 6f6e 5f73 7472 696e 6720 6973 204e 6f6e  on_string is Non
+0000f530: 653a 0a20 2020 2020 2020 2020 2020 2076  e:.            v
+0000f540: 6572 7369 6f6e 5f73 7472 696e 6720 3d20  ersion_string = 
+0000f550: 4752 4944 5f53 5243 5f56 4552 5349 4f4e  GRID_SRC_VERSION
+0000f560: 5b30 5d0a 2020 2020 2020 2020 7665 7273  [0].        vers
+0000f570: 696f 6e5f 7374 7269 6e67 202b 3d20 222d  ion_string += "-
+0000f580: 6465 7622 0a20 2020 2020 2020 2076 6572  dev".        ver
+0000f590: 7369 6f6e 5f68 6173 6820 3d20 4752 4944  sion_hash = GRID
+0000f5a0: 5f53 5243 5f56 4552 5349 4f4e 5b31 5d0a  _SRC_VERSION[1].
+0000f5b0: 2020 2020 2020 2020 6275 696c 6420 3d20          build = 
+0000f5c0: 5472 7565 0a20 2020 2065 6c73 653a 0a20  True.    else:. 
+0000f5d0: 2020 2020 2020 2023 2077 6865 7265 6173         # whereas
+0000f5e0: 2069 6620 696e 2070 726f 6475 6374 696f   if in productio
+0000f5f0: 6e20 6d6f 6465 2061 6e64 2074 6167 203d  n mode and tag =
+0000f600: 3d20 226c 6f63 616c 2220 7573 6520 7468  = "local" use th
+0000f610: 6520 6c6f 6361 6c20 5645 5253 494f 4e20  e local VERSION 
+0000f620: 6669 6c65 0a20 2020 2020 2020 2023 206f  file.        # o
+0000f630: 7220 6966 2069 7473 206e 6f74 2073 6574  r if its not set
+0000f640: 2073 6f6d 6568 6f77 2c20 7768 6963 6820   somehow, which 
+0000f650: 7368 6f75 6c64 206e 6576 6572 2068 6170  should never hap
+0000f660: 7065 6e2c 2075 7365 2073 7461 626c 650a  pen, use stable.
+0000f670: 2020 2020 2020 2020 2320 6f74 6865 7277          # otherw
+0000f680: 6973 6520 7573 6520 7468 6520 6b77 6172  ise use the kwar
+0000f690: 6773 5b22 7461 6722 5d20 6672 6f6d 2061  gs["tag"] from a
+0000f6a0: 626f 7665 0a0a 2020 2020 2020 2020 2320  bove..        # 
+0000f6b0: 6475 7269 6e67 2070 726f 6475 6374 696f  during productio
+0000f6c0: 6e20 7468 6520 6465 6661 756c 7420 776f  n the default wo
+0000f6d0: 756c 6420 6265 2073 7461 626c 650a 2020  uld be stable.  
+0000f6e0: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
+0000f6f0: 5f73 7472 696e 6720 3d3d 2022 6c6f 6361  _string == "loca
+0000f700: 6c22 3a0a 2020 2020 2020 2020 2020 2020  l":.            
+0000f710: 2320 7468 6973 2063 616e 2062 6520 7573  # this can be us
+0000f720: 6564 2069 6e20 564d 7320 696e 2070 726f  ed in VMs in pro
+0000f730: 6475 6374 696f 6e20 746f 2061 7574 6f20  duction to auto 
+0000f740: 7570 6461 7465 2066 726f 6d20 7372 630a  update from src.
+0000f750: 2020 2020 2020 2020 2020 2020 7665 7273              vers
+0000f760: 696f 6e5f 7374 7269 6e67 203d 2047 5249  ion_string = GRI
+0000f770: 445f 5352 435f 5645 5253 494f 4e5b 305d  D_SRC_VERSION[0]
+0000f780: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
+0000f790: 7369 6f6e 5f68 6173 6820 3d20 4752 4944  sion_hash = GRID
+0000f7a0: 5f53 5243 5f56 4552 5349 4f4e 5b31 5d0a  _SRC_VERSION[1].
+0000f7b0: 2020 2020 2020 2020 2020 2020 6275 696c              buil
+0000f7c0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0000f7d0: 2065 6c69 6620 7665 7273 696f 6e5f 7374   elif version_st
+0000f7e0: 7269 6e67 2069 7320 4e6f 6e65 3a0a 2020  ring is None:.  
+0000f7f0: 2020 2020 2020 2020 2020 7665 7273 696f            versio
+0000f800: 6e5f 7374 7269 6e67 203d 2022 6c61 7465  n_string = "late
+0000f810: 7374 220a 0a20 2020 2069 6620 706c 6174  st"..    if plat
+0000f820: 666f 726d 2e75 6e61 6d65 2829 2e6d 6163  form.uname().mac
+0000f830: 6869 6e65 2e6c 6f77 6572 2829 2069 6e20  hine.lower() in 
+0000f840: 5b22 7838 365f 3634 222c 2022 616d 6436  ["x86_64", "amd6
+0000f850: 3422 5d3a 0a20 2020 2020 2020 2064 6f63  4"]:.        doc
+0000f860: 6b65 725f 706c 6174 666f 726d 203d 2022  ker_platform = "
+0000f870: 6c69 6e75 782f 616d 6436 3422 0a20 2020  linux/amd64".   
+0000f880: 2065 6c73 653a 0a20 2020 2020 2020 2064   else:.        d
+0000f890: 6f63 6b65 725f 706c 6174 666f 726d 203d  ocker_platform =
+0000f8a0: 2022 6c69 6e75 782f 6172 6d36 3422 0a0a   "linux/arm64"..
+0000f8b0: 2020 2020 6966 2022 706c 6174 666f 726d      if "platform
+0000f8c0: 2220 696e 206b 7761 7267 7320 616e 6420  " in kwargs and 
+0000f8d0: 6b77 6172 6773 5b22 706c 6174 666f 726d  kwargs["platform
+0000f8e0: 225d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  "] is not None:.
+0000f8f0: 2020 2020 2020 2020 646f 636b 6572 5f70          docker_p
+0000f900: 6c61 7466 6f72 6d20 3d20 6b77 6172 6773  latform = kwargs
+0000f910: 5b22 706c 6174 666f 726d 225d 0a0a 2020  ["platform"]..  
+0000f920: 2020 656e 6162 6c65 5f6f 626c 7620 3d20    enable_oblv = 
+0000f930: 626f 6f6c 286b 7761 7267 735b 226f 626c  bool(kwargs["obl
+0000f940: 7622 5d29 0a20 2020 2070 7269 6e74 2822  v"]).    print("
+0000f950: 2020 2d20 4e41 4d45 3a20 2220 2b20 7374    - NAME: " + st
+0000f960: 7228 736e 616b 655f 6e61 6d65 2929 0a20  r(snake_name)). 
+0000f970: 2020 2070 7269 6e74 2822 2020 2d20 5245     print("  - RE
+0000f980: 4c45 4153 453a 2022 202b 206b 7761 7267  LEASE: " + kwarg
+0000f990: 735b 2272 656c 6561 7365 225d 290a 2020  s["release"]).  
+0000f9a0: 2020 7072 696e 7428 2220 202d 2041 5243    print("  - ARC
+0000f9b0: 483a 2022 202b 2064 6f63 6b65 725f 706c  H: " + docker_pl
+0000f9c0: 6174 666f 726d 290a 2020 2020 7072 696e  atform).    prin
+0000f9d0: 7428 2220 202d 2054 5950 453a 2022 202b  t("  - TYPE: " +
+0000f9e0: 2073 7472 286e 6f64 655f 7479 7065 2e69   str(node_type.i
+0000f9f0: 6e70 7574 2929 0a20 2020 2070 7269 6e74  nput)).    print
+0000fa00: 2822 2020 2d20 444f 434b 4552 5f54 4147  ("  - DOCKER_TAG
+0000fa10: 3a20 2220 2b20 7665 7273 696f 6e5f 7374  : " + version_st
+0000fa20: 7269 6e67 290a 2020 2020 6966 2076 6572  ring).    if ver
+0000fa30: 7369 6f6e 5f68 6173 6820 213d 2022 646f  sion_hash != "do
+0000fa40: 636b 6572 6875 6222 3a0a 2020 2020 2020  ckerhub":.      
+0000fa50: 2020 7072 696e 7428 2220 202d 2047 4954    print("  - GIT
+0000fa60: 5f48 4153 483a 2022 202b 2076 6572 7369  _HASH: " + versi
+0000fa70: 6f6e 5f68 6173 6829 0a20 2020 2070 7269  on_hash).    pri
+0000fa80: 6e74 2822 2020 2d20 4841 4752 4944 5f56  nt("  - HAGRID_V
+0000fa90: 4552 5349 4f4e 3a20 2220 2b20 6765 745f  ERSION: " + get_
+0000faa0: 7665 7273 696f 6e5f 7374 7269 6e67 2829  version_string()
+0000fab0: 290a 2020 2020 6966 2045 4449 5441 424c  ).    if EDITABL
+0000fac0: 455f 4d4f 4445 3a0a 2020 2020 2020 2020  E_MODE:.        
+0000fad0: 7072 696e 7428 2220 202d 2048 4147 5249  print("  - HAGRI
+0000fae0: 445f 5245 504f 5f53 4841 3a20 2220 2b20  D_REPO_SHA: " + 
+0000faf0: 636f 6d6d 6974 5f68 6173 6828 2929 0a20  commit_hash()). 
+0000fb00: 2020 2070 7269 6e74 2822 2020 2d20 504f     print("  - PO
+0000fb10: 5254 3a20 2220 2b20 7374 7228 686f 7374  RT: " + str(host
+0000fb20: 5f74 6572 6d2e 6672 6565 5f70 6f72 7429  _term.free_port)
+0000fb30: 290a 2020 2020 7072 696e 7428 2220 202d  ).    print("  -
+0000fb40: 2044 4f43 4b45 5220 434f 4d50 4f53 453a   DOCKER COMPOSE:
+0000fb50: 2022 202b 2064 6f63 6b65 725f 7665 7273   " + docker_vers
+0000fb60: 696f 6e29 0a20 2020 2069 6620 656e 6162  ion).    if enab
+0000fb70: 6c65 5f6f 626c 763a 0a20 2020 2020 2020  le_oblv:.       
+0000fb80: 2070 7269 6e74 2822 2020 2d20 4f42 4c56   print("  - OBLV
+0000fb90: 3a20 222c 2065 6e61 626c 655f 6f62 6c76  : ", enable_oblv
+0000fba0: 290a 0a20 2020 2070 7269 6e74 2822 5c6e  )..    print("\n
+0000fbb0: 2229 0a0a 2020 2020 7573 655f 626c 6f62  ")..    use_blob
+0000fbc0: 5f73 746f 7261 6765 203d 2028 0a20 2020  _storage = (.   
+0000fbd0: 2020 2020 2046 616c 7365 2069 6620 7374       False if st
+0000fbe0: 7228 6e6f 6465 5f74 7970 652e 696e 7075  r(node_type.inpu
+0000fbf0: 7429 203d 3d20 226e 6574 776f 726b 2220  t) == "network" 
+0000fc00: 656c 7365 2062 6f6f 6c28 6b77 6172 6773  else bool(kwargs
+0000fc10: 5b22 7573 655f 626c 6f62 5f73 746f 7261  ["use_blob_stora
+0000fc20: 6765 225d 290a 2020 2020 290a 0a20 2020  ge"]).    )..   
+0000fc30: 2065 6e76 7320 3d20 7b0a 2020 2020 2020   envs = {.      
+0000fc40: 2020 2252 454c 4541 5345 223a 2022 7072    "RELEASE": "pr
+0000fc50: 6f64 7563 7469 6f6e 222c 0a20 2020 2020  oduction",.     
+0000fc60: 2020 2022 434f 4d50 4f53 455f 444f 434b     "COMPOSE_DOCK
+0000fc70: 4552 5f43 4c49 5f42 5549 4c44 223a 2031  ER_CLI_BUILD": 1
+0000fc80: 2c0a 2020 2020 2020 2020 2244 4f43 4b45  ,.        "DOCKE
+0000fc90: 525f 4255 494c 444b 4954 223a 2031 2c0a  R_BUILDKIT": 1,.
+0000fca0: 2020 2020 2020 2020 2248 5454 505f 504f          "HTTP_PO
+0000fcb0: 5254 223a 2069 6e74 2868 6f73 745f 7465  RT": int(host_te
+0000fcc0: 726d 2e66 7265 655f 706f 7274 292c 0a20  rm.free_port),. 
+0000fcd0: 2020 2020 2020 2022 4854 5450 535f 504f         "HTTPS_PO
+0000fce0: 5254 223a 2069 6e74 2868 6f73 745f 7465  RT": int(host_te
+0000fcf0: 726d 2e66 7265 655f 706f 7274 5f74 6c73  rm.free_port_tls
+0000fd00: 292c 0a20 2020 2020 2020 2022 5452 4145  ),.        "TRAE
+0000fd10: 4649 4b5f 5441 4722 3a20 7374 7228 7461  FIK_TAG": str(ta
+0000fd20: 6729 2c0a 2020 2020 2020 2020 224e 4f44  g),.        "NOD
+0000fd30: 455f 4e41 4d45 223a 2073 7472 2873 6e61  E_NAME": str(sna
+0000fd40: 6b65 5f6e 616d 6529 2c0a 2020 2020 2020  ke_name),.      
+0000fd50: 2020 224e 4f44 455f 5459 5045 223a 2073    "NODE_TYPE": s
+0000fd60: 7472 286e 6f64 655f 7479 7065 2e69 6e70  tr(node_type.inp
+0000fd70: 7574 292c 0a20 2020 2020 2020 2022 5452  ut),.        "TR
+0000fd80: 4145 4649 4b5f 5055 424c 4943 5f4e 4554  AEFIK_PUBLIC_NET
+0000fd90: 574f 524b 5f49 535f 4558 5445 524e 414c  WORK_IS_EXTERNAL
+0000fda0: 223a 2022 4661 6c73 6522 2c0a 2020 2020  ": "False",.    
+0000fdb0: 2020 2020 2256 4552 5349 4f4e 223a 2076      "VERSION": v
+0000fdc0: 6572 7369 6f6e 5f73 7472 696e 672c 0a20  ersion_string,. 
+0000fdd0: 2020 2020 2020 2022 5645 5253 494f 4e5f         "VERSION_
+0000fde0: 4841 5348 223a 2076 6572 7369 6f6e 5f68  HASH": version_h
+0000fdf0: 6173 682c 0a20 2020 2020 2020 2022 5553  ash,.        "US
+0000fe00: 455f 424c 4f42 5f53 544f 5241 4745 223a  E_BLOB_STORAGE":
+0000fe10: 2073 7472 2875 7365 5f62 6c6f 625f 7374   str(use_blob_st
+0000fe20: 6f72 6167 6529 2c0a 2020 2020 2020 2020  orage),.        
+0000fe30: 2246 524f 4e54 454e 445f 5441 5247 4554  "FRONTEND_TARGET
+0000fe40: 223a 2022 6772 6964 2d75 692d 6465 7665  ": "grid-ui-deve
+0000fe50: 6c6f 706d 656e 7422 2c0a 2020 2020 2020  lopment",.      
+0000fe60: 2020 2253 5441 434b 5f41 5049 5f4b 4559    "STACK_API_KEY
+0000fe70: 223a 2073 7472 280a 2020 2020 2020 2020  ": str(.        
+0000fe80: 2020 2020 6765 6e65 7261 7465 5f73 6563      generate_sec
+0000fe90: 5f72 616e 646f 6d5f 7061 7373 776f 7264  _random_password
+0000fea0: 286c 656e 6774 683d 3438 2c20 7370 6563  (length=48, spec
+0000feb0: 6961 6c5f 6368 6172 733d 4661 6c73 6529  ial_chars=False)
+0000fec0: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+0000fed0: 2020 2020 2245 4e41 424c 455f 4f42 4c56      "ENABLE_OBLV
+0000fee0: 223a 2073 7472 2865 6e61 626c 655f 6f62  ": str(enable_ob
+0000fef0: 6c76 292e 6c6f 7765 7228 292c 0a20 2020  lv).lower(),.   
+0000ff00: 207d 0a0a 2020 2020 6966 2022 7472 6163   }..    if "trac
+0000ff10: 6522 2069 6e20 6b77 6172 6773 2061 6e64  e" in kwargs and
+0000ff20: 206b 7761 7267 735b 2274 7261 6365 225d   kwargs["trace"]
+0000ff30: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+0000ff40: 2020 656e 7673 5b22 5452 4143 4522 5d20    envs["TRACE"] 
+0000ff50: 3d20 2254 7275 6522 0a20 2020 2020 2020  = "True".       
+0000ff60: 2065 6e76 735b 224a 4145 4745 525f 484f   envs["JAEGER_HO
+0000ff70: 5354 225d 203d 2022 646f 636b 6572 2d68  ST"] = "docker-h
+0000ff80: 6f73 7422 0a20 2020 2020 2020 2065 6e76  ost".        env
+0000ff90: 735b 224a 4145 4745 525f 504f 5254 225d  s["JAEGER_PORT"]
+0000ffa0: 203d 2069 6e74 280a 2020 2020 2020 2020   = int(.        
+0000ffb0: 2020 2020 6669 6e64 5f61 7661 696c 6162      find_availab
+0000ffc0: 6c65 5f70 6f72 7428 686f 7374 3d22 6c6f  le_port(host="lo
+0000ffd0: 6361 6c68 6f73 7422 2c20 706f 7274 3d31  calhost", port=1
+0000ffe0: 3432 3638 2c20 7365 6172 6368 3d54 7275  4268, search=Tru
+0000fff0: 6529 0a20 2020 2020 2020 2029 0a0a 2020  e).        )..  
+00010000: 2020 6966 2022 706c 6174 666f 726d 2220    if "platform" 
+00010010: 696e 206b 7761 7267 7320 616e 6420 6b77  in kwargs and kw
+00010020: 6172 6773 5b22 706c 6174 666f 726d 225d  args["platform"]
+00010030: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00010040: 2020 2020 2020 656e 7673 5b22 444f 434b        envs["DOCK
+00010050: 4552 5f44 4546 4155 4c54 5f50 4c41 5446  ER_DEFAULT_PLATF
+00010060: 4f52 4d22 5d20 3d20 646f 636b 6572 5f70  ORM"] = docker_p
+00010070: 6c61 7466 6f72 6d0a 0a20 2020 2069 6620  latform..    if 
+00010080: 2274 6c73 2220 696e 206b 7761 7267 7320  "tls" in kwargs 
+00010090: 616e 6420 6b77 6172 6773 5b22 746c 7322  and kwargs["tls"
+000100a0: 5d20 6973 2054 7275 6520 616e 6420 6c65  ] is True and le
+000100b0: 6e28 6b77 6172 6773 5b22 6365 7274 5f73  n(kwargs["cert_s
+000100c0: 746f 7265 5f70 6174 6822 5d29 203e 2030  tore_path"]) > 0
+000100d0: 3a0a 2020 2020 2020 2020 656e 7673 5b22  :.        envs["
+000100e0: 5452 4145 4649 4b5f 544c 535f 4345 5254  TRAEFIK_TLS_CERT
+000100f0: 5322 5d20 3d20 6b77 6172 6773 5b22 6365  S"] = kwargs["ce
+00010100: 7274 5f73 746f 7265 5f70 6174 6822 5d0a  rt_store_path"].
+00010110: 0a20 2020 2069 6620 280a 2020 2020 2020  .    if (.      
+00010120: 2020 2274 6c73 2220 696e 206b 7761 7267    "tls" in kwarg
+00010130: 730a 2020 2020 2020 2020 616e 6420 6b77  s.        and kw
+00010140: 6172 6773 5b22 746c 7322 5d20 6973 2054  args["tls"] is T
+00010150: 7275 650a 2020 2020 2020 2020 616e 6420  rue.        and 
+00010160: 2274 6573 7422 2069 6e20 6b77 6172 6773  "test" in kwargs
+00010170: 0a20 2020 2020 2020 2061 6e64 206b 7761  .        and kwa
+00010180: 7267 735b 2274 6573 7422 5d20 6973 2054  rgs["test"] is T
+00010190: 7275 650a 2020 2020 293a 0a20 2020 2020  rue.    ):.     
+000101a0: 2020 2065 6e76 735b 2249 474e 4f52 455f     envs["IGNORE_
+000101b0: 544c 535f 4552 524f 5253 225d 203d 2022  TLS_ERRORS"] = "
+000101c0: 5472 7565 220a 0a20 2020 2069 6620 2274  True"..    if "t
+000101d0: 6573 7422 2069 6e20 6b77 6172 6773 2061  est" in kwargs a
+000101e0: 6e64 206b 7761 7267 735b 2274 6573 7422  nd kwargs["test"
+000101f0: 5d20 6973 2054 7275 653a 0a20 2020 2020  ] is True:.     
+00010200: 2020 2065 6e76 735b 2253 335f 564f 4c55     envs["S3_VOLU
+00010210: 4d45 5f53 495a 455f 4d42 225d 203d 2022  ME_SIZE_MB"] = "
+00010220: 3130 3022 2020 2320 4769 7448 7562 2043  100"  # GitHub C
+00010230: 4920 6973 2073 6d61 6c6c 0a0a 2020 2020  I is small..    
+00010240: 6966 206b 7761 7267 732e 6765 7428 2272  if kwargs.get("r
+00010250: 656c 6561 7365 222c 2022 2229 203d 3d20  elease", "") == 
+00010260: 2264 6576 656c 6f70 6d65 6e74 223a 0a20  "development":. 
+00010270: 2020 2020 2020 2065 6e76 735b 2252 4142         envs["RAB
+00010280: 4249 544d 515f 4d41 4e41 4745 4d45 4e54  BITMQ_MANAGEMENT
+00010290: 225d 203d 2022 2d6d 616e 6167 656d 656e  "] = "-managemen
+000102a0: 7422 0a0a 2020 2020 2320 6375 7272 656e  t"..    # curren
+000102b0: 746c 7920 7765 206f 6e6c 7920 6861 7665  tly we only have
+000102c0: 2061 2064 6f6d 6169 6e20 6672 6f6e 7465   a domain fronte
+000102d0: 6e64 2066 6f72 2064 6576 206d 6f64 650a  nd for dev mode.
+000102e0: 2020 2020 6966 206b 7761 7267 732e 6765      if kwargs.ge
+000102f0: 7428 2272 656c 6561 7365 222c 2022 2229  t("release", "")
+00010300: 203d 3d20 2264 6576 656c 6f70 6d65 6e74   == "development
+00010310: 2220 616e 6420 7374 7228 6e6f 6465 5f74  " and str(node_t
+00010320: 7970 652e 696e 7075 7429 2021 3d20 226e  ype.input) != "n
+00010330: 6574 776f 726b 223a 0a20 2020 2020 2020  etwork":.       
+00010340: 2065 6e76 735b 2246 524f 4e54 454e 445f   envs["FRONTEND_
+00010350: 5441 5247 4554 225d 203d 2022 6772 6964  TARGET"] = "grid
+00010360: 2d75 692d 6465 7665 6c6f 706d 656e 7422  -ui-development"
+00010370: 0a0a 2020 2020 6966 2022 7365 745f 726f  ..    if "set_ro
+00010380: 6f74 5f70 6173 7377 6f72 6422 2069 6e20  ot_password" in 
+00010390: 6b77 6172 6773 2061 6e64 206b 7761 7267  kwargs and kwarg
+000103a0: 735b 2273 6574 5f72 6f6f 745f 7061 7373  s["set_root_pass
+000103b0: 776f 7264 225d 2069 7320 6e6f 7420 4e6f  word"] is not No
+000103c0: 6e65 3a0a 2020 2020 2020 2020 656e 7673  ne:.        envs
+000103d0: 5b22 4445 4641 554c 545f 524f 4f54 5f50  ["DEFAULT_ROOT_P
+000103e0: 4153 5357 4f52 4422 5d20 3d20 6b77 6172  ASSWORD"] = kwar
+000103f0: 6773 5b22 7365 745f 726f 6f74 5f70 6173  gs["set_root_pas
+00010400: 7377 6f72 6422 5d0a 0a20 2020 2069 6620  sword"]..    if 
+00010410: 2273 6574 5f72 6f6f 745f 656d 6169 6c22  "set_root_email"
+00010420: 2069 6e20 6b77 6172 6773 2061 6e64 206b   in kwargs and k
+00010430: 7761 7267 735b 2273 6574 5f72 6f6f 745f  wargs["set_root_
+00010440: 656d 6169 6c22 5d20 6973 206e 6f74 204e  email"] is not N
+00010450: 6f6e 653a 0a20 2020 2020 2020 2065 6e76  one:.        env
+00010460: 735b 2244 4546 4155 4c54 5f52 4f4f 545f  s["DEFAULT_ROOT_
+00010470: 454d 4149 4c22 5d20 3d20 6b77 6172 6773  EMAIL"] = kwargs
+00010480: 5b22 7365 745f 726f 6f74 5f65 6d61 696c  ["set_root_email
+00010490: 225d 0a0a 2020 2020 6966 2022 7265 6c65  "]..    if "rele
+000104a0: 6173 6522 2069 6e20 6b77 6172 6773 3a0a  ase" in kwargs:.
+000104b0: 2020 2020 2020 2020 656e 7673 5b22 5245          envs["RE
+000104c0: 4c45 4153 4522 5d20 3d20 6b77 6172 6773  LEASE"] = kwargs
+000104d0: 5b22 7265 6c65 6173 6522 5d0a 0a20 2020  ["release"]..   
+000104e0: 2063 6d64 203d 2022 220a 2020 2020 6172   cmd = "".    ar
+000104f0: 6773 203d 205b 5d0a 2020 2020 666f 7220  gs = [].    for 
+00010500: 6b2c 2076 2069 6e20 656e 7673 2e69 7465  k, v in envs.ite
+00010510: 6d73 2829 3a0a 2020 2020 2020 2020 6966  ms():.        if
+00010520: 2069 735f 7769 6e64 6f77 7328 293a 0a20   is_windows():. 
+00010530: 2020 2020 2020 2020 2020 2023 2070 6f77             # pow
+00010540: 6572 7368 656c 6c20 656e 7673 0a20 2020  ershell envs.   
+00010550: 2020 2020 2020 2020 2071 756f 7465 6420           quoted 
+00010560: 3d20 6622 277b 767d 2722 2069 6620 6e6f  = f"'{v}'" if no
+00010570: 7420 6973 696e 7374 616e 6365 2876 2c20  t isinstance(v, 
+00010580: 696e 7429 2065 6c73 6520 760a 2020 2020  int) else v.    
+00010590: 2020 2020 2020 2020 6172 6773 2e61 7070          args.app
+000105a0: 656e 6428 6622 2465 6e76 3a7b 6b7d 3d7b  end(f"$env:{k}={
+000105b0: 7175 6f74 6564 7d22 290a 2020 2020 2020  quoted}").      
+000105c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000105d0: 2020 2020 6172 6773 2e61 7070 656e 6428      args.append(
+000105e0: 6622 7b6b 7d3d 7b76 7d22 290a 2020 2020  f"{k}={v}").    
+000105f0: 6966 2069 735f 7769 6e64 6f77 7328 293a  if is_windows():
+00010600: 0a20 2020 2020 2020 2063 6d64 202b 3d20  .        cmd += 
+00010610: 223b 2022 2e6a 6f69 6e28 6172 6773 290a  "; ".join(args).
+00010620: 2020 2020 2020 2020 636d 6420 2b3d 2022          cmd += "
+00010630: 3b20 220a 2020 2020 656c 7365 3a0a 2020  ; ".    else:.  
+00010640: 2020 2020 2020 636d 6420 2b3d 2022 2022        cmd += " "
+00010650: 2e6a 6f69 6e28 6172 6773 290a 0a20 2020  .join(args)..   
+00010660: 2063 6d64 202b 3d20 2220 646f 636b 6572   cmd += " docker
+00010670: 2063 6f6d 706f 7365 202d 7020 2220 2b20   compose -p " + 
+00010680: 736e 616b 655f 6e61 6d65 0a0a 2020 2020  snake_name..    
+00010690: 2320 6e65 7720 646f 636b 6572 2063 6f6d  # new docker com
+000106a0: 706f 7365 2072 6567 7265 7373 696f 6e20  pose regression 
+000106b0: 776f 726b 2061 726f 756e 640a 2020 2020  work around.    
+000106c0: 2320 6465 6661 756c 745f 656e 7620 3d20  # default_env = 
+000106d0: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+000106e0: 6572 2822 7e2f 2e68 6167 7269 642f 6170  er("~/.hagrid/ap
+000106f0: 702f 2e65 6e76 2229 0a20 2020 2064 6566  p/.env").    def
+00010700: 6175 6c74 5f65 6e76 203d 2066 227b 4752  ault_env = f"{GR
+00010710: 4944 5f53 5243 5f50 4154 487d 2f2e 656e  ID_SRC_PATH}/.en
+00010720: 7622 0a20 2020 2064 6566 6175 6c74 5f65  v".    default_e
+00010730: 6e76 7320 3d20 7b7d 0a20 2020 2077 6974  nvs = {}.    wit
+00010740: 6820 6f70 656e 2864 6566 6175 6c74 5f65  h open(default_e
+00010750: 6e76 2c20 2272 2229 2061 7320 663a 0a20  nv, "r") as f:. 
+00010760: 2020 2020 2020 2066 6f72 206c 696e 6520         for line 
+00010770: 696e 2066 2e72 6561 646c 696e 6573 2829  in f.readlines()
+00010780: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00010790: 2022 3d22 2069 6e20 6c69 6e65 3a0a 2020   "=" in line:.  
+000107a0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000107b0: 7274 7320 3d20 6c69 6e65 2e73 7472 6970  rts = line.strip
+000107c0: 2829 2e73 706c 6974 2822 3d22 290a 2020  ().split("=").  
+000107d0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+000107e0: 7920 3d20 7061 7274 735b 305d 0a20 2020  y = parts[0].   
+000107f0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00010800: 7565 203d 2022 220a 2020 2020 2020 2020  ue = "".        
+00010810: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
+00010820: 6172 7473 2920 3e20 313a 0a20 2020 2020  arts) > 1:.     
+00010830: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00010840: 616c 7565 203d 2070 6172 7473 5b31 5d0a  alue = parts[1].
+00010850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010860: 6465 6661 756c 745f 656e 7673 5b6b 6579  default_envs[key
+00010870: 5d20 3d20 7661 6c75 650a 2020 2020 6465  ] = value.    de
+00010880: 6661 756c 745f 656e 7673 2e75 7064 6174  fault_envs.updat
+00010890: 6528 656e 7673 290a 0a20 2020 2023 2065  e(envs)..    # e
+000108a0: 6e76 2066 696c 6520 7061 7468 0a20 2020  nv file path.   
+000108b0: 2065 6e76 5f66 696c 655f 7061 7468 203d   env_file_path =
+000108c0: 206f 732e 7061 7468 2e6a 6f69 6e28 4752   os.path.join(GR
+000108d0: 4944 5f53 5243 5f50 4154 482c 2022 2e65  ID_SRC_PATH, ".e
+000108e0: 6e76 6669 6c65 2229 0a0a 2020 2020 2320  nvfile")..    # 
+000108f0: 5265 6e64 6572 2074 656d 706c 6174 6573  Render templates
+00010900: 2069 6620 6372 6561 7469 6e67 2073 7461   if creating sta
+00010910: 636b 2066 726f 6d20 7468 6520 6d61 6e69  ck from the mani
+00010920: 6665 7374 5f74 656d 706c 6174 652e 796d  fest_template.ym
+00010930: 6c0a 2020 2020 6966 2066 726f 6d5f 7465  l.    if from_te
+00010940: 6d70 6c61 7465 2061 6e64 2068 6f73 745f  mplate and host_
+00010950: 7465 726d 2e68 6f73 7420 6973 206e 6f74  term.host is not
+00010960: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+00010970: 2049 6620 7265 6c65 6173 6520 6973 2064   If release is d
+00010980: 6576 656c 6f70 6d65 6e74 2c20 7570 6461  evelopment, upda
+00010990: 7465 2072 656c 6174 6976 6520 7061 7468  te relative path
+000109a0: 0a20 2020 2020 2020 2069 6620 4544 4954  .        if EDIT
+000109b0: 4142 4c45 5f4d 4f44 453a 0a20 2020 2020  ABLE_MODE:.     
+000109c0: 2020 2020 2020 2064 6566 6175 6c74 5f65         default_e
+000109d0: 6e76 735b 2252 454c 4154 4956 455f 5041  nvs["RELATIVE_PA
+000109e0: 5448 225d 203d 2022 2e2e 2f22 0a0a 2020  TH"] = "../"..  
+000109f0: 2020 2020 2020 7265 6e64 6572 5f74 656d        render_tem
+00010a00: 706c 6174 6573 280a 2020 2020 2020 2020  plates(.        
+00010a10: 2020 2020 656e 765f 7661 7273 3d64 6566      env_vars=def
+00010a20: 6175 6c74 5f65 6e76 732c 0a20 2020 2020  ault_envs,.     
+00010a30: 2020 2020 2020 2068 6f73 745f 7479 7065         host_type
+00010a40: 3d68 6f73 745f 7465 726d 2e68 6f73 742c  =host_term.host,
+00010a50: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00010a60: 2020 2020 656e 765f 6669 6c65 5f70 6174      env_file_pat
+00010a70: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+00010a80: 2847 5249 445f 5352 435f 5041 5448 2c20  (GRID_SRC_PATH, 
+00010a90: 5245 4e44 4552 4544 5f44 4952 2c20 222e  RENDERED_DIR, ".
+00010aa0: 656e 7666 696c 6522 290a 0a20 2020 2074  envfile")..    t
+00010ab0: 7279 3a0a 2020 2020 2020 2020 656e 765f  ry:.        env_
+00010ac0: 6669 6c65 203d 2022 220a 2020 2020 2020  file = "".      
+00010ad0: 2020 666f 7220 6b2c 2076 2069 6e20 6465    for k, v in de
+00010ae0: 6661 756c 745f 656e 7673 2e69 7465 6d73  fault_envs.items
+00010af0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00010b00: 656e 765f 6669 6c65 202b 3d20 6622 7b6b  env_file += f"{k
+00010b10: 7d3d 7b76 7d5c 6e22 0a0a 2020 2020 2020  }={v}\n"..      
+00010b20: 2020 7769 7468 206f 7065 6e28 656e 765f    with open(env_
+00010b30: 6669 6c65 5f70 6174 682c 2022 7722 2920  file_path, "w") 
+00010b40: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00010b50: 2020 662e 7772 6974 6528 656e 765f 6669    f.write(env_fi
+00010b60: 6c65 290a 0a20 2020 2020 2020 2063 6d64  le)..        cmd
+00010b70: 202b 3d20 6622 202d 2d65 6e76 2d66 696c   += f" --env-fil
+00010b80: 6520 7b65 6e76 5f66 696c 655f 7061 7468  e {env_file_path
+00010b90: 7d22 0a20 2020 2065 7863 6570 7420 4578  }".    except Ex
+00010ba0: 6365 7074 696f 6e3a 2020 2320 6e6f 7365  ception:  # nose
+00010bb0: 630a 2020 2020 2020 2020 7061 7373 0a0a  c.        pass..
+00010bc0: 2020 2020 6966 206e 6f64 655f 7479 7065      if node_type
+00010bd0: 2e69 6e70 7574 203d 3d20 2265 6e63 6c61  .input == "encla
+00010be0: 7665 223a 0a20 2020 2020 2020 2072 6574  ve":.        ret
+00010bf0: 7572 6e20 6372 6561 7465 5f6c 6175 6e63  urn create_launc
+00010c00: 685f 656e 636c 6176 655f 636d 6428 636d  h_enclave_cmd(cm
+00010c10: 643d 636d 642c 206b 7761 7267 733d 6b77  d=cmd, kwargs=kw
+00010c20: 6172 6773 2c20 6275 696c 643d 6275 696c  args, build=buil
+00010c30: 642c 2074 6169 6c3d 7461 696c 290a 0a20  d, tail=tail).. 
+00010c40: 2020 2069 6620 626f 6f6c 286b 7761 7267     if bool(kwarg
+00010c50: 735b 2276 706e 225d 293a 0a20 2020 2020  s["vpn"]):.     
+00010c60: 2020 2063 6d64 202b 3d20 2220 2d2d 7072     cmd += " --pr
+00010c70: 6f66 696c 6520 7670 6e22 0a0a 2020 2020  ofile vpn"..    
+00010c80: 6966 2073 7472 286e 6f64 655f 7479 7065  if str(node_type
+00010c90: 2e69 6e70 7574 2920 3d3d 2022 6e65 7477  .input) == "netw
+00010ca0: 6f72 6b22 3a0a 2020 2020 2020 2020 636d  ork":.        cm
+00010cb0: 6420 2b3d 2022 202d 2d70 726f 6669 6c65  d += " --profile
+00010cc0: 206e 6574 776f 726b 220a 0a20 2020 2069   network"..    i
+00010cd0: 6620 7573 655f 626c 6f62 5f73 746f 7261  f use_blob_stora
+00010ce0: 6765 3a0a 2020 2020 2020 2020 636d 6420  ge:.        cmd 
+00010cf0: 2b3d 2022 202d 2d70 726f 6669 6c65 2062  += " --profile b
+00010d00: 6c6f 622d 7374 6f72 6167 6522 0a0a 2020  lob-storage"..  
+00010d10: 2020 2320 6e6f 2066 726f 6e74 656e 6420    # no frontend 
+00010d20: 636f 6e74 6169 6e65 7220 736f 2065 7870  container so exp
+00010d30: 6563 7420 6261 6420 6761 7465 7761 7920  ect bad gateway 
+00010d40: 6f6e 2074 6865 202f 2072 6f75 7465 0a20  on the / route. 
+00010d50: 2020 2069 6620 6e6f 7420 626f 6f6c 286b     if not bool(k
+00010d60: 7761 7267 735b 2268 6561 646c 6573 7322  wargs["headless"
+00010d70: 5d29 3a0a 2020 2020 2020 2020 636d 6420  ]):.        cmd 
+00010d80: 2b3d 2022 202d 2d70 726f 6669 6c65 2066  += " --profile f
+00010d90: 726f 6e74 656e 6422 0a0a 2020 2020 6966  rontend"..    if
+00010da0: 2022 7472 6163 6522 2069 6e20 6b77 6172   "trace" in kwar
+00010db0: 6773 2061 6e64 206b 7761 7267 735b 2274  gs and kwargs["t
+00010dc0: 7261 6365 225d 3a0a 2020 2020 2020 2020  race"]:.        
+00010dd0: 636d 6420 2b3d 2022 202d 2d70 726f 6669  cmd += " --profi
+00010de0: 6c65 2074 656c 656d 6574 7279 220a 0a20  le telemetry".. 
+00010df0: 2020 2066 696e 616c 5f63 6f6d 6d61 6e64     final_command
+00010e00: 7320 3d20 7b7d 0a20 2020 2066 696e 616c  s = {}.    final
+00010e10: 5f63 6f6d 6d61 6e64 735b 2250 756c 6c69  _commands["Pulli
+00010e20: 6e67 225d 203d 2070 756c 6c5f 636f 6d6d  ng"] = pull_comm
+00010e30: 616e 6428 636d 642c 206b 7761 7267 7329  and(cmd, kwargs)
+00010e40: 0a0a 2020 2020 636d 6420 2b3d 2022 202d  ..    cmd += " -
+00010e50: 2d66 696c 6520 646f 636b 6572 2d63 6f6d  -file docker-com
+00010e60: 706f 7365 2e79 6d6c 220a 2020 2020 6966  pose.yml".    if
+00010e70: 2022 746c 7322 2069 6e20 6b77 6172 6773   "tls" in kwargs
+00010e80: 2061 6e64 206b 7761 7267 735b 2274 6c73   and kwargs["tls
+00010e90: 225d 2069 7320 5472 7565 3a0a 2020 2020  "] is True:.    
+00010ea0: 2020 2020 636d 6420 2b3d 2022 202d 2d66      cmd += " --f
+00010eb0: 696c 6520 646f 636b 6572 2d63 6f6d 706f  ile docker-compo
+00010ec0: 7365 2e74 6c73 2e79 6d6c 220a 2020 2020  se.tls.yml".    
+00010ed0: 6966 2022 7465 7374 2220 696e 206b 7761  if "test" in kwa
+00010ee0: 7267 7320 616e 6420 6b77 6172 6773 5b22  rgs and kwargs["
+00010ef0: 7465 7374 225d 2069 7320 5472 7565 3a0a  test"] is True:.
+00010f00: 2020 2020 2020 2020 636d 6420 2b3d 2022          cmd += "
+00010f10: 202d 2d66 696c 6520 646f 636b 6572 2d63   --file docker-c
+00010f20: 6f6d 706f 7365 2e74 6573 742e 796d 6c22  ompose.test.yml"
+00010f30: 0a0a 2020 2020 6966 2062 7569 6c64 3a0a  ..    if build:.
+00010f40: 2020 2020 2020 2020 6d79 5f62 7569 6c64          my_build
+00010f50: 5f63 6f6d 6d61 6e64 203d 2062 7569 6c64  _command = build
+00010f60: 5f63 6f6d 6d61 6e64 2863 6d64 290a 2020  _command(cmd).  
+00010f70: 2020 2020 2020 6669 6e61 6c5f 636f 6d6d        final_comm
+00010f80: 616e 6473 5b22 4275 696c 6469 6e67 225d  ands["Building"]
+00010f90: 203d 206d 795f 6275 696c 645f 636f 6d6d   = my_build_comm
+00010fa0: 616e 640a 0a20 2020 2072 656c 6561 7365  and..    release
+00010fb0: 5f74 7970 6520 3d20 6b77 6172 6773 5b22  _type = kwargs["
+00010fc0: 7265 6c65 6173 6522 5d0a 0a20 2020 2066  release"]..    f
+00010fd0: 696e 616c 5f63 6f6d 6d61 6e64 735b 224c  inal_commands["L
+00010fe0: 6175 6e63 6869 6e67 225d 203d 2064 6570  aunching"] = dep
+00010ff0: 6c6f 795f 636f 6d6d 616e 6428 636d 642c  loy_command(cmd,
+00011000: 2074 6169 6c2c 2072 656c 6561 7365 5f74   tail, release_t
+00011010: 7970 6529 0a20 2020 2072 6574 7572 6e20  ype).    return 
+00011020: 6669 6e61 6c5f 636f 6d6d 616e 6473 0a0a  final_commands..
+00011030: 0a64 6566 2063 7265 6174 655f 6c61 756e  .def create_laun
+00011040: 6368 5f65 6e63 6c61 7665 5f63 6d64 280a  ch_enclave_cmd(.
+00011050: 2020 2020 636d 643a 2073 7472 2c0a 2020      cmd: str,.  
+00011060: 2020 6b77 6172 6773 3a20 5479 7065 4469    kwargs: TypeDi
+00011070: 6374 5b73 7472 2c20 416e 795d 2c0a 2020  ct[str, Any],.  
+00011080: 2020 6275 696c 643a 2062 6f6f 6c2c 0a20    build: bool,. 
+00011090: 2020 2074 6169 6c3a 2062 6f6f 6c20 3d20     tail: bool = 
+000110a0: 5472 7565 2c0a 2920 2d3e 2054 7970 6544  True,.) -> TypeD
+000110b0: 6963 745b 7374 722c 2054 7970 654c 6973  ict[str, TypeLis
+000110c0: 745b 7374 725d 5d3a 0a20 2020 2072 656c  t[str]]:.    rel
+000110d0: 6561 7365 5f74 7970 6520 3d20 6b77 6172  ease_type = kwar
+000110e0: 6773 5b22 7265 6c65 6173 6522 5d0a 0a20  gs["release"].. 
+000110f0: 2020 2066 696e 616c 5f63 6f6d 6d61 6e64     final_command
+00011100: 7320 3d20 7b7d 0a20 2020 2066 696e 616c  s = {}.    final
+00011110: 5f63 6f6d 6d61 6e64 735b 2250 756c 6c69  _commands["Pulli
+00011120: 6e67 225d 203d 2070 756c 6c5f 636f 6d6d  ng"] = pull_comm
+00011130: 616e 6428 636d 642c 206b 7761 7267 7329  and(cmd, kwargs)
+00011140: 0a20 2020 2063 6d64 202b 3d20 2220 2d2d  .    cmd += " --
+00011150: 6669 6c65 2064 6f63 6b65 722d 636f 6d70  file docker-comp
+00011160: 6f73 652e 796d 6c22 0a0a 2020 2020 6966  ose.yml"..    if
+00011170: 2062 7569 6c64 3a0a 2020 2020 2020 2020   build:.        
+00011180: 6d79 5f62 7569 6c64 5f63 6f6d 6d61 6e64  my_build_command
+00011190: 203d 2062 7569 6c64 5f63 6f6d 6d61 6e64   = build_command
+000111a0: 2863 6d64 290a 2020 2020 2020 2020 6669  (cmd).        fi
+000111b0: 6e61 6c5f 636f 6d6d 616e 6473 5b22 4275  nal_commands["Bu
+000111c0: 696c 6469 6e67 225d 203d 206d 795f 6275  ilding"] = my_bu
+000111d0: 696c 645f 636f 6d6d 616e 640a 0a20 2020  ild_command..   
+000111e0: 2072 656c 6561 7365 5f74 7970 6520 3d20   release_type = 
+000111f0: 6b77 6172 6773 5b22 7265 6c65 6173 6522  kwargs["release"
+00011200: 5d0a 0a20 2020 2066 696e 616c 5f63 6f6d  ]..    final_com
+00011210: 6d61 6e64 735b 224c 6175 6e63 6869 6e67  mands["Launching
+00011220: 225d 203d 2064 6570 6c6f 795f 636f 6d6d  "] = deploy_comm
+00011230: 616e 6428 636d 642c 2074 6169 6c2c 2072  and(cmd, tail, r
+00011240: 656c 6561 7365 5f74 7970 6529 0a20 2020  elease_type).   
+00011250: 2072 6574 7572 6e20 6669 6e61 6c5f 636f   return final_co
+00011260: 6d6d 616e 6473 0a0a 0a64 6566 2063 7265  mmands...def cre
+00011270: 6174 655f 6c61 756e 6368 5f76 6167 7261  ate_launch_vagra
+00011280: 6e74 5f63 6d64 2876 6572 623a 2047 7261  nt_cmd(verb: Gra
+00011290: 6d6d 6172 5665 7262 2920 2d3e 2073 7472  mmarVerb) -> str
+000112a0: 3a0a 2020 2020 686f 7374 5f74 6572 6d20  :.    host_term 
+000112b0: 3d20 7665 7262 2e67 6574 5f6e 616d 6564  = verb.get_named
+000112c0: 5f74 6572 6d5f 686f 7374 6772 616d 6d61  _term_hostgramma
+000112d0: 7228 6e61 6d65 3d22 686f 7374 2229 0a20  r(name="host"). 
+000112e0: 2020 206e 6f64 655f 6e61 6d65 203d 2076     node_name = v
+000112f0: 6572 622e 6765 745f 6e61 6d65 645f 7465  erb.get_named_te
+00011300: 726d 5f74 7970 6528 6e61 6d65 3d22 6e6f  rm_type(name="no
+00011310: 6465 5f6e 616d 6522 290a 2020 2020 6e6f  de_name").    no
+00011320: 6465 5f74 7970 6520 3d20 7665 7262 2e67  de_type = verb.g
+00011330: 6574 5f6e 616d 6564 5f74 6572 6d5f 7479  et_named_term_ty
+00011340: 7065 286e 616d 653d 226e 6f64 655f 7479  pe(name="node_ty
+00011350: 7065 2229 0a0a 2020 2020 736e 616b 655f  pe")..    snake_
+00011360: 6e61 6d65 203d 2073 7472 286e 6f64 655f  name = str(node_
+00011370: 6e61 6d65 2e73 6e61 6b65 5f69 6e70 7574  name.snake_input
+00011380: 290a 0a20 2020 2069 6620 4152 543a 0a20  )..    if ART:. 
+00011390: 2020 2020 2020 2068 6167 7269 6428 290a         hagrid().
+000113a0: 0a20 2020 2070 7269 6e74 280a 2020 2020  .    print(.    
+000113b0: 2020 2020 224c 6175 6e63 6869 6e67 2061      "Launching a
+000113c0: 2022 0a20 2020 2020 2020 202b 2073 7472   ".        + str
+000113d0: 286e 6f64 655f 7479 7065 2e69 6e70 7574  (node_type.input
+000113e0: 290a 2020 2020 2020 2020 2b20 2220 5079  ).        + " Py
+000113f0: 4772 6964 206e 6f64 6520 6f6e 2070 6f72  Grid node on por
+00011400: 7420 220a 2020 2020 2020 2020 2b20 7374  t ".        + st
+00011410: 7228 686f 7374 5f74 6572 6d2e 706f 7274  r(host_term.port
+00011420: 290a 2020 2020 2020 2020 2b20 2221 5c6e  ).        + "!\n
+00011430: 220a 2020 2020 290a 0a20 2020 2070 7269  ".    )..    pri
+00011440: 6e74 2822 2020 2d20 5459 5045 3a20 2220  nt("  - TYPE: " 
+00011450: 2b20 7374 7228 6e6f 6465 5f74 7970 652e  + str(node_type.
+00011460: 696e 7075 7429 290a 2020 2020 7072 696e  input)).    prin
+00011470: 7428 2220 202d 204e 414d 453a 2022 202b  t("  - NAME: " +
+00011480: 2073 7472 2873 6e61 6b65 5f6e 616d 6529   str(snake_name)
+00011490: 290a 2020 2020 7072 696e 7428 2220 202d  ).    print("  -
+000114a0: 2050 4f52 543a 2022 202b 2073 7472 2868   PORT: " + str(h
+000114b0: 6f73 745f 7465 726d 2e70 6f72 7429 290a  ost_term.port)).
+000114c0: 2020 2020 2320 7072 696e 7428 2220 202d      # print("  -
+000114d0: 2056 4147 5241 4e54 3a20 2220 2b20 2231   VAGRANT: " + "1
+000114e0: 2229 0a20 2020 2023 2070 7269 6e74 2822  ").    # print("
+000114f0: 2020 2d20 5649 5254 5541 4c42 4f58 3a20    - VIRTUALBOX: 
+00011500: 2220 2b20 2231 2229 0a20 2020 2070 7269  " + "1").    pri
+00011510: 6e74 2822 5c6e 2229 0a0a 2020 2020 636d  nt("\n")..    cm
+00011520: 6420 3d20 2222 0a20 2020 2063 6d64 202b  d = "".    cmd +
+00011530: 3d20 2741 4e53 4942 4c45 5f41 5247 533d  = 'ANSIBLE_ARGS=
+00011540: 2227 0a20 2020 2063 6d64 202b 3d20 6622  "'.    cmd += f"
+00011550: 2d65 2027 6e6f 6465 5f6e 616d 653d 7b73  -e 'node_name={s
+00011560: 6e61 6b65 5f6e 616d 657d 2722 0a20 2020  nake_name}'".   
+00011570: 2063 6d64 202b 3d20 6622 2d65 2027 6e6f   cmd += f"-e 'no
+00011580: 6465 5f74 7970 653d 7b6e 6f64 655f 7479  de_type={node_ty
+00011590: 7065 2e69 6e70 7574 7d27 220a 2020 2020  pe.input}'".    
+000115a0: 636d 6420 2b3d 2027 2220 270a 2020 2020  cmd += '" '.    
+000115b0: 636d 6420 2b3d 2022 7661 6772 616e 7420  cmd += "vagrant 
+000115c0: 7570 202d 2d70 726f 7669 7369 6f6e 220a  up --provision".
+000115d0: 2020 2020 636d 6420 3d20 2263 6420 2220      cmd = "cd " 
+000115e0: 2b20 4752 4944 5f53 5243 5f50 4154 4820  + GRID_SRC_PATH 
+000115f0: 2b20 223b 2220 2b20 636d 640a 2020 2020  + ";" + cmd.    
+00011600: 7265 7475 726e 2063 6d64 0a0a 0a64 6566  return cmd...def
+00011610: 2067 6574 5f6f 725f 6d61 6b65 5f72 6573   get_or_make_res
+00011620: 6f75 7263 655f 6772 6f75 7028 7265 736f  ource_group(reso
+00011630: 7572 6365 5f67 726f 7570 3a20 7374 722c  urce_group: str,
+00011640: 206c 6f63 6174 696f 6e3a 2073 7472 203d   location: str =
+00011650: 2022 7765 7374 7573 2229 202d 3e20 4e6f   "westus") -> No
+00011660: 6e65 3a0a 2020 2020 636d 6420 3d20 6622  ne:.    cmd = f"
+00011670: 617a 2067 726f 7570 2073 686f 7720 2d2d  az group show --
+00011680: 7265 736f 7572 6365 2d67 726f 7570 207b  resource-group {
+00011690: 7265 736f 7572 6365 5f67 726f 7570 7d22  resource_group}"
+000116a0: 0a20 2020 2065 7869 7374 7320 3d20 5472  .    exists = Tr
+000116b0: 7565 0a20 2020 2074 7279 3a0a 2020 2020  ue.    try:.    
+000116c0: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
+000116d0: 6865 636b 5f63 616c 6c28 636d 642c 2073  heck_call(cmd, s
+000116e0: 6865 6c6c 3d54 7275 6529 2020 2320 6e6f  hell=True)  # no
+000116f0: 7365 630a 2020 2020 6578 6365 7074 2045  sec.    except E
+00011700: 7863 6570 7469 6f6e 3a20 2023 206e 6f73  xception:  # nos
+00011710: 6563 0a20 2020 2020 2020 2023 2067 726f  ec.        # gro
+00011720: 7570 2064 6f65 736e 2774 2065 7869 7374  up doesn't exist
+00011730: 2073 6f20 6c65 7473 2063 7265 6174 6520   so lets create 
+00011740: 6974 0a20 2020 2020 2020 2065 7869 7374  it.        exist
+00011750: 7320 3d20 4661 6c73 650a 0a20 2020 2069  s = False..    i
+00011760: 6620 6e6f 7420 6578 6973 7473 3a0a 2020  f not exists:.  
+00011770: 2020 2020 2020 636d 6420 3d20 6622 617a        cmd = f"az
+00011780: 2067 726f 7570 2063 7265 6174 6520 2d6c   group create -l
+00011790: 207b 6c6f 6361 7469 6f6e 7d20 2d6e 207b   {location} -n {
+000117a0: 7265 736f 7572 6365 5f67 726f 7570 7d22  resource_group}"
+000117b0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000117c0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000117d0: 6622 4372 6561 7469 6e67 2072 6573 6f75  f"Creating resou
+000117e0: 7263 6520 6772 6f75 702e 5c6e 5275 6e6e  rce group.\nRunn
+000117f0: 696e 673a 207b 636d 647d 2229 0a20 2020  ing: {cmd}").   
+00011800: 2020 2020 2020 2020 2073 7562 7072 6f63           subproc
+00011810: 6573 732e 6368 6563 6b5f 6361 6c6c 2863  ess.check_call(c
+00011820: 6d64 2c20 7368 656c 6c3d 5472 7565 2920  md, shell=True) 
+00011830: 2023 206e 6f73 6563 0a20 2020 2020 2020   # nosec.       
+00011840: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00011850: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00011860: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+00011870: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00011880: 2020 2020 2066 2255 6e61 626c 6520 746f       f"Unable to
+00011890: 2063 7265 6174 6520 7265 736f 7572 6365   create resource
+000118a0: 2067 726f 7570 207b 7265 736f 7572 6365   group {resource
+000118b0: 5f67 726f 7570 7d20 4020 7b6c 6f63 6174  _group} @ {locat
+000118c0: 696f 6e7d 2e20 7b65 7d22 0a20 2020 2020  ion}. {e}".     
+000118d0: 2020 2020 2020 2029 0a0a 0a64 6566 2065         )...def e
+000118e0: 7874 7261 6374 5f68 6f73 745f 6970 2873  xtract_host_ip(s
+000118f0: 7464 6f75 743a 2062 7974 6573 2920 2d3e  tdout: bytes) ->
+00011900: 204f 7074 696f 6e61 6c5b 7374 725d 3a0a   Optional[str]:.
+00011910: 2020 2020 6f75 7470 7574 203d 2073 7464      output = std
+00011920: 6f75 742e 6465 636f 6465 2822 7574 662d  out.decode("utf-
+00011930: 3822 290a 0a20 2020 2074 7279 3a0a 2020  8")..    try:.  
+00011940: 2020 2020 2020 6a20 3d20 6a73 6f6e 2e6c        j = json.l
+00011950: 6f61 6473 286f 7574 7075 7429 0a20 2020  oads(output).   
+00011960: 2020 2020 2069 6620 2270 7562 6c69 6349       if "publicI
+00011970: 7041 6464 7265 7373 2220 696e 206a 3a0a  pAddress" in j:.
+00011980: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011990: 726e 2073 7472 286a 5b22 7075 626c 6963  rn str(j["public
+000119a0: 4970 4164 6472 6573 7322 5d29 0a20 2020  IpAddress"]).   
+000119b0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000119c0: 6e3a 2020 2320 6e6f 7365 630a 2020 2020  n:  # nosec.    
+000119d0: 2020 2020 6d61 7463 6865 7220 3d20 7227      matcher = r'
+000119e0: 7075 626c 6963 4970 4164 6472 6573 7322  publicIpAddress"
+000119f0: 3a5c 732b 2228 2e2b 2922 270a 2020 2020  :\s+"(.+)"'.    
+00011a00: 2020 2020 6970 7320 3d20 7265 2e66 696e      ips = re.fin
+00011a10: 6461 6c6c 286d 6174 6368 6572 2c20 6f75  dall(matcher, ou
+00011a20: 7470 7574 290a 2020 2020 2020 2020 6966  tput).        if
+00011a30: 206c 656e 2869 7073 2920 3e20 303a 0a20   len(ips) > 0:. 
+00011a40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011a50: 6e20 6970 735b 305d 0a0a 2020 2020 7265  n ips[0]..    re
+00011a60: 7475 726e 204e 6f6e 650a 0a0a 6465 6620  turn None...def 
+00011a70: 6765 745f 766d 5f68 6f73 745f 6970 7328  get_vm_host_ips(
+00011a80: 6e6f 6465 5f6e 616d 653a 2073 7472 2c20  node_name: str, 
+00011a90: 7265 736f 7572 6365 5f67 726f 7570 3a20  resource_group: 
+00011aa0: 7374 7229 202d 3e20 4f70 7469 6f6e 616c  str) -> Optional
+00011ab0: 5b54 7970 654c 6973 745d 3a0a 2020 2020  [TypeList]:.    
+00011ac0: 636d 6420 3d20 6622 617a 2076 6d20 6c69  cmd = f"az vm li
+00011ad0: 7374 2d69 702d 6164 6472 6573 7365 7320  st-ip-addresses 
+00011ae0: 2d67 207b 7265 736f 7572 6365 5f67 726f  -g {resource_gro
+00011af0: 7570 7d20 2d2d 7175 6572 7920 220a 2020  up} --query ".  
+00011b00: 2020 636d 6420 2b3d 2066 2222 2222 5b3f    cmd += f""""[?
+00011b10: 7374 6172 7473 5f77 6974 6828 7669 7274  starts_with(virt
+00011b20: 7561 6c4d 6163 6869 6e65 2e6e 616d 652c  ualMachine.name,
+00011b30: 2027 7b6e 6f64 655f 6e61 6d65 7d27 295d   '{node_name}')]
+00011b40: 2222 220a 2020 2020 636d 6420 2b3d 2027  """.    cmd += '
+00011b50: 2727 2e76 6972 7475 616c 4d61 6368 696e  ''.virtualMachin
+00011b60: 652e 6e65 7477 6f72 6b2e 7075 626c 6963  e.network.public
+00011b70: 4970 4164 6472 6573 7365 735b 305d 2e69  IpAddresses[0].i
+00011b80: 7041 6464 7265 7373 2227 2727 0a20 2020  pAddress"'''.   
+00011b90: 206f 7574 7075 7420 3d20 7375 6270 726f   output = subpro
+00011ba0: 6365 7373 2e63 6865 636b 5f6f 7574 7075  cess.check_outpu
+00011bb0: 7428 636d 642c 2073 6865 6c6c 3d54 7275  t(cmd, shell=Tru
+00011bc0: 6529 2020 2320 6e6f 7365 630a 2020 2020  e)  # nosec.    
+00011bd0: 7472 793a 0a20 2020 2020 2020 2068 6f73  try:.        hos
+00011be0: 745f 6970 7320 3d20 6a73 6f6e 2e6c 6f61  t_ips = json.loa
+00011bf0: 6473 286f 7574 7075 7429 0a20 2020 2020  ds(output).     
+00011c00: 2020 2072 6574 7572 6e20 686f 7374 5f69     return host_i
+00011c10: 7073 0a20 2020 2065 7863 6570 7420 4578  ps.    except Ex
+00011c20: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+00011c30: 2020 2020 2020 7072 696e 7428 6622 4661        print(f"Fa
+00011c40: 696c 6564 2074 6f20 6578 7472 6163 7420  iled to extract 
+00011c50: 6970 733a 207b 657d 2229 0a0a 2020 2020  ips: {e}")..    
+00011c60: 7265 7475 726e 204e 6f6e 650a 0a0a 6465  return None...de
+00011c70: 6620 6973 5f76 616c 6964 5f69 7028 686f  f is_valid_ip(ho
+00011c80: 7374 5f6f 725f 6970 3a20 7374 7229 202d  st_or_ip: str) -
+00011c90: 3e20 626f 6f6c 3a0a 2020 2020 6d61 7463  > bool:.    matc
+00011ca0: 6865 7220 3d20 7222 283f 3a5b 302d 395d  her = r"(?:[0-9]
+00011cb0: 7b31 2c33 7d5c 2e29 7b33 7d5b 302d 395d  {1,3}\.){3}[0-9]
+00011cc0: 7b31 2c33 7d22 0a20 2020 2069 7073 203d  {1,3}".    ips =
+00011cd0: 2072 652e 6669 6e64 616c 6c28 6d61 7463   re.findall(matc
+00011ce0: 6865 722c 2068 6f73 745f 6f72 5f69 702e  her, host_or_ip.
+00011cf0: 7374 7269 7028 2929 0a20 2020 2069 6620  strip()).    if 
+00011d00: 6c65 6e28 6970 7329 203d 3d20 313a 0a20  len(ips) == 1:. 
+00011d10: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00011d20: 7565 0a20 2020 2072 6574 7572 6e20 4661  ue.    return Fa
+00011d30: 6c73 650a 0a0a 6465 6620 6578 7472 6163  lse...def extrac
+00011d40: 745f 686f 7374 5f69 705f 6763 7028 7374  t_host_ip_gcp(st
+00011d50: 646f 7574 3a20 6279 7465 7329 202d 3e20  dout: bytes) -> 
+00011d60: 4f70 7469 6f6e 616c 5b73 7472 5d3a 0a20  Optional[str]:. 
+00011d70: 2020 206f 7574 7075 7420 3d20 7374 646f     output = stdo
+00011d80: 7574 2e64 6563 6f64 6528 2275 7466 2d38  ut.decode("utf-8
+00011d90: 2229 0a0a 2020 2020 7472 793a 0a20 2020  ")..    try:.   
+00011da0: 2020 2020 206d 6174 6368 6572 203d 2072       matcher = r
+00011db0: 2228 3f3a 5b30 2d39 5d7b 312c 337d 5c2e  "(?:[0-9]{1,3}\.
+00011dc0: 297b 337d 5b30 2d39 5d7b 312c 337d 220a  ){3}[0-9]{1,3}".
+00011dd0: 2020 2020 2020 2020 6970 7320 3d20 7265          ips = re
+00011de0: 2e66 696e 6461 6c6c 286d 6174 6368 6572  .findall(matcher
+00011df0: 2c20 6f75 7470 7574 290a 2020 2020 2020  , output).      
+00011e00: 2020 6966 206c 656e 2869 7073 2920 3d3d    if len(ips) ==
+00011e10: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00011e20: 7265 7475 726e 2069 7073 5b31 5d0a 2020  return ips[1].  
+00011e30: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00011e40: 6f6e 3a20 2023 206e 6f73 6563 0a20 2020  on:  # nosec.   
+00011e50: 2020 2020 2070 6173 730a 0a20 2020 2072       pass..    r
+00011e60: 6574 7572 6e20 4e6f 6e65 0a0a 0a64 6566  eturn None...def
+00011e70: 2065 7874 7261 6374 5f68 6f73 745f 6970   extract_host_ip
+00011e80: 5f66 726f 6d5f 636d 6428 636d 643a 2073  _from_cmd(cmd: s
+00011e90: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
+00011ea0: 7374 725d 3a0a 2020 2020 7472 793a 0a20  str]:.    try:. 
+00011eb0: 2020 2020 2020 206d 6174 6368 6572 203d         matcher =
+00011ec0: 2072 2228 3f3a 5b30 2d39 5d7b 312c 337d   r"(?:[0-9]{1,3}
+00011ed0: 5c2e 297b 337d 5b30 2d39 5d7b 312c 337d  \.){3}[0-9]{1,3}
+00011ee0: 220a 2020 2020 2020 2020 6970 7320 3d20  ".        ips = 
+00011ef0: 7265 2e66 696e 6461 6c6c 286d 6174 6368  re.findall(match
+00011f00: 6572 2c20 636d 6429 0a20 2020 2020 2020  er, cmd).       
+00011f10: 2069 6620 6970 733a 0a20 2020 2020 2020   if ips:.       
+00011f20: 2020 2020 2072 6574 7572 6e20 6970 735b       return ips[
+00011f30: 305d 0a20 2020 2065 7863 6570 7420 4578  0].    except Ex
+00011f40: 6365 7074 696f 6e3a 2020 2320 6e6f 7365  ception:  # nose
+00011f50: 630a 2020 2020 2020 2020 7061 7373 0a0a  c.        pass..
+00011f60: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00011f70: 0a0a 6465 6620 6368 6563 6b5f 6970 5f66  ..def check_ip_f
+00011f80: 6f72 5f73 7368 280a 2020 2020 686f 7374  or_ssh(.    host
+00011f90: 5f69 703a 2073 7472 2c20 7469 6d65 6f75  _ip: str, timeou
+00011fa0: 743a 2069 6e74 203d 2036 3030 2c20 7761  t: int = 600, wa
+00011fb0: 6974 5f74 696d 653a 2069 6e74 203d 2035  it_time: int = 5
+00011fc0: 2c20 7369 6c65 6e74 3a20 626f 6f6c 203d  , silent: bool =
+00011fd0: 2046 616c 7365 0a29 202d 3e20 626f 6f6c   False.) -> bool
+00011fe0: 3a0a 2020 2020 6966 206e 6f74 2073 696c  :.    if not sil
+00011ff0: 656e 743a 0a20 2020 2020 2020 2070 7269  ent:.        pri
+00012000: 6e74 2866 2243 6865 636b 696e 6720 564d  nt(f"Checking VM
+00012010: 2061 7420 7b68 6f73 745f 6970 7d20 6973   at {host_ip} is
+00012020: 2075 7022 290a 2020 2020 6368 6563 6b73   up").    checks
+00012030: 203d 2069 6e74 2874 696d 656f 7574 202f   = int(timeout /
+00012040: 2077 6169 745f 7469 6d65 2920 2023 2031   wait_time)  # 1
+00012050: 3020 6d69 6e75 7465 7320 696e 2035 2073  0 minutes in 5 s
+00012060: 6563 6f6e 6420 6368 756e 6b73 0a20 2020  econd chunks.   
+00012070: 2066 6972 7374 5f72 756e 203d 2054 7275   first_run = Tru
+00012080: 650a 2020 2020 7768 696c 6520 6368 6563  e.    while chec
+00012090: 6b73 203e 2030 3a0a 2020 2020 2020 2020  ks > 0:.        
+000120a0: 6368 6563 6b73 202d 3d20 310a 2020 2020  checks -= 1.    
+000120b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000120c0: 2020 2020 2073 6f63 6b20 3d20 736f 636b       sock = sock
+000120d0: 6574 2e73 6f63 6b65 7428 736f 636b 6574  et.socket(socket
+000120e0: 2e41 465f 494e 4554 2c20 736f 636b 6574  .AF_INET, socket
+000120f0: 2e53 4f43 4b5f 5354 5245 414d 290a 2020  .SOCK_STREAM).  
+00012100: 2020 2020 2020 2020 2020 736f 636b 2e73            sock.s
+00012110: 6574 7469 6d65 6f75 7428 7761 6974 5f74  ettimeout(wait_t
+00012120: 696d 6529 0a20 2020 2020 2020 2020 2020  ime).           
+00012130: 2072 6573 756c 7420 3d20 736f 636b 2e63   result = sock.c
+00012140: 6f6e 6e65 6374 5f65 7828 2868 6f73 745f  onnect_ex((host_
+00012150: 6970 2c20 3232 2929 0a20 2020 2020 2020  ip, 22)).       
+00012160: 2020 2020 2073 6f63 6b2e 636c 6f73 6528       sock.close(
+00012170: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00012180: 2072 6573 756c 7420 3d3d 2030 3a0a 2020   result == 0:.  
+00012190: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000121a0: 206e 6f74 2073 696c 656e 743a 0a20 2020   not silent:.   
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 2070 7269 6e74 2866 2256 4d20 6174 207b   print(f"VM at {
+000121d0: 686f 7374 5f69 707d 2069 7320 7570 2122  host_ip} is up!"
+000121e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000121f0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+00012200: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012220: 6966 2066 6972 7374 5f72 756e 3a0a 2020  if first_run:.  
+00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012240: 2020 6966 206e 6f74 2073 696c 656e 743a    if not silent:
+00012250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012260: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00012270: 5761 6974 696e 6720 666f 7220 564d 2074  Waiting for VM t
+00012280: 6f20 7374 6172 7422 2c20 656e 643d 2222  o start", end=""
+00012290: 2c20 666c 7573 683d 5472 7565 290a 2020  , flush=True).  
+000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122b0: 2020 6669 7273 745f 7275 6e20 3d20 4661    first_run = Fa
+000122c0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000122d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000122e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000122f0: 206e 6f74 2073 696c 656e 743a 0a20 2020   not silent:.   
+00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012310: 2020 2020 2070 7269 6e74 2822 2e22 2c20       print(".", 
+00012320: 656e 643d 2222 2c20 666c 7573 683d 5472  end="", flush=Tr
+00012330: 7565 290a 2020 2020 2020 2020 6578 6365  ue).        exce
+00012340: 7074 2045 7863 6570 7469 6f6e 3a20 2023  pt Exception:  #
+00012350: 206e 6f73 6563 0a20 2020 2020 2020 2020   nosec.         
+00012360: 2020 2070 6173 730a 2020 2020 7265 7475     pass.    retu
+00012370: 726e 2046 616c 7365 0a0a 0a64 6566 2063  rn False...def c
+00012380: 7265 6174 655f 6177 735f 7365 6375 7269  reate_aws_securi
+00012390: 7479 5f67 726f 7570 280a 2020 2020 7365  ty_group(.    se
+000123a0: 6375 7269 7479 5f67 726f 7570 5f6e 616d  curity_group_nam
+000123b0: 653a 2073 7472 2c20 7265 6769 6f6e 3a20  e: str, region: 
+000123c0: 7374 722c 2073 6e61 6b65 5f6e 616d 653a  str, snake_name:
+000123d0: 2073 7472 0a29 202d 3e20 7374 723a 0a20   str.) -> str:. 
+000123e0: 2020 2073 675f 6465 7363 7269 7074 696f     sg_descriptio
+000123f0: 6e20 3d20 6622 7b73 6e61 6b65 5f6e 616d  n = f"{snake_nam
+00012400: 657d 2073 6563 7572 6974 7920 6772 6f75  e} security grou
+00012410: 7022 0a20 2020 2063 7265 6174 655f 636d  p".    create_cm
+00012420: 6420 3d20 6622 6177 7320 6563 3220 6372  d = f"aws ec2 cr
+00012430: 6561 7465 2d73 6563 7572 6974 792d 6772  eate-security-gr
+00012440: 6f75 7020 2d2d 6772 6f75 702d 6e61 6d65  oup --group-name
+00012450: 207b 7365 6375 7269 7479 5f67 726f 7570   {security_group
+00012460: 5f6e 616d 657d 2022 0a20 2020 2063 7265  _name} ".    cre
+00012470: 6174 655f 636d 6420 2b3d 2066 272d 2d72  ate_cmd += f'--r
+00012480: 6567 696f 6e20 7b72 6567 696f 6e7d 202d  egion {region} -
+00012490: 2d64 6573 6372 6970 7469 6f6e 2022 7b73  -description "{s
+000124a0: 675f 6465 7363 7269 7074 696f 6e7d 2220  g_description}" 
+000124b0: 270a 2020 2020 7367 5f6f 7574 7075 7420  '.    sg_output 
+000124c0: 3d20 7375 6270 726f 6365 7373 2e63 6865  = subprocess.che
+000124d0: 636b 5f6f 7574 7075 7428 2020 2320 6e6f  ck_output(  # no
+000124e0: 7365 630a 2020 2020 2020 2020 6372 6561  sec.        crea
+000124f0: 7465 5f63 6d64 2c0a 2020 2020 2020 2020  te_cmd,.        
+00012500: 7368 656c 6c3d 5472 7565 2c0a 2020 2020  shell=True,.    
+00012510: 290a 2020 2020 7367 5f6f 7574 7075 745f  ).    sg_output_
+00012520: 6469 6374 203d 206a 736f 6e2e 6c6f 6164  dict = json.load
+00012530: 7328 7367 5f6f 7574 7075 7429 0a20 2020  s(sg_output).   
+00012540: 2069 6620 2247 726f 7570 4964 2220 696e   if "GroupId" in
+00012550: 2073 675f 6f75 7470 7574 5f64 6963 743a   sg_output_dict:
+00012560: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012570: 7367 5f6f 7574 7075 745f 6469 6374 5b22  sg_output_dict["
+00012580: 4772 6f75 7049 6422 5d0a 0a20 2020 2072  GroupId"]..    r
+00012590: 6574 7572 6e20 2222 0a0a 0a64 6566 206f  eturn ""...def o
+000125a0: 7065 6e5f 706f 7274 5f61 7773 280a 2020  pen_port_aws(.  
+000125b0: 2020 7365 6375 7269 7479 5f67 726f 7570    security_group
+000125c0: 5f6e 616d 653a 2073 7472 2c20 706f 7274  _name: str, port
+000125d0: 5f6e 6f3a 2069 6e74 2c20 6369 6472 3a20  _no: int, cidr: 
+000125e0: 7374 722c 2072 6567 696f 6e3a 2073 7472  str, region: str
+000125f0: 0a29 202d 3e20 4e6f 6e65 3a0a 2020 2020  .) -> None:.    
+00012600: 636d 6420 3d20 6622 6177 7320 6563 3220  cmd = f"aws ec2 
+00012610: 6175 7468 6f72 697a 652d 7365 6375 7269  authorize-securi
+00012620: 7479 2d67 726f 7570 2d69 6e67 7265 7373  ty-group-ingress
+00012630: 202d 2d67 726f 7570 2d6e 616d 6520 7b73   --group-name {s
+00012640: 6563 7572 6974 795f 6772 6f75 705f 6e61  ecurity_group_na
+00012650: 6d65 7d20 2d2d 7072 6f74 6f63 6f6c 2074  me} --protocol t
+00012660: 6370 2022 0a20 2020 2063 6d64 202b 3d20  cp ".    cmd += 
+00012670: 6622 2d2d 706f 7274 207b 706f 7274 5f6e  f"--port {port_n
+00012680: 6f7d 202d 2d63 6964 7220 7b63 6964 727d  o} --cidr {cidr}
+00012690: 202d 2d72 6567 696f 6e20 7b72 6567 696f   --region {regio
+000126a0: 6e7d 220a 2020 2020 7375 6270 726f 6365  n}".    subproce
+000126b0: 7373 2e63 6865 636b 5f63 616c 6c28 2020  ss.check_call(  
+000126c0: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
+000126d0: 636d 642c 0a20 2020 2020 2020 2073 6865  cmd,.        she
+000126e0: 6c6c 3d54 7275 652c 0a20 2020 2029 0a0a  ll=True,.    )..
+000126f0: 0a64 6566 2065 7874 7261 6374 5f69 6e73  .def extract_ins
+00012700: 7461 6e63 655f 6964 735f 6177 7328 7374  tance_ids_aws(st
+00012710: 646f 7574 3a20 6279 7465 7329 202d 3e20  dout: bytes) -> 
+00012720: 5479 7065 4c69 7374 3a0a 2020 2020 6f75  TypeList:.    ou
+00012730: 7470 7574 203d 2073 7464 6f75 742e 6465  tput = stdout.de
+00012740: 636f 6465 2822 7574 662d 3822 290a 2020  code("utf-8").  
+00012750: 2020 6f75 7470 7574 5f64 6963 7420 3d20    output_dict = 
+00012760: 6a73 6f6e 2e6c 6f61 6473 286f 7574 7075  json.loads(outpu
+00012770: 7429 0a20 2020 2069 6e73 7461 6e63 655f  t).    instance_
+00012780: 6964 733a 2054 7970 654c 6973 7420 3d20  ids: TypeList = 
+00012790: 5b5d 0a20 2020 2069 6620 2249 6e73 7461  [].    if "Insta
+000127a0: 6e63 6573 2220 696e 206f 7574 7075 745f  nces" in output_
+000127b0: 6469 6374 3a0a 2020 2020 2020 2020 666f  dict:.        fo
+000127c0: 7220 6563 325f 696e 7374 616e 6365 5f6d  r ec2_instance_m
+000127d0: 6574 6164 6174 6120 696e 206f 7574 7075  etadata in outpu
+000127e0: 745f 6469 6374 5b22 496e 7374 616e 6365  t_dict["Instance
+000127f0: 7322 5d3a 0a20 2020 2020 2020 2020 2020  s"]:.           
+00012800: 2069 6620 2249 6e73 7461 6e63 6549 6422   if "InstanceId"
+00012810: 2069 6e20 6563 325f 696e 7374 616e 6365   in ec2_instance
+00012820: 5f6d 6574 6164 6174 613a 0a20 2020 2020  _metadata:.     
+00012830: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
+00012840: 6e63 655f 6964 732e 6170 7065 6e64 2865  nce_ids.append(e
+00012850: 6332 5f69 6e73 7461 6e63 655f 6d65 7461  c2_instance_meta
+00012860: 6461 7461 5b22 496e 7374 616e 6365 4964  data["InstanceId
+00012870: 225d 290a 0a20 2020 2072 6574 7572 6e20  "])..    return 
+00012880: 696e 7374 616e 6365 5f69 6473 0a0a 0a64  instance_ids...d
+00012890: 6566 2067 6574 5f68 6f73 745f 6970 735f  ef get_host_ips_
+000128a0: 6769 7665 6e5f 696e 7374 616e 6365 5f69  given_instance_i
+000128b0: 6473 280a 2020 2020 696e 7374 616e 6365  ds(.    instance
+000128c0: 5f69 6473 3a20 5479 7065 4c69 7374 2c20  _ids: TypeList, 
+000128d0: 7469 6d65 6f75 743a 2069 6e74 203d 2036  timeout: int = 6
+000128e0: 3030 2c20 7761 6974 5f74 696d 653a 2069  00, wait_time: i
+000128f0: 6e74 203d 2031 300a 2920 2d3e 2054 7970  nt = 10.) -> Typ
+00012900: 654c 6973 743a 0a20 2020 2063 6865 636b  eList:.    check
+00012910: 7320 3d20 696e 7428 7469 6d65 6f75 7420  s = int(timeout 
+00012920: 2f20 7761 6974 5f74 696d 6529 2020 2320  / wait_time)  # 
+00012930: 3130 206d 696e 7574 6573 2069 6e20 3130  10 minutes in 10
+00012940: 2073 6563 6f6e 6420 6368 756e 6b73 0a20   second chunks. 
+00012950: 2020 2069 6e73 7461 6e63 655f 6964 735f     instance_ids_
+00012960: 7374 7220 3d20 2220 222e 6a6f 696e 2869  str = " ".join(i
+00012970: 6e73 7461 6e63 655f 6964 7329 0a20 2020  nstance_ids).   
+00012980: 2063 6d64 203d 2066 2261 7773 2065 6332   cmd = f"aws ec2
+00012990: 2064 6573 6372 6962 652d 696e 7374 616e   describe-instan
+000129a0: 6365 7320 2d2d 696e 7374 616e 6365 2d69  ces --instance-i
+000129b0: 6473 207b 696e 7374 616e 6365 5f69 6473  ds {instance_ids
+000129c0: 5f73 7472 7d22 0a20 2020 2063 6d64 202b  _str}".    cmd +
+000129d0: 3d20 2220 2d2d 7175 6572 7920 2752 6573  = " --query 'Res
+000129e0: 6572 7661 7469 6f6e 735b 2a5d 2e49 6e73  ervations[*].Ins
+000129f0: 7461 6e63 6573 5b2a 5d2e 7b53 7461 7465  tances[*].{State
+00012a00: 4e61 6d65 3a53 7461 7465 2e4e 616d 652c  Name:State.Name,
+00012a10: 5075 626c 6963 4970 4164 6472 6573 733a  PublicIpAddress:
+00012a20: 5075 626c 6963 4970 4164 6472 6573 737d  PublicIpAddress}
+00012a30: 2722 0a20 2020 2063 6d64 202b 3d20 2220  '".    cmd += " 
+00012a40: 2d2d 6f75 7470 7574 206a 736f 6e22 0a20  --output json". 
+00012a50: 2020 2077 6869 6c65 2063 6865 636b 7320     while checks 
+00012a60: 3e20 303a 0a20 2020 2020 2020 2063 6865  > 0:.        che
+00012a70: 636b 7320 2d3d 2031 0a20 2020 2020 2020  cks -= 1.       
+00012a80: 2074 696d 652e 736c 6565 7028 7761 6974   time.sleep(wait
+00012a90: 5f74 696d 6529 0a20 2020 2020 2020 2064  _time).        d
+00012aa0: 6573 635f 6563 325f 6f75 7470 7574 203d  esc_ec2_output =
+00012ab0: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
+00012ac0: 6b5f 6f75 7470 7574 2863 6d64 2c20 7368  k_output(cmd, sh
+00012ad0: 656c 6c3d 5472 7565 2920 2023 206e 6f73  ell=True)  # nos
+00012ae0: 6563 0a20 2020 2020 2020 2069 6e73 7461  ec.        insta
+00012af0: 6e63 6573 5f6f 7574 7075 745f 6a73 6f6e  nces_output_json
+00012b00: 203d 206a 736f 6e2e 6c6f 6164 7328 6465   = json.loads(de
+00012b10: 7363 5f65 6332 5f6f 7574 7075 742e 6465  sc_ec2_output.de
+00012b20: 636f 6465 2822 7574 662d 3822 2929 0a20  code("utf-8")). 
+00012b30: 2020 2020 2020 2068 6f73 745f 6970 733a         host_ips:
+00012b40: 2054 7970 654c 6973 7420 3d20 5b5d 0a20   TypeList = []. 
+00012b50: 2020 2020 2020 2061 6c6c 5f69 6e73 7461         all_insta
+00012b60: 6e63 6573 5f72 756e 6e69 6e67 203d 2054  nces_running = T
+00012b70: 7275 650a 2020 2020 2020 2020 666f 7220  rue.        for 
+00012b80: 7265 7365 7276 6174 696f 6e20 696e 2069  reservation in i
+00012b90: 6e73 7461 6e63 6573 5f6f 7574 7075 745f  nstances_output_
+00012ba0: 6a73 6f6e 3a0a 2020 2020 2020 2020 2020  json:.          
+00012bb0: 2020 666f 7220 696e 7374 616e 6365 5f6d    for instance_m
+00012bc0: 6574 6164 6174 6120 696e 2072 6573 6572  etadata in reser
+00012bd0: 7661 7469 6f6e 3a0a 2020 2020 2020 2020  vation:.        
+00012be0: 2020 2020 2020 2020 6966 2069 6e73 7461          if insta
+00012bf0: 6e63 655f 6d65 7461 6461 7461 5b22 5374  nce_metadata["St
+00012c00: 6174 654e 616d 6522 5d20 213d 2022 7275  ateName"] != "ru
+00012c10: 6e6e 696e 6722 3a0a 2020 2020 2020 2020  nning":.        
+00012c20: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+00012c30: 696e 7374 616e 6365 735f 7275 6e6e 696e  instances_runnin
+00012c40: 6720 3d20 4661 6c73 650a 2020 2020 2020  g = False.      
+00012c50: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00012c60: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00012c70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012c80: 2020 2020 2020 2020 2020 2020 2020 686f                ho
+00012c90: 7374 5f69 7073 2e61 7070 656e 6428 696e  st_ips.append(in
+00012ca0: 7374 616e 6365 5f6d 6574 6164 6174 615b  stance_metadata[
+00012cb0: 2250 7562 6c69 6349 7041 6464 7265 7373  "PublicIpAddress
+00012cc0: 225d 290a 2020 2020 2020 2020 6966 2061  "]).        if a
+00012cd0: 6c6c 5f69 6e73 7461 6e63 6573 5f72 756e  ll_instances_run
+00012ce0: 6e69 6e67 3a0a 2020 2020 2020 2020 2020  ning:.          
+00012cf0: 2020 7265 7475 726e 2068 6f73 745f 6970    return host_ip
+00012d00: 730a 2020 2020 2020 2020 2320 656c 7365  s.        # else
+00012d10: 2c20 7761 6974 2061 6e6f 7468 6572 2077  , wait another w
+00012d20: 6169 745f 7469 6d65 2073 6563 6f6e 6473  ait_time seconds
+00012d30: 2061 6e64 2074 7279 2061 6761 696e 0a0a   and try again..
+00012d40: 2020 2020 7265 7475 726e 205b 5d0a 0a0a      return []...
+00012d50: 6465 6620 6d61 6b65 5f61 7773 5f65 6332  def make_aws_ec2
+00012d60: 5f69 6e73 7461 6e63 6528 0a20 2020 2061  _instance(.    a
+00012d70: 6d69 5f69 643a 2073 7472 2c20 6563 325f  mi_id: str, ec2_
+00012d80: 696e 7374 616e 6365 5f74 7970 653a 2073  instance_type: s
+00012d90: 7472 2c20 6b65 795f 6e61 6d65 3a20 7374  tr, key_name: st
+00012da0: 722c 2073 6563 7572 6974 795f 6772 6f75  r, security_grou
+00012db0: 705f 6e61 6d65 3a20 7374 720a 2920 2d3e  p_name: str.) ->
+00012dc0: 2054 7970 654c 6973 743a 0a20 2020 2023   TypeList:.    #
+00012dd0: 2046 726f 6d20 7468 6520 646f 6373 3a20   From the docs: 
+00012de0: 2246 6f72 2073 6563 7572 6974 7920 6772  "For security gr
+00012df0: 6f75 7073 2069 6e20 6120 6e6f 6e64 6566  oups in a nondef
+00012e00: 6175 6c74 2056 5043 2c20 796f 7520 6d75  ault VPC, you mu
+00012e10: 7374 2073 7065 6369 6679 2074 6865 2073  st specify the s
+00012e20: 6563 7572 6974 7920 6772 6f75 7020 4944  ecurity group ID
+00012e30: 222e 0a20 2020 2023 2052 6967 6874 206e  "..    # Right n
+00012e40: 6f77 2c20 7369 6e63 6520 7765 2772 6520  ow, since we're 
+00012e50: 7573 696e 6720 6465 6661 756c 7420 5650  using default VP
+00012e60: 432c 2077 6520 6361 6e20 7573 6520 7365  C, we can use se
+00012e70: 6375 7269 7479 2067 726f 7570 206e 616d  curity group nam
+00012e80: 6520 696e 7374 6561 6420 6f66 2049 442e  e instead of ID.
+00012e90: 0a0a 2020 2020 6562 735f 7369 7a65 203d  ..    ebs_size =
+00012ea0: 2032 3030 2020 2320 6762 0a20 2020 2063   200  # gb.    c
+00012eb0: 6d64 203d 2066 2261 7773 2065 6332 2072  md = f"aws ec2 r
+00012ec0: 756e 2d69 6e73 7461 6e63 6573 202d 2d69  un-instances --i
+00012ed0: 6d61 6765 2d69 6420 7b61 6d69 5f69 647d  mage-id {ami_id}
+00012ee0: 202d 2d63 6f75 6e74 2031 202d 2d69 6e73   --count 1 --ins
+00012ef0: 7461 6e63 652d 7479 7065 207b 6563 325f  tance-type {ec2_
+00012f00: 696e 7374 616e 6365 5f74 7970 657d 2022  instance_type} "
+00012f10: 0a20 2020 2063 6d64 202b 3d20 6622 2d2d  .    cmd += f"--
+00012f20: 6b65 792d 6e61 6d65 207b 6b65 795f 6e61  key-name {key_na
+00012f30: 6d65 7d20 2d2d 7365 6375 7269 7479 2d67  me} --security-g
+00012f40: 726f 7570 7320 7b73 6563 7572 6974 795f  roups {security_
+00012f50: 6772 6f75 705f 6e61 6d65 7d20 220a 2020  group_name} ".  
+00012f60: 2020 746d 705f 636d 6420 3d20 7266 225b    tmp_cmd = rf"[
+00012f70: 7b7b 5c22 4465 7669 6365 4e61 6d65 5c22  {{\"DeviceName\"
+00012f80: 3a5c 222f 6465 762f 7364 665c 222c 5c22  :\"/dev/sdf\",\"
+00012f90: 4562 735c 223a 7b7b 5c22 566f 6c75 6d65  Ebs\":{{\"Volume
+00012fa0: 5369 7a65 5c22 3a7b 6562 735f 7369 7a65  Size\":{ebs_size
+00012fb0: 7d2c 5c22 4465 6c65 7465 4f6e 5465 726d  },\"DeleteOnTerm
+00012fc0: 696e 6174 696f 6e5c 223a 6661 6c73 657d  ination\":false}
+00012fd0: 7d7d 7d5d 220a 2020 2020 636d 6420 2b3d  }}}]".    cmd +=
+00012fe0: 2066 272d 2d62 6c6f 636b 2d64 6576 6963   f'--block-devic
+00012ff0: 652d 6d61 7070 696e 6773 2022 7b74 6d70  e-mappings "{tmp
+00013000: 5f63 6d64 7d22 270a 0a20 2020 2068 6f73  _cmd}"'..    hos
+00013010: 745f 6970 733a 2054 7970 654c 6973 7420  t_ips: TypeList 
+00013020: 3d20 5b5d 0a20 2020 2074 7279 3a0a 2020  = [].    try:.  
+00013030: 2020 2020 2020 7072 696e 7428 6622 4372        print(f"Cr
+00013040: 6561 7469 6e67 2045 4332 2069 6e73 7461  eating EC2 insta
+00013050: 6e63 652e 5c6e 5275 6e6e 696e 673a 207b  nce.\nRunning: {
+00013060: 636d 647d 2229 0a20 2020 2020 2020 2063  cmd}").        c
+00013070: 7265 6174 655f 6563 325f 6f75 7470 7574  reate_ec2_output
+00013080: 203d 2073 7562 7072 6f63 6573 732e 6368   = subprocess.ch
+00013090: 6563 6b5f 6f75 7470 7574 2863 6d64 2c20  eck_output(cmd, 
+000130a0: 7368 656c 6c3d 5472 7565 2920 2023 206e  shell=True)  # n
+000130b0: 6f73 6563 0a20 2020 2020 2020 2069 6e73  osec.        ins
+000130c0: 7461 6e63 655f 6964 7320 3d20 6578 7472  tance_ids = extr
+000130d0: 6163 745f 696e 7374 616e 6365 5f69 6473  act_instance_ids
+000130e0: 5f61 7773 2863 7265 6174 655f 6563 325f  _aws(create_ec2_
+000130f0: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
+00013100: 686f 7374 5f69 7073 203d 2067 6574 5f68  host_ips = get_h
+00013110: 6f73 745f 6970 735f 6769 7665 6e5f 696e  ost_ips_given_in
+00013120: 7374 616e 6365 5f69 6473 2869 6e73 7461  stance_ids(insta
+00013130: 6e63 655f 6964 733d 696e 7374 616e 6365  nce_ids=instance
+00013140: 5f69 6473 290a 2020 2020 6578 6365 7074  _ids).    except
+00013150: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00013160: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+00013170: 6661 696c 6564 222c 2065 290a 0a20 2020  failed", e)..   
+00013180: 2069 6620 6e6f 7420 2868 6f73 745f 6970   if not (host_ip
+00013190: 7329 3a0a 2020 2020 2020 2020 7261 6973  s):.        rais
+000131a0: 6520 4578 6365 7074 696f 6e28 2246 6169  e Exception("Fai
+000131b0: 6c65 6420 746f 2063 7265 6174 6520 4543  led to create EC
+000131c0: 3220 696e 7374 616e 6365 2873 2920 6f72  2 instance(s) or
+000131d0: 2067 6574 2070 7562 6c69 6320 6970 2873   get public ip(s
+000131e0: 2922 290a 0a20 2020 2072 6574 7572 6e20  )")..    return 
+000131f0: 686f 7374 5f69 7073 0a0a 0a64 6566 2063  host_ips...def c
+00013200: 7265 6174 655f 6c61 756e 6368 5f61 7773  reate_launch_aws
+00013210: 5f63 6d64 280a 2020 2020 7665 7262 3a20  _cmd(.    verb: 
+00013220: 4772 616d 6d61 7256 6572 622c 0a20 2020  GrammarVerb,.   
+00013230: 2072 6567 696f 6e3a 2073 7472 2c0a 2020   region: str,.  
+00013240: 2020 6563 325f 696e 7374 616e 6365 5f74    ec2_instance_t
+00013250: 7970 653a 2073 7472 2c0a 2020 2020 7365  ype: str,.    se
+00013260: 6375 7269 7479 5f67 726f 7570 5f6e 616d  curity_group_nam
+00013270: 653a 2073 7472 2c0a 2020 2020 6177 735f  e: str,.    aws_
+00013280: 7365 6375 7269 7479 5f67 726f 7570 5f63  security_group_c
+00013290: 6964 723a 2073 7472 2c0a 2020 2020 6b65  idr: str,.    ke
+000132a0: 795f 6e61 6d65 3a20 7374 722c 0a20 2020  y_name: str,.   
+000132b0: 206b 6579 5f70 6174 683a 2073 7472 2c0a   key_path: str,.
+000132c0: 2020 2020 616e 7369 626c 655f 6578 7472      ansible_extr
+000132d0: 6173 3a20 7374 722c 0a20 2020 206b 7761  as: str,.    kwa
+000132e0: 7267 733a 2054 7970 6544 6963 745b 7374  rgs: TypeDict[st
+000132f0: 722c 2041 6e79 5d2c 0a20 2020 2072 6570  r, Any],.    rep
+00013300: 6f3a 2073 7472 2c0a 2020 2020 6272 616e  o: str,.    bran
+00013310: 6368 3a20 7374 722c 0a20 2020 2061 6d69  ch: str,.    ami
+00013320: 5f69 643a 2073 7472 2c0a 2020 2020 7573  _id: str,.    us
+00013330: 6572 6e61 6d65 3a20 7374 722c 0a20 2020  ername: str,.   
+00013340: 2061 7574 683a 2041 7574 6843 7265 6465   auth: AuthCrede
+00013350: 6e74 6961 6c73 2c0a 2920 2d3e 2054 7970  ntials,.) -> Typ
+00013360: 654c 6973 745b 7374 725d 3a0a 2020 2020  eList[str]:.    
+00013370: 6e6f 6465 5f6e 616d 6520 3d20 7665 7262  node_name = verb
+00013380: 2e67 6574 5f6e 616d 6564 5f74 6572 6d5f  .get_named_term_
+00013390: 7479 7065 286e 616d 653d 226e 6f64 655f  type(name="node_
+000133a0: 6e61 6d65 2229 0a20 2020 2073 6e61 6b65  name").    snake
+000133b0: 5f6e 616d 6520 3d20 7374 7228 6e6f 6465  _name = str(node
+000133c0: 5f6e 616d 652e 736e 616b 655f 696e 7075  _name.snake_inpu
+000133d0: 7429 0a20 2020 2063 7265 6174 655f 6177  t).    create_aw
+000133e0: 735f 7365 6375 7269 7479 5f67 726f 7570  s_security_group
+000133f0: 2873 6563 7572 6974 795f 6772 6f75 705f  (security_group_
+00013400: 6e61 6d65 2c20 7265 6769 6f6e 2c20 736e  name, region, sn
+00013410: 616b 655f 6e61 6d65 290a 2020 2020 6f70  ake_name).    op
+00013420: 656e 5f70 6f72 745f 6177 7328 0a20 2020  en_port_aws(.   
+00013430: 2020 2020 2073 6563 7572 6974 795f 6772       security_gr
+00013440: 6f75 705f 6e61 6d65 3d73 6563 7572 6974  oup_name=securit
+00013450: 795f 6772 6f75 705f 6e61 6d65 2c0a 2020  y_group_name,.  
+00013460: 2020 2020 2020 706f 7274 5f6e 6f3d 3830        port_no=80
+00013470: 2c0a 2020 2020 2020 2020 6369 6472 3d61  ,.        cidr=a
+00013480: 7773 5f73 6563 7572 6974 795f 6772 6f75  ws_security_grou
+00013490: 705f 6369 6472 2c0a 2020 2020 2020 2020  p_cidr,.        
+000134a0: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
+000134b0: 2020 2029 2020 2320 4854 5450 0a20 2020     )  # HTTP.   
+000134c0: 206f 7065 6e5f 706f 7274 5f61 7773 280a   open_port_aws(.
+000134d0: 2020 2020 2020 2020 7365 6375 7269 7479          security
+000134e0: 5f67 726f 7570 5f6e 616d 653d 7365 6375  _group_name=secu
+000134f0: 7269 7479 5f67 726f 7570 5f6e 616d 652c  rity_group_name,
+00013500: 0a20 2020 2020 2020 2070 6f72 745f 6e6f  .        port_no
+00013510: 3d34 3433 2c0a 2020 2020 2020 2020 6369  =443,.        ci
+00013520: 6472 3d61 7773 5f73 6563 7572 6974 795f  dr=aws_security_
+00013530: 6772 6f75 705f 6369 6472 2c0a 2020 2020  group_cidr,.    
+00013540: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
+00013550: 6e2c 0a20 2020 2029 2020 2320 4854 5450  n,.    )  # HTTP
+00013560: 530a 2020 2020 6f70 656e 5f70 6f72 745f  S.    open_port_
+00013570: 6177 7328 0a20 2020 2020 2020 2073 6563  aws(.        sec
+00013580: 7572 6974 795f 6772 6f75 705f 6e61 6d65  urity_group_name
+00013590: 3d73 6563 7572 6974 795f 6772 6f75 705f  =security_group_
+000135a0: 6e61 6d65 2c0a 2020 2020 2020 2020 706f  name,.        po
+000135b0: 7274 5f6e 6f3d 3232 2c0a 2020 2020 2020  rt_no=22,.      
+000135c0: 2020 6369 6472 3d61 7773 5f73 6563 7572    cidr=aws_secur
+000135d0: 6974 795f 6772 6f75 705f 6369 6472 2c0a  ity_group_cidr,.
+000135e0: 2020 2020 2020 2020 7265 6769 6f6e 3d72          region=r
+000135f0: 6567 696f 6e2c 0a20 2020 2029 2020 2320  egion,.    )  # 
+00013600: 5353 480a 2020 2020 6966 206b 7761 7267  SSH.    if kwarg
+00013610: 735b 226a 7570 7974 6572 225d 3a0a 2020  s["jupyter"]:.  
+00013620: 2020 2020 2020 6f70 656e 5f70 6f72 745f        open_port_
+00013630: 6177 7328 0a20 2020 2020 2020 2020 2020  aws(.           
+00013640: 2073 6563 7572 6974 795f 6772 6f75 705f   security_group_
+00013650: 6e61 6d65 3d73 6563 7572 6974 795f 6772  name=security_gr
+00013660: 6f75 705f 6e61 6d65 2c0a 2020 2020 2020  oup_name,.      
+00013670: 2020 2020 2020 706f 7274 5f6e 6f3d 3838        port_no=88
+00013680: 3838 2c0a 2020 2020 2020 2020 2020 2020  88,.            
+00013690: 6369 6472 3d61 7773 5f73 6563 7572 6974  cidr=aws_securit
+000136a0: 795f 6772 6f75 705f 6369 6472 2c0a 2020  y_group_cidr,.  
+000136b0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+000136c0: 3d72 6567 696f 6e2c 0a20 2020 2020 2020  =region,.       
+000136d0: 2029 2020 2320 4a75 7079 7465 720a 0a20   )  # Jupyter.. 
+000136e0: 2020 2068 6f73 745f 6970 7320 3d20 6d61     host_ips = ma
+000136f0: 6b65 5f61 7773 5f65 6332 5f69 6e73 7461  ke_aws_ec2_insta
+00013700: 6e63 6528 0a20 2020 2020 2020 2061 6d69  nce(.        ami
+00013710: 5f69 643d 616d 695f 6964 2c0a 2020 2020  _id=ami_id,.    
+00013720: 2020 2020 6563 325f 696e 7374 616e 6365      ec2_instance
+00013730: 5f74 7970 653d 6563 325f 696e 7374 616e  _type=ec2_instan
+00013740: 6365 5f74 7970 652c 0a20 2020 2020 2020  ce_type,.       
+00013750: 206b 6579 5f6e 616d 653d 6b65 795f 6e61   key_name=key_na
+00013760: 6d65 2c0a 2020 2020 2020 2020 7365 6375  me,.        secu
+00013770: 7269 7479 5f67 726f 7570 5f6e 616d 653d  rity_group_name=
+00013780: 7365 6375 7269 7479 5f67 726f 7570 5f6e  security_group_n
+00013790: 616d 652c 0a20 2020 2029 0a0a 2020 2020  ame,.    )..    
+000137a0: 6c61 756e 6368 5f63 6d64 733a 2054 7970  launch_cmds: Typ
+000137b0: 654c 6973 745b 7374 725d 203d 205b 5d0a  eList[str] = [].
+000137c0: 0a20 2020 2066 6f72 2068 6f73 745f 6970  .    for host_ip
+000137d0: 2069 6e20 686f 7374 5f69 7073 3a0a 2020   in host_ips:.  
+000137e0: 2020 2020 2020 2320 6765 7420 6f6c 6420        # get old 
+000137f0: 686f 7374 0a20 2020 2020 2020 2068 6f73  host.        hos
+00013800: 745f 7465 726d 203d 2076 6572 622e 6765  t_term = verb.ge
+00013810: 745f 6e61 6d65 645f 7465 726d 5f68 6f73  t_named_term_hos
+00013820: 7467 7261 6d6d 6172 286e 616d 653d 2268  tgrammar(name="h
+00013830: 6f73 7422 290a 0a20 2020 2020 2020 2023  ost")..        #
+00013840: 2072 6570 6c61 6365 0a20 2020 2020 2020   replace.       
+00013850: 2068 6f73 745f 7465 726d 2e70 6172 7365   host_term.parse
+00013860: 5f69 6e70 7574 2868 6f73 745f 6970 290a  _input(host_ip).
+00013870: 2020 2020 2020 2020 7665 7262 2e73 6574          verb.set
+00013880: 5f6e 616d 6564 5f74 6572 6d5f 7479 7065  _named_term_type
+00013890: 286e 616d 653d 2268 6f73 7422 2c20 6e65  (name="host", ne
+000138a0: 775f 7465 726d 3d68 6f73 745f 7465 726d  w_term=host_term
+000138b0: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+000138c0: 7420 626f 6f6c 286b 7761 7267 735b 2270  t bool(kwargs["p
+000138d0: 726f 7669 7369 6f6e 225d 293a 0a20 2020  rovision"]):.   
+000138e0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000138f0: 536b 6970 7069 6e67 2061 7574 6f6d 6174  Skipping automat
+00013900: 6963 2070 726f 7669 7369 6f6e 696e 672e  ic provisioning.
+00013910: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00013920: 7269 6e74 2822 564d 2063 7265 6174 6564  rint("VM created
+00013930: 2077 6974 683a 2229 0a20 2020 2020 2020   with:").       
+00013940: 2020 2020 2070 7269 6e74 2866 2249 503a       print(f"IP:
+00013950: 207b 686f 7374 5f69 707d 2229 0a20 2020   {host_ip}").   
+00013960: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00013970: 224b 6579 3a20 7b6b 6579 5f70 6174 687d  "Key: {key_path}
+00013980: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00013990: 7269 6e74 2822 5c6e 436f 6e6e 6563 7420  rint("\nConnect 
+000139a0: 7769 7468 3a22 290a 2020 2020 2020 2020  with:").        
+000139b0: 2020 2020 7072 696e 7428 6622 7373 6820      print(f"ssh 
+000139c0: 2d69 207b 6b65 795f 7061 7468 7d20 7b75  -i {key_path} {u
+000139d0: 7365 726e 616d 657d 407b 686f 7374 5f69  sername}@{host_i
+000139e0: 707d 2229 0a0a 2020 2020 2020 2020 656c  p}")..        el
+000139f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00013a00: 6578 7472 615f 6b77 6172 6773 203d 207b  extra_kwargs = {
+00013a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a20: 2022 7265 706f 223a 2072 6570 6f2c 0a20   "repo": repo,. 
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013a40: 6272 616e 6368 223a 2062 7261 6e63 682c  branch": branch,
+00013a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a60: 2022 616e 7369 626c 655f 6578 7472 6173   "ansible_extras
+00013a70: 223a 2061 6e73 6962 6c65 5f65 7874 7261  ": ansible_extra
+00013a80: 732c 0a20 2020 2020 2020 2020 2020 207d  s,.            }
+00013a90: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00013aa0: 7267 732e 7570 6461 7465 2865 7874 7261  rgs.update(extra
+00013ab0: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
+00013ac0: 2020 2020 2020 2320 7072 6f76 6973 696f        # provisio
+00013ad0: 6e0a 2020 2020 2020 2020 2020 2020 686f  n.            ho
+00013ae0: 7374 5f75 7020 3d20 6368 6563 6b5f 6970  st_up = check_ip
+00013af0: 5f66 6f72 5f73 7368 2868 6f73 745f 6970  _for_ssh(host_ip
+00013b00: 3d68 6f73 745f 6970 290a 2020 2020 2020  =host_ip).      
+00013b10: 2020 2020 2020 6966 206e 6f74 2068 6f73        if not hos
+00013b20: 745f 7570 3a0a 2020 2020 2020 2020 2020  t_up:.          
+00013b30: 2020 2020 2020 7072 696e 7428 6622 5761        print(f"Wa
+00013b40: 726e 696e 673a 207b 686f 7374 5f69 707d  rning: {host_ip}
+00013b50: 2073 7368 206e 6f74 2061 7661 696c 6162   ssh not availab
+00013b60: 6c65 2079 6574 2229 0a20 2020 2020 2020  le yet").       
+00013b70: 2020 2020 206c 6175 6e63 685f 636d 6420       launch_cmd 
+00013b80: 3d20 6372 6561 7465 5f6c 6175 6e63 685f  = create_launch_
+00013b90: 6375 7374 6f6d 5f63 6d64 2876 6572 623d  custom_cmd(verb=
+00013ba0: 7665 7262 2c20 6175 7468 3d61 7574 682c  verb, auth=auth,
+00013bb0: 206b 7761 7267 733d 6b77 6172 6773 290a   kwargs=kwargs).
+00013bc0: 2020 2020 2020 2020 2020 2020 6c61 756e              laun
+00013bd0: 6368 5f63 6d64 732e 6170 7065 6e64 286c  ch_cmds.append(l
+00013be0: 6175 6e63 685f 636d 6429 0a0a 2020 2020  aunch_cmd)..    
+00013bf0: 7265 7475 726e 206c 6175 6e63 685f 636d  return launch_cm
+00013c00: 6473 0a0a 0a64 6566 206d 616b 655f 766d  ds...def make_vm
+00013c10: 5f61 7a75 7265 280a 2020 2020 6e6f 6465  _azure(.    node
+00013c20: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
+00013c30: 7265 736f 7572 6365 5f67 726f 7570 3a20  resource_group: 
+00013c40: 7374 722c 0a20 2020 2075 7365 726e 616d  str,.    usernam
+00013c50: 653a 2073 7472 2c0a 2020 2020 7061 7373  e: str,.    pass
+00013c60: 776f 7264 3a20 4f70 7469 6f6e 616c 5b73  word: Optional[s
+00013c70: 7472 5d2c 0a20 2020 206b 6579 5f70 6174  tr],.    key_pat
+00013c80: 683a 204f 7074 696f 6e61 6c5b 7374 725d  h: Optional[str]
+00013c90: 2c0a 2020 2020 7369 7a65 3a20 7374 722c  ,.    size: str,
+00013ca0: 0a20 2020 2069 6d61 6765 5f6e 616d 653a  .    image_name:
+00013cb0: 2073 7472 2c0a 2020 2020 6e6f 6465 5f63   str,.    node_c
+00013cc0: 6f75 6e74 3a20 696e 742c 0a29 202d 3e20  ount: int,.) -> 
+00013cd0: 5479 7065 4c69 7374 3a0a 2020 2020 6469  TypeList:.    di
+00013ce0: 736b 5f73 697a 655f 6762 203d 2022 3230  sk_size_gb = "20
+00013cf0: 3022 0a20 2020 2074 7279 3a0a 2020 2020  0".    try:.    
+00013d00: 2020 2020 7465 6d70 5f64 6972 203d 2074      temp_dir = t
+00013d10: 656d 7066 696c 652e 5465 6d70 6f72 6172  empfile.Temporar
+00013d20: 7944 6972 6563 746f 7279 2829 0a20 2020  yDirectory().   
+00013d30: 2020 2020 2070 7562 6c69 635f 6b65 795f       public_key_
+00013d40: 7061 7468 203d 2028 0a20 2020 2020 2020  path = (.       
+00013d50: 2020 2020 2070 7269 7661 7465 5f74 6f5f       private_to_
+00013d60: 7075 626c 6963 5f6b 6579 280a 2020 2020  public_key(.    
+00013d70: 2020 2020 2020 2020 2020 2020 7072 6976              priv
+00013d80: 6174 655f 6b65 795f 7061 7468 3d6b 6579  ate_key_path=key
+00013d90: 5f70 6174 682c 2074 656d 705f 7061 7468  _path, temp_path
+00013da0: 3d74 656d 705f 6469 722e 6e61 6d65 2c20  =temp_dir.name, 
+00013db0: 7573 6572 6e61 6d65 3d75 7365 726e 616d  username=usernam
+00013dc0: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
+00013dd0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00013de0: 6579 5f70 6174 680a 2020 2020 2020 2020  ey_path.        
+00013df0: 2020 2020 656c 7365 204e 6f6e 650a 2020      else None.  
+00013e00: 2020 2020 2020 290a 2020 2020 6578 6365        ).    exce
+00013e10: 7074 2045 7863 6570 7469 6f6e 3a20 2023  pt Exception:  #
+00013e20: 206e 6f73 6563 0a20 2020 2020 2020 2074   nosec.        t
+00013e30: 656d 705f 6469 722e 636c 6561 6e75 7028  emp_dir.cleanup(
+00013e40: 290a 0a20 2020 2061 7574 6865 6e74 6963  )..    authentic
+00013e50: 6174 696f 6e5f 7479 7065 203d 2022 7373  ation_type = "ss
+00013e60: 6822 2069 6620 6b65 795f 7061 7468 2065  h" if key_path e
+00013e70: 6c73 6520 2270 6173 7377 6f72 6422 0a20  lse "password". 
+00013e80: 2020 2063 6d64 203d 2066 2261 7a20 766d     cmd = f"az vm
+00013e90: 2063 7265 6174 6520 2d6e 207b 6e6f 6465   create -n {node
+00013ea0: 5f6e 616d 657d 202d 6720 7b72 6573 6f75  _name} -g {resou
+00013eb0: 7263 655f 6772 6f75 707d 202d 2d73 697a  rce_group} --siz
+00013ec0: 6520 7b73 697a 657d 2022 0a20 2020 2063  e {size} ".    c
+00013ed0: 6d64 202b 3d20 6622 2d2d 696d 6167 6520  md += f"--image 
+00013ee0: 7b69 6d61 6765 5f6e 616d 657d 202d 2d6f  {image_name} --o
+00013ef0: 732d 6469 736b 2d73 697a 652d 6762 207b  s-disk-size-gb {
+00013f00: 6469 736b 5f73 697a 655f 6762 7d20 220a  disk_size_gb} ".
+00013f10: 2020 2020 636d 6420 2b3d 2066 222d 2d70      cmd += f"--p
+00013f20: 7562 6c69 632d 6970 2d73 6b75 2053 7461  ublic-ip-sku Sta
+00013f30: 6e64 6172 6420 2d2d 6175 7468 656e 7469  ndard --authenti
+00013f40: 6361 7469 6f6e 2d74 7970 6520 7b61 7574  cation-type {aut
+00013f50: 6865 6e74 6963 6174 696f 6e5f 7479 7065  hentication_type
+00013f60: 7d20 2d2d 6164 6d69 6e2d 7573 6572 6e61  } --admin-userna
+00013f70: 6d65 207b 7573 6572 6e61 6d65 7d20 220a  me {username} ".
+00013f80: 2020 2020 636d 6420 2b3d 2066 222d 2d73      cmd += f"--s
+00013f90: 7368 2d6b 6579 2d76 616c 7565 7320 7b70  sh-key-values {p
+00013fa0: 7562 6c69 635f 6b65 795f 7061 7468 7d20  ublic_key_path} 
+00013fb0: 2220 6966 2070 7562 6c69 635f 6b65 795f  " if public_key_
+00013fc0: 7061 7468 2065 6c73 6520 2222 0a20 2020  path else "".   
+00013fd0: 2063 6d64 202b 3d20 6622 2d2d 6164 6d69   cmd += f"--admi
+00013fe0: 6e2d 7061 7373 776f 7264 2027 7b70 6173  n-password '{pas
+00013ff0: 7377 6f72 647d 2720 2220 6966 2070 6173  sword}' " if pas
+00014000: 7377 6f72 6420 656c 7365 2022 220a 2020  sword else "".  
+00014010: 2020 636d 6420 2b3d 2066 222d 2d63 6f75    cmd += f"--cou
+00014020: 6e74 207b 6e6f 6465 5f63 6f75 6e74 7d20  nt {node_count} 
+00014030: 2220 6966 206e 6f64 655f 636f 756e 7420  " if node_count 
+00014040: 3e20 3120 656c 7365 2022 220a 0a20 2020  > 1 else ""..   
+00014050: 2068 6f73 745f 6970 733a 204f 7074 696f   host_ips: Optio
+00014060: 6e61 6c5b 5479 7065 4c69 7374 5d20 3d20  nal[TypeList] = 
+00014070: 5b5d 0a20 2020 2074 7279 3a0a 2020 2020  [].    try:.    
+00014080: 2020 2020 7072 696e 7428 6622 4372 6561      print(f"Crea
+00014090: 7469 6e67 2076 6d2e 5c6e 5275 6e6e 696e  ting vm.\nRunnin
+000140a0: 673a 207b 6869 6465 5f61 7a75 7265 5f76  g: {hide_azure_v
+000140b0: 6d5f 7061 7373 776f 7264 2863 6d64 297d  m_password(cmd)}
+000140c0: 2229 0a20 2020 2020 2020 2073 7562 7072  ").        subpr
+000140d0: 6f63 6573 732e 6368 6563 6b5f 6f75 7470  ocess.check_outp
+000140e0: 7574 2863 6d64 2c20 7368 656c 6c3d 5472  ut(cmd, shell=Tr
+000140f0: 7565 2920 2023 206e 6f73 6563 0a20 2020  ue)  # nosec.   
+00014100: 2020 2020 2068 6f73 745f 6970 7320 3d20       host_ips = 
+00014110: 6765 745f 766d 5f68 6f73 745f 6970 7328  get_vm_host_ips(
+00014120: 6e6f 6465 5f6e 616d 653d 6e6f 6465 5f6e  node_name=node_n
+00014130: 616d 652c 2072 6573 6f75 7263 655f 6772  ame, resource_gr
+00014140: 6f75 703d 7265 736f 7572 6365 5f67 726f  oup=resource_gro
+00014150: 7570 290a 2020 2020 6578 6365 7074 2045  up).    except E
+00014160: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00014170: 2020 2020 2020 2070 7269 6e74 2822 6661         print("fa
+00014180: 696c 6564 222c 2065 290a 2020 2020 6669  iled", e).    fi
+00014190: 6e61 6c6c 793a 0a20 2020 2020 2020 2074  nally:.        t
+000141a0: 656d 705f 6469 722e 636c 6561 6e75 7028  emp_dir.cleanup(
+000141b0: 290a 0a20 2020 2069 6620 6e6f 7420 686f  )..    if not ho
+000141c0: 7374 5f69 7073 3a0a 2020 2020 2020 2020  st_ips:.        
+000141d0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+000141e0: 2246 6169 6c65 6420 746f 2063 7265 6174  "Failed to creat
+000141f0: 6520 766d 206f 7220 6765 7420 564d 2070  e vm or get VM p
+00014200: 7562 6c69 6320 6970 2229 0a0a 2020 2020  ublic ip")..    
+00014210: 7472 793a 0a20 2020 2020 2020 2023 2063  try:.        # c
+00014220: 6c65 616e 2075 7020 7465 6d70 2070 7562  lean up temp pub
+00014230: 6c69 6320 6b65 790a 2020 2020 2020 2020  lic key.        
+00014240: 6966 2070 7562 6c69 635f 6b65 795f 7061  if public_key_pa
+00014250: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00014260: 6f73 2e75 6e6c 696e 6b28 7075 626c 6963  os.unlink(public
+00014270: 5f6b 6579 5f70 6174 6829 0a20 2020 2065  _key_path).    e
+00014280: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00014290: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
+000142a0: 2020 7061 7373 0a0a 2020 2020 7265 7475    pass..    retu
+000142b0: 726e 2068 6f73 745f 6970 730a 0a0a 6465  rn host_ips...de
+000142c0: 6620 6f70 656e 5f70 6f72 745f 766d 5f61  f open_port_vm_a
+000142d0: 7a75 7265 280a 2020 2020 7265 736f 7572  zure(.    resour
+000142e0: 6365 5f67 726f 7570 3a20 7374 722c 206e  ce_group: str, n
+000142f0: 6f64 655f 6e61 6d65 3a20 7374 722c 2070  ode_name: str, p
+00014300: 6f72 745f 6e61 6d65 3a20 7374 722c 2070  ort_name: str, p
+00014310: 6f72 743a 2069 6e74 2c20 7072 696f 7269  ort: int, priori
+00014320: 7479 3a20 696e 740a 2920 2d3e 204e 6f6e  ty: int.) -> Non
+00014330: 653a 0a20 2020 2063 6d64 203d 2066 2261  e:.    cmd = f"a
+00014340: 7a20 6e65 7477 6f72 6b20 6e73 6720 7275  z network nsg ru
+00014350: 6c65 2063 7265 6174 6520 2d2d 7265 736f  le create --reso
+00014360: 7572 6365 2d67 726f 7570 207b 7265 736f  urce-group {reso
+00014370: 7572 6365 5f67 726f 7570 7d20 220a 2020  urce_group} ".  
+00014380: 2020 636d 6420 2b3d 2066 222d 2d6e 7367    cmd += f"--nsg
+00014390: 2d6e 616d 6520 7b6e 6f64 655f 6e61 6d65  -name {node_name
+000143a0: 7d4e 5347 202d 2d6e 616d 6520 7b70 6f72  }NSG --name {por
+000143b0: 745f 6e61 6d65 7d20 2d2d 6465 7374 696e  t_name} --destin
+000143c0: 6174 696f 6e2d 706f 7274 2d72 616e 6765  ation-port-range
+000143d0: 7320 7b70 6f72 747d 202d 2d70 7269 6f72  s {port} --prior
+000143e0: 6974 7920 7b70 7269 6f72 6974 797d 220a  ity {priority}".
+000143f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00014400: 2070 7269 6e74 2866 2243 7265 6174 696e   print(f"Creatin
+00014410: 6720 7b70 6f72 745f 6e61 6d65 7d20 7b70  g {port_name} {p
+00014420: 6f72 747d 206e 6773 2072 756c 652e 5c6e  ort} ngs rule.\n
+00014430: 5275 6e6e 696e 673a 207b 636d 647d 2229  Running: {cmd}")
+00014440: 0a20 2020 2020 2020 206f 7574 7075 7420  .        output 
+00014450: 3d20 7375 6270 726f 6365 7373 2e63 6865  = subprocess.che
+00014460: 636b 5f63 616c 6c28 636d 642c 2073 6865  ck_call(cmd, she
+00014470: 6c6c 3d54 7275 6529 2020 2320 6e6f 7365  ll=True)  # nose
+00014480: 630a 2020 2020 2020 2020 7072 696e 7428  c.        print(
+00014490: 226f 7574 7075 7422 2c20 6f75 7470 7574  "output", output
+000144a0: 290a 2020 2020 2020 2020 7061 7373 0a20  ).        pass. 
+000144b0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000144c0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+000144d0: 2020 7072 696e 7428 2266 6169 6c65 6422    print("failed"
+000144e0: 2c20 6529 0a0a 0a64 6566 2063 7265 6174  , e)...def creat
+000144f0: 655f 7072 6f6a 6563 7428 7072 6f6a 6563  e_project(projec
+00014500: 745f 6964 3a20 7374 7229 202d 3e20 4e6f  t_id: str) -> No
+00014510: 6e65 3a0a 2020 2020 636d 6420 3d20 6622  ne:.    cmd = f"
+00014520: 6763 6c6f 7564 2070 726f 6a65 6374 7320  gcloud projects 
+00014530: 6372 6561 7465 207b 7072 6f6a 6563 745f  create {project_
+00014540: 6964 7d20 2d2d 7365 742d 6173 2d64 6566  id} --set-as-def
+00014550: 6175 6c74 220a 2020 2020 7472 793a 0a20  ault".    try:. 
+00014560: 2020 2020 2020 2070 7269 6e74 2866 2243         print(f"C
+00014570: 7265 6174 696e 6720 7072 6f6a 6563 742e  reating project.
+00014580: 5c6e 5275 6e6e 696e 673a 207b 636d 647d  \nRunning: {cmd}
+00014590: 2229 0a20 2020 2020 2020 2073 7562 7072  ").        subpr
+000145a0: 6f63 6573 732e 6368 6563 6b5f 6361 6c6c  ocess.check_call
+000145b0: 2863 6d64 2c20 7368 656c 6c3d 5472 7565  (cmd, shell=True
+000145c0: 2920 2023 206e 6f73 6563 0a20 2020 2065  )  # nosec.    e
+000145d0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+000145e0: 6173 2065 3a0a 2020 2020 2020 2020 7072  as e:.        pr
+000145f0: 696e 7428 2266 6169 6c65 6422 2c20 6529  int("failed", e)
+00014600: 0a0a 2020 2020 7072 696e 7428 2263 7265  ..    print("cre
+00014610: 6174 6520 7072 6f6a 6563 7420 636f 6d70  ate project comp
+00014620: 6c65 7465 2229 0a0a 0a64 6566 2063 7265  lete")...def cre
+00014630: 6174 655f 6c61 756e 6368 5f67 6370 5f63  ate_launch_gcp_c
+00014640: 6d64 280a 2020 2020 7665 7262 3a20 4772  md(.    verb: Gr
+00014650: 616d 6d61 7256 6572 622c 0a20 2020 2070  ammarVerb,.    p
+00014660: 726f 6a65 6374 5f69 643a 2073 7472 2c0a  roject_id: str,.
+00014670: 2020 2020 7a6f 6e65 3a20 7374 722c 0a20      zone: str,. 
+00014680: 2020 206d 6163 6869 6e65 5f74 7970 653a     machine_type:
+00014690: 2073 7472 2c0a 2020 2020 616e 7369 626c   str,.    ansibl
+000146a0: 655f 6578 7472 6173 3a20 7374 722c 0a20  e_extras: str,. 
+000146b0: 2020 206b 7761 7267 733a 2054 7970 6544     kwargs: TypeD
+000146c0: 6963 745b 7374 722c 2041 6e79 5d2c 0a20  ict[str, Any],. 
+000146d0: 2020 2072 6570 6f3a 2073 7472 2c0a 2020     repo: str,.  
+000146e0: 2020 6272 616e 6368 3a20 7374 722c 0a20    branch: str,. 
+000146f0: 2020 2061 7574 683a 2041 7574 6843 7265     auth: AuthCre
+00014700: 6465 6e74 6961 6c73 2c0a 2920 2d3e 2073  dentials,.) -> s
+00014710: 7472 3a0a 2020 2020 2320 6372 6561 7465  tr:.    # create
+00014720: 2070 726f 6a65 6374 2069 6620 6974 2064   project if it d
+00014730: 6f65 736e 2774 2065 7869 7374 0a20 2020  oesn't exist.   
+00014740: 2063 7265 6174 655f 7072 6f6a 6563 7428   create_project(
+00014750: 7072 6f6a 6563 745f 6964 290a 2020 2020  project_id).    
+00014760: 2320 766d 0a20 2020 206e 6f64 655f 6e61  # vm.    node_na
+00014770: 6d65 203d 2076 6572 622e 6765 745f 6e61  me = verb.get_na
+00014780: 6d65 645f 7465 726d 5f74 7970 6528 6e61  med_term_type(na
+00014790: 6d65 3d22 6e6f 6465 5f6e 616d 6522 290a  me="node_name").
+000147a0: 2020 2020 6b65 6261 625f 6e61 6d65 203d      kebab_name =
+000147b0: 2073 7472 286e 6f64 655f 6e61 6d65 2e6b   str(node_name.k
+000147c0: 6562 6162 5f69 6e70 7574 290a 2020 2020  ebab_input).    
+000147d0: 6469 736b 5f73 697a 655f 6762 203d 2022  disk_size_gb = "
+000147e0: 3230 3022 0a20 2020 2068 6f73 745f 6970  200".    host_ip
+000147f0: 203d 206d 616b 655f 6763 705f 766d 280a   = make_gcp_vm(.
+00014800: 2020 2020 2020 2020 766d 5f6e 616d 653d          vm_name=
+00014810: 6b65 6261 625f 6e61 6d65 2c0a 2020 2020  kebab_name,.    
+00014820: 2020 2020 7072 6f6a 6563 745f 6964 3d70      project_id=p
+00014830: 726f 6a65 6374 5f69 642c 0a20 2020 2020  roject_id,.     
+00014840: 2020 207a 6f6e 653d 7a6f 6e65 2c0a 2020     zone=zone,.  
+00014850: 2020 2020 2020 6d61 6368 696e 655f 7479        machine_ty
+00014860: 7065 3d6d 6163 6869 6e65 5f74 7970 652c  pe=machine_type,
+00014870: 0a20 2020 2020 2020 2064 6973 6b5f 7369  .        disk_si
+00014880: 7a65 5f67 623d 6469 736b 5f73 697a 655f  ze_gb=disk_size_
+00014890: 6762 2c0a 2020 2020 290a 0a20 2020 2023  gb,.    )..    #
+000148a0: 2067 6574 206f 6c64 2068 6f73 740a 2020   get old host.  
+000148b0: 2020 686f 7374 5f74 6572 6d20 3d20 7665    host_term = ve
+000148c0: 7262 2e67 6574 5f6e 616d 6564 5f74 6572  rb.get_named_ter
+000148d0: 6d5f 686f 7374 6772 616d 6d61 7228 6e61  m_hostgrammar(na
+000148e0: 6d65 3d22 686f 7374 2229 0a0a 2020 2020  me="host")..    
+000148f0: 686f 7374 5f75 7020 3d20 6368 6563 6b5f  host_up = check_
+00014900: 6970 5f66 6f72 5f73 7368 2868 6f73 745f  ip_for_ssh(host_
+00014910: 6970 3d68 6f73 745f 6970 290a 2020 2020  ip=host_ip).    
+00014920: 6966 206e 6f74 2068 6f73 745f 7570 3a0a  if not host_up:.
+00014930: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00014940: 6365 7074 696f 6e28 6622 536f 6d65 7468  ception(f"Someth
+00014950: 696e 6720 7765 6e74 2077 726f 6e67 206c  ing went wrong l
+00014960: 6175 6e63 6869 6e67 2074 6865 2056 4d20  aunching the VM 
+00014970: 6174 2049 503a 207b 686f 7374 5f69 707d  at IP: {host_ip}
+00014980: 2e22 290a 0a20 2020 2069 6620 6e6f 7420  .")..    if not 
+00014990: 626f 6f6c 286b 7761 7267 735b 2270 726f  bool(kwargs["pro
+000149a0: 7669 7369 6f6e 225d 293a 0a20 2020 2020  vision"]):.     
+000149b0: 2020 2070 7269 6e74 2822 536b 6970 7069     print("Skippi
+000149c0: 6e67 2061 7574 6f6d 6174 6963 2070 726f  ng automatic pro
+000149d0: 7669 7369 6f6e 696e 672e 2229 0a20 2020  visioning.").   
+000149e0: 2020 2020 2070 7269 6e74 2822 564d 2063       print("VM c
+000149f0: 7265 6174 6564 2077 6974 683a 2229 0a20  reated with:"). 
+00014a00: 2020 2020 2020 2070 7269 6e74 2866 2249         print(f"I
+00014a10: 503a 207b 686f 7374 5f69 707d 2229 0a20  P: {host_ip}"). 
+00014a20: 2020 2020 2020 2070 7269 6e74 2866 2255         print(f"U
+00014a30: 7365 723a 207b 6175 7468 2e75 7365 726e  ser: {auth.usern
+00014a40: 616d 657d 2229 0a20 2020 2020 2020 2070  ame}").        p
+00014a50: 7269 6e74 2866 224b 6579 3a20 7b61 7574  rint(f"Key: {aut
+00014a60: 682e 6b65 795f 7061 7468 7d22 290a 2020  h.key_path}").  
+00014a70: 2020 2020 2020 7072 696e 7428 225c 6e43        print("\nC
+00014a80: 6f6e 6e65 6374 2077 6974 683a 2229 0a20  onnect with:"). 
+00014a90: 2020 2020 2020 2070 7269 6e74 2866 2273         print(f"s
+00014aa0: 7368 202d 6920 7b61 7574 682e 6b65 795f  sh -i {auth.key_
+00014ab0: 7061 7468 7d20 7b61 7574 682e 7573 6572  path} {auth.user
+00014ac0: 6e61 6d65 7d40 7b68 6f73 745f 6970 7d22  name}@{host_ip}"
+00014ad0: 290a 2020 2020 2020 2020 7379 732e 6578  ).        sys.ex
+00014ae0: 6974 2830 290a 0a20 2020 2023 2072 6570  it(0)..    # rep
+00014af0: 6c61 6365 0a20 2020 2068 6f73 745f 7465  lace.    host_te
+00014b00: 726d 2e70 6172 7365 5f69 6e70 7574 2868  rm.parse_input(h
+00014b10: 6f73 745f 6970 290a 2020 2020 7665 7262  ost_ip).    verb
+00014b20: 2e73 6574 5f6e 616d 6564 5f74 6572 6d5f  .set_named_term_
+00014b30: 7479 7065 286e 616d 653d 2268 6f73 7422  type(name="host"
+00014b40: 2c20 6e65 775f 7465 726d 3d68 6f73 745f  , new_term=host_
+00014b50: 7465 726d 290a 0a20 2020 2065 7874 7261  term)..    extra
+00014b60: 5f6b 7761 7267 7320 3d20 7b0a 2020 2020  _kwargs = {.    
+00014b70: 2020 2020 2272 6570 6f22 3a20 7265 706f      "repo": repo
+00014b80: 2c0a 2020 2020 2020 2020 2262 7261 6e63  ,.        "branc
+00014b90: 6822 3a20 6272 616e 6368 2c0a 2020 2020  h": branch,.    
+00014ba0: 2020 2020 2261 7574 685f 7479 7065 223a      "auth_type":
+00014bb0: 2022 6b65 7922 2c0a 2020 2020 2020 2020   "key",.        
+00014bc0: 2261 6e73 6962 6c65 5f65 7874 7261 7322  "ansible_extras"
+00014bd0: 3a20 616e 7369 626c 655f 6578 7472 6173  : ansible_extras
+00014be0: 2c0a 2020 2020 7d0a 2020 2020 6b77 6172  ,.    }.    kwar
+00014bf0: 6773 2e75 7064 6174 6528 6578 7472 615f  gs.update(extra_
+00014c00: 6b77 6172 6773 290a 0a20 2020 2023 2070  kwargs)..    # p
+00014c10: 726f 7669 7369 6f6e 0a20 2020 2072 6574  rovision.    ret
+00014c20: 7572 6e20 6372 6561 7465 5f6c 6175 6e63  urn create_launc
+00014c30: 685f 6375 7374 6f6d 5f63 6d64 2876 6572  h_custom_cmd(ver
+00014c40: 623d 7665 7262 2c20 6175 7468 3d61 7574  b=verb, auth=aut
+00014c50: 682c 206b 7761 7267 733d 6b77 6172 6773  h, kwargs=kwargs
+00014c60: 290a 0a0a 6465 6620 6d61 6b65 5f67 6370  )...def make_gcp
+00014c70: 5f76 6d28 0a20 2020 2076 6d5f 6e61 6d65  _vm(.    vm_name
+00014c80: 3a20 7374 722c 2070 726f 6a65 6374 5f69  : str, project_i
+00014c90: 643a 2073 7472 2c20 7a6f 6e65 3a20 7374  d: str, zone: st
+00014ca0: 722c 206d 6163 6869 6e65 5f74 7970 653a  r, machine_type:
+00014cb0: 2073 7472 2c20 6469 736b 5f73 697a 655f   str, disk_size_
+00014cc0: 6762 3a20 7374 720a 2920 2d3e 2073 7472  gb: str.) -> str
+00014cd0: 3a0a 2020 2020 6372 6561 7465 5f63 6d64  :.    create_cmd
+00014ce0: 203d 2022 6763 6c6f 7564 2063 6f6d 7075   = "gcloud compu
+00014cf0: 7465 2069 6e73 7461 6e63 6573 2063 7265  te instances cre
+00014d00: 6174 6522 0a20 2020 206e 6574 776f 726b  ate".    network
+00014d10: 5f73 6574 7469 6e67 7320 3d20 226e 6574  _settings = "net
+00014d20: 776f 726b 3d64 6566 6175 6c74 2c6e 6574  work=default,net
+00014d30: 776f 726b 2d74 6965 723d 5052 454d 4955  work-tier=PREMIU
+00014d40: 4d22 0a20 2020 206d 6169 6e74 656e 616e  M".    maintenan
+00014d50: 6365 5f70 6f6c 6963 7920 3d20 224d 4947  ce_policy = "MIG
+00014d60: 5241 5445 220a 2020 2020 7363 6f70 6573  RATE".    scopes
+00014d70: 203d 205b 0a20 2020 2020 2020 2022 6874   = [.        "ht
+00014d80: 7470 733a 2f2f 7777 772e 676f 6f67 6c65  tps://www.google
+00014d90: 6170 6973 2e63 6f6d 2f61 7574 682f 6465  apis.com/auth/de
+00014da0: 7673 746f 7261 6765 2e72 6561 645f 6f6e  vstorage.read_on
+00014db0: 6c79 222c 0a20 2020 2020 2020 2022 6874  ly",.        "ht
+00014dc0: 7470 733a 2f2f 7777 772e 676f 6f67 6c65  tps://www.google
+00014dd0: 6170 6973 2e63 6f6d 2f61 7574 682f 6c6f  apis.com/auth/lo
+00014de0: 6767 696e 672e 7772 6974 6522 2c0a 2020  gging.write",.  
+00014df0: 2020 2020 2020 2268 7474 7073 3a2f 2f77        "https://w
+00014e00: 7777 2e67 6f6f 676c 6561 7069 732e 636f  ww.googleapis.co
+00014e10: 6d2f 6175 7468 2f6d 6f6e 6974 6f72 696e  m/auth/monitorin
+00014e20: 672e 7772 6974 6522 2c0a 2020 2020 2020  g.write",.      
+00014e30: 2020 2268 7474 7073 3a2f 2f77 7777 2e67    "https://www.g
+00014e40: 6f6f 676c 6561 7069 732e 636f 6d2f 6175  oogleapis.com/au
+00014e50: 7468 2f73 6572 7669 6365 636f 6e74 726f  th/servicecontro
+00014e60: 6c22 2c0a 2020 2020 2020 2020 2268 7474  l",.        "htt
+00014e70: 7073 3a2f 2f77 7777 2e67 6f6f 676c 6561  ps://www.googlea
+00014e80: 7069 732e 636f 6d2f 6175 7468 2f73 6572  pis.com/auth/ser
+00014e90: 7669 6365 2e6d 616e 6167 656d 656e 742e  vice.management.
+00014ea0: 7265 6164 6f6e 6c79 222c 0a20 2020 2020  readonly",.     
+00014eb0: 2020 2022 6874 7470 733a 2f2f 7777 772e     "https://www.
+00014ec0: 676f 6f67 6c65 6170 6973 2e63 6f6d 2f61  googleapis.com/a
+00014ed0: 7574 682f 7472 6163 652e 6170 7065 6e64  uth/trace.append
+00014ee0: 222c 0a20 2020 205d 0a20 2020 2074 6167  ",.    ].    tag
+00014ef0: 7320 3d20 2268 7474 702d 7365 7276 6572  s = "http-server
+00014f00: 2c68 7474 7073 2d73 6572 7665 7222 0a20  ,https-server". 
+00014f10: 2020 2064 6973 6b5f 696d 6167 6520 3d20     disk_image = 
+00014f20: 2270 726f 6a65 6374 732f 7562 756e 7475  "projects/ubuntu
+00014f30: 2d6f 732d 636c 6f75 642f 676c 6f62 616c  -os-cloud/global
+00014f40: 2f69 6d61 6765 732f 7562 756e 7475 2d32  /images/ubuntu-2
+00014f50: 3030 342d 666f 6361 6c2d 7632 3032 3230  004-focal-v20220
+00014f60: 3330 3822 0a20 2020 2064 6973 6b20 3d20  308".    disk = 
+00014f70: 280a 2020 2020 2020 2020 6622 6175 746f  (.        f"auto
+00014f80: 2d64 656c 6574 653d 7965 732c 626f 6f74  -delete=yes,boot
+00014f90: 3d79 6573 2c64 6576 6963 652d 6e61 6d65  =yes,device-name
+00014fa0: 3d7b 766d 5f6e 616d 657d 2c69 6d61 6765  ={vm_name},image
+00014fb0: 3d7b 6469 736b 5f69 6d61 6765 7d2c 220a  ={disk_image},".
+00014fc0: 2020 2020 2020 2020 2b20 6622 6d6f 6465          + f"mode
+00014fd0: 3d72 772c 7369 7a65 3d7b 6469 736b 5f73  =rw,size={disk_s
+00014fe0: 697a 655f 6762 7d2c 7479 7065 3d70 642d  ize_gb},type=pd-
+00014ff0: 7373 6422 0a20 2020 2029 0a20 2020 2073  ssd".    ).    s
+00015000: 6563 7572 6974 795f 666c 6167 7320 3d20  ecurity_flags = 
+00015010: 280a 2020 2020 2020 2020 222d 2d6e 6f2d  (.        "--no-
+00015020: 7368 6965 6c64 6564 2d73 6563 7572 652d  shielded-secure-
+00015030: 626f 6f74 202d 2d73 6869 656c 6465 642d  boot --shielded-
+00015040: 7674 706d 2022 0a20 2020 2020 2020 202b  vtpm ".        +
+00015050: 2022 2d2d 7368 6965 6c64 6564 2d69 6e74   "--shielded-int
+00015060: 6567 7269 7479 2d6d 6f6e 6974 6f72 696e  egrity-monitorin
+00015070: 6720 2d2d 7265 7365 7276 6174 696f 6e2d  g --reservation-
+00015080: 6166 6669 6e69 7479 3d61 6e79 220a 2020  affinity=any".  
+00015090: 2020 290a 0a20 2020 2063 6d64 203d 2028    )..    cmd = (
+000150a0: 0a20 2020 2020 2020 2066 227b 6372 6561  .        f"{crea
+000150b0: 7465 5f63 6d64 7d20 7b76 6d5f 6e61 6d65  te_cmd} {vm_name
+000150c0: 7d20 220a 2020 2020 2020 2020 2b20 6622  } ".        + f"
+000150d0: 2d2d 7072 6f6a 6563 743d 7b70 726f 6a65  --project={proje
+000150e0: 6374 5f69 647d 2022 0a20 2020 2020 2020  ct_id} ".       
+000150f0: 202b 2066 222d 2d7a 6f6e 653d 7b7a 6f6e   + f"--zone={zon
+00015100: 657d 2022 0a20 2020 2020 2020 202b 2066  e} ".        + f
+00015110: 222d 2d6d 6163 6869 6e65 2d74 7970 653d  "--machine-type=
+00015120: 7b6d 6163 6869 6e65 5f74 7970 657d 2022  {machine_type} "
+00015130: 0a20 2020 2020 2020 202b 2066 222d 2d63  .        + f"--c
+00015140: 7265 6174 652d 6469 736b 3d7b 6469 736b  reate-disk={disk
+00015150: 7d20 220a 2020 2020 2020 2020 2b20 6622  } ".        + f"
+00015160: 2d2d 6e65 7477 6f72 6b2d 696e 7465 7266  --network-interf
+00015170: 6163 653d 7b6e 6574 776f 726b 5f73 6574  ace={network_set
+00015180: 7469 6e67 737d 2022 0a20 2020 2020 2020  tings} ".       
+00015190: 202b 2066 222d 2d6d 6169 6e74 656e 616e   + f"--maintenan
+000151a0: 6365 2d70 6f6c 6963 793d 7b6d 6169 6e74  ce-policy={maint
+000151b0: 656e 616e 6365 5f70 6f6c 6963 797d 2022  enance_policy} "
+000151c0: 0a20 2020 2020 2020 202b 2066 222d 2d73  .        + f"--s
+000151d0: 636f 7065 733d 7b27 2c27 2e6a 6f69 6e28  copes={','.join(
+000151e0: 7363 6f70 6573 297d 202d 2d74 6167 733d  scopes)} --tags=
+000151f0: 7b74 6167 737d 2022 0a20 2020 2020 2020  {tags} ".       
+00015200: 202b 2066 227b 7365 6375 7269 7479 5f66   + f"{security_f
+00015210: 6c61 6773 7d22 0a20 2020 2029 0a0a 2020  lags}".    )..  
+00015220: 2020 686f 7374 5f69 7020 3d20 4e6f 6e65    host_ip = None
+00015230: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00015240: 2020 7072 696e 7428 6622 4372 6561 7469    print(f"Creati
+00015250: 6e67 2076 6d2e 5c6e 5275 6e6e 696e 673a  ng vm.\nRunning:
+00015260: 207b 636d 647d 2229 0a20 2020 2020 2020   {cmd}").       
+00015270: 206f 7574 7075 7420 3d20 7375 6270 726f   output = subpro
+00015280: 6365 7373 2e63 6865 636b 5f6f 7574 7075  cess.check_outpu
+00015290: 7428 636d 642c 2073 6865 6c6c 3d54 7275  t(cmd, shell=Tru
+000152a0: 6529 2020 2320 6e6f 7365 630a 2020 2020  e)  # nosec.    
+000152b0: 2020 2020 686f 7374 5f69 7020 3d20 6578      host_ip = ex
+000152c0: 7472 6163 745f 686f 7374 5f69 705f 6763  tract_host_ip_gc
+000152d0: 7028 7374 646f 7574 3d6f 7574 7075 7429  p(stdout=output)
+000152e0: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+000152f0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00015300: 2020 2020 7072 696e 7428 2266 6169 6c65      print("faile
+00015310: 6422 2c20 6529 0a0a 2020 2020 6966 2068  d", e)..    if h
+00015320: 6f73 745f 6970 2069 7320 4e6f 6e65 3a0a  ost_ip is None:.
+00015330: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00015340: 6365 7074 696f 6e28 2246 6169 6c65 6420  ception("Failed 
+00015350: 746f 2063 7265 6174 6520 766d 206f 7220  to create vm or 
+00015360: 6765 7420 564d 2070 7562 6c69 6320 6970  get VM public ip
+00015370: 2229 0a0a 2020 2020 7265 7475 726e 2068  ")..    return h
+00015380: 6f73 745f 6970 0a0a 0a64 6566 2063 7265  ost_ip...def cre
+00015390: 6174 655f 6c61 756e 6368 5f61 7a75 7265  ate_launch_azure
+000153a0: 5f63 6d64 280a 2020 2020 7665 7262 3a20  _cmd(.    verb: 
+000153b0: 4772 616d 6d61 7256 6572 622c 0a20 2020  GrammarVerb,.   
+000153c0: 2072 6573 6f75 7263 655f 6772 6f75 703a   resource_group:
+000153d0: 2073 7472 2c0a 2020 2020 6c6f 6361 7469   str,.    locati
+000153e0: 6f6e 3a20 7374 722c 0a20 2020 2073 697a  on: str,.    siz
+000153f0: 653a 2073 7472 2c0a 2020 2020 7573 6572  e: str,.    user
+00015400: 6e61 6d65 3a20 7374 722c 0a20 2020 2070  name: str,.    p
+00015410: 6173 7377 6f72 643a 204f 7074 696f 6e61  assword: Optiona
+00015420: 6c5b 7374 725d 2c0a 2020 2020 6b65 795f  l[str],.    key_
+00015430: 7061 7468 3a20 4f70 7469 6f6e 616c 5b73  path: Optional[s
+00015440: 7472 5d2c 0a20 2020 2072 6570 6f3a 2073  tr],.    repo: s
+00015450: 7472 2c0a 2020 2020 6272 616e 6368 3a20  tr,.    branch: 
+00015460: 7374 722c 0a20 2020 2061 7574 683a 2041  str,.    auth: A
+00015470: 7574 6843 7265 6465 6e74 6961 6c73 2c0a  uthCredentials,.
+00015480: 2020 2020 616e 7369 626c 655f 6578 7472      ansible_extr
+00015490: 6173 3a20 7374 722c 0a20 2020 206b 7761  as: str,.    kwa
+000154a0: 7267 733a 2054 7970 6544 6963 745b 7374  rgs: TypeDict[st
+000154b0: 722c 2041 6e79 5d2c 0a29 202d 3e20 5479  r, Any],.) -> Ty
+000154c0: 7065 4c69 7374 5b73 7472 5d3a 0a20 2020  peList[str]:.   
+000154d0: 2067 6574 5f6f 725f 6d61 6b65 5f72 6573   get_or_make_res
+000154e0: 6f75 7263 655f 6772 6f75 7028 7265 736f  ource_group(reso
+000154f0: 7572 6365 5f67 726f 7570 3d72 6573 6f75  urce_group=resou
+00015500: 7263 655f 6772 6f75 702c 206c 6f63 6174  rce_group, locat
+00015510: 696f 6e3d 6c6f 6361 7469 6f6e 290a 0a20  ion=location).. 
+00015520: 2020 206e 6f64 655f 636f 756e 7420 3d20     node_count = 
+00015530: 6b77 6172 6773 2e67 6574 2822 6e6f 6465  kwargs.get("node
+00015540: 5f63 6f75 6e74 222c 2031 290a 2020 2020  _count", 1).    
+00015550: 7072 696e 7428 2254 6f74 616c 2056 4d73  print("Total VMs
+00015560: 2074 6f20 6372 6561 7465 3a20 222c 206e   to create: ", n
+00015570: 6f64 655f 636f 756e 7429 0a0a 2020 2020  ode_count)..    
+00015580: 2320 766d 0a20 2020 206e 6f64 655f 6e61  # vm.    node_na
+00015590: 6d65 203d 2076 6572 622e 6765 745f 6e61  me = verb.get_na
+000155a0: 6d65 645f 7465 726d 5f74 7970 6528 6e61  med_term_type(na
+000155b0: 6d65 3d22 6e6f 6465 5f6e 616d 6522 290a  me="node_name").
+000155c0: 2020 2020 736e 616b 655f 6e61 6d65 203d      snake_name =
+000155d0: 2073 7472 286e 6f64 655f 6e61 6d65 2e73   str(node_name.s
+000155e0: 6e61 6b65 5f69 6e70 7574 290a 2020 2020  nake_input).    
+000155f0: 696d 6167 655f 6e61 6d65 203d 2067 6574  image_name = get
+00015600: 5f61 7a75 7265 5f69 6d61 6765 286b 7761  _azure_image(kwa
+00015610: 7267 735b 2269 6d61 6765 5f6e 616d 6522  rgs["image_name"
+00015620: 5d29 0a20 2020 2068 6f73 745f 6970 7320  ]).    host_ips 
+00015630: 3d20 6d61 6b65 5f76 6d5f 617a 7572 6528  = make_vm_azure(
+00015640: 0a20 2020 2020 2020 2073 6e61 6b65 5f6e  .        snake_n
+00015650: 616d 652c 0a20 2020 2020 2020 2072 6573  ame,.        res
+00015660: 6f75 7263 655f 6772 6f75 702c 0a20 2020  ource_group,.   
+00015670: 2020 2020 2075 7365 726e 616d 652c 0a20       username,. 
+00015680: 2020 2020 2020 2070 6173 7377 6f72 642c         password,
+00015690: 0a20 2020 2020 2020 206b 6579 5f70 6174  .        key_pat
+000156a0: 682c 0a20 2020 2020 2020 2073 697a 652c  h,.        size,
+000156b0: 0a20 2020 2020 2020 2069 6d61 6765 5f6e  .        image_n
+000156c0: 616d 652c 0a20 2020 2020 2020 206e 6f64  ame,.        nod
+000156d0: 655f 636f 756e 742c 0a20 2020 2029 0a0a  e_count,.    )..
+000156e0: 2020 2020 2320 6f70 656e 2070 6f72 7420      # open port 
+000156f0: 3830 0a20 2020 206f 7065 6e5f 706f 7274  80.    open_port
+00015700: 5f76 6d5f 617a 7572 6528 0a20 2020 2020  _vm_azure(.     
+00015710: 2020 2072 6573 6f75 7263 655f 6772 6f75     resource_grou
+00015720: 703d 7265 736f 7572 6365 5f67 726f 7570  p=resource_group
+00015730: 2c0a 2020 2020 2020 2020 6e6f 6465 5f6e  ,.        node_n
+00015740: 616d 653d 736e 616b 655f 6e61 6d65 2c0a  ame=snake_name,.
+00015750: 2020 2020 2020 2020 706f 7274 5f6e 616d          port_nam
+00015760: 653d 2248 5454 5022 2c0a 2020 2020 2020  e="HTTP",.      
+00015770: 2020 706f 7274 3d38 302c 0a20 2020 2020    port=80,.     
+00015780: 2020 2070 7269 6f72 6974 793d 3530 302c     priority=500,
+00015790: 0a20 2020 2029 0a0a 2020 2020 2320 6f70  .    )..    # op
+000157a0: 656e 2070 6f72 7420 3434 330a 2020 2020  en port 443.    
+000157b0: 6f70 656e 5f70 6f72 745f 766d 5f61 7a75  open_port_vm_azu
+000157c0: 7265 280a 2020 2020 2020 2020 7265 736f  re(.        reso
+000157d0: 7572 6365 5f67 726f 7570 3d72 6573 6f75  urce_group=resou
+000157e0: 7263 655f 6772 6f75 702c 0a20 2020 2020  rce_group,.     
+000157f0: 2020 206e 6f64 655f 6e61 6d65 3d73 6e61     node_name=sna
+00015800: 6b65 5f6e 616d 652c 0a20 2020 2020 2020  ke_name,.       
+00015810: 2070 6f72 745f 6e61 6d65 3d22 4854 5450   port_name="HTTP
+00015820: 5322 2c0a 2020 2020 2020 2020 706f 7274  S",.        port
+00015830: 3d34 3433 2c0a 2020 2020 2020 2020 7072  =443,.        pr
+00015840: 696f 7269 7479 3d35 3031 2c0a 2020 2020  iority=501,.    
+00015850: 290a 0a20 2020 2069 6620 6b77 6172 6773  )..    if kwargs
+00015860: 5b22 6a75 7079 7465 7222 5d3a 0a20 2020  ["jupyter"]:.   
+00015870: 2020 2020 2023 206f 7065 6e20 706f 7274       # open port
+00015880: 2038 3838 380a 2020 2020 2020 2020 6f70   8888.        op
+00015890: 656e 5f70 6f72 745f 766d 5f61 7a75 7265  en_port_vm_azure
+000158a0: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
+000158b0: 736f 7572 6365 5f67 726f 7570 3d72 6573  source_group=res
+000158c0: 6f75 7263 655f 6772 6f75 702c 0a20 2020  ource_group,.   
+000158d0: 2020 2020 2020 2020 206e 6f64 655f 6e61           node_na
+000158e0: 6d65 3d73 6e61 6b65 5f6e 616d 652c 0a20  me=snake_name,. 
+000158f0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00015900: 6e61 6d65 3d22 4a75 7079 7465 7222 2c0a  name="Jupyter",.
+00015910: 2020 2020 2020 2020 2020 2020 706f 7274              port
+00015920: 3d38 3838 382c 0a20 2020 2020 2020 2020  =8888,.         
+00015930: 2020 2070 7269 6f72 6974 793d 3530 322c     priority=502,
+00015940: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00015950: 6c61 756e 6368 5f63 6d64 733a 2054 7970  launch_cmds: Typ
+00015960: 654c 6973 745b 7374 725d 203d 205b 5d0a  eList[str] = [].
+00015970: 0a20 2020 2066 6f72 2068 6f73 745f 6970  .    for host_ip
+00015980: 2069 6e20 686f 7374 5f69 7073 3a0a 2020   in host_ips:.  
+00015990: 2020 2020 2020 2320 6765 7420 6f6c 6420        # get old 
+000159a0: 686f 7374 0a20 2020 2020 2020 2068 6f73  host.        hos
+000159b0: 745f 7465 726d 203d 2076 6572 622e 6765  t_term = verb.ge
+000159c0: 745f 6e61 6d65 645f 7465 726d 5f68 6f73  t_named_term_hos
+000159d0: 7467 7261 6d6d 6172 286e 616d 653d 2268  tgrammar(name="h
+000159e0: 6f73 7422 290a 0a20 2020 2020 2020 2023  ost")..        #
+000159f0: 2072 6570 6c61 6365 0a20 2020 2020 2020   replace.       
+00015a00: 2068 6f73 745f 7465 726d 2e70 6172 7365   host_term.parse
+00015a10: 5f69 6e70 7574 2868 6f73 745f 6970 290a  _input(host_ip).
+00015a20: 2020 2020 2020 2020 7665 7262 2e73 6574          verb.set
+00015a30: 5f6e 616d 6564 5f74 6572 6d5f 7479 7065  _named_term_type
+00015a40: 286e 616d 653d 2268 6f73 7422 2c20 6e65  (name="host", ne
+00015a50: 775f 7465 726d 3d68 6f73 745f 7465 726d  w_term=host_term
+00015a60: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00015a70: 7420 626f 6f6c 286b 7761 7267 735b 2270  t bool(kwargs["p
+00015a80: 726f 7669 7369 6f6e 225d 293a 0a20 2020  rovision"]):.   
+00015a90: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00015aa0: 536b 6970 7069 6e67 2061 7574 6f6d 6174  Skipping automat
+00015ab0: 6963 2070 726f 7669 7369 6f6e 696e 672e  ic provisioning.
+00015ac0: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00015ad0: 7269 6e74 2822 564d 2063 7265 6174 6564  rint("VM created
+00015ae0: 2077 6974 683a 2229 0a20 2020 2020 2020   with:").       
+00015af0: 2020 2020 2070 7269 6e74 2866 224e 616d       print(f"Nam
+00015b00: 653a 207b 736e 616b 655f 6e61 6d65 7d22  e: {snake_name}"
+00015b10: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00015b20: 696e 7428 6622 4950 3a20 7b68 6f73 745f  int(f"IP: {host_
+00015b30: 6970 7d22 290a 2020 2020 2020 2020 2020  ip}").          
+00015b40: 2020 7072 696e 7428 6622 5573 6572 3a20    print(f"User: 
+00015b50: 7b75 7365 726e 616d 657d 2229 0a20 2020  {username}").   
+00015b60: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00015b70: 2250 6173 7377 6f72 643a 207b 7061 7373  "Password: {pass
+00015b80: 776f 7264 7d22 290a 2020 2020 2020 2020  word}").        
+00015b90: 2020 2020 7072 696e 7428 6622 4b65 793a      print(f"Key:
+00015ba0: 207b 6b65 795f 7061 7468 7d22 290a 2020   {key_path}").  
+00015bb0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00015bc0: 225c 6e43 6f6e 6e65 6374 2077 6974 683a  "\nConnect with:
+00015bd0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+00015be0: 6620 6b77 6172 6773 5b22 6175 7468 5f74  f kwargs["auth_t
+00015bf0: 7970 6522 5d20 3d3d 2022 6b65 7922 3a0a  ype"] == "key":.
+00015c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c10: 7072 696e 7428 6622 7373 6820 2d69 207b  print(f"ssh -i {
+00015c20: 6b65 795f 7061 7468 7d20 7b75 7365 726e  key_path} {usern
+00015c30: 616d 657d 407b 686f 7374 5f69 707d 2229  ame}@{host_ip}")
+00015c40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00015c50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00015c60: 2020 2070 7269 6e74 2866 2273 7368 207b     print(f"ssh {
+00015c70: 7573 6572 6e61 6d65 7d40 7b68 6f73 745f  username}@{host_
+00015c80: 6970 7d22 290a 2020 2020 2020 2020 656c  ip}").        el
+00015c90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015ca0: 6578 7472 615f 6b77 6172 6773 203d 207b  extra_kwargs = {
+00015cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015cc0: 2022 7265 706f 223a 2072 6570 6f2c 0a20   "repo": repo,. 
+00015cd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00015ce0: 6272 616e 6368 223a 2062 7261 6e63 682c  branch": branch,
+00015cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d00: 2022 616e 7369 626c 655f 6578 7472 6173   "ansible_extras
+00015d10: 223a 2061 6e73 6962 6c65 5f65 7874 7261  ": ansible_extra
+00015d20: 732c 0a20 2020 2020 2020 2020 2020 207d  s,.            }
+00015d30: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00015d40: 7267 732e 7570 6461 7465 2865 7874 7261  rgs.update(extra
+00015d50: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
+00015d60: 2020 2020 2020 2320 7072 6f76 6973 696f        # provisio
+00015d70: 6e0a 2020 2020 2020 2020 2020 2020 686f  n.            ho
+00015d80: 7374 5f75 7020 3d20 6368 6563 6b5f 6970  st_up = check_ip
+00015d90: 5f66 6f72 5f73 7368 2868 6f73 745f 6970  _for_ssh(host_ip
+00015da0: 3d68 6f73 745f 6970 290a 2020 2020 2020  =host_ip).      
+00015db0: 2020 2020 2020 6966 206e 6f74 2068 6f73        if not hos
+00015dc0: 745f 7570 3a0a 2020 2020 2020 2020 2020  t_up:.          
+00015dd0: 2020 2020 2020 7072 696e 7428 6622 5761        print(f"Wa
+00015de0: 726e 696e 673a 207b 686f 7374 5f69 707d  rning: {host_ip}
+00015df0: 2073 7368 206e 6f74 2061 7661 696c 6162   ssh not availab
+00015e00: 6c65 2079 6574 2229 0a20 2020 2020 2020  le yet").       
+00015e10: 2020 2020 206c 6175 6e63 685f 636d 6420       launch_cmd 
+00015e20: 3d20 6372 6561 7465 5f6c 6175 6e63 685f  = create_launch_
+00015e30: 6375 7374 6f6d 5f63 6d64 2876 6572 623d  custom_cmd(verb=
+00015e40: 7665 7262 2c20 6175 7468 3d61 7574 682c  verb, auth=auth,
+00015e50: 206b 7761 7267 733d 6b77 6172 6773 290a   kwargs=kwargs).
+00015e60: 2020 2020 2020 2020 2020 2020 6c61 756e              laun
+00015e70: 6368 5f63 6d64 732e 6170 7065 6e64 286c  ch_cmds.append(l
+00015e80: 6175 6e63 685f 636d 6429 0a0a 2020 2020  aunch_cmd)..    
+00015e90: 7265 7475 726e 206c 6175 6e63 685f 636d  return launch_cm
+00015ea0: 6473 0a0a 0a64 6566 2063 7265 6174 655f  ds...def create_
+00015eb0: 616e 7369 626c 655f 6c61 6e64 5f63 6d64  ansible_land_cmd
+00015ec0: 280a 2020 2020 7665 7262 3a20 4772 616d  (.    verb: Gram
+00015ed0: 6d61 7256 6572 622c 2061 7574 683a 204f  marVerb, auth: O
+00015ee0: 7074 696f 6e61 6c5b 4175 7468 4372 6564  ptional[AuthCred
+00015ef0: 656e 7469 616c 735d 2c20 6b77 6172 6773  entials], kwargs
+00015f00: 3a20 5479 7065 4469 6374 5b73 7472 2c20  : TypeDict[str, 
+00015f10: 416e 795d 0a29 202d 3e20 7374 723a 0a20  Any].) -> str:. 
+00015f20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00015f30: 686f 7374 5f74 6572 6d20 3d20 7665 7262  host_term = verb
+00015f40: 2e67 6574 5f6e 616d 6564 5f74 6572 6d5f  .get_named_term_
+00015f50: 686f 7374 6772 616d 6d61 7228 6e61 6d65  hostgrammar(name
+00015f60: 3d22 686f 7374 2229 0a20 2020 2020 2020  ="host").       
+00015f70: 2070 7269 6e74 2822 4c61 6e64 696e 6720   print("Landing 
+00015f80: 5079 4772 6964 206e 6f64 6520 6f6e 2070  PyGrid node on p
+00015f90: 6f72 7420 2220 2b20 7374 7228 686f 7374  ort " + str(host
+00015fa0: 5f74 6572 6d2e 706f 7274 2920 2b20 2221  _term.port) + "!
+00015fb0: 5c6e 2229 0a0a 2020 2020 2020 2020 7072  \n")..        pr
+00015fc0: 696e 7428 2220 202d 2050 4f52 543a 2022  int("  - PORT: "
+00015fd0: 202b 2073 7472 2868 6f73 745f 7465 726d   + str(host_term
+00015fe0: 2e70 6f72 7429 290a 2020 2020 2020 2020  .port)).        
+00015ff0: 7072 696e 7428 225c 6e22 290a 0a20 2020  print("\n")..   
+00016000: 2020 2020 2070 6c61 7962 6f6f 6b5f 7061       playbook_pa
+00016010: 7468 203d 2047 5249 445f 5352 435f 5041  th = GRID_SRC_PA
+00016020: 5448 202b 2022 2f61 6e73 6962 6c65 2f73  TH + "/ansible/s
+00016030: 6974 652e 796d 6c22 0a20 2020 2020 2020  ite.yml".       
+00016040: 2061 6e73 6962 6c65 5f63 6667 5f70 6174   ansible_cfg_pat
+00016050: 6820 3d20 4752 4944 5f53 5243 5f50 4154  h = GRID_SRC_PAT
+00016060: 4820 2b20 222f 616e 7369 626c 652e 6366  H + "/ansible.cf
+00016070: 6722 0a20 2020 2020 2020 2061 7574 6820  g".        auth 
+00016080: 3d20 6361 7374 2841 7574 6843 7265 6465  = cast(AuthCrede
+00016090: 6e74 6961 6c73 2c20 6175 7468 290a 0a20  ntials, auth).. 
+000160a0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000160b0: 2e70 6174 682e 6578 6973 7473 2870 6c61  .path.exists(pla
+000160c0: 7962 6f6f 6b5f 7061 7468 293a 0a20 2020  ybook_path):.   
+000160d0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+000160e0: 2243 616e 2774 2066 696e 6420 706c 6179  "Can't find play
+000160f0: 626f 6f6b 2073 6974 652e 796d 6c20 6174  book site.yml at
+00016100: 3a20 7b70 6c61 7962 6f6f 6b5f 7061 7468  : {playbook_path
+00016110: 7d22 290a 2020 2020 2020 2020 636d 6420  }").        cmd 
+00016120: 3d20 6622 414e 5349 424c 455f 434f 4e46  = f"ANSIBLE_CONF
+00016130: 4947 3d7b 616e 7369 626c 655f 6366 675f  IG={ansible_cfg_
+00016140: 7061 7468 7d20 616e 7369 626c 652d 706c  path} ansible-pl
+00016150: 6179 626f 6f6b 2022 0a20 2020 2020 2020  aybook ".       
+00016160: 2069 6620 686f 7374 5f74 6572 6d2e 686f   if host_term.ho
+00016170: 7374 203d 3d20 226c 6f63 616c 686f 7374  st == "localhost
+00016180: 223a 0a20 2020 2020 2020 2020 2020 2063  ":.            c
+00016190: 6d64 202b 3d20 222d 2d63 6f6e 6e65 6374  md += "--connect
+000161a0: 696f 6e3d 6c6f 6361 6c20 220a 2020 2020  ion=local ".    
+000161b0: 2020 2020 636d 6420 2b3d 2066 222d 6920      cmd += f"-i 
+000161c0: 7b68 6f73 745f 7465 726d 2e68 6f73 747d  {host_term.host}
+000161d0: 2c20 7b70 6c61 7962 6f6f 6b5f 7061 7468  , {playbook_path
+000161e0: 7d22 0a20 2020 2020 2020 2069 6620 686f  }".        if ho
+000161f0: 7374 5f74 6572 6d2e 686f 7374 2021 3d20  st_term.host != 
+00016200: 226c 6f63 616c 686f 7374 2220 616e 6420  "localhost" and 
+00016210: 6b77 6172 6773 5b22 6175 7468 5f74 7970  kwargs["auth_typ
+00016220: 6522 5d20 3d3d 2022 6b65 7922 3a0a 2020  e"] == "key":.  
+00016230: 2020 2020 2020 2020 2020 636d 6420 2b3d            cmd +=
+00016240: 2066 2220 2d2d 7072 6976 6174 652d 6b65   f" --private-ke
+00016250: 7920 7b61 7574 682e 6b65 795f 7061 7468  y {auth.key_path
+00016260: 7d20 2d2d 7573 6572 207b 6175 7468 2e75  } --user {auth.u
+00016270: 7365 726e 616d 657d 220a 2020 2020 2020  sername}".      
+00016280: 2020 656c 6966 2068 6f73 745f 7465 726d    elif host_term
+00016290: 2e68 6f73 7420 213d 2022 6c6f 6361 6c68  .host != "localh
+000162a0: 6f73 7422 2061 6e64 206b 7761 7267 735b  ost" and kwargs[
+000162b0: 2261 7574 685f 7479 7065 225d 203d 3d20  "auth_type"] == 
+000162c0: 2270 6173 7377 6f72 6422 3a0a 2020 2020  "password":.    
+000162d0: 2020 2020 2020 2020 636d 6420 2b3d 2066          cmd += f
+000162e0: 2220 2d63 2070 6172 616d 696b 6f20 2d2d  " -c paramiko --
+000162f0: 7573 6572 207b 6175 7468 2e75 7365 726e  user {auth.usern
+00016300: 616d 657d 220a 0a20 2020 2020 2020 2041  ame}"..        A
+00016310: 4e53 4942 4c45 5f41 5247 5320 3d20 7b22  NSIBLE_ARGS = {"
+00016320: 696e 7374 616c 6c22 3a20 2266 616c 7365  install": "false
+00016330: 227d 0a0a 2020 2020 2020 2020 6966 2068  "}..        if h
+00016340: 6f73 745f 7465 726d 2e68 6f73 7420 213d  ost_term.host !=
+00016350: 2022 6c6f 6361 6c68 6f73 7422 2061 6e64   "localhost" and
+00016360: 206b 7761 7267 735b 2261 7574 685f 7479   kwargs["auth_ty
+00016370: 7065 225d 203d 3d20 2270 6173 7377 6f72  pe"] == "passwor
+00016380: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+00016390: 414e 5349 424c 455f 4152 4753 5b22 616e  ANSIBLE_ARGS["an
+000163a0: 7369 626c 655f 7373 685f 7061 7373 225d  sible_ssh_pass"]
+000163b0: 203d 206b 7761 7267 735b 2270 6173 7377   = kwargs["passw
+000163c0: 6f72 6422 5d0a 0a20 2020 2020 2020 2069  ord"]..        i
+000163d0: 6620 686f 7374 5f74 6572 6d2e 686f 7374  f host_term.host
+000163e0: 203d 3d20 226c 6f63 616c 686f 7374 223a   == "localhost":
+000163f0: 0a20 2020 2020 2020 2020 2020 2041 4e53  .            ANS
+00016400: 4942 4c45 5f41 5247 535b 226c 6f63 616c  IBLE_ARGS["local
+00016410: 225d 203d 2022 7472 7565 220a 0a20 2020  "] = "true"..   
+00016420: 2020 2020 2069 6620 2261 6e73 6962 6c65       if "ansible
+00016430: 5f65 7874 7261 7322 2069 6e20 6b77 6172  _extras" in kwar
+00016440: 6773 2061 6e64 206b 7761 7267 735b 2261  gs and kwargs["a
+00016450: 6e73 6962 6c65 5f65 7874 7261 7322 5d20  nsible_extras"] 
+00016460: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+00016470: 2020 206f 7074 696f 6e73 203d 206b 7761     options = kwa
+00016480: 7267 735b 2261 6e73 6962 6c65 5f65 7874  rgs["ansible_ext
+00016490: 7261 7322 5d2e 7370 6c69 7428 222c 2229  ras"].split(",")
+000164a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000164b0: 206f 7074 696f 6e20 696e 206f 7074 696f   option in optio
+000164c0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+000164d0: 2020 2020 7061 7274 7320 3d20 6f70 7469      parts = opti
+000164e0: 6f6e 2e73 7472 6970 2829 2e73 706c 6974  on.strip().split
+000164f0: 2822 3d22 290a 2020 2020 2020 2020 2020  ("=").          
+00016500: 2020 2020 2020 6966 206c 656e 2870 6172        if len(par
+00016510: 7473 2920 3d3d 2032 3a0a 2020 2020 2020  ts) == 2:.      
+00016520: 2020 2020 2020 2020 2020 2020 2020 414e                AN
+00016530: 5349 424c 455f 4152 4753 5b70 6172 7473  SIBLE_ARGS[parts
+00016540: 5b30 5d5d 203d 2070 6172 7473 5b31 5d0a  [0]] = parts[1].
+00016550: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+00016560: 7620 696e 2041 4e53 4942 4c45 5f41 5247  v in ANSIBLE_ARG
+00016570: 532e 6974 656d 7328 293a 0a20 2020 2020  S.items():.     
+00016580: 2020 2020 2020 2063 6d64 202b 3d20 6622         cmd += f"
+00016590: 202d 6520 5c22 7b6b 7d3d 277b 767d 275c   -e \"{k}='{v}'\
+000165a0: 2222 0a0a 2020 2020 2020 2020 636d 6420  ""..        cmd 
+000165b0: 3d20 2263 6420 2220 2b20 4752 4944 5f53  = "cd " + GRID_S
+000165c0: 5243 5f50 4154 4820 2b20 223b 2220 2b20  RC_PATH + ";" + 
+000165d0: 636d 640a 2020 2020 2020 2020 7265 7475  cmd.        retu
+000165e0: 726e 2063 6d64 0a20 2020 2065 7863 6570  rn cmd.    excep
+000165f0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00016600: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00016610: 6622 4661 696c 6564 2074 6f20 636f 6e73  f"Failed to cons
+00016620: 7472 7563 7420 6375 7374 6f6d 2064 6570  truct custom dep
+00016630: 6c6f 796d 656e 7420 636d 643a 207b 636d  loyment cmd: {cm
+00016640: 647d 2e20 7b65 7d22 290a 2020 2020 2020  d}. {e}").      
+00016650: 2020 7261 6973 6520 650a 0a0a 6465 6620    raise e...def 
+00016660: 6372 6561 7465 5f6c 6175 6e63 685f 6375  create_launch_cu
+00016670: 7374 6f6d 5f63 6d64 280a 2020 2020 7665  stom_cmd(.    ve
+00016680: 7262 3a20 4772 616d 6d61 7256 6572 622c  rb: GrammarVerb,
+00016690: 2061 7574 683a 204f 7074 696f 6e61 6c5b   auth: Optional[
+000166a0: 4175 7468 4372 6564 656e 7469 616c 735d  AuthCredentials]
+000166b0: 2c20 6b77 6172 6773 3a20 5479 7065 4469  , kwargs: TypeDi
+000166c0: 6374 5b73 7472 2c20 416e 795d 0a29 202d  ct[str, Any].) -
+000166d0: 3e20 7374 723a 0a20 2020 2074 7279 3a0a  > str:.    try:.
+000166e0: 2020 2020 2020 2020 686f 7374 5f74 6572          host_ter
+000166f0: 6d20 3d20 7665 7262 2e67 6574 5f6e 616d  m = verb.get_nam
+00016700: 6564 5f74 6572 6d5f 686f 7374 6772 616d  ed_term_hostgram
+00016710: 6d61 7228 6e61 6d65 3d22 686f 7374 2229  mar(name="host")
+00016720: 0a20 2020 2020 2020 206e 6f64 655f 6e61  .        node_na
+00016730: 6d65 203d 2076 6572 622e 6765 745f 6e61  me = verb.get_na
+00016740: 6d65 645f 7465 726d 5f74 7970 6528 6e61  med_term_type(na
+00016750: 6d65 3d22 6e6f 6465 5f6e 616d 6522 290a  me="node_name").
+00016760: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00016770: 6520 3d20 7665 7262 2e67 6574 5f6e 616d  e = verb.get_nam
+00016780: 6564 5f74 6572 6d5f 7479 7065 286e 616d  ed_term_type(nam
+00016790: 653d 226e 6f64 655f 7479 7065 2229 0a20  e="node_type"). 
+000167a0: 2020 2020 2020 2023 2073 6f75 7263 655f         # source_
+000167b0: 7465 726d 203d 2076 6572 622e 6765 745f  term = verb.get_
+000167c0: 6e61 6d65 645f 7465 726d 5f74 7970 6528  named_term_type(
+000167d0: 6e61 6d65 3d22 736f 7572 6365 2229 0a0a  name="source")..
+000167e0: 2020 2020 2020 2020 736e 616b 655f 6e61          snake_na
+000167f0: 6d65 203d 2073 7472 286e 6f64 655f 6e61  me = str(node_na
+00016800: 6d65 2e73 6e61 6b65 5f69 6e70 7574 290a  me.snake_input).
+00016810: 0a20 2020 2020 2020 2069 6620 4152 543a  .        if ART:
+00016820: 0a20 2020 2020 2020 2020 2020 2068 6167  .            hag
+00016830: 7269 6428 290a 0a20 2020 2020 2020 2070  rid()..        p
+00016840: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00016850: 2020 224c 6175 6e63 6869 6e67 2061 2022    "Launching a "
+00016860: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
+00016870: 7472 286e 6f64 655f 7479 7065 2e69 6e70  tr(node_type.inp
+00016880: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
+00016890: 2b20 2220 5079 4772 6964 206e 6f64 6520  + " PyGrid node 
+000168a0: 6f6e 2070 6f72 7420 220a 2020 2020 2020  on port ".      
+000168b0: 2020 2020 2020 2b20 7374 7228 686f 7374        + str(host
+000168c0: 5f74 6572 6d2e 706f 7274 290a 2020 2020  _term.port).    
+000168d0: 2020 2020 2020 2020 2b20 2221 5c6e 220a          + "!\n".
+000168e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000168f0: 2020 2070 7269 6e74 2822 2020 2d20 5459     print("  - TY
+00016900: 5045 3a20 2220 2b20 7374 7228 6e6f 6465  PE: " + str(node
+00016910: 5f74 7970 652e 696e 7075 7429 290a 2020  _type.input)).  
+00016920: 2020 2020 2020 7072 696e 7428 2220 202d        print("  -
+00016930: 204e 414d 453a 2022 202b 2073 7472 2873   NAME: " + str(s
+00016940: 6e61 6b65 5f6e 616d 6529 290a 2020 2020  nake_name)).    
+00016950: 2020 2020 7072 696e 7428 2220 202d 2050      print("  - P
+00016960: 4f52 543a 2022 202b 2073 7472 2868 6f73  ORT: " + str(hos
+00016970: 745f 7465 726d 2e70 6f72 7429 290a 2020  t_term.port)).  
+00016980: 2020 2020 2020 7072 696e 7428 225c 6e22        print("\n"
+00016990: 290a 0a20 2020 2020 2020 2070 6c61 7962  )..        playb
+000169a0: 6f6f 6b5f 7061 7468 203d 2047 5249 445f  ook_path = GRID_
+000169b0: 5352 435f 5041 5448 202b 2022 2f61 6e73  SRC_PATH + "/ans
+000169c0: 6962 6c65 2f73 6974 652e 796d 6c22 0a20  ible/site.yml". 
+000169d0: 2020 2020 2020 2061 6e73 6962 6c65 5f63         ansible_c
+000169e0: 6667 5f70 6174 6820 3d20 4752 4944 5f53  fg_path = GRID_S
+000169f0: 5243 5f50 4154 4820 2b20 222f 616e 7369  RC_PATH + "/ansi
+00016a00: 626c 652e 6366 6722 0a20 2020 2020 2020  ble.cfg".       
+00016a10: 2061 7574 6820 3d20 6361 7374 2841 7574   auth = cast(Aut
+00016a20: 6843 7265 6465 6e74 6961 6c73 2c20 6175  hCredentials, au
+00016a30: 7468 290a 0a20 2020 2020 2020 2069 6620  th)..        if 
+00016a40: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00016a50: 7473 2870 6c61 7962 6f6f 6b5f 7061 7468  ts(playbook_path
+00016a60: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+00016a70: 7269 6e74 2866 2243 616e 2774 2066 696e  rint(f"Can't fin
+00016a80: 6420 706c 6179 626f 6f6b 2073 6974 652e  d playbook site.
+00016a90: 796d 6c20 6174 3a20 7b70 6c61 7962 6f6f  yml at: {playboo
+00016aa0: 6b5f 7061 7468 7d22 290a 2020 2020 2020  k_path}").      
+00016ab0: 2020 636d 6420 3d20 6622 414e 5349 424c    cmd = f"ANSIBL
+00016ac0: 455f 434f 4e46 4947 3d7b 616e 7369 626c  E_CONFIG={ansibl
+00016ad0: 655f 6366 675f 7061 7468 7d20 616e 7369  e_cfg_path} ansi
+00016ae0: 626c 652d 706c 6179 626f 6f6b 2022 0a20  ble-playbook ". 
+00016af0: 2020 2020 2020 2069 6620 686f 7374 5f74         if host_t
+00016b00: 6572 6d2e 686f 7374 203d 3d20 226c 6f63  erm.host == "loc
+00016b10: 616c 686f 7374 223a 0a20 2020 2020 2020  alhost":.       
+00016b20: 2020 2020 2063 6d64 202b 3d20 222d 2d63       cmd += "--c
+00016b30: 6f6e 6e65 6374 696f 6e3d 6c6f 6361 6c20  onnection=local 
+00016b40: 220a 2020 2020 2020 2020 636d 6420 2b3d  ".        cmd +=
+00016b50: 2066 222d 6920 7b68 6f73 745f 7465 726d   f"-i {host_term
+00016b60: 2e68 6f73 747d 2c20 7b70 6c61 7962 6f6f  .host}, {playboo
+00016b70: 6b5f 7061 7468 7d22 0a20 2020 2020 2020  k_path}".       
+00016b80: 2069 6620 686f 7374 5f74 6572 6d2e 686f   if host_term.ho
+00016b90: 7374 2021 3d20 226c 6f63 616c 686f 7374  st != "localhost
+00016ba0: 2220 616e 6420 6b77 6172 6773 5b22 6175  " and kwargs["au
+00016bb0: 7468 5f74 7970 6522 5d20 3d3d 2022 6b65  th_type"] == "ke
+00016bc0: 7922 3a0a 2020 2020 2020 2020 2020 2020  y":.            
+00016bd0: 636d 6420 2b3d 2066 2220 2d2d 7072 6976  cmd += f" --priv
+00016be0: 6174 652d 6b65 7920 7b61 7574 682e 6b65  ate-key {auth.ke
+00016bf0: 795f 7061 7468 7d20 2d2d 7573 6572 207b  y_path} --user {
+00016c00: 6175 7468 2e75 7365 726e 616d 657d 220a  auth.username}".
+00016c10: 2020 2020 2020 2020 656c 6966 2068 6f73          elif hos
+00016c20: 745f 7465 726d 2e68 6f73 7420 213d 2022  t_term.host != "
+00016c30: 6c6f 6361 6c68 6f73 7422 2061 6e64 206b  localhost" and k
+00016c40: 7761 7267 735b 2261 7574 685f 7479 7065  wargs["auth_type
+00016c50: 225d 203d 3d20 2270 6173 7377 6f72 6422  "] == "password"
+00016c60: 3a0a 2020 2020 2020 2020 2020 2020 636d  :.            cm
+00016c70: 6420 2b3d 2066 2220 2d63 2070 6172 616d  d += f" -c param
+00016c80: 696b 6f20 2d2d 7573 6572 207b 6175 7468  iko --user {auth
+00016c90: 2e75 7365 726e 616d 657d 220a 0a20 2020  .username}"..   
+00016ca0: 2020 2020 2076 6572 7369 6f6e 5f73 7472       version_str
+00016cb0: 696e 6720 3d20 6b77 6172 6773 5b22 7461  ing = kwargs["ta
+00016cc0: 6722 5d0a 2020 2020 2020 2020 6966 2076  g"].        if v
+00016cd0: 6572 7369 6f6e 5f73 7472 696e 6720 6973  ersion_string is
+00016ce0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00016cf0: 2020 2076 6572 7369 6f6e 5f73 7472 696e     version_strin
+00016d00: 6720 3d20 226c 6f63 616c 220a 0a20 2020  g = "local"..   
+00016d10: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
+00016d20: 5320 3d20 7b0a 2020 2020 2020 2020 2020  S = {.          
+00016d30: 2020 226e 6f64 655f 7479 7065 223a 206e    "node_type": n
+00016d40: 6f64 655f 7479 7065 2e69 6e70 7574 2c0a  ode_type.input,.
+00016d50: 2020 2020 2020 2020 2020 2020 226e 6f64              "nod
+00016d60: 655f 6e61 6d65 223a 2073 6e61 6b65 5f6e  e_name": snake_n
+00016d70: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00016d80: 2022 6769 7468 7562 5f72 6570 6f22 3a20   "github_repo": 
+00016d90: 6b77 6172 6773 5b22 7265 706f 225d 2c0a  kwargs["repo"],.
+00016da0: 2020 2020 2020 2020 2020 2020 2272 6570              "rep
+00016db0: 6f5f 6272 616e 6368 223a 206b 7761 7267  o_branch": kwarg
+00016dc0: 735b 2262 7261 6e63 6822 5d2c 0a20 2020  s["branch"],.   
+00016dd0: 2020 2020 2020 2020 2022 646f 636b 6572           "docker
+00016de0: 5f74 6167 223a 2076 6572 7369 6f6e 5f73  _tag": version_s
+00016df0: 7472 696e 672c 0a20 2020 2020 2020 207d  tring,.        }
+00016e00: 0a0a 2020 2020 2020 2020 6966 2068 6f73  ..        if hos
+00016e10: 745f 7465 726d 2e68 6f73 7420 213d 2022  t_term.host != "
+00016e20: 6c6f 6361 6c68 6f73 7422 2061 6e64 206b  localhost" and k
+00016e30: 7761 7267 735b 2261 7574 685f 7479 7065  wargs["auth_type
+00016e40: 225d 203d 3d20 2270 6173 7377 6f72 6422  "] == "password"
+00016e50: 3a0a 2020 2020 2020 2020 2020 2020 414e  :.            AN
+00016e60: 5349 424c 455f 4152 4753 5b22 616e 7369  SIBLE_ARGS["ansi
+00016e70: 626c 655f 7373 685f 7061 7373 225d 203d  ble_ssh_pass"] =
+00016e80: 206b 7761 7267 735b 2270 6173 7377 6f72   kwargs["passwor
+00016e90: 6422 5d0a 0a20 2020 2020 2020 2069 6620  d"]..        if 
+00016ea0: 686f 7374 5f74 6572 6d2e 686f 7374 203d  host_term.host =
+00016eb0: 3d20 226c 6f63 616c 686f 7374 223a 0a20  = "localhost":. 
+00016ec0: 2020 2020 2020 2020 2020 2041 4e53 4942             ANSIB
+00016ed0: 4c45 5f41 5247 535b 226c 6f63 616c 225d  LE_ARGS["local"]
+00016ee0: 203d 2022 7472 7565 220a 0a20 2020 2020   = "true"..     
+00016ef0: 2020 2069 6620 6b77 6172 6773 5b22 746c     if kwargs["tl
+00016f00: 7322 5d20 6973 2054 7275 653a 0a20 2020  s"] is True:.   
+00016f10: 2020 2020 2020 2020 2041 4e53 4942 4c45           ANSIBLE
+00016f20: 5f41 5247 535b 2274 6c73 225d 203d 2022  _ARGS["tls"] = "
+00016f30: 7472 7565 220a 0a20 2020 2020 2020 2069  true"..        i
+00016f40: 6620 2272 656c 6561 7365 2220 696e 206b  f "release" in k
+00016f50: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
+00016f60: 2020 2041 4e53 4942 4c45 5f41 5247 535b     ANSIBLE_ARGS[
+00016f70: 2272 656c 6561 7365 225d 203d 206b 7761  "release"] = kwa
+00016f80: 7267 735b 2272 656c 6561 7365 225d 0a0a  rgs["release"]..
+00016f90: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00016fa0: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+00016fb0: 2274 6c73 225d 2069 7320 5472 7565 0a20  "tls"] is True. 
+00016fc0: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
+00016fd0: 6365 7274 5f73 746f 7265 5f70 6174 6822  cert_store_path"
+00016fe0: 2069 6e20 6b77 6172 6773 0a20 2020 2020   in kwargs.     
+00016ff0: 2020 2020 2020 2061 6e64 206c 656e 286b         and len(k
+00017000: 7761 7267 735b 2263 6572 745f 7374 6f72  wargs["cert_stor
+00017010: 655f 7061 7468 225d 2920 3e20 300a 2020  e_path"]) > 0.  
+00017020: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00017030: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
+00017040: 535b 2263 6572 745f 7374 6f72 655f 7061  S["cert_store_pa
+00017050: 7468 225d 203d 206b 7761 7267 735b 2263  th"] = kwargs["c
+00017060: 6572 745f 7374 6f72 655f 7061 7468 225d  ert_store_path"]
+00017070: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
+00017080: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+00017090: 735b 2274 6c73 225d 2069 7320 5472 7565  s["tls"] is True
+000170a0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+000170b0: 2022 7570 6c6f 6164 5f74 6c73 5f6b 6579   "upload_tls_key
+000170c0: 2220 696e 206b 7761 7267 730a 2020 2020  " in kwargs.    
+000170d0: 2020 2020 2020 2020 616e 6420 6c65 6e28          and len(
+000170e0: 6b77 6172 6773 5b22 7570 6c6f 6164 5f74  kwargs["upload_t
+000170f0: 6c73 5f6b 6579 225d 2920 3e20 300a 2020  ls_key"]) > 0.  
+00017100: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00017110: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
+00017120: 535b 2275 706c 6f61 645f 746c 735f 6b65  S["upload_tls_ke
+00017130: 7922 5d20 3d20 6b77 6172 6773 5b22 7570  y"] = kwargs["up
+00017140: 6c6f 6164 5f74 6c73 5f6b 6579 225d 0a0a  load_tls_key"]..
+00017150: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00017160: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+00017170: 2274 6c73 225d 2069 7320 5472 7565 0a20  "tls"] is True. 
+00017180: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
+00017190: 7570 6c6f 6164 5f74 6c73 5f63 6572 7422  upload_tls_cert"
+000171a0: 2069 6e20 6b77 6172 6773 0a20 2020 2020   in kwargs.     
+000171b0: 2020 2020 2020 2061 6e64 206c 656e 286b         and len(k
+000171c0: 7761 7267 735b 2275 706c 6f61 645f 746c  wargs["upload_tl
+000171d0: 735f 6365 7274 225d 2920 3e20 300a 2020  s_cert"]) > 0.  
+000171e0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+000171f0: 2020 2020 2041 4e53 4942 4c45 5f41 5247       ANSIBLE_ARG
+00017200: 535b 2275 706c 6f61 645f 746c 735f 6365  S["upload_tls_ce
+00017210: 7274 225d 203d 206b 7761 7267 735b 2275  rt"] = kwargs["u
+00017220: 706c 6f61 645f 746c 735f 6365 7274 225d  pload_tls_cert"]
+00017230: 0a0a 2020 2020 2020 2020 6966 206b 7761  ..        if kwa
+00017240: 7267 735b 226a 7570 7974 6572 225d 2069  rgs["jupyter"] i
+00017250: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+00017260: 2020 2020 414e 5349 424c 455f 4152 4753      ANSIBLE_ARGS
+00017270: 5b22 6a75 7079 7465 7222 5d20 3d20 2274  ["jupyter"] = "t
+00017280: 7275 6522 0a20 2020 2020 2020 2020 2020  rue".           
+00017290: 2041 4e53 4942 4c45 5f41 5247 535b 226a   ANSIBLE_ARGS["j
+000172a0: 7570 7974 6572 5f74 6f6b 656e 225d 203d  upyter_token"] =
+000172b0: 2067 656e 6572 6174 655f 7365 635f 7261   generate_sec_ra
+000172c0: 6e64 6f6d 5f70 6173 7377 6f72 6428 0a20  ndom_password(. 
+000172d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000172e0: 656e 6774 683d 3438 2c20 7570 7065 725f  ength=48, upper_
+000172f0: 6361 7365 3d46 616c 7365 2c20 7370 6563  case=False, spec
+00017300: 6961 6c5f 6368 6172 733d 4661 6c73 650a  ial_chars=False.
+00017310: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00017320: 2020 2020 2020 2069 6620 2261 6e73 6962         if "ansib
+00017330: 6c65 5f65 7874 7261 7322 2069 6e20 6b77  le_extras" in kw
+00017340: 6172 6773 2061 6e64 206b 7761 7267 735b  args and kwargs[
+00017350: 2261 6e73 6962 6c65 5f65 7874 7261 7322  "ansible_extras"
+00017360: 5d20 213d 2022 223a 0a20 2020 2020 2020  ] != "":.       
+00017370: 2020 2020 206f 7074 696f 6e73 203d 206b       options = k
+00017380: 7761 7267 735b 2261 6e73 6962 6c65 5f65  wargs["ansible_e
+00017390: 7874 7261 7322 5d2e 7370 6c69 7428 222c  xtras"].split(",
+000173a0: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+000173b0: 6f72 206f 7074 696f 6e20 696e 206f 7074  or option in opt
+000173c0: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
+000173d0: 2020 2020 2020 7061 7274 7320 3d20 6f70        parts = op
+000173e0: 7469 6f6e 2e73 7472 6970 2829 2e73 706c  tion.strip().spl
+000173f0: 6974 2822 3d22 290a 2020 2020 2020 2020  it("=").        
+00017400: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
+00017410: 6172 7473 2920 3d3d 2032 3a0a 2020 2020  arts) == 2:.    
+00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017430: 414e 5349 424c 455f 4152 4753 5b70 6172  ANSIBLE_ARGS[par
+00017440: 7473 5b30 5d5d 203d 2070 6172 7473 5b31  ts[0]] = parts[1
+00017450: 5d0a 0a20 2020 2020 2020 2023 2069 6620  ]..        # if 
+00017460: 6d6f 6465 203d 3d20 2264 6570 6c6f 7922  mode == "deploy"
+00017470: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
+00017480: 414e 5349 424c 455f 4152 4753 5b22 6465  ANSIBLE_ARGS["de
+00017490: 706c 6f79 225d 203d 2022 7472 7565 220a  ploy"] = "true".
+000174a0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+000174b0: 7620 696e 2041 4e53 4942 4c45 5f41 5247  v in ANSIBLE_ARG
+000174c0: 532e 6974 656d 7328 293a 0a20 2020 2020  S.items():.     
+000174d0: 2020 2020 2020 2063 6d64 202b 3d20 6622         cmd += f"
+000174e0: 202d 6520 5c22 7b6b 7d3d 277b 767d 275c   -e \"{k}='{v}'\
+000174f0: 2222 0a0a 2020 2020 2020 2020 636d 6420  ""..        cmd 
+00017500: 3d20 2263 6420 2220 2b20 4752 4944 5f53  = "cd " + GRID_S
+00017510: 5243 5f50 4154 4820 2b20 223b 2220 2b20  RC_PATH + ";" + 
+00017520: 636d 640a 2020 2020 2020 2020 7265 7475  cmd.        retu
+00017530: 726e 2063 6d64 0a20 2020 2065 7863 6570  rn cmd.    excep
+00017540: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00017550: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00017560: 6622 4661 696c 6564 2074 6f20 636f 6e73  f"Failed to cons
+00017570: 7472 7563 7420 6375 7374 6f6d 2064 6570  truct custom dep
+00017580: 6c6f 796d 656e 7420 636d 643a 207b 636d  loyment cmd: {cm
+00017590: 647d 2e20 7b65 7d22 290a 2020 2020 2020  d}. {e}").      
+000175a0: 2020 7261 6973 6520 650a 0a0a 6465 6620    raise e...def 
+000175b0: 6372 6561 7465 5f6c 616e 645f 636d 6428  create_land_cmd(
+000175c0: 7665 7262 3a20 4772 616d 6d61 7256 6572  verb: GrammarVer
+000175d0: 622c 206b 7761 7267 733a 2054 7970 6544  b, kwargs: TypeD
+000175e0: 6963 745b 7374 722c 2041 6e79 5d29 202d  ict[str, Any]) -
+000175f0: 3e20 7374 723a 0a20 2020 2068 6f73 745f  > str:.    host_
+00017600: 7465 726d 203d 2076 6572 622e 6765 745f  term = verb.get_
+00017610: 6e61 6d65 645f 7465 726d 5f68 6f73 7467  named_term_hostg
+00017620: 7261 6d6d 6172 286e 616d 653d 2268 6f73  rammar(name="hos
+00017630: 7422 290a 2020 2020 686f 7374 203d 2068  t").    host = h
+00017640: 6f73 745f 7465 726d 2e68 6f73 7420 6966  ost_term.host if
+00017650: 2068 6f73 745f 7465 726d 2e68 6f73 7420   host_term.host 
+00017660: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00017670: 2022 220a 0a20 2020 2069 6620 686f 7374   ""..    if host
+00017680: 2069 6e20 5b22 646f 636b 6572 225d 3a0a   in ["docker"]:.
+00017690: 2020 2020 2020 2020 7461 7267 6574 203d          target =
+000176a0: 2076 6572 622e 6765 745f 6e61 6d65 645f   verb.get_named_
+000176b0: 7465 726d 5f67 7261 6d6d 6172 2822 6e6f  term_grammar("no
+000176c0: 6465 5f6e 616d 6522 292e 696e 7075 740a  de_name").input.
+000176d0: 2020 2020 2020 2020 6966 2074 6172 6765          if targe
+000176e0: 7420 3d3d 2022 616c 6c22 3a0a 2020 2020  t == "all":.    
+000176f0: 2020 2020 2020 2020 2320 7375 6270 726f          # subpro
+00017700: 6365 7373 2e63 616c 6c28 2264 6f63 6b65  cess.call("docke
+00017710: 7220 726d 2060 646f 636b 6572 2070 7320  r rm `docker ps 
+00017720: 2d61 7160 202d 2d66 6f72 6365 222c 2073  -aq` --force", s
+00017730: 6865 6c6c 3d54 7275 6529 2023 206e 6f73  hell=True) # nos
+00017740: 6563 0a20 2020 2020 2020 2020 2020 2072  ec.            r
+00017750: 6574 7572 6e20 2264 6f63 6b65 7220 726d  eturn "docker rm
+00017760: 2060 646f 636b 6572 2070 7320 2d61 7160   `docker ps -aq`
+00017770: 202d 2d66 6f72 6365 220a 0a20 2020 2020   --force"..     
+00017780: 2020 2076 6572 7369 6f6e 203d 2063 6865     version = che
+00017790: 636b 5f64 6f63 6b65 725f 7665 7273 696f  ck_docker_versio
+000177a0: 6e28 290a 2020 2020 2020 2020 6966 2076  n().        if v
+000177b0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
+000177c0: 2020 2020 7265 7475 726e 2063 7265 6174      return creat
+000177d0: 655f 6c61 6e64 5f64 6f63 6b65 725f 636d  e_land_docker_cm
+000177e0: 6428 7665 7262 3d76 6572 6229 0a20 2020  d(verb=verb).   
+000177f0: 2065 6c69 6620 686f 7374 203d 3d20 226c   elif host == "l
+00017800: 6f63 616c 686f 7374 2220 6f72 2069 735f  ocalhost" or is_
+00017810: 7661 6c69 645f 6970 2868 6f73 7429 3a0a  valid_ip(host):.
+00017820: 2020 2020 2020 2020 7061 7273 6564 5f6b          parsed_k
+00017830: 7761 7267 7320 3d20 7b7d 0a20 2020 2020  wargs = {}.     
+00017840: 2020 2069 6620 4445 5045 4e44 454e 4349     if DEPENDENCI
+00017850: 4553 5b22 616e 7369 626c 652d 706c 6179  ES["ansible-play
+00017860: 626f 6f6b 225d 3a0a 2020 2020 2020 2020  book"]:.        
+00017870: 2020 2020 6966 2068 6f73 7420 213d 2022      if host != "
+00017880: 6c6f 6361 6c68 6f73 7422 3a0a 2020 2020  localhost":.    
+00017890: 2020 2020 2020 2020 2020 2020 7061 7273              pars
+000178a0: 6564 5f6b 7761 7267 735b 2275 7365 726e  ed_kwargs["usern
+000178b0: 616d 6522 5d20 3d20 6173 6b28 0a20 2020  ame"] = ask(.   
+000178c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178d0: 2071 7565 7374 696f 6e3d 5175 6573 7469   question=Questi
+000178e0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+000178f0: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+00017900: 6e61 6d65 3d22 7573 6572 6e61 6d65 222c  name="username",
+00017910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017920: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+00017930: 6e3d 6622 5573 6572 6e61 6d65 2066 6f72  n=f"Username for
+00017940: 207b 686f 7374 7d20 7769 7468 2073 7564   {host} with sud
+00017950: 6f20 7072 6976 6c65 6467 6573 3f22 2c0a  o privledges?",.
+00017960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017970: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+00017980: 6172 675f 6361 6368 655b 2275 7365 726e  arg_cache["usern
+00017990: 616d 6522 5d2c 0a20 2020 2020 2020 2020  ame"],.         
+000179a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+000179b0: 696e 643d 2273 7472 696e 6722 2c0a 2020  ind="string",.  
+000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179d0: 2020 2020 2020 6361 6368 653d 5472 7565        cache=True
+000179e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000179f0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00017a00: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+00017a10: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
+00017a20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00017a30: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00017a40: 7273 6564 5f6b 7761 7267 735b 2261 7574  rsed_kwargs["aut
+00017a50: 685f 7479 7065 225d 203d 2061 736b 280a  h_type"] = ask(.
+00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a70: 2020 2020 7175 6573 7469 6f6e 3d51 7565      question=Que
+00017a80: 7374 696f 6e28 0a20 2020 2020 2020 2020  stion(.         
+00017a90: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00017aa0: 6172 5f6e 616d 653d 2261 7574 685f 7479  ar_name="auth_ty
+00017ab0: 7065 222c 0a20 2020 2020 2020 2020 2020  pe",.           
+00017ac0: 2020 2020 2020 2020 2020 2020 2071 7565               que
+00017ad0: 7374 696f 6e3d 2244 6f20 796f 7520 7761  stion="Do you wa
+00017ae0: 6e74 2074 6f20 6c6f 6769 6e20 7769 7468  nt to login with
+00017af0: 2061 206b 6579 206f 7220 7061 7373 776f   a key or passwo
+00017b00: 7264 222c 0a20 2020 2020 2020 2020 2020  rd",.           
+00017b10: 2020 2020 2020 2020 2020 2020 2064 6566               def
+00017b20: 6175 6c74 3d61 7267 5f63 6163 6865 5b22  ault=arg_cache["
+00017b30: 6175 7468 5f74 7970 6522 5d2c 0a20 2020  auth_type"],.   
+00017b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b50: 2020 2020 206b 696e 643d 226f 7074 696f       kind="optio
+00017b60: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+00017b70: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
+00017b80: 6f6e 733d 5b22 6b65 7922 2c20 2270 6173  ons=["key", "pas
+00017b90: 7377 6f72 6422 5d2c 0a20 2020 2020 2020  sword"],.       
+00017ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bb0: 2063 6163 6865 3d54 7275 652c 0a20 2020   cache=True,.   
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bd0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+00017be0: 2020 2020 2020 2020 6b77 6172 6773 3d6b          kwargs=k
+00017bf0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00017c00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017c10: 2020 2020 2020 2020 2069 6620 7061 7273           if pars
+00017c20: 6564 5f6b 7761 7267 735b 2261 7574 685f  ed_kwargs["auth_
+00017c30: 7479 7065 225d 203d 3d20 226b 6579 223a  type"] == "key":
+00017c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c50: 2020 2020 2070 6172 7365 645f 6b77 6172       parsed_kwar
+00017c60: 6773 5b22 6b65 795f 7061 7468 225d 203d  gs["key_path"] =
+00017c70: 2061 736b 280a 2020 2020 2020 2020 2020   ask(.          
+00017c80: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+00017c90: 6573 7469 6f6e 3d51 7565 7374 696f 6e28  estion=Question(
+00017ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017cb0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00017cc0: 5f6e 616d 653d 226b 6579 5f70 6174 6822  _name="key_path"
+00017cd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+00017cf0: 6573 7469 6f6e 3d66 2250 7269 7661 7465  estion=f"Private
+00017d00: 206b 6579 2074 6f20 6163 6365 7373 207b   key to access {
+00017d10: 7061 7273 6564 5f6b 7761 7267 735b 2775  parsed_kwargs['u
+00017d20: 7365 726e 616d 6527 5d7d 407b 686f 7374  sername']}@{host
+00017d30: 7d3f 222c 0a20 2020 2020 2020 2020 2020  }?",.           
+00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d50: 2064 6566 6175 6c74 3d61 7267 5f63 6163   default=arg_cac
+00017d60: 6865 5b22 6b65 795f 7061 7468 225d 2c0a  he["key_path"],.
+00017d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d80: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
+00017d90: 3d22 7061 7468 222c 0a20 2020 2020 2020  ="path",.       
+00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017db0: 2020 2020 2063 6163 6865 3d54 7275 652c       cache=True,
+00017dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017dd0: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+00017de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017df0: 2020 2020 6b77 6172 6773 3d6b 7761 7267      kwargs=kwarg
+00017e00: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00017e10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017e20: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
+00017e30: 7273 6564 5f6b 7761 7267 735b 2261 7574  rsed_kwargs["aut
+00017e40: 685f 7479 7065 225d 203d 3d20 2270 6173  h_type"] == "pas
+00017e50: 7377 6f72 6422 3a0a 2020 2020 2020 2020  sword":.        
+00017e60: 2020 2020 2020 2020 2020 2020 7061 7273              pars
+00017e70: 6564 5f6b 7761 7267 735b 2270 6173 7377  ed_kwargs["passw
+00017e80: 6f72 6422 5d20 3d20 6173 6b28 0a20 2020  ord"] = ask(.   
+00017e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ea0: 2020 2020 2071 7565 7374 696f 6e3d 5175       question=Qu
+00017eb0: 6573 7469 6f6e 280a 2020 2020 2020 2020  estion(.        
+00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ed0: 2020 2020 7661 725f 6e61 6d65 3d22 7061      var_name="pa
+00017ee0: 7373 776f 7264 222c 0a20 2020 2020 2020  ssword",.       
+00017ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f00: 2020 2020 2071 7565 7374 696f 6e3d 6622       question=f"
+00017f10: 5061 7373 776f 7264 2066 6f72 207b 7061  Password for {pa
+00017f20: 7273 6564 5f6b 7761 7267 735b 2775 7365  rsed_kwargs['use
+00017f30: 726e 616d 6527 5d7d 407b 686f 7374 7d3f  rname']}@{host}?
+00017f40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00017f50: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00017f60: 696e 643d 2270 6173 7377 6f72 6422 2c0a  ind="password",.
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fa0: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
+00017fb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017fc0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00017fd0: 2020 2020 2061 7574 6820 3d20 4e6f 6e65       auth = None
+00017fe0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017ff0: 686f 7374 2021 3d20 226c 6f63 616c 686f  host != "localho
+00018000: 7374 223a 0a20 2020 2020 2020 2020 2020  st":.           
+00018010: 2020 2020 2069 6620 7061 7273 6564 5f6b       if parsed_k
+00018020: 7761 7267 735b 2261 7574 685f 7479 7065  wargs["auth_type
+00018030: 225d 203d 3d20 226b 6579 223a 0a20 2020  "] == "key":.   
+00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018050: 2061 7574 6820 3d20 4175 7468 4372 6564   auth = AuthCred
+00018060: 656e 7469 616c 7328 0a20 2020 2020 2020  entials(.       
+00018070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018080: 2075 7365 726e 616d 653d 7061 7273 6564   username=parsed
+00018090: 5f6b 7761 7267 735b 2275 7365 726e 616d  _kwargs["usernam
+000180a0: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+000180b0: 2020 2020 2020 2020 2020 2020 206b 6579               key
+000180c0: 5f70 6174 683d 7061 7273 6564 5f6b 7761  _path=parsed_kwa
+000180d0: 7267 735b 226b 6579 5f70 6174 6822 5d2c  rgs["key_path"],
+000180e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00018100: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00018110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018120: 2061 7574 6820 3d20 4175 7468 4372 6564   auth = AuthCred
+00018130: 656e 7469 616c 7328 0a20 2020 2020 2020  entials(.       
+00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018150: 2075 7365 726e 616d 653d 7061 7273 6564   username=parsed
+00018160: 5f6b 7761 7267 735b 2275 7365 726e 616d  _kwargs["usernam
+00018170: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+00018180: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00018190: 5f70 6174 683d 7061 7273 6564 5f6b 7761  _path=parsed_kwa
+000181a0: 7267 735b 2270 6173 7377 6f72 6422 5d2c  rgs["password"],
+000181b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000181c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000181d0: 2020 2020 2020 2069 6620 6e6f 7420 6175         if not au
+000181e0: 7468 2e76 616c 6964 3a0a 2020 2020 2020  th.valid:.      
+000181f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00018200: 6973 6520 4578 6365 7074 696f 6e28 6622  ise Exception(f"
+00018210: 4c6f 6769 6e20 4372 6564 656e 7469 616c  Login Credential
+00018220: 7320 6172 6520 6e6f 7420 7661 6c69 642e  s are not valid.
+00018230: 207b 6175 7468 7d22 290a 2020 2020 2020   {auth}").      
+00018240: 2020 2020 2020 7061 7273 6564 5f6b 7761        parsed_kwa
+00018250: 7267 735b 2261 6e73 6962 6c65 5f65 7874  rgs["ansible_ext
+00018260: 7261 7322 5d20 3d20 6b77 6172 6773 5b22  ras"] = kwargs["
+00018270: 616e 7369 626c 655f 6578 7472 6173 225d  ansible_extras"]
+00018280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00018290: 7572 6e20 6372 6561 7465 5f61 6e73 6962  urn create_ansib
+000182a0: 6c65 5f6c 616e 645f 636d 6428 7665 7262  le_land_cmd(verb
+000182b0: 3d76 6572 622c 2061 7574 683d 6175 7468  =verb, auth=auth
+000182c0: 2c20 6b77 6172 6773 3d70 6172 7365 645f  , kwargs=parsed_
+000182d0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+000182e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000182f0: 2020 6572 726f 7273 203d 205b 5d0a 2020    errors = [].  
+00018300: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00018310: 2044 4550 454e 4445 4e43 4945 535b 2261   DEPENDENCIES["a
+00018320: 6e73 6962 6c65 2d70 6c61 7962 6f6f 6b22  nsible-playbook"
+00018330: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00018340: 2020 2065 7272 6f72 732e 6170 7065 6e64     errors.append
+00018350: 2822 616e 7369 626c 652d 706c 6179 626f  ("ansible-playbo
+00018360: 6f6b 2229 0a20 2020 2020 2020 2020 2020  ok").           
+00018370: 2072 6169 7365 204d 6973 7369 6e67 4465   raise MissingDe
+00018380: 7065 6e64 656e 6379 280a 2020 2020 2020  pendency(.      
+00018390: 2020 2020 2020 2020 2020 6622 4c61 756e            f"Laun
+000183a0: 6368 696e 6720 6120 4375 7374 6f6d 2056  ching a Custom V
+000183b0: 4d20 7265 7175 6972 6573 3a20 7b27 2027  M requires: {' '
+000183c0: 2e6a 6f69 6e28 6572 726f 7273 297d 220a  .join(errors)}".
+000183d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000183e0: 2020 2068 6f73 745f 6f70 7469 6f6e 7320     host_options 
+000183f0: 3d20 222c 2022 2e6a 6f69 6e28 616c 6c6f  = ", ".join(allo
+00018400: 7765 645f 686f 7374 7329 0a20 2020 2072  wed_hosts).    r
+00018410: 6169 7365 204d 6973 7369 6e67 4465 7065  aise MissingDepe
+00018420: 6e64 656e 6379 280a 2020 2020 2020 2020  ndency(.        
+00018430: 6622 4c61 756e 6368 2072 6571 7569 7265  f"Launch require
+00018440: 7320 6120 636f 7272 6563 7420 686f 7374  s a correct host
+00018450: 206f 7074 696f 6e2c 2074 7279 3a20 7b68   option, try: {h
+00018460: 6f73 745f 6f70 7469 6f6e 737d 220a 2020  ost_options}".  
+00018470: 2020 290a 0a0a 6465 6620 6372 6561 7465    )...def create
+00018480: 5f6c 616e 645f 646f 636b 6572 5f63 6d64  _land_docker_cmd
+00018490: 2876 6572 623a 2047 7261 6d6d 6172 5665  (verb: GrammarVe
+000184a0: 7262 2920 2d3e 2073 7472 3a0a 2020 2020  rb) -> str:.    
+000184b0: 6e6f 6465 5f6e 616d 6520 3d20 7665 7262  node_name = verb
+000184c0: 2e67 6574 5f6e 616d 6564 5f74 6572 6d5f  .get_named_term_
+000184d0: 7479 7065 286e 616d 653d 226e 6f64 655f  type(name="node_
+000184e0: 6e61 6d65 2229 0a20 2020 2073 6e61 6b65  name").    snake
+000184f0: 5f6e 616d 6520 3d20 7374 7228 6e6f 6465  _name = str(node
+00018500: 5f6e 616d 652e 736e 616b 655f 696e 7075  _name.snake_inpu
+00018510: 7429 0a20 2020 2063 6f6e 7461 696e 6572  t).    container
+00018520: 7320 3d20 7368 656c 6c28 2264 6f63 6b65  s = shell("docke
+00018530: 7220 7073 202d 2d66 6f72 6d61 7420 277b  r ps --format '{
+00018540: 7b2e 4e61 6d65 737d 7d27 207c 2022 202b  {.Names}}' | " +
+00018550: 2066 2267 7265 7020 7b73 6e61 6b65 5f6e   f"grep {snake_n
+00018560: 616d 657d 2229 0a0a 2020 2020 2320 4368  ame}")..    # Ch
+00018570: 6563 6b20 6966 2074 6865 2063 6f6e 7461  eck if the conta
+00018580: 696e 6572 206e 616d 6520 6265 6c6f 6e67  iner name belong
+00018590: 7320 746f 2077 6f72 6b65 7220 636f 6e74  s to worker cont
+000185a0: 6169 6e65 720a 2020 2020 6966 2022 6365  ainer.    if "ce
+000185b0: 6c65 7279 776f 726b 6572 2220 696e 2063  leryworker" in c
+000185c0: 6f6e 7461 696e 6572 733a 0a20 2020 2020  ontainers:.     
+000185d0: 2020 2070 6174 6820 3d20 4752 4944 5f53     path = GRID_S
+000185e0: 5243 5f50 4154 480a 2020 2020 2020 2020  RC_PATH.        
+000185f0: 656e 765f 7661 7220 3d20 223b 6578 706f  env_var = ";expo
+00018600: 7274 2024 2863 6174 202e 656e 7620 7c20  rt $(cat .env | 
+00018610: 7365 6420 2773 2f23 2e2a 2f2f 6727 207c  sed 's/#.*//g' |
+00018620: 2078 6172 6773 293b 220a 2020 2020 656c   xargs);".    el
+00018630: 7365 3a0a 2020 2020 2020 2020 7061 7468  se:.        path
+00018640: 203d 2047 5249 445f 5352 435f 5041 5448   = GRID_SRC_PATH
+00018650: 202b 2022 2f77 6f72 6b65 7222 0a20 2020   + "/worker".   
+00018660: 2020 2020 2065 6e76 5f76 6172 203d 2022       env_var = "
+00018670: 3b65 7870 6f72 7420 2428 6361 7420 2e2e  ;export $(cat ..
+00018680: 2f2e 656e 7620 7c20 7365 6420 2773 2f23  /.env | sed 's/#
+00018690: 2e2a 2f2f 6727 207c 2078 6172 6773 293b  .*//g' | xargs);
+000186a0: 220a 0a20 2020 2063 6d64 203d 2022 220a  "..    cmd = "".
+000186b0: 2020 2020 636d 6420 2b3d 2022 646f 636b      cmd += "dock
+000186c0: 6572 2063 6f6d 706f 7365 220a 2020 2020  er compose".    
+000186d0: 636d 6420 2b3d 2027 202d 2d66 696c 6520  cmd += ' --file 
+000186e0: 2264 6f63 6b65 722d 636f 6d70 6f73 652e  "docker-compose.
+000186f0: 796d 6c22 270a 2020 2020 636d 6420 2b3d  yml"'.    cmd +=
+00018700: 2027 202d 2d70 726f 6a65 6374 2d6e 616d   ' --project-nam
+00018710: 6520 2227 202b 2073 6e61 6b65 5f6e 616d  e "' + snake_nam
+00018720: 6520 2b20 2722 270a 2020 2020 636d 6420  e + '"'.    cmd 
+00018730: 2b3d 2022 2064 6f77 6e22 0a0a 2020 2020  += " down"..    
+00018740: 636d 6420 3d20 2263 6420 2220 2b20 7061  cmd = "cd " + pa
+00018750: 7468 202b 2065 6e76 5f76 6172 202b 2063  th + env_var + c
+00018760: 6d64 0a20 2020 2072 6574 7572 6e20 636d  md.    return cm
+00018770: 640a 0a0a 4063 6c69 636b 2e63 6f6d 6d61  d...@click.comma
+00018780: 6e64 280a 2020 2020 6865 6c70 3d22 5374  nd(.    help="St
+00018790: 6f70 2061 2072 756e 6e69 6e67 2050 7947  op a running PyG
+000187a0: 7269 6420 646f 6d61 696e 2f6e 6574 776f  rid domain/netwo
+000187b0: 726b 206e 6f64 652e 222c 0a20 2020 2063  rk node.",.    c
+000187c0: 6f6e 7465 7874 5f73 6574 7469 6e67 733d  ontext_settings=
+000187d0: 7b22 7368 6f77 5f64 6566 6175 6c74 223a  {"show_default":
+000187e0: 2054 7275 657d 2c0a 290a 4063 6c69 636b   True},.).@click
+000187f0: 2e61 7267 756d 656e 7428 2261 7267 7322  .argument("args"
+00018800: 2c20 7479 7065 3d73 7472 2c20 6e61 7267  , type=str, narg
+00018810: 733d 2d31 290a 4063 6c69 636b 2e6f 7074  s=-1).@click.opt
+00018820: 696f 6e28 0a20 2020 2022 2d2d 636d 6422  ion(.    "--cmd"
+00018830: 2c0a 2020 2020 6973 5f66 6c61 673d 5472  ,.    is_flag=Tr
+00018840: 7565 2c0a 2020 2020 6865 6c70 3d22 5072  ue,.    help="Pr
+00018850: 696e 7420 7468 6520 636d 6420 7769 7468  int the cmd with
+00018860: 6f75 7420 7275 6e6e 696e 6720 6974 222c  out running it",
+00018870: 0a29 0a40 636c 6963 6b2e 6f70 7469 6f6e  .).@click.option
+00018880: 280a 2020 2020 222d 2d61 6e73 6962 6c65  (.    "--ansible
+00018890: 2d65 7874 7261 7322 2c0a 2020 2020 6465  -extras",.    de
+000188a0: 6661 756c 743d 2222 2c0a 2020 2020 7479  fault="",.    ty
+000188b0: 7065 3d73 7472 2c0a 290a 4063 6c69 636b  pe=str,.).@click
+000188c0: 2e6f 7074 696f 6e28 0a20 2020 2022 2d2d  .option(.    "--
+000188d0: 6275 696c 642d 7372 6322 2c0a 2020 2020  build-src",.    
+000188e0: 6465 6661 756c 743d 4445 4641 554c 545f  default=DEFAULT_
+000188f0: 4252 414e 4348 2c0a 2020 2020 7265 7175  BRANCH,.    requ
+00018900: 6972 6564 3d46 616c 7365 2c0a 2020 2020  ired=False,.    
+00018910: 7479 7065 3d73 7472 2c0a 2020 2020 6865  type=str,.    he
+00018920: 6c70 3d22 4769 7420 6272 616e 6368 2074  lp="Git branch t
+00018930: 6f20 7573 6520 666f 7220 6c61 756e 6368  o use for launch
+00018940: 202f 2062 7569 6c64 206f 7065 7261 7469   / build operati
+00018950: 6f6e 7322 2c0a 290a 4063 6c69 636b 2e6f  ons",.).@click.o
+00018960: 7074 696f 6e28 0a20 2020 2022 2d2d 7369  ption(.    "--si
+00018970: 6c65 6e74 222c 0a20 2020 2069 735f 666c  lent",.    is_fl
+00018980: 6167 3d54 7275 652c 0a20 2020 2068 656c  ag=True,.    hel
+00018990: 703d 2253 7570 7072 6573 7320 6578 7472  p="Suppress extr
+000189a0: 6120 6f75 7470 7574 7322 2c0a 290a 4063  a outputs",.).@c
+000189b0: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+000189c0: 2022 2d2d 666f 7263 6522 2c0a 2020 2020   "--force",.    
+000189d0: 6973 5f66 6c61 673d 5472 7565 2c0a 2020  is_flag=True,.  
+000189e0: 2020 6865 6c70 3d22 4279 7061 7373 2074    help="Bypass t
+000189f0: 6865 2070 726f 6d70 7420 6475 7269 6e67  he prompt during
+00018a00: 2068 6167 7269 6420 6c61 6e64 222c 0a29   hagrid land",.)
+00018a10: 0a64 6566 206c 616e 6428 6172 6773 3a20  .def land(args: 
+00018a20: 5479 7065 5475 706c 655b 7374 725d 2c20  TypeTuple[str], 
+00018a30: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
+00018a40: 3e20 4e6f 6e65 3a0a 2020 2020 7665 7262  > None:.    verb
+00018a50: 203d 2067 6574 5f6c 616e 645f 7665 7262   = get_land_verb
+00018a60: 2829 0a20 2020 2073 696c 656e 7420 3d20  ().    silent = 
+00018a70: 626f 6f6c 286b 7761 7267 735b 2273 696c  bool(kwargs["sil
+00018a80: 656e 7422 5d29 0a20 2020 2066 6f72 6365  ent"]).    force
+00018a90: 203d 2062 6f6f 6c28 6b77 6172 6773 5b22   = bool(kwargs["
+00018aa0: 666f 7263 6522 5d29 0a20 2020 2074 7279  force"]).    try
+00018ab0: 3a0a 2020 2020 2020 2020 6772 616d 6d61  :.        gramma
+00018ac0: 7220 3d20 7061 7273 655f 6772 616d 6d61  r = parse_gramma
+00018ad0: 7228 6172 6773 3d61 7267 732c 2076 6572  r(args=args, ver
+00018ae0: 623d 7665 7262 290a 2020 2020 2020 2020  b=verb).        
+00018af0: 7665 7262 2e6c 6f61 645f 6772 616d 6d61  verb.load_gramma
+00018b00: 7228 6772 616d 6d61 723d 6772 616d 6d61  r(grammar=gramma
+00018b10: 7229 0a20 2020 2065 7863 6570 7420 4261  r).    except Ba
+00018b20: 6447 7261 6d6d 6172 2061 7320 653a 0a20  dGrammar as e:. 
+00018b30: 2020 2020 2020 2070 7269 6e74 2865 290a         print(e).
+00018b40: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00018b50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00018b60: 2075 7064 6174 655f 7265 706f 2872 6570   update_repo(rep
+00018b70: 6f3d 4749 545f 5245 504f 2c20 6272 616e  o=GIT_REPO, bran
+00018b80: 6368 3d73 7472 286b 7761 7267 735b 2262  ch=str(kwargs["b
+00018b90: 7569 6c64 5f73 7263 225d 2929 0a20 2020  uild_src"])).   
+00018ba0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00018bb0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+00018bc0: 7072 696e 7428 6622 4661 696c 6564 2074  print(f"Failed t
+00018bd0: 6f20 7570 6461 7465 2072 6570 6f2e 207b  o update repo. {
+00018be0: 657d 2229 0a0a 2020 2020 7472 793a 0a20  e}")..    try:. 
+00018bf0: 2020 2020 2020 2063 6d64 203d 2063 7265         cmd = cre
+00018c00: 6174 655f 6c61 6e64 5f63 6d64 2876 6572  ate_land_cmd(ver
+00018c10: 623d 7665 7262 2c20 6b77 6172 6773 3d6b  b=verb, kwargs=k
+00018c20: 7761 7267 7329 0a20 2020 2065 7863 6570  wargs).    excep
+00018c30: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00018c40: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00018c50: 6622 7b65 7d22 290a 2020 2020 2020 2020  f"{e}").        
+00018c60: 7265 7475 726e 0a0a 2020 2020 7461 7267  return..    targ
+00018c70: 6574 203d 2076 6572 622e 6765 745f 6e61  et = verb.get_na
+00018c80: 6d65 645f 7465 726d 5f67 7261 6d6d 6172  med_term_grammar
+00018c90: 2822 6e6f 6465 5f6e 616d 6522 292e 696e  ("node_name").in
+00018ca0: 7075 740a 0a20 2020 2069 6620 6e6f 7420  put..    if not 
+00018cb0: 666f 7263 653a 0a20 2020 2020 2020 205f  force:.        _
+00018cc0: 6c61 6e64 5f64 6f6d 6169 6e20 3d20 6173  land_domain = as
+00018cd0: 6b28 0a20 2020 2020 2020 2020 2020 2051  k(.            Q
+00018ce0: 7565 7374 696f 6e28 0a20 2020 2020 2020  uestion(.       
+00018cf0: 2020 2020 2020 2020 2076 6172 5f6e 616d           var_nam
+00018d00: 653d 225f 6c61 6e64 5f64 6f6d 6169 6e22  e="_land_domain"
+00018d10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018d20: 2020 7175 6573 7469 6f6e 3d66 2241 7265    question=f"Are
+00018d30: 2079 6f75 2073 7572 6520 796f 7520 7761   you sure you wa
+00018d40: 6e74 2074 6f20 6c61 6e64 207b 7461 7267  nt to land {targ
+00018d50: 6574 7d20 2879 2f6e 2922 2c0a 2020 2020  et} (y/n)",.    
+00018d60: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
+00018d70: 3d22 7965 736e 6f22 2c0a 2020 2020 2020  ="yesno",.      
+00018d80: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00018d90: 2020 2020 206b 7761 7267 733d 7b7d 2c0a       kwargs={},.
+00018da0: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
+00018db0: 6620 666f 7263 6520 6f72 205f 6c61 6e64  f force or _land
+00018dc0: 5f64 6f6d 6169 6e20 3d3d 2022 7922 3a0a  _domain == "y":.
+00018dd0: 2020 2020 2020 2020 6966 206e 6f74 2062          if not b
+00018de0: 6f6f 6c28 6b77 6172 6773 5b22 636d 6422  ool(kwargs["cmd"
+00018df0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+00018e00: 6966 206e 6f74 2073 696c 656e 743a 0a20  if not silent:. 
+00018e10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00018e20: 7269 6e74 2822 5275 6e6e 696e 673a 205c  rint("Running: \
+00018e30: 6e22 2c20 636d 6429 0a20 2020 2020 2020  n", cmd).       
+00018e40: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00018e50: 2020 2020 2020 2020 2020 6966 2073 696c            if sil
+00018e60: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
+00018e70: 2020 2020 2020 2020 2070 726f 6365 7373           process
+00018e80: 203d 2073 7562 7072 6f63 6573 732e 506f   = subprocess.Po
+00018e90: 7065 6e28 2020 2320 6e6f 7365 630a 2020  pen(  # nosec.  
+00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018eb0: 2020 2020 2020 636d 642c 0a20 2020 2020        cmd,.     
+00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ed0: 2020 2073 7464 6f75 743d 7375 6270 726f     stdout=subpro
+00018ee0: 6365 7373 2e50 4950 452c 0a20 2020 2020  cess.PIPE,.     
+00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f00: 2020 2073 7464 6572 723d 7375 6270 726f     stderr=subpro
+00018f10: 6365 7373 2e50 4950 452c 0a20 2020 2020  cess.PIPE,.     
+00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f30: 2020 2063 7764 3d47 5249 445f 5352 435f     cwd=GRID_SRC_
+00018f40: 5041 5448 2c0a 2020 2020 2020 2020 2020  PATH,.          
+00018f50: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00018f60: 656c 6c3d 5472 7565 2c0a 2020 2020 2020  ell=True,.      
+00018f70: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00018f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f90: 2020 2020 7072 6f63 6573 732e 636f 6d6d      process.comm
+00018fa0: 756e 6963 6174 6528 290a 0a20 2020 2020  unicate()..     
+00018fb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00018fc0: 7269 6e74 2866 2248 4147 7269 6420 6c61  rint(f"HAGrid la
+00018fd0: 6e64 207b 7461 7267 6574 7d20 636f 6d70  nd {target} comp
+00018fe0: 6c65 7465 2122 290a 2020 2020 2020 2020  lete!").        
+00018ff0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00019000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019010: 2020 7375 6270 726f 6365 7373 2e63 616c    subprocess.cal
+00019020: 6c28 636d 642c 2073 6865 6c6c 3d54 7275  l(cmd, shell=Tru
+00019030: 652c 2063 7764 3d47 5249 445f 5352 435f  e, cwd=GRID_SRC_
+00019040: 5041 5448 2920 2023 206e 6f73 6563 0a20  PATH)  # nosec. 
+00019050: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00019060: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00019070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019080: 2020 7072 696e 7428 6622 4661 696c 6564    print(f"Failed
+00019090: 2074 6f20 7275 6e20 636d 643a 207b 636d   to run cmd: {cm
+000190a0: 647d 2e20 7b65 7d22 290a 2020 2020 656c  d}. {e}").    el
+000190b0: 7365 3a0a 2020 2020 2020 2020 7072 696e  se:.        prin
+000190c0: 7428 2248 6167 7269 6420 6c61 6e64 2061  t("Hagrid land a
+000190d0: 626f 7274 6564 2e22 290a 0a0a 636c 692e  borted.")...cli.
+000190e0: 6164 645f 636f 6d6d 616e 6428 6c61 756e  add_command(laun
+000190f0: 6368 290a 636c 692e 6164 645f 636f 6d6d  ch).cli.add_comm
+00019100: 616e 6428 6c61 6e64 290a 636c 692e 6164  and(land).cli.ad
+00019110: 645f 636f 6d6d 616e 6428 636c 6561 6e29  d_command(clean)
+00019120: 0a0a 0a40 636c 6963 6b2e 636f 6d6d 616e  ...@click.comman
+00019130: 6428 0a20 2020 2068 656c 703d 2253 686f  d(.    help="Sho
+00019140: 7720 4841 4772 6964 2064 6562 7567 2069  w HAGrid debug i
+00019150: 6e66 6f72 6d61 7469 6f6e 222c 2063 6f6e  nformation", con
+00019160: 7465 7874 5f73 6574 7469 6e67 733d 7b22  text_settings={"
+00019170: 7368 6f77 5f64 6566 6175 6c74 223a 2054  show_default": T
+00019180: 7275 657d 0a29 0a40 636c 6963 6b2e 6172  rue}.).@click.ar
+00019190: 6775 6d65 6e74 2822 6172 6773 222c 2074  gument("args", t
+000191a0: 7970 653d 7374 722c 206e 6172 6773 3d2d  ype=str, nargs=-
+000191b0: 3129 0a64 6566 2064 6562 7567 2861 7267  1).def debug(arg
+000191c0: 733a 2054 7970 6554 7570 6c65 5b73 7472  s: TypeTuple[str
+000191d0: 5d2c 202a 2a6b 7761 7267 733a 2054 7970  ], **kwargs: Typ
+000191e0: 6544 6963 745b 7374 722c 2041 6e79 5d29  eDict[str, Any])
+000191f0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 6465   -> None:.    de
+00019200: 6275 675f 696e 666f 203d 2067 6174 6865  bug_info = gathe
+00019210: 725f 6465 6275 6728 290a 2020 2020 7072  r_debug().    pr
+00019220: 696e 7428 225c 6e5c 6e57 6865 6e20 7265  int("\n\nWhen re
+00019230: 706f 7274 696e 6720 6275 6773 2c20 706c  porting bugs, pl
+00019240: 6561 7365 2063 6f70 7920 6576 6572 7974  ease copy everyt
+00019250: 6869 6e67 2062 6574 7765 656e 2074 6865  hing between the
+00019260: 206c 696e 6573 2e22 290a 2020 2020 7072   lines.").    pr
+00019270: 696e 7428 223d 3d3d 3d3d 3d3d 3d3d 3d3d  int("===========
+00019280: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019290: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000192a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000192b0: 3d3d 3d3d 3d3d 3d5c 6e22 290a 2020 2020  =======\n").    
+000192c0: 7072 696e 7428 6a73 6f6e 2e64 756d 7073  print(json.dumps
+000192d0: 2864 6562 7567 5f69 6e66 6f29 290a 2020  (debug_info)).  
+000192e0: 2020 7072 696e 7428 225c 6e3d 3d3d 3d3d    print("\n=====
+000192f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019300: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019310: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019320: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 5c6e 5c6e  ============\n\n
+00019330: 2229 0a0a 0a63 6c69 2e61 6464 5f63 6f6d  ")...cli.add_com
+00019340: 6d61 6e64 2864 6562 7567 290a 0a0a 4445  mand(debug)...DE
+00019350: 4641 554c 545f 4845 414c 5448 5f43 4845  FAULT_HEALTH_CHE
+00019360: 434b 5320 3d20 5b22 686f 7374 222c 2022  CKS = ["host", "
+00019370: 5549 2028 ceb2 6574 6129 222c 2022 6170  UI (..eta)", "ap
+00019380: 6922 2c20 2273 7368 222c 2022 6a75 7079  i", "ssh", "jupy
+00019390: 7465 7222 5d0a 4845 414c 5448 5f43 4845  ter"].HEALTH_CHE
+000193a0: 434b 5f46 554e 4354 494f 4e53 203d 207b  CK_FUNCTIONS = {
+000193b0: 0a20 2020 2022 686f 7374 223a 2063 6865  .    "host": che
+000193c0: 636b 5f68 6f73 742c 0a20 2020 2022 5549  ck_host,.    "UI
+000193d0: 2028 ceb2 6574 6129 223a 2063 6865 636b   (..eta)": check
+000193e0: 5f6c 6f67 696e 5f70 6167 652c 0a20 2020  _login_page,.   
+000193f0: 2022 6170 6922 3a20 6368 6563 6b5f 6170   "api": check_ap
+00019400: 695f 6d65 7461 6461 7461 2c0a 2020 2020  i_metadata,.    
+00019410: 2273 7368 223a 2063 6865 636b 5f69 705f  "ssh": check_ip_
+00019420: 666f 725f 7373 682c 0a20 2020 2022 6a75  for_ssh,.    "ju
+00019430: 7079 7465 7222 3a20 6368 6563 6b5f 6a75  pyter": check_ju
+00019440: 7079 7465 725f 7365 7276 6572 2c0a 7d0a  pyter_server,.}.
+00019450: 0a48 4541 4c54 485f 4348 4543 4b5f 4943  .HEALTH_CHECK_IC
+00019460: 4f4e 5320 3d20 7b0a 2020 2020 2268 6f73  ONS = {.    "hos
+00019470: 7422 3a20 22f0 9f94 8c22 2c0a 2020 2020  t": "....",.    
+00019480: 2255 4920 28ce b265 7461 2922 3a20 22f0  "UI (..eta)": ".
+00019490: 9f96 b122 2c0a 2020 2020 2261 7069 223a  ...",.    "api":
+000194a0: 2022 e29a 99ef b88f 222c 0a20 2020 2022   "......",.    "
+000194b0: 7373 6822 3a20 22f0 9f94 9022 2c0a 2020  ssh": "....",.  
+000194c0: 2020 226a 7570 7974 6572 223a 2022 f09f    "jupyter": "..
+000194d0: 9397 222c 0a7d 0a0a 4845 414c 5448 5f43  ..",.}..HEALTH_C
+000194e0: 4845 434b 5f55 524c 5320 3d20 7b0a 2020  HECK_URLS = {.  
+000194f0: 2020 2268 6f73 7422 3a20 227b 6970 5f61    "host": "{ip_a
+00019500: 6464 7265 7373 7d22 2c0a 2020 2020 2255  ddress}",.    "U
+00019510: 4920 28ce b265 7461 2922 3a20 2268 7474  I (..eta)": "htt
+00019520: 703a 2f2f 7b69 705f 6164 6472 6573 737d  p://{ip_address}
+00019530: 2f6c 6f67 696e 222c 0a20 2020 2022 6170  /login",.    "ap
+00019540: 6922 3a20 2268 7474 703a 2f2f 7b69 705f  i": "http://{ip_
+00019550: 6164 6472 6573 737d 2f61 7069 2f76 312f  address}/api/v1/
+00019560: 6f70 656e 6170 692e 6a73 6f6e 222c 0a20  openapi.json",. 
+00019570: 2020 2022 7373 6822 3a20 2268 6167 7269     "ssh": "hagri
+00019580: 6420 7373 6820 7b69 705f 6164 6472 6573  d ssh {ip_addres
+00019590: 737d 222c 0a20 2020 2022 6a75 7079 7465  s}",.    "jupyte
+000195a0: 7222 3a20 2268 7474 703a 2f2f 7b69 705f  r": "http://{ip_
+000195b0: 6164 6472 6573 737d 3a38 3838 3822 2c0a  address}:8888",.
+000195c0: 7d0a 0a0a 6465 6620 6368 6563 6b5f 686f  }...def check_ho
+000195d0: 7374 5f68 6561 6c74 6828 6970 5f61 6464  st_health(ip_add
+000195e0: 7265 7373 3a20 7374 722c 206b 6579 733a  ress: str, keys:
+000195f0: 2054 7970 654c 6973 745b 7374 725d 2920   TypeList[str]) 
+00019600: 2d3e 2054 7970 6544 6963 745b 7374 722c  -> TypeDict[str,
+00019610: 2062 6f6f 6c5d 3a0a 2020 2020 7374 6174   bool]:.    stat
+00019620: 7573 203d 207b 7d0a 2020 2020 666f 7220  us = {}.    for 
+00019630: 6b65 7920 696e 206b 6579 733a 0a20 2020  key in keys:.   
+00019640: 2020 2020 2066 756e 633a 2043 616c 6c61       func: Calla
+00019650: 626c 6520 3d20 4845 414c 5448 5f43 4845  ble = HEALTH_CHE
+00019660: 434b 5f46 554e 4354 494f 4e53 5b6b 6579  CK_FUNCTIONS[key
+00019670: 5d20 2023 2074 7970 653a 2069 676e 6f72  ]  # type: ignor
+00019680: 650a 2020 2020 2020 2020 7374 6174 7573  e.        status
+00019690: 5b6b 6579 5d20 3d20 6675 6e63 2869 705f  [key] = func(ip_
+000196a0: 6164 6472 6573 732c 2073 696c 656e 743d  address, silent=
+000196b0: 5472 7565 290a 2020 2020 7265 7475 726e  True).    return
+000196c0: 2073 7461 7475 730a 0a0a 6465 6620 6963   status...def ic
+000196d0: 6f6e 5f73 7461 7475 7328 7374 6174 7573  on_status(status
+000196e0: 3a20 626f 6f6c 2920 2d3e 2073 7472 3a0a  : bool) -> str:.
+000196f0: 2020 2020 7265 7475 726e 2022 e29c 8522      return "..."
+00019700: 2069 6620 7374 6174 7573 2065 6c73 6520   if status else 
+00019710: 22e2 9d8c 220a 0a0a 6465 6620 6765 745f  "..."...def get_
+00019720: 6865 616c 7468 5f63 6865 636b 7328 6970  health_checks(ip
+00019730: 5f61 6464 7265 7373 3a20 7374 7229 202d  _address: str) -
+00019740: 3e20 5479 7065 5475 706c 655b 626f 6f6c  > TypeTuple[bool
+00019750: 2c20 5479 7065 4c69 7374 5b54 7970 654c  , TypeList[TypeL
+00019760: 6973 745b 7374 725d 5d5d 3a0a 2020 2020  ist[str]]]:.    
+00019770: 6b65 7973 203d 206c 6973 7428 4445 4641  keys = list(DEFA
+00019780: 554c 545f 4845 414c 5448 5f43 4845 434b  ULT_HEALTH_CHECK
+00019790: 5329 0a20 2020 2069 6620 226c 6f63 616c  S).    if "local
+000197a0: 686f 7374 2220 696e 2069 705f 6164 6472  host" in ip_addr
+000197b0: 6573 733a 0a20 2020 2020 2020 206e 6577  ess:.        new
+000197c0: 5f6b 6579 7320 3d20 5b5d 0a20 2020 2020  _keys = [].     
+000197d0: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
+000197e0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+000197f0: 6966 206b 6579 206e 6f74 2069 6e20 5b22  if key not in ["
+00019800: 686f 7374 222c 2022 6a75 7079 7465 7222  host", "jupyter"
+00019810: 2c20 2273 7368 225d 3a0a 2020 2020 2020  , "ssh"]:.      
+00019820: 2020 2020 2020 2020 2020 6e65 775f 6b65            new_ke
+00019830: 7973 2e61 7070 656e 6428 6b65 7929 0a20  ys.append(key). 
+00019840: 2020 2020 2020 206b 6579 7320 3d20 6e65         keys = ne
+00019850: 775f 6b65 7973 0a0a 2020 2020 6865 616c  w_keys..    heal
+00019860: 7468 5f73 7461 7475 7320 3d20 6368 6563  th_status = chec
+00019870: 6b5f 686f 7374 5f68 6561 6c74 6828 6970  k_host_health(ip
+00019880: 5f61 6464 7265 7373 3d69 705f 6164 6472  _address=ip_addr
+00019890: 6573 732c 206b 6579 733d 6b65 7973 290a  ess, keys=keys).
+000198a0: 2020 2020 636f 6d70 6c65 7465 5f73 7461      complete_sta
+000198b0: 7475 7320 3d20 616c 6c28 6865 616c 7468  tus = all(health
+000198c0: 5f73 7461 7475 732e 7661 6c75 6573 2829  _status.values()
+000198d0: 290a 0a20 2020 2023 2066 696e 6420 706f  )..    # find po
+000198e0: 7274 2066 726f 6d20 6970 5f61 6464 7265  rt from ip_addre
+000198f0: 7373 0a20 2020 2074 7279 3a0a 2020 2020  ss.    try:.    
+00019900: 2020 2020 706f 7274 203d 2069 6e74 2869      port = int(i
+00019910: 705f 6164 6472 6573 732e 7370 6c69 7428  p_address.split(
+00019920: 223a 2229 5b31 5d29 0a20 2020 2065 7863  ":")[1]).    exc
+00019930: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00019940: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
+00019950: 2074 6f20 3830 0a20 2020 2020 2020 2070   to 80.        p
+00019960: 6f72 7420 3d20 3830 0a0a 2020 2020 2320  ort = 80..    # 
+00019970: 7572 6c20 746f 2064 6973 706c 6179 2062  url to display b
+00019980: 6173 6564 206f 6e20 7275 6e6e 696e 6720  ased on running 
+00019990: 656e 7669 726f 6e6d 656e 740a 2020 2020  environment.    
+000199a0: 6469 7370 6c61 795f 7572 6c20 3d20 6769  display_url = gi
+000199b0: 7470 6f64 5f75 726c 2870 6f72 7429 2e73  tpod_url(port).s
+000199c0: 706c 6974 2822 2f2f 2229 5b31 5d20 6966  plit("//")[1] if
+000199d0: 2069 735f 6769 7470 6f64 2829 2065 6c73   is_gitpod() els
+000199e0: 6520 6970 5f61 6464 7265 7373 0a0a 2020  e ip_address..  
+000199f0: 2020 2320 6669 6775 7265 206f 7574 2068    # figure out h
+00019a00: 6f77 2074 6f20 6164 6420 7468 6973 2062  ow to add this b
+00019a10: 6163 6b3f 0a20 2020 2023 2063 6f6e 736f  ack?.    # conso
+00019a20: 6c65 2e70 7269 6e74 2822 5b62 6f6c 6420  le.print("[bold 
+00019a30: 6d61 6765 6e74 615d 4368 6563 6b69 6e67  magenta]Checking
+00019a40: 2068 6f73 743a 5b2f 626f 6c64 206d 6167   host:[/bold mag
+00019a50: 656e 7461 5d22 2c20 6970 5f61 6464 7265  enta]", ip_addre
+00019a60: 7373 2c20 223a 6d61 6765 3a22 290a 2020  ss, ":mage:").  
+00019a70: 2020 7461 626c 655f 636f 6e74 656e 7473    table_contents
+00019a80: 203d 205b 5d0a 2020 2020 666f 7220 6b65   = [].    for ke
+00019a90: 792c 2076 616c 7565 2069 6e20 6865 616c  y, value in heal
+00019aa0: 7468 5f73 7461 7475 732e 6974 656d 7328  th_status.items(
+00019ab0: 293a 0a20 2020 2020 2020 2074 6162 6c65  ):.        table
+00019ac0: 5f63 6f6e 7465 6e74 732e 6170 7065 6e64  _contents.append
+00019ad0: 280a 2020 2020 2020 2020 2020 2020 5b0a  (.            [.
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 4845 414c 5448 5f43 4845 434b 5f49 434f  HEALTH_CHECK_ICO
+00019b00: 4e53 5b6b 6579 5d2c 0a20 2020 2020 2020  NS[key],.       
+00019b10: 2020 2020 2020 2020 206b 6579 2c0a 2020           key,.  
+00019b20: 2020 2020 2020 2020 2020 2020 2020 4845                HE
+00019b30: 414c 5448 5f43 4845 434b 5f55 524c 535b  ALTH_CHECK_URLS[
+00019b40: 6b65 795d 2e72 6570 6c61 6365 2822 7b69  key].replace("{i
+00019b50: 705f 6164 6472 6573 737d 222c 2064 6973  p_address}", dis
+00019b60: 706c 6179 5f75 726c 292c 0a20 2020 2020  play_url),.     
+00019b70: 2020 2020 2020 2020 2020 2069 636f 6e5f             icon_
+00019b80: 7374 6174 7573 2876 616c 7565 292c 0a20  status(value),. 
+00019b90: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+00019ba0: 2020 2020 2029 0a0a 2020 2020 7265 7475       )..    retu
+00019bb0: 726e 2063 6f6d 706c 6574 655f 7374 6174  rn complete_stat
+00019bc0: 7573 2c20 7461 626c 655f 636f 6e74 656e  us, table_conten
+00019bd0: 7473 0a0a 0a64 6566 2063 7265 6174 655f  ts...def create_
+00019be0: 6368 6563 6b5f 7461 626c 6528 0a20 2020  check_table(.   
+00019bf0: 2074 6162 6c65 5f63 6f6e 7465 6e74 733a   table_contents:
+00019c00: 2054 7970 654c 6973 745b 5479 7065 4c69   TypeList[TypeLi
+00019c10: 7374 5b73 7472 5d5d 2c20 7469 6d65 5f6c  st[str]], time_l
+00019c20: 6566 743a 2069 6e74 203d 2030 0a29 202d  eft: int = 0.) -
+00019c30: 3e20 7269 6368 2e74 6162 6c65 2e54 6162  > rich.table.Tab
+00019c40: 6c65 3a0a 2020 2020 7461 626c 6520 3d20  le:.    table = 
+00019c50: 7269 6368 2e74 6162 6c65 2e54 6162 6c65  rich.table.Table
+00019c60: 2829 0a20 2020 2074 6162 6c65 2e61 6464  ().    table.add
+00019c70: 5f63 6f6c 756d 6e28 2250 7947 7269 6422  _column("PyGrid"
+00019c80: 2c20 7374 796c 653d 226d 6167 656e 7461  , style="magenta
+00019c90: 2229 0a20 2020 2074 6162 6c65 2e61 6464  ").    table.add
+00019ca0: 5f63 6f6c 756d 6e28 2249 6e66 6f22 2c20  _column("Info", 
+00019cb0: 6a75 7374 6966 793d 226c 6566 7422 2c20  justify="left", 
+00019cc0: 6f76 6572 666c 6f77 3d22 666f 6c64 2229  overflow="fold")
+00019cd0: 0a20 2020 2074 696d 655f 6c65 6674 5f73  .    time_left_s
+00019ce0: 7472 203d 2022 2220 6966 2074 696d 655f  tr = "" if time_
+00019cf0: 6c65 6674 203d 3d20 3020 656c 7365 2073  left == 0 else s
+00019d00: 7472 2874 696d 655f 6c65 6674 290a 2020  tr(time_left).  
+00019d10: 2020 7461 626c 652e 6164 645f 636f 6c75    table.add_colu
+00019d20: 6d6e 2874 696d 655f 6c65 6674 5f73 7472  mn(time_left_str
+00019d30: 2c20 6a75 7374 6966 793d 226c 6566 7422  , justify="left"
+00019d40: 290a 2020 2020 666f 7220 726f 7720 696e  ).    for row in
+00019d50: 2074 6162 6c65 5f63 6f6e 7465 6e74 733a   table_contents:
+00019d60: 0a20 2020 2020 2020 2074 6162 6c65 2e61  .        table.a
+00019d70: 6464 5f72 6f77 2872 6f77 5b31 5d2c 2072  dd_row(row[1], r
+00019d80: 6f77 5b32 5d2c 2072 6f77 5b33 5d29 0a20  ow[2], row[3]). 
+00019d90: 2020 2072 6574 7572 6e20 7461 626c 650a     return table.
+00019da0: 0a0a 6465 6620 6765 745f 686f 7374 5f6e  ..def get_host_n
+00019db0: 616d 6528 636f 6e74 6169 6e65 725f 6e61  ame(container_na
+00019dc0: 6d65 3a20 7374 722c 2062 795f 7375 6666  me: str, by_suff
+00019dd0: 6978 3a20 7374 7229 202d 3e20 7374 723a  ix: str) -> str:
+00019de0: 0a20 2020 2023 2041 7373 756d 7074 696f  .    # Assumptio
+00019df0: 6e20 7765 2061 6c77 6179 7320 6765 7420  n we always get 
+00019e00: 7072 6f78 7920 636f 6e74 6169 6e65 7273  proxy containers
+00019e10: 2066 6972 7374 2e0a 2020 2020 2320 6966   first..    # if
+00019e20: 2075 7365 7273 2068 6176 6520 6f6c 6420   users have old 
+00019e30: 646f 636b 6572 2063 6f6d 706f 7365 2076  docker compose v
+00019e40: 6572 7369 6f73 2e0a 2020 2020 2320 7468  ersios..    # th
+00019e50: 6520 636f 6e74 6169 6e65 7220 6e61 6d65  e container name
+00019e60: 7320 6172 6520 5f20 696e 7374 6561 6420  s are _ instead 
+00019e70: 6f66 202d 0a20 2020 2023 2063 616e 6164  of -.    # canad
+00019e80: 615f 7072 6f78 795f 3120 696e 7374 6561  a_proxy_1 instea
+00019e90: 6420 6f66 2063 616e 6164 612d 7072 6f78  d of canada-prox
+00019ea0: 792d 310a 2020 2020 7472 793a 0a20 2020  y-1.    try:.   
+00019eb0: 2020 2020 2068 6f73 745f 6e61 6d65 203d       host_name =
+00019ec0: 2063 6f6e 7461 696e 6572 5f6e 616d 655b   container_name[
+00019ed0: 3020 3a20 636f 6e74 6169 6e65 725f 6e61  0 : container_na
+00019ee0: 6d65 2e66 696e 6428 6279 5f73 7566 6669  me.find(by_suffi
+00019ef0: 7829 202d 2031 5d20 2023 206e 6f71 613a  x) - 1]  # noqa:
+00019f00: 2045 3230 330a 2020 2020 6578 6365 7074   E203.    except
+00019f10: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00019f20: 2020 2020 686f 7374 5f6e 616d 6520 3d20      host_name = 
+00019f30: 2222 0a20 2020 2072 6574 7572 6e20 686f  "".    return ho
+00019f40: 7374 5f6e 616d 650a 0a0a 6465 6620 6765  st_name...def ge
+00019f50: 745f 646f 636b 6572 5f73 7461 7475 7328  t_docker_status(
+00019f60: 0a20 2020 2069 705f 6164 6472 6573 733a  .    ip_address:
+00019f70: 2073 7472 2c20 6e6f 6465 5f6e 616d 653a   str, node_name:
+00019f80: 204f 7074 696f 6e61 6c5b 7374 725d 0a29   Optional[str].)
+00019f90: 202d 3e20 5475 706c 655b 626f 6f6c 2c20   -> Tuple[bool, 
+00019fa0: 5475 706c 655b 7374 722c 2073 7472 5d5d  Tuple[str, str]]
+00019fb0: 3a0a 2020 2020 7572 6c20 3d20 6672 6f6d  :.    url = from
+00019fc0: 5f75 726c 2869 705f 6164 6472 6573 7329  _url(ip_address)
+00019fd0: 0a20 2020 2070 6f72 7420 3d20 7572 6c5b  .    port = url[
+00019fe0: 325d 0a20 2020 206e 6574 776f 726b 5f63  2].    network_c
+00019ff0: 6f6e 7461 696e 6572 203d 2028 0a20 2020  ontainer = (.   
+0001a000: 2020 2020 2073 6865 6c6c 280a 2020 2020       shell(.    
+0001a010: 2020 2020 2020 2020 2264 6f63 6b65 7220          "docker 
+0001a020: 7073 202d 2d66 6f72 6d61 7420 277b 7b2e  ps --format '{{.
+0001a030: 4e61 6d65 737d 7d20 7b7b 2e50 6f72 7473  Names}} {{.Ports
+0001a040: 7d7d 2720 7c20 2220 2b20 6622 6772 6570  }}' | " + f"grep
+0001a050: 2027 302e 302e 302e 303a 7b70 6f72 747d   '0.0.0.0:{port}
+0001a060: 2722 0a20 2020 2020 2020 2029 0a20 2020  '".        ).   
+0001a070: 2020 2020 202e 7374 7269 7028 290a 2020       .strip().  
+0001a080: 2020 2020 2020 2e73 706c 6974 2822 2022        .split(" "
+0001a090: 295b 305d 0a20 2020 2029 0a0a 2020 2020  )[0].    )..    
+0001a0a0: 2320 5365 636f 6e64 2063 6f6e 6469 7469  # Second conditi
+0001a0b0: 6f6e 616c 2068 616e 646c 6520 7468 6520  onal handle the 
+0001a0c0: 6361 7365 2077 6865 6e20 696e 7465 726e  case when intern
+0001a0d0: 616c 2070 6f72 7420 6f66 2077 6f72 6b65  al port of worke
+0001a0e0: 7220 636f 6e74 6169 6e65 720a 2020 2020  r container.    
+0001a0f0: 2320 6d61 7463 6865 7320 7769 7468 2068  # matches with h
+0001a100: 6f73 7420 706f 7274 206f 6620 6c61 756e  ost port of laun
+0001a110: 6368 6564 2044 6f6d 6169 6e2f 4e65 7477  ched Domain/Netw
+0001a120: 6f72 6b20 436f 6e74 6169 6e65 720a 2020  ork Container.  
+0001a130: 2020 6966 206e 6f74 206e 6574 776f 726b    if not network
+0001a140: 5f63 6f6e 7461 696e 6572 206f 7220 286e  _container or (n
+0001a150: 6f64 655f 6e61 6d65 2061 6e64 206e 6f64  ode_name and nod
+0001a160: 655f 6e61 6d65 206e 6f74 2069 6e20 6e65  e_name not in ne
+0001a170: 7477 6f72 6b5f 636f 6e74 6169 6e65 7229  twork_container)
+0001a180: 3a0a 2020 2020 2020 2020 2320 6368 6563  :.        # chec
+0001a190: 6b20 6966 2069 7420 6973 2061 2077 6f72  k if it is a wor
+0001a1a0: 6b65 7220 636f 6e74 6169 6e65 7220 616e  ker container an
+0001a1b0: 6420 616e 2069 6e74 6572 6e61 6c20 706f  d an internal po
+0001a1c0: 7274 2077 6173 2070 6173 7365 640a 2020  rt was passed.  
+0001a1d0: 2020 2020 2020 776f 726b 6572 5f63 6f6e        worker_con
+0001a1e0: 7461 696e 6572 735f 6f75 7470 7574 3a20  tainers_output: 
+0001a1f0: 7374 7220 3d20 7368 656c 6c28 0a20 2020  str = shell(.   
+0001a200: 2020 2020 2020 2020 2022 646f 636b 6572           "docker
+0001a210: 2070 7320 2d2d 666f 726d 6174 2027 7b7b   ps --format '{{
+0001a220: 2e4e 616d 6573 7d7d 207b 7b2e 506f 7274  .Names}} {{.Port
+0001a230: 737d 7d27 207c 2022 202b 2066 2267 7265  s}}' | " + f"gre
+0001a240: 7020 277b 706f 7274 7d2f 7463 7027 220a  p '{port}/tcp'".
+0001a250: 2020 2020 2020 2020 292e 7374 7269 7028          ).strip(
+0001a260: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0001a270: 2077 6f72 6b65 725f 636f 6e74 6169 6e65   worker_containe
+0001a280: 7273 5f6f 7574 7075 7420 6f72 206e 6f74  rs_output or not
+0001a290: 206e 6f64 655f 6e61 6d65 3a0a 2020 2020   node_name:.    
+0001a2a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001a2b0: 616c 7365 2c20 2822 222c 2022 2229 0a0a  alse, ("", "")..
+0001a2c0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0001a2d0: 7265 2061 7265 2077 6f72 6b65 7220 636f  re are worker co
+0001a2e0: 6e74 6169 6e65 7273 2077 6974 6820 616e  ntainers with an
+0001a2f0: 2069 6e74 6572 6e61 6c20 706f 7274 0a20   internal port. 
+0001a300: 2020 2020 2020 2023 2066 6574 6368 2074         # fetch t
+0001a310: 6865 2077 6f72 6b65 7220 636f 6e74 6169  he worker contai
+0001a320: 6e65 7220 7769 7468 2074 6865 206c 6175  ner with the lau
+0001a330: 6e63 6865 6420 776f 726b 6572 206e 616d  nched worker nam
+0001a340: 650a 2020 2020 2020 2020 776f 726b 6572  e.        worker
+0001a350: 5f63 6f6e 7461 696e 6572 7320 3d20 776f  _containers = wo
+0001a360: 726b 6572 5f63 6f6e 7461 696e 6572 735f  rker_containers_
+0001a370: 6f75 7470 7574 2e73 706c 6974 2822 5c6e  output.split("\n
+0001a380: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+0001a390: 6478 2c20 776f 726b 6572 5f63 6f6e 7461  dx, worker_conta
+0001a3a0: 696e 6572 2069 6e20 656e 756d 6572 6174  iner in enumerat
+0001a3b0: 6528 776f 726b 6572 5f63 6f6e 7461 696e  e(worker_contain
+0001a3c0: 6572 7329 3a0a 2020 2020 2020 2020 2020  ers):.          
+0001a3d0: 2020 636f 6e74 6169 6e65 725f 6e61 6d65    container_name
+0001a3e0: 203d 2077 6f72 6b65 725f 636f 6e74 6169   = worker_contai
+0001a3f0: 6e65 722e 7370 6c69 7428 2220 2229 5b30  ner.split(" ")[0
+0001a400: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0001a410: 206e 6f64 655f 6e61 6d65 2069 6e20 636f   node_name in co
+0001a420: 6e74 6169 6e65 725f 6e61 6d65 3a0a 2020  ntainer_name:.  
+0001a430: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001a440: 7477 6f72 6b5f 636f 6e74 6169 6e65 7220  twork_container 
+0001a450: 3d20 636f 6e74 6169 6e65 725f 6e61 6d65  = container_name
+0001a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a470: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+0001a480: 2320 4966 2074 6865 2077 6f72 6b65 7220  # If the worker 
+0001a490: 636f 6e74 6169 6e65 7220 6973 206e 6f74  container is not
+0001a4a0: 2063 7265 6174 6564 2079 6574 0a20 2020   created yet.   
+0001a4b0: 2020 2020 2069 6620 6964 7820 3d3d 206c       if idx == l
+0001a4c0: 656e 2877 6f72 6b65 725f 636f 6e74 6169  en(worker_contai
+0001a4d0: 6e65 7273 293a 0a20 2020 2020 2020 2020  ners):.         
+0001a4e0: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+0001a4f0: 2028 2222 2c20 2222 290a 0a20 2020 2069   ("", "")..    i
+0001a500: 6620 2270 726f 7879 2220 696e 206e 6574  f "proxy" in net
+0001a510: 776f 726b 5f63 6f6e 7461 696e 6572 3a0a  work_container:.
+0001a520: 2020 2020 2020 2020 686f 7374 5f6e 616d          host_nam
+0001a530: 6520 3d20 6765 745f 686f 7374 5f6e 616d  e = get_host_nam
+0001a540: 6528 6e65 7477 6f72 6b5f 636f 6e74 6169  e(network_contai
+0001a550: 6e65 722c 2062 795f 7375 6666 6978 3d22  ner, by_suffix="
+0001a560: 7072 6f78 7922 290a 0a20 2020 2020 2020  proxy")..       
+0001a570: 2062 6163 6b65 6e64 5f63 6f6e 7461 696e   backend_contain
+0001a580: 6572 7320 3d20 7368 656c 6c28 0a20 2020  ers = shell(.   
+0001a590: 2020 2020 2020 2020 2022 646f 636b 6572           "docker
+0001a5a0: 2070 7320 2d2d 666f 726d 6174 2027 7b7b   ps --format '{{
+0001a5b0: 2e4e 616d 6573 7d7d 2720 7c20 6772 6570  .Names}}' | grep
+0001a5c0: 2027 6261 636b 656e 6427 2022 0a20 2020   'backend' ".   
+0001a5d0: 2020 2020 2029 2e73 706c 6974 2829 0a0a       ).split()..
+0001a5e0: 2020 2020 2020 2020 5f62 6163 6b65 6e64          _backend
+0001a5f0: 5f65 7869 7374 7320 3d20 4661 6c73 650a  _exists = False.
+0001a600: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+0001a610: 6169 6e65 7220 696e 2062 6163 6b65 6e64  ainer in backend
+0001a620: 5f63 6f6e 7461 696e 6572 733a 0a20 2020  _containers:.   
+0001a630: 2020 2020 2020 2020 2069 6620 686f 7374           if host
+0001a640: 5f6e 616d 6520 696e 2063 6f6e 7461 696e  _name in contain
+0001a650: 6572 2061 6e64 2022 7374 7265 616d 2220  er and "stream" 
+0001a660: 6e6f 7420 696e 2063 6f6e 7461 696e 6572  not in container
+0001a670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a680: 2020 5f62 6163 6b65 6e64 5f65 7869 7374    _backend_exist
+0001a690: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
+0001a6a0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0001a6b0: 2020 2020 2020 2069 6620 6e6f 7420 5f62         if not _b
+0001a6c0: 6163 6b65 6e64 5f65 7869 7374 733a 0a20  ackend_exists:. 
+0001a6d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a6e0: 6e20 4661 6c73 652c 2028 2222 2c20 2222  n False, ("", ""
+0001a6f0: 290a 0a20 2020 2020 2020 2023 2049 6465  )..        # Ide
+0001a700: 6e74 6966 7969 6e67 2054 7970 6520 6f66  ntifying Type of
+0001a710: 204e 6f64 652e 0a20 2020 2020 2020 2068   Node..        h
+0001a720: 6561 6473 6361 6c65 5f63 6f6e 7461 696e  eadscale_contain
+0001a730: 6572 7320 3d20 7368 656c 6c28 0a20 2020  ers = shell(.   
+0001a740: 2020 2020 2020 2020 2022 646f 636b 6572           "docker
+0001a750: 2070 7320 2d2d 666f 726d 6174 2027 7b7b   ps --format '{{
+0001a760: 2e4e 616d 6573 7d7d 2720 7c20 6772 6570  .Names}}' | grep
+0001a770: 2027 6865 6164 7363 616c 6527 2022 0a20   'headscale' ". 
+0001a780: 2020 2020 2020 2029 2e73 706c 6974 2829         ).split()
+0001a790: 0a0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+0001a7a0: 7970 6520 3d20 2244 6f6d 6169 6e22 0a20  ype = "Domain". 
+0001a7b0: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
+0001a7c0: 696e 6572 2069 6e20 6865 6164 7363 616c  iner in headscal
+0001a7d0: 655f 636f 6e74 6169 6e65 7273 3a0a 2020  e_containers:.  
+0001a7e0: 2020 2020 2020 2020 2020 6966 2068 6f73            if hos
+0001a7f0: 745f 6e61 6d65 2069 6e20 636f 6e74 6169  t_name in contai
+0001a800: 6e65 723a 0a20 2020 2020 2020 2020 2020  ner:.           
+0001a810: 2020 2020 206e 6f64 655f 7479 7065 203d       node_type =
+0001a820: 2022 4e65 7477 6f72 6b22 0a20 2020 2020   "Network".     
+0001a830: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001a840: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a850: 2054 7275 652c 2028 686f 7374 5f6e 616d   True, (host_nam
+0001a860: 652c 206e 6f64 655f 7479 7065 290a 2020  e, node_type).  
+0001a870: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001a880: 2320 6865 616c 7468 2063 6865 636b 2066  # health check f
+0001a890: 6f72 2065 6e63 6c61 7665 206e 6f64 6520  or enclave node 
+0001a8a0: 7479 7065 0a20 2020 2020 2020 2068 6f73  type.        hos
+0001a8b0: 745f 6e61 6d65 203d 2067 6574 5f68 6f73  t_name = get_hos
+0001a8c0: 745f 6e61 6d65 286e 6574 776f 726b 5f63  t_name(network_c
+0001a8d0: 6f6e 7461 696e 6572 2c20 6279 5f73 7566  ontainer, by_suf
+0001a8e0: 6669 783d 2277 6f72 6b65 7222 290a 2020  fix="worker").  
+0001a8f0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0001a900: 652c 2028 686f 7374 5f6e 616d 652c 2022  e, (host_name, "
+0001a910: 576f 726b 6572 2229 0a0a 0a64 6566 2067  Worker")...def g
+0001a920: 6574 5f73 7966 745f 696e 7374 616c 6c5f  et_syft_install_
+0001a930: 7374 6174 7573 2868 6f73 745f 6e61 6d65  status(host_name
+0001a940: 3a20 7374 722c 206e 6f64 655f 7479 7065  : str, node_type
+0001a950: 3a20 7374 7229 202d 3e20 626f 6f6c 3a0a  : str) -> bool:.
+0001a960: 2020 2020 636f 6e74 6169 6e65 725f 7365      container_se
+0001a970: 6172 6368 203d 2022 6261 636b 656e 6422  arch = "backend"
+0001a980: 2069 6620 6e6f 6465 5f74 7970 6520 213d   if node_type !=
+0001a990: 2022 576f 726b 6572 2220 656c 7365 2022   "Worker" else "
+0001a9a0: 776f 726b 6572 220a 2020 2020 7365 6172  worker".    sear
+0001a9b0: 6368 5f63 6f6e 7461 696e 6572 7320 3d20  ch_containers = 
+0001a9c0: 7368 656c 6c28 0a20 2020 2020 2020 2022  shell(.        "
+0001a9d0: 646f 636b 6572 2070 7320 2d2d 666f 726d  docker ps --form
+0001a9e0: 6174 2027 7b7b 2e4e 616d 6573 7d7d 2720  at '{{.Names}}' 
+0001a9f0: 7c20 2220 2b20 6622 6772 6570 2027 7b63  | " + f"grep '{c
+0001aa00: 6f6e 7461 696e 6572 5f73 6561 7263 687d  ontainer_search}
+0001aa10: 2720 220a 2020 2020 292e 7370 6c69 7428  ' ".    ).split(
+0001aa20: 290a 0a20 2020 2063 6f6e 7465 7874 5f63  )..    context_c
+0001aa30: 6f6e 7461 696e 6572 203d 204e 6f6e 650a  ontainer = None.
+0001aa40: 2020 2020 666f 7220 636f 6e74 6169 6e65      for containe
+0001aa50: 7220 696e 2073 6561 7263 685f 636f 6e74  r in search_cont
+0001aa60: 6169 6e65 7273 3a0a 2020 2020 2020 2020  ainers:.        
+0001aa70: 2320 7374 7265 616d 206b 6579 776f 7264  # stream keyword
+0001aa80: 2069 7320 666f 7220 6f75 7220 6f6c 6420   is for our old 
+0001aa90: 636f 6e74 6169 6e65 7220 7374 6163 6b0a  container stack.
+0001aaa0: 2020 2020 2020 2020 6966 2068 6f73 745f          if host_
+0001aab0: 6e61 6d65 2069 6e20 636f 6e74 6169 6e65  name in containe
+0001aac0: 7220 616e 6420 2273 7472 6561 6d22 206e  r and "stream" n
+0001aad0: 6f74 2069 6e20 636f 6e74 6169 6e65 723a  ot in container:
+0001aae0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0001aaf0: 7465 7874 5f63 6f6e 7461 696e 6572 203d  text_container =
+0001ab00: 2063 6f6e 7461 696e 6572 0a20 2020 2020   container.     
+0001ab10: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+0001ab20: 2020 6966 206e 6f74 2063 6f6e 7465 7874    if not context
+0001ab30: 5f63 6f6e 7461 696e 6572 3a0a 2020 2020  _container:.    
+0001ab40: 2020 2020 7072 696e 7428 6622 e29d 8c20      print(f"... 
+0001ab50: 7b63 6f6e 7461 696e 6572 5f73 6561 7263  {container_searc
+0001ab60: 687d 2044 6f63 6b65 7220 5374 6163 6b20  h} Docker Stack 
+0001ab70: 666f 723a 207b 686f 7374 5f6e 616d 657d  for: {host_name}
+0001ab80: 206e 6f74 2066 6f75 6e64 2229 0a20 2020   not found").   
+0001ab90: 2020 2020 2065 7869 7428 3029 0a20 2020       exit(0).   
+0001aba0: 2065 6c73 653a 0a20 2020 2020 2020 2063   else:.        c
+0001abb0: 6f6e 7461 696e 6572 5f6c 6f67 203d 2073  ontainer_log = s
+0001abc0: 6865 6c6c 2866 2264 6f63 6b65 7220 6c6f  hell(f"docker lo
+0001abd0: 6773 207b 636f 6e74 6578 745f 636f 6e74  gs {context_cont
+0001abe0: 6169 6e65 727d 2229 0a20 2020 2020 2020  ainer}").       
+0001abf0: 2069 6620 2241 7070 6c69 6361 7469 6f6e   if "Application
+0001ac00: 2073 7461 7274 7570 2063 6f6d 706c 6574   startup complet
+0001ac10: 6522 206e 6f74 2069 6e20 636f 6e74 6169  e" not in contai
+0001ac20: 6e65 725f 6c6f 673a 0a20 2020 2020 2020  ner_log:.       
+0001ac30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001ac40: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+0001ac50: 2054 7275 650a 0a0a 4063 6c69 636b 2e63   True...@click.c
+0001ac60: 6f6d 6d61 6e64 280a 2020 2020 6865 6c70  ommand(.    help
+0001ac70: 3d22 4368 6563 6b20 6865 616c 7468 206f  ="Check health o
+0001ac80: 6620 616e 2049 5020 6164 6472 6573 732f  f an IP address/
+0001ac90: 6164 6472 6573 7365 7320 6f72 2061 2072  addresses or a r
+0001aca0: 6573 6f75 7263 6520 6772 6f75 7022 2c0a  esource group",.
+0001acb0: 2020 2020 636f 6e74 6578 745f 7365 7474      context_sett
+0001acc0: 696e 6773 3d7b 2273 686f 775f 6465 6661  ings={"show_defa
+0001acd0: 756c 7422 3a20 5472 7565 7d2c 0a29 0a40  ult": True},.).@
+0001ace0: 636c 6963 6b2e 6172 6775 6d65 6e74 2822  click.argument("
+0001acf0: 6970 5f61 6464 7265 7373 6573 222c 2074  ip_addresses", t
+0001ad00: 7970 653d 7374 722c 206e 6172 6773 3d2d  ype=str, nargs=-
+0001ad10: 3129 0a40 636c 6963 6b2e 6f70 7469 6f6e  1).@click.option
+0001ad20: 280a 2020 2020 222d 2d74 696d 656f 7574  (.    "--timeout
+0001ad30: 222c 0a20 2020 2064 6566 6175 6c74 3d33  ",.    default=3
+0001ad40: 3030 2c0a 2020 2020 6865 6c70 3d22 5469  00,.    help="Ti
+0001ad50: 6d65 6f75 7420 666f 7220 6861 6772 6964  meout for hagrid
+0001ad60: 2063 6865 636b 2063 6f6d 6d61 6e64 222c   check command",
+0001ad70: 0a29 0a40 636c 6963 6b2e 6f70 7469 6f6e  .).@click.option
+0001ad80: 280a 2020 2020 222d 2d76 6572 626f 7365  (.    "--verbose
+0001ad90: 222c 0a20 2020 2069 735f 666c 6167 3d54  ",.    is_flag=T
+0001ada0: 7275 652c 0a20 2020 2068 656c 703d 2252  rue,.    help="R
+0001adb0: 6566 7265 7368 206f 7574 7075 7422 2c0a  efresh output",.
+0001adc0: 290a 6465 6620 6368 6563 6b28 0a20 2020  ).def check(.   
+0001add0: 2069 705f 6164 6472 6573 7365 733a 2054   ip_addresses: T
+0001ade0: 7970 654c 6973 745b 7374 725d 2c20 7665  ypeList[str], ve
+0001adf0: 7262 6f73 653a 2062 6f6f 6c20 3d20 4661  rbose: bool = Fa
+0001ae00: 6c73 652c 2074 696d 656f 7574 3a20 556e  lse, timeout: Un
+0001ae10: 696f 6e5b 696e 742c 2073 7472 5d20 3d20  ion[int, str] = 
+0001ae20: 3330 300a 2920 2d3e 204e 6f6e 653a 0a20  300.) -> None:. 
+0001ae30: 2020 2063 6865 636b 5f73 7461 7475 7328     check_status(
+0001ae40: 6970 5f61 6464 7265 7373 6573 3d69 705f  ip_addresses=ip_
+0001ae50: 6164 6472 6573 7365 732c 2073 696c 656e  addresses, silen
+0001ae60: 743d 6e6f 7420 7665 7262 6f73 652c 2074  t=not verbose, t
+0001ae70: 696d 656f 7574 3d74 696d 656f 7574 290a  imeout=timeout).
+0001ae80: 0a0a 6465 6620 5f63 6865 636b 5f73 7461  ..def _check_sta
+0001ae90: 7475 7328 0a20 2020 2069 705f 6164 6472  tus(.    ip_addr
+0001aea0: 6573 7365 733a 2055 6e69 6f6e 5b73 7472  esses: Union[str
+0001aeb0: 2c20 5479 7065 4c69 7374 5b73 7472 5d5d  , TypeList[str]]
+0001aec0: 2c0a 2020 2020 7369 6c65 6e74 3a20 626f  ,.    silent: bo
+0001aed0: 6f6c 203d 2054 7275 652c 0a20 2020 2073  ol = True,.    s
+0001aee0: 6967 6e61 6c3a 204f 7074 696f 6e61 6c5b  ignal: Optional[
+0001aef0: 4576 656e 745d 203d 204e 6f6e 652c 0a20  Event] = None,. 
+0001af00: 2020 206e 6f64 655f 6e61 6d65 3a20 4f70     node_name: Op
+0001af10: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0001af20: 6e65 2c0a 2920 2d3e 204e 6f6e 653a 0a20  ne,.) -> None:. 
+0001af30: 2020 204f 4b5f 454d 4f4a 4920 3d20 5269     OK_EMOJI = Ri
+0001af40: 6368 456d 6f6a 6928 2277 6869 7465 5f68  chEmoji("white_h
+0001af50: 6561 7679 5f63 6865 636b 5f6d 6172 6b22  eavy_check_mark"
+0001af60: 292e 746f 5f73 7472 2829 0a20 2020 2023  ).to_str().    #
+0001af70: 2043 6865 636b 2069 6620 6970 5f61 6464   Check if ip_add
+0001af80: 7265 7373 6573 2069 7320 7374 722c 2074  resses is str, t
+0001af90: 6865 6e20 636f 6e76 6572 7420 746f 206c  hen convert to l
+0001afa0: 6973 740a 2020 2020 6966 2069 705f 6164  ist.    if ip_ad
+0001afb0: 6472 6573 7365 7320 616e 6420 6973 696e  dresses and isin
+0001afc0: 7374 616e 6365 2869 705f 6164 6472 6573  stance(ip_addres
+0001afd0: 7365 732c 2073 7472 293a 0a20 2020 2020  ses, str):.     
+0001afe0: 2020 2069 705f 6164 6472 6573 7365 7320     ip_addresses 
+0001aff0: 3d20 5b69 705f 6164 6472 6573 7365 735d  = [ip_addresses]
+0001b000: 0a20 2020 2063 6f6e 736f 6c65 203d 2043  .    console = C
+0001b010: 6f6e 736f 6c65 2829 0a20 2020 206e 6f64  onsole().    nod
+0001b020: 655f 696e 666f 203d 204e 6f6e 650a 2020  e_info = None.  
+0001b030: 2020 6966 206c 656e 2869 705f 6164 6472    if len(ip_addr
+0001b040: 6573 7365 7329 203d 3d20 303a 0a20 2020  esses) == 0:.   
+0001b050: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
+0001b060: 2255 7365 722d 4167 656e 7422 3a20 2263  "User-Agent": "c
+0001b070: 7572 6c2f 372e 3739 2e31 227d 0a20 2020  url/7.79.1"}.   
+0001b080: 2020 2020 2070 7269 6e74 2822 4465 7465       print("Dete
+0001b090: 6374 696e 6720 4578 7465 726e 616c 2049  cting External I
+0001b0a0: 502e 2e2e 2229 0a20 2020 2020 2020 2069  P...").        i
+0001b0b0: 705f 7265 7320 3d20 7265 7175 6573 7473  p_res = requests
+0001b0c0: 2e67 6574 2822 6874 7470 733a 2f2f 6966  .get("https://if
+0001b0d0: 636f 6e66 6967 2e63 6f22 2c20 6865 6164  config.co", head
+0001b0e0: 6572 733d 6865 6164 6572 7329 2020 2320  ers=headers)  # 
+0001b0f0: 6e6f 7365 630a 2020 2020 2020 2020 6970  nosec.        ip
+0001b100: 5f61 6464 7265 7373 203d 2069 705f 7265  _address = ip_re
+0001b110: 732e 7465 7874 2e73 7472 6970 2829 0a20  s.text.strip(). 
+0001b120: 2020 2020 2020 2069 705f 6164 6472 6573         ip_addres
+0001b130: 7365 7320 3d20 5b69 705f 6164 6472 6573  ses = [ip_addres
+0001b140: 735d 0a0a 2020 2020 6966 206c 656e 2869  s]..    if len(i
+0001b150: 705f 6164 6472 6573 7365 7329 203d 3d20  p_addresses) == 
+0001b160: 313a 0a20 2020 2020 2020 2069 705f 6164  1:.        ip_ad
+0001b170: 6472 6573 7320 3d20 6970 5f61 6464 7265  dress = ip_addre
+0001b180: 7373 6573 5b30 5d0a 2020 2020 2020 2020  sses[0].        
+0001b190: 7374 6174 7573 2c20 7461 626c 655f 636f  status, table_co
+0001b1a0: 6e74 656e 7473 203d 2067 6574 5f68 6561  ntents = get_hea
+0001b1b0: 6c74 685f 6368 6563 6b73 2869 705f 6164  lth_checks(ip_ad
+0001b1c0: 6472 6573 733d 6970 5f61 6464 7265 7373  dress=ip_address
+0001b1d0: 290a 2020 2020 2020 2020 7461 626c 6520  ).        table 
+0001b1e0: 3d20 6372 6561 7465 5f63 6865 636b 5f74  = create_check_t
+0001b1f0: 6162 6c65 2874 6162 6c65 5f63 6f6e 7465  able(table_conte
+0001b200: 6e74 733d 7461 626c 655f 636f 6e74 656e  nts=table_conten
+0001b210: 7473 290a 2020 2020 2020 2020 6d61 785f  ts).        max_
+0001b220: 7469 6d65 6f75 7420 3d20 3630 300a 2020  timeout = 600.  
+0001b230: 2020 2020 2020 6966 206e 6f74 2073 7461        if not sta
+0001b240: 7475 733a 0a20 2020 2020 2020 2020 2020  tus:.           
+0001b250: 2074 6162 6c65 203d 2063 7265 6174 655f   table = create_
+0001b260: 6368 6563 6b5f 7461 626c 6528 0a20 2020  check_table(.   
+0001b270: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+0001b280: 6c65 5f63 6f6e 7465 6e74 733d 7461 626c  le_contents=tabl
+0001b290: 655f 636f 6e74 656e 7473 2c20 7469 6d65  e_contents, time
+0001b2a0: 5f6c 6566 743d 6d61 785f 7469 6d65 6f75  _left=max_timeou
+0001b2b0: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+0001b2c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001b2d0: 696c 656e 743a 0a20 2020 2020 2020 2020  ilent:.         
+0001b2e0: 2020 2020 2020 2077 6974 6820 636f 6e73         with cons
+0001b2f0: 6f6c 652e 7374 6174 7573 2822 4761 7468  ole.status("Gath
+0001b300: 6572 696e 6720 4e6f 6465 2069 6e66 6f72  ering Node infor
+0001b310: 6d61 7469 6f6e 2229 2061 7320 636f 6e73  mation") as cons
+0001b320: 6f6c 655f 7374 6174 7573 3a0a 2020 2020  ole_status:.    
+0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b340: 636f 6e73 6f6c 655f 7374 6174 7573 2e75  console_status.u
+0001b350: 7064 6174 6528 0a20 2020 2020 2020 2020  pdate(.         
+0001b360: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b370: 5b62 6f6c 6420 6f72 616e 6765 5f72 6564  [bold orange_red
+0001b380: 315d 5761 6974 696e 6720 666f 7220 436f  1]Waiting for Co
+0001b390: 6e74 6169 6e65 7220 4372 6561 7469 6f6e  ntainer Creation
+0001b3a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001b3b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b3c0: 2020 2020 2020 2020 2020 2020 646f 636b              dock
+0001b3d0: 6572 5f73 7461 7475 732c 206e 6f64 655f  er_status, node_
+0001b3e0: 696e 666f 203d 2067 6574 5f64 6f63 6b65  info = get_docke
+0001b3f0: 725f 7374 6174 7573 2869 705f 6164 6472  r_status(ip_addr
+0001b400: 6573 732c 206e 6f64 655f 6e61 6d65 290a  ess, node_name).
+0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b420: 2020 2020 7768 696c 6520 6e6f 7420 646f      while not do
+0001b430: 636b 6572 5f73 7461 7475 733a 0a20 2020  cker_status:.   
+0001b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b450: 2020 2020 2064 6f63 6b65 725f 7374 6174       docker_stat
+0001b460: 7573 2c20 6e6f 6465 5f69 6e66 6f20 3d20  us, node_info = 
+0001b470: 6765 745f 646f 636b 6572 5f73 7461 7475  get_docker_statu
+0001b480: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0001b490: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b4a0: 705f 6164 6472 6573 732c 206e 6f64 655f  p_address, node_
+0001b4b0: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+0001b4c0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4e0: 2020 2020 2020 2074 696d 652e 736c 6565         time.slee
+0001b4f0: 7028 3129 0a20 2020 2020 2020 2020 2020  p(1).           
+0001b500: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b510: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001b520: 2020 2020 2020 2020 2020 2020 2020 7369                si
+0001b530: 676e 616c 2061 6e64 2073 6967 6e61 6c2e  gnal and signal.
+0001b540: 6973 5f73 6574 2829 0a20 2020 2020 2020  is_set().       
+0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b560: 2029 3a20 2023 2053 746f 7020 6578 6563   ):  # Stop exec
+0001b570: 7574 696f 6e20 6966 2074 696d 656f 7574  ution if timeout
+0001b580: 2069 7320 7472 6967 6765 7265 640a 2020   is triggered.  
+0001b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b5c0: 2020 2020 2063 6f6e 736f 6c65 2e70 7269       console.pri
+0001b5d0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0001b5e0: 2020 2020 2020 2020 2020 2020 6622 7b4f              f"{O
+0001b5f0: 4b5f 454d 4f4a 497d 207b 6e6f 6465 5f69  K_EMOJI} {node_i
+0001b600: 6e66 6f5b 305d 7d20 7b6e 6f64 655f 696e  nfo[0]} {node_in
+0001b610: 666f 5b31 5d7d 2043 6f6e 7461 696e 6572  fo[1]} Container
+0001b620: 7320 4372 6561 7465 6422 0a20 2020 2020  s Created".     
+0001b630: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001b640: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b650: 2020 2020 2020 636f 6e73 6f6c 655f 7374        console_st
+0001b660: 6174 7573 2e75 7064 6174 6528 225b 626f  atus.update("[bo
+0001b670: 6c64 206f 7261 6e67 655f 7265 6431 5d53  ld orange_red1]S
+0001b680: 7461 7274 696e 6720 4261 636b 656e 6422  tarting Backend"
+0001b690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b6a0: 2020 2020 2020 7379 6674 5f69 6e73 7461        syft_insta
+0001b6b0: 6c6c 5f73 7461 7475 7320 3d20 6765 745f  ll_status = get_
+0001b6c0: 7379 6674 5f69 6e73 7461 6c6c 5f73 7461  syft_install_sta
+0001b6d0: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
+0001b6e0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
+0001b6f0: 655f 696e 666f 5b30 5d2c 206e 6f64 655f  e_info[0], node_
+0001b700: 696e 666f 5b31 5d0a 2020 2020 2020 2020  info[1].        
+0001b710: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b730: 2020 7768 696c 6520 6e6f 7420 7379 6674    while not syft
+0001b740: 5f69 6e73 7461 6c6c 5f73 7461 7475 733a  _install_status:
+0001b750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b760: 2020 2020 2020 2020 2073 7966 745f 696e           syft_in
+0001b770: 7374 616c 6c5f 7374 6174 7573 203d 2067  stall_status = g
+0001b780: 6574 5f73 7966 745f 696e 7374 616c 6c5f  et_syft_install_
+0001b790: 7374 6174 7573 280a 2020 2020 2020 2020  status(.        
+0001b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7b0: 2020 2020 6e6f 6465 5f69 6e66 6f5b 305d      node_info[0]
+0001b7c0: 2c20 6e6f 6465 5f69 6e66 6f5b 315d 0a20  , node_info[1]. 
+0001b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b800: 2074 696d 652e 736c 6565 7028 3129 0a20   time.sleep(1). 
+0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b820: 2020 2020 2020 2023 2053 746f 7020 6578         # Stop ex
+0001b830: 6563 7574 696f 6e20 6966 2074 696d 656f  ecution if timeo
+0001b840: 7574 2069 7320 7472 6967 6765 7265 640a  ut is triggered.
+0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b860: 2020 2020 2020 2020 6966 2073 6967 6e61          if signa
+0001b870: 6c20 616e 6420 7369 676e 616c 2e69 735f  l and signal.is_
+0001b880: 7365 7428 293a 0a20 2020 2020 2020 2020  set():.         
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001b8c0: 6e73 6f6c 652e 7072 696e 7428 6622 7b4f  nsole.print(f"{O
+0001b8d0: 4b5f 454d 4f4a 497d 2042 6163 6b65 6e64  K_EMOJI} Backend
+0001b8e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001b8f0: 2020 2020 2020 2063 6f6e 736f 6c65 2e70         console.p
+0001b900: 7269 6e74 2866 227b 4f4b 5f45 4d4f 4a49  rint(f"{OK_EMOJI
+0001b910: 7d20 5374 6172 7475 7020 436f 6d70 6c65  } Startup Comple
+0001b920: 7465 2229 0a0a 2020 2020 2020 2020 2020  te")..          
+0001b930: 2020 2020 2020 7374 6174 7573 2c20 7461        status, ta
+0001b940: 626c 655f 636f 6e74 656e 7473 203d 2067  ble_contents = g
+0001b950: 6574 5f68 6561 6c74 685f 6368 6563 6b73  et_health_checks
+0001b960: 2869 705f 6164 6472 6573 7329 0a20 2020  (ip_address).   
+0001b970: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+0001b980: 6c65 203d 2063 7265 6174 655f 6368 6563  le = create_chec
+0001b990: 6b5f 7461 626c 6528 0a20 2020 2020 2020  k_table(.       
+0001b9a0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+0001b9b0: 6c65 5f63 6f6e 7465 6e74 733d 7461 626c  le_contents=tabl
+0001b9c0: 655f 636f 6e74 656e 7473 2c20 7469 6d65  e_contents, time
+0001b9d0: 5f6c 6566 743d 6d61 785f 7469 6d65 6f75  _left=max_timeou
+0001b9e0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001b9f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001ba00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001ba10: 2020 2020 2020 7768 696c 6520 6e6f 7420        while not 
+0001ba20: 7374 6174 7573 3a0a 2020 2020 2020 2020  status:.        
+0001ba30: 2020 2020 2020 2020 2020 2020 2320 5374              # St
+0001ba40: 6f70 2065 7865 6375 7469 6f6e 2069 6620  op execution if 
+0001ba50: 7469 6d65 6f75 7420 6973 2074 7269 6767  timeout is trigg
+0001ba60: 6572 6564 0a20 2020 2020 2020 2020 2020  ered.           
+0001ba70: 2020 2020 2020 2020 2069 6620 7369 676e           if sign
+0001ba80: 616c 2069 7320 6e6f 7420 4e6f 6e65 2061  al is not None a
+0001ba90: 6e64 2073 6967 6e61 6c2e 6973 5f73 6574  nd signal.is_set
+0001baa0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001bab0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bac0: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
+0001bad0: 2020 2020 2020 2077 6974 6820 4c69 7665         with Live
+0001bae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001baf0: 2020 2020 2020 2020 2020 7461 626c 652c            table,
+0001bb00: 2072 6566 7265 7368 5f70 6572 5f73 6563   refresh_per_sec
+0001bb10: 6f6e 643d 322c 2073 6372 6565 6e3d 5472  ond=2, screen=Tr
+0001bb20: 7565 2c20 6175 746f 5f72 6566 7265 7368  ue, auto_refresh
+0001bb30: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0001bb40: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
+0001bb50: 6c69 7665 3a0a 2020 2020 2020 2020 2020  live:.          
+0001bb60: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0001bb70: 785f 7469 6d65 6f75 7420 2d3d 2031 0a20  x_timeout -= 1. 
+0001bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb90: 2020 2020 2020 2069 6620 6d61 785f 7469         if max_ti
+0001bba0: 6d65 6f75 7420 2520 3520 3d3d 2030 3a0a  meout % 5 == 0:.
+0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbc0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+0001bbd0: 7573 2c20 7461 626c 655f 636f 6e74 656e  us, table_conten
+0001bbe0: 7473 203d 2067 6574 5f68 6561 6c74 685f  ts = get_health_
+0001bbf0: 6368 6563 6b73 2869 705f 6164 6472 6573  checks(ip_addres
+0001bc00: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0001bc10: 2020 2020 2020 2020 2020 2074 6162 6c65             table
+0001bc20: 203d 2063 7265 6174 655f 6368 6563 6b5f   = create_check_
+0001bc30: 7461 626c 6528 0a20 2020 2020 2020 2020  table(.         
+0001bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc50: 2020 2074 6162 6c65 5f63 6f6e 7465 6e74     table_content
+0001bc60: 733d 7461 626c 655f 636f 6e74 656e 7473  s=table_contents
+0001bc70: 2c20 7469 6d65 5f6c 6566 743d 6d61 785f  , time_left=max_
+0001bc80: 7469 6d65 6f75 740a 2020 2020 2020 2020  timeout.        
+0001bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001bcb0: 2020 2020 2020 2020 2020 6c69 7665 2e75            live.u
+0001bcc0: 7064 6174 6528 7461 626c 6529 0a20 2020  pdate(table).   
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bce0: 2020 2020 2069 6620 7374 6174 7573 3a0a       if status:.
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd00: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0001bd10: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0001bd20: 2020 2020 2020 2020 2020 7469 6d65 2e73            time.s
+0001bd30: 6c65 6570 2831 290a 0a20 2020 2020 2020  leep(1)..       
+0001bd40: 2023 2054 4f44 4f3a 2043 7265 6174 6520   # TODO: Create 
+0001bd50: 6e65 7720 6865 616c 7468 2063 6865 636b  new health check
+0001bd60: 7320 7461 626c 6520 666f 7220 576f 726b  s table for Work
+0001bd70: 6572 2043 6f6e 7461 696e 6572 0a20 2020  er Container.   
+0001bd80: 2020 2020 2069 6620 286e 6f64 655f 696e       if (node_in
+0001bd90: 666f 2061 6e64 206e 6f64 655f 696e 666f  fo and node_info
+0001bda0: 5b31 5d20 213d 2022 576f 726b 6572 2229  [1] != "Worker")
+0001bdb0: 206f 7220 6e6f 7420 6e6f 6465 5f69 6e66   or not node_inf
+0001bdc0: 6f3a 0a20 2020 2020 2020 2020 2020 2063  o:.            c
+0001bdd0: 6f6e 736f 6c65 2e70 7269 6e74 2874 6162  onsole.print(tab
+0001bde0: 6c65 290a 2020 2020 656c 7365 3a0a 2020  le).    else:.  
+0001bdf0: 2020 2020 2020 666f 7220 6970 5f61 6464        for ip_add
+0001be00: 7265 7373 2069 6e20 6970 5f61 6464 7265  ress in ip_addre
+0001be10: 7373 6573 3a0a 2020 2020 2020 2020 2020  sses:.          
+0001be20: 2020 5f2c 2074 6162 6c65 5f63 6f6e 7465    _, table_conte
+0001be30: 6e74 7320 3d20 6765 745f 6865 616c 7468  nts = get_health
+0001be40: 5f63 6865 636b 7328 6970 5f61 6464 7265  _checks(ip_addre
+0001be50: 7373 290a 2020 2020 2020 2020 2020 2020  ss).            
+0001be60: 7461 626c 6520 3d20 6372 6561 7465 5f63  table = create_c
+0001be70: 6865 636b 5f74 6162 6c65 2874 6162 6c65  heck_table(table
+0001be80: 5f63 6f6e 7465 6e74 733d 7461 626c 655f  _contents=table_
+0001be90: 636f 6e74 656e 7473 290a 2020 2020 2020  contents).      
+0001bea0: 2020 2020 2020 636f 6e73 6f6c 652e 7072        console.pr
+0001beb0: 696e 7428 7461 626c 6529 0a0a 0a64 6566  int(table)...def
+0001bec0: 2063 6865 636b 5f73 7461 7475 7328 0a20   check_status(. 
+0001bed0: 2020 2069 705f 6164 6472 6573 7365 733a     ip_addresses:
+0001bee0: 2055 6e69 6f6e 5b73 7472 2c20 5479 7065   Union[str, Type
+0001bef0: 4c69 7374 5b73 7472 5d5d 2c0a 2020 2020  List[str]],.    
+0001bf00: 7369 6c65 6e74 3a20 626f 6f6c 203d 2054  silent: bool = T
+0001bf10: 7275 652c 0a20 2020 2074 696d 656f 7574  rue,.    timeout
+0001bf20: 3a20 556e 696f 6e5b 696e 742c 2073 7472  : Union[int, str
+0001bf30: 5d20 3d20 3330 302c 0a20 2020 206e 6f64  ] = 300,.    nod
+0001bf40: 655f 6e61 6d65 3a20 4f70 7469 6f6e 616c  e_name: Optional
+0001bf50: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2920  [str] = None,.) 
+0001bf60: 2d3e 204e 6f6e 653a 0a20 2020 2074 696d  -> None:.    tim
+0001bf70: 656f 7574 203d 2069 6e74 2874 696d 656f  eout = int(timeo
+0001bf80: 7574 290a 2020 2020 2320 7468 6972 6420  ut).    # third 
+0001bf90: 7061 7274 790a 2020 2020 6672 6f6d 2072  party.    from r
+0001bfa0: 6963 6820 696d 706f 7274 2070 7269 6e74  ich import print
+0001bfb0: 0a0a 2020 2020 7369 676e 616c 203d 2045  ..    signal = E
+0001bfc0: 7665 6e74 2829 0a0a 2020 2020 7420 3d20  vent()..    t = 
+0001bfd0: 5468 7265 6164 280a 2020 2020 2020 2020  Thread(.        
+0001bfe0: 7461 7267 6574 3d5f 6368 6563 6b5f 7374  target=_check_st
+0001bff0: 6174 7573 2c0a 2020 2020 2020 2020 6b77  atus,.        kw
+0001c000: 6172 6773 3d7b 0a20 2020 2020 2020 2020  args={.         
+0001c010: 2020 2022 6970 5f61 6464 7265 7373 6573     "ip_addresses
+0001c020: 223a 2069 705f 6164 6472 6573 7365 732c  ": ip_addresses,
+0001c030: 0a20 2020 2020 2020 2020 2020 2022 7369  .            "si
+0001c040: 6c65 6e74 223a 2073 696c 656e 742c 0a20  lent": silent,. 
+0001c050: 2020 2020 2020 2020 2020 2022 7369 676e             "sign
+0001c060: 616c 223a 2073 6967 6e61 6c2c 0a20 2020  al": signal,.   
+0001c070: 2020 2020 2020 2020 2022 6e6f 6465 5f6e           "node_n
+0001c080: 616d 6522 3a20 6e6f 6465 5f6e 616d 652c  ame": node_name,
+0001c090: 0a20 2020 2020 2020 207d 2c0a 2020 2020  .        },.    
+0001c0a0: 290a 2020 2020 742e 7374 6172 7428 290a  ).    t.start().
+0001c0b0: 2020 2020 742e 6a6f 696e 2874 696d 656f      t.join(timeo
+0001c0c0: 7574 3d74 696d 656f 7574 290a 0a20 2020  ut=timeout)..   
+0001c0d0: 2069 6620 742e 6973 5f61 6c69 7665 2829   if t.is_alive()
+0001c0e0: 3a0a 2020 2020 2020 2020 7369 676e 616c  :.        signal
+0001c0f0: 2e73 6574 2829 0a20 2020 2020 2020 2074  .set().        t
+0001c100: 2e6a 6f69 6e28 290a 0a20 2020 2020 2020  .join()..       
+0001c110: 2070 7269 6e74 2866 2248 6167 7269 6420   print(f"Hagrid 
+0001c120: 6368 6563 6b20 636f 6d6d 616e 6420 7469  check command ti
+0001c130: 6d65 6420 6f75 7420 6166 7465 723a 207b  med out after: {
+0001c140: 7469 6d65 6f75 747d 2073 6563 6f6e 6473  timeout} seconds
+0001c150: 20f0 9f95 9b22 290a 2020 2020 2020 2020   ....").        
+0001c160: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0001c170: 2020 2022 506c 6561 7365 2074 7279 2069     "Please try i
+0001c180: 6e63 7265 6173 696e 6720 7468 6520 7469  ncreasing the ti
+0001c190: 6d65 6f75 7420 6f72 206b 696e 646c 7920  meout or kindly 
+0001c1a0: 6368 6563 6b20 7468 6520 646f 636b 6572  check the docker
+0001c1b0: 2063 6f6e 7461 696e 6572 7320 666f 7220   containers for 
+0001c1c0: 6572 726f 7220 6c6f 6773 2e22 0a20 2020  error logs.".   
+0001c1d0: 2020 2020 2029 0a20 2020 2020 2020 2070       ).        p
+0001c1e0: 7269 6e74 2822 596f 7520 6361 6e20 7669  rint("You can vi
+0001c1f0: 6577 2079 6f75 7220 636f 6e74 6169 6e65  ew your containe
+0001c200: 7220 6c6f 6773 2075 7369 6e67 2074 6865  r logs using the
+0001c210: 2066 6f6c 6c6f 7769 6e67 2074 6f6f 6c3a   following tool:
+0001c220: 2229 0a20 2020 2020 2020 2070 7269 6e74  ").        print
+0001c230: 2822 546f 6f6c 3a20 5b6c 696e 6b3d 6874  ("Tool: [link=ht
+0001c240: 7470 733a 2f2f 6374 6f70 2e73 685d 4374  tps://ctop.sh]Ct
+0001c250: 6f70 5b2f 6c69 6e6b 5d22 290a 2020 2020  op[/link]").    
+0001c260: 2020 2020 7072 696e 7428 2256 6964 656f      print("Video
+0001c270: 2045 7870 6c61 6e61 7469 6f6e 3a20 6874   Explanation: ht
+0001c280: 7470 733a 2f2f 796f 7574 752e 6265 2f42  tps://youtu.be/B
+0001c290: 4a68 6c43 7865 7251 5034 205c 6e22 290a  JhlCxerQP4 \n").
+0001c2a0: 0a0a 636c 692e 6164 645f 636f 6d6d 616e  ..cli.add_comman
+0001c2b0: 6428 6368 6563 6b29 0a0a 0a23 2061 6464  d(check)...# add
+0001c2c0: 2048 6167 7269 6420 696e 666f 2074 6f20   Hagrid info to 
+0001c2d0: 7468 6520 636c 690a 4063 6c69 636b 2e63  the cli.@click.c
+0001c2e0: 6f6d 6d61 6e64 2868 656c 703d 2253 686f  ommand(help="Sho
+0001c2f0: 7720 4841 4772 6964 2069 6e66 6f22 2c20  w HAGrid info", 
+0001c300: 636f 6e74 6578 745f 7365 7474 696e 6773  context_settings
+0001c310: 3d7b 2273 686f 775f 6465 6661 756c 7422  ={"show_default"
+0001c320: 3a20 5472 7565 7d29 0a64 6566 2076 6572  : True}).def ver
+0001c330: 7369 6f6e 2829 202d 3e20 4e6f 6e65 3a0a  sion() -> None:.
+0001c340: 2020 2020 7072 696e 7428 6622 4841 4752      print(f"HAGR
+0001c350: 4944 5f56 4552 5349 4f4e 3a20 7b67 6574  ID_VERSION: {get
+0001c360: 5f76 6572 7369 6f6e 5f73 7472 696e 6728  _version_string(
+0001c370: 297d 2229 0a20 2020 2069 6620 4544 4954  )}").    if EDIT
+0001c380: 4142 4c45 5f4d 4f44 453a 0a20 2020 2020  ABLE_MODE:.     
+0001c390: 2020 2070 7269 6e74 2866 2248 4147 5249     print(f"HAGRI
+0001c3a0: 445f 5245 504f 5f53 4841 3a20 7b63 6f6d  D_REPO_SHA: {com
+0001c3b0: 6d69 745f 6861 7368 2829 7d22 290a 0a0a  mit_hash()}")...
+0001c3c0: 636c 692e 6164 645f 636f 6d6d 616e 6428  cli.add_command(
+0001c3d0: 7665 7273 696f 6e29 0a0a 0a64 6566 2072  version)...def r
+0001c3e0: 756e 5f71 7569 636b 7374 6172 7428 0a20  un_quickstart(. 
+0001c3f0: 2020 2075 726c 3a20 4f70 7469 6f6e 616c     url: Optional
+0001c400: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0001c410: 2020 7379 6674 3a20 7374 7220 3d20 226c    syft: str = "l
+0001c420: 6174 6573 7422 2c0a 2020 2020 7265 7365  atest",.    rese
+0001c430: 743a 2062 6f6f 6c20 3d20 4661 6c73 652c  t: bool = False,
+0001c440: 0a20 2020 2071 7569 6574 3a20 626f 6f6c  .    quiet: bool
+0001c450: 203d 2046 616c 7365 2c0a 2020 2020 7072   = False,.    pr
+0001c460: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
+0001c470: 0a20 2020 2074 6573 743a 2062 6f6f 6c20  .    test: bool 
+0001c480: 3d20 4661 6c73 652c 0a20 2020 2072 6570  = False,.    rep
+0001c490: 6f3a 2073 7472 203d 2044 4546 4155 4c54  o: str = DEFAULT
+0001c4a0: 5f52 4550 4f2c 0a20 2020 2062 7261 6e63  _REPO,.    branc
+0001c4b0: 683a 2073 7472 203d 2044 4546 4155 4c54  h: str = DEFAULT
+0001c4c0: 5f42 5241 4e43 482c 0a20 2020 2063 6f6d  _BRANCH,.    com
+0001c4d0: 6d69 743a 204f 7074 696f 6e61 6c5b 7374  mit: Optional[st
+0001c4e0: 725d 203d 204e 6f6e 652c 0a20 2020 2070  r] = None,.    p
+0001c4f0: 7974 686f 6e3a 204f 7074 696f 6e61 6c5b  ython: Optional[
+0001c500: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+0001c510: 207a 6970 5f66 696c 653a 204f 7074 696f   zip_file: Optio
+0001c520: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+0001c530: 0a29 202d 3e20 4e6f 6e65 3a0a 2020 2020  .) -> None:.    
+0001c540: 7472 793a 0a20 2020 2020 2020 2071 7569  try:.        qui
+0001c550: 636b 7374 6172 745f 6172 7428 290a 2020  ckstart_art().  
+0001c560: 2020 2020 2020 6469 7265 6374 6f72 7920        directory 
+0001c570: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+0001c580: 7573 6572 2822 7e2f 2e68 6167 7269 642f  user("~/.hagrid/
+0001c590: 7175 6963 6b73 7461 7274 2f22 290a 2020  quickstart/").  
+0001c5a0: 2020 2020 2020 636f 6e66 6972 6d5f 7265        confirm_re
+0001c5b0: 7365 7420 3d20 4e6f 6e65 0a20 2020 2020  set = None.     
+0001c5c0: 2020 2069 6620 7265 7365 743a 0a20 2020     if reset:.   
+0001c5d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001c5e0: 7175 6965 743a 0a20 2020 2020 2020 2020  quiet:.         
+0001c5f0: 2020 2020 2020 2063 6f6e 6669 726d 5f72         confirm_r
+0001c600: 6573 6574 203d 2063 6c69 636b 2e63 6f6e  eset = click.con
+0001c610: 6669 726d 280a 2020 2020 2020 2020 2020  firm(.          
+0001c620: 2020 2020 2020 2020 2020 2254 6869 7320            "This 
+0001c630: 7769 6c6c 2063 7265 6174 6520 6120 6e65  will create a ne
+0001c640: 7720 7175 6963 6b73 7461 7274 2076 6972  w quickstart vir
+0001c650: 7475 616c 656e 7620 616e 6420 7265 696e  tualenv and rein
+0001c660: 7374 616c 6c20 5379 6674 2061 6e64 2022  stall Syft and "
+0001c670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c680: 2020 2020 2022 4a75 7079 7465 722e 2041       "Jupyter. A
+0001c690: 7265 2079 6f75 2073 7572 6520 796f 7520  re you sure you 
+0001c6a0: 7761 6e74 2074 6f20 636f 6e74 696e 7565  want to continue
+0001c6b0: 3f22 0a20 2020 2020 2020 2020 2020 2020  ?".             
+0001c6c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001c6d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001c6e0: 2020 2020 2020 2063 6f6e 6669 726d 5f72         confirm_r
+0001c6f0: 6573 6574 203d 2054 7275 650a 2020 2020  eset = True.    
+0001c700: 2020 2020 6966 2063 6f6e 6669 726d 5f72      if confirm_r
+0001c710: 6573 6574 2069 7320 4661 6c73 653a 0a20  eset is False:. 
+0001c720: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001c730: 6e0a 0a20 2020 2020 2020 2069 6620 7265  n..        if re
+0001c740: 7365 7420 616e 6420 636f 6e66 6972 6d5f  set and confirm_
+0001c750: 7265 7365 7420 6f72 206e 6f74 206f 732e  reset or not os.
+0001c760: 7061 7468 2e69 7364 6972 2864 6972 6563  path.isdir(direc
+0001c770: 746f 7279 293a 0a20 2020 2020 2020 2020  tory):.         
+0001c780: 2020 2071 7569 636b 7374 6172 745f 7365     quickstart_se
+0001c790: 7475 7028 0a20 2020 2020 2020 2020 2020  tup(.           
+0001c7a0: 2020 2020 2064 6972 6563 746f 7279 3d64       directory=d
+0001c7b0: 6972 6563 746f 7279 2c0a 2020 2020 2020  irectory,.      
+0001c7c0: 2020 2020 2020 2020 2020 7379 6674 5f76            syft_v
+0001c7d0: 6572 7369 6f6e 3d73 7966 742c 0a20 2020  ersion=syft,.   
+0001c7e0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001c7f0: 6574 3d72 6573 6574 2c0a 2020 2020 2020  et=reset,.      
+0001c800: 2020 2020 2020 2020 2020 7072 653d 7072            pre=pr
+0001c810: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001c820: 2020 2070 7974 686f 6e3d 7079 7468 6f6e     python=python
+0001c830: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001c840: 2020 2020 2020 2020 646f 776e 6c6f 6164          download
+0001c850: 6564 5f66 696c 6573 203d 205b 5d0a 2020  ed_files = [].  
+0001c860: 2020 2020 2020 6966 207a 6970 5f66 696c        if zip_fil
+0001c870: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0001c880: 6f77 6e6c 6f61 6465 645f 6669 6c65 7320  ownloaded_files 
+0001c890: 3d20 6665 7463 685f 6e6f 7465 626f 6f6b  = fetch_notebook
+0001c8a0: 735f 6672 6f6d 5f7a 6970 6669 6c65 280a  s_from_zipfile(.
+0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8c0: 7a69 705f 6669 6c65 2c0a 2020 2020 2020  zip_file,.      
+0001c8d0: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+0001c8e0: 6f72 793d 6469 7265 6374 6f72 792c 0a20  ory=directory,. 
+0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001c900: 6573 6574 3d72 6573 6574 2c0a 2020 2020  eset=reset,.    
+0001c910: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001c920: 2020 656c 6966 2075 726c 3a0a 2020 2020    elif url:.    
+0001c930: 2020 2020 2020 2020 646f 776e 6c6f 6164          download
+0001c940: 6564 5f66 696c 6573 203d 2066 6574 6368  ed_files = fetch
+0001c950: 5f6e 6f74 6562 6f6f 6b73 5f66 6f72 5f75  _notebooks_for_u
+0001c960: 726c 280a 2020 2020 2020 2020 2020 2020  rl(.            
+0001c970: 2020 2020 7572 6c3d 7572 6c2c 0a20 2020      url=url,.   
+0001c980: 2020 2020 2020 2020 2020 2020 2064 6972               dir
+0001c990: 6563 746f 7279 3d64 6972 6563 746f 7279  ectory=directory
+0001c9a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c9b0: 2020 7265 7365 743d 7265 7365 742c 0a20    reset=reset,. 
+0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001c9d0: 6570 6f3d 7265 706f 2c0a 2020 2020 2020  epo=repo,.      
+0001c9e0: 2020 2020 2020 2020 2020 6272 616e 6368            branch
+0001c9f0: 3d62 7261 6e63 682c 0a20 2020 2020 2020  =branch,.       
+0001ca00: 2020 2020 2020 2020 2063 6f6d 6d69 743d           commit=
+0001ca10: 636f 6d6d 6974 2c0a 2020 2020 2020 2020  commit,.        
+0001ca20: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+0001ca30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001ca40: 6669 6c65 5f70 6174 6820 3d20 6164 645f  file_path = add_
+0001ca50: 696e 7472 6f5f 6e6f 7465 626f 6f6b 2864  intro_notebook(d
+0001ca60: 6972 6563 746f 7279 3d64 6972 6563 746f  irectory=directo
+0001ca70: 7279 2c20 7265 7365 743d 7265 7365 7429  ry, reset=reset)
+0001ca80: 0a20 2020 2020 2020 2020 2020 2064 6f77  .            dow
+0001ca90: 6e6c 6f61 6465 645f 6669 6c65 732e 6170  nloaded_files.ap
+0001caa0: 7065 6e64 2866 696c 655f 7061 7468 290a  pend(file_path).
+0001cab0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0001cac0: 646f 776e 6c6f 6164 6564 5f66 696c 6573  downloaded_files
+0001cad0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0001cae0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001caf0: 696f 6e28 6622 556e 6162 6c65 2074 6f20  ion(f"Unable to 
+0001cb00: 6669 6e64 2066 696c 6573 2061 743a 207b  find files at: {
+0001cb10: 7572 6c7d 2229 0a20 2020 2020 2020 2066  url}").        f
+0001cb20: 696c 655f 7061 7468 203d 2073 6f72 7465  ile_path = sorte
+0001cb30: 6428 646f 776e 6c6f 6164 6564 5f66 696c  d(downloaded_fil
+0001cb40: 6573 295b 305d 0a0a 2020 2020 2020 2020  es)[0]..        
+0001cb50: 2320 6164 6420 7669 7274 7561 6c65 6e76  # add virtualenv
+0001cb60: 2070 6174 680a 2020 2020 2020 2020 656e   path.        en
+0001cb70: 7669 726f 6e20 3d20 6f73 2e65 6e76 6972  viron = os.envir
+0001cb80: 6f6e 2e63 6f70 7928 290a 2020 2020 2020  on.copy().      
+0001cb90: 2020 6f73 5f62 696e 5f70 6174 6820 3d20    os_bin_path = 
+0001cba0: 2253 6372 6970 7473 2220 6966 2069 735f  "Scripts" if is_
+0001cbb0: 7769 6e64 6f77 7328 2920 656c 7365 2022  windows() else "
+0001cbc0: 6269 6e22 0a20 2020 2020 2020 2076 656e  bin".        ven
+0001cbd0: 765f 6469 7220 3d20 6469 7265 6374 6f72  v_dir = director
+0001cbe0: 7920 2b20 222e 7665 6e76 220a 2020 2020  y + ".venv".    
+0001cbf0: 2020 2020 656e 7669 726f 6e5b 2250 4154      environ["PAT
+0001cc00: 4822 5d20 3d20 7665 6e76 5f64 6972 202b  H"] = venv_dir +
+0001cc10: 206f 732e 7365 7020 2b20 6f73 5f62 696e   os.sep + os_bin
+0001cc20: 5f70 6174 6820 2b20 6f73 2e70 6174 6873  _path + os.paths
+0001cc30: 6570 202b 2065 6e76 6972 6f6e 5b22 5041  ep + environ["PA
+0001cc40: 5448 225d 0a20 2020 2020 2020 206a 7570  TH"].        jup
+0001cc50: 7974 6572 5f62 696e 6172 7920 3d20 226a  yter_binary = "j
+0001cc60: 7570 7974 6572 2e65 7865 2220 6966 2069  upyter.exe" if i
+0001cc70: 735f 7769 6e64 6f77 7328 2920 656c 7365  s_windows() else
+0001cc80: 2022 6a75 7079 7465 7222 0a0a 2020 2020   "jupyter"..    
+0001cc90: 2020 2020 6966 2069 735f 7769 6e64 6f77      if is_window
+0001cca0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0001ccb0: 2065 6e76 5f61 6374 6976 6174 655f 636d   env_activate_cm
+0001ccc0: 6420 3d20 280a 2020 2020 2020 2020 2020  d = (.          
+0001ccd0: 2020 2020 2020 2228 506f 7765 7273 6865        "(Powershe
+0001cce0: 6c6c 293a 2022 0a20 2020 2020 2020 2020  ll): ".         
+0001ccf0: 2020 2020 2020 202b 2022 6364 2022 0a20         + "cd ". 
+0001cd00: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001cd10: 2076 656e 765f 6469 720a 2020 2020 2020   venv_dir.      
+0001cd20: 2020 2020 2020 2020 2020 2b20 223b 2022            + "; "
+0001cd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd40: 202b 206f 735f 6269 6e5f 7061 7468 0a20   + os_bin_path. 
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001cd60: 206f 732e 7365 700a 2020 2020 2020 2020   os.sep.        
+0001cd70: 2020 2020 2020 2020 2b20 2261 6374 6976          + "activ
+0001cd80: 6174 6522 0a20 2020 2020 2020 2020 2020  ate".           
+0001cd90: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+0001cda0: 0a20 2020 2020 2020 2020 2020 2065 6e76  .            env
+0001cdb0: 5f61 6374 6976 6174 655f 636d 6420 3d20  _activate_cmd = 
+0001cdc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001cdd0: 2020 2228 4c69 6e75 7829 3a20 736f 7572    "(Linux): sour
+0001cde0: 6365 2022 202b 2076 656e 765f 6469 7220  ce " + venv_dir 
+0001cdf0: 2b20 6f73 2e73 6570 202b 206f 735f 6269  + os.sep + os_bi
+0001ce00: 6e5f 7061 7468 202b 2022 2f61 6374 6976  n_path + "/activ
+0001ce10: 6174 6522 0a20 2020 2020 2020 2020 2020  ate".           
+0001ce20: 2029 0a0a 2020 2020 2020 2020 7072 696e   )..        prin
+0001ce30: 7428 6622 546f 2061 6374 6976 6174 6520  t(f"To activate 
+0001ce40: 796f 7572 2076 6972 7475 616c 656e 7620  your virtualenv 
+0001ce50: 7b65 6e76 5f61 6374 6976 6174 655f 636d  {env_activate_cm
+0001ce60: 647d 2229 0a0a 2020 2020 2020 2020 7472  d}")..        tr
+0001ce70: 793a 0a20 2020 2020 2020 2020 2020 2061  y:.            a
+0001ce80: 6c6c 6f77 5f62 726f 7773 6572 203d 2022  llow_browser = "
+0001ce90: 202d 2d6e 6f2d 6272 6f77 7365 7222 2069   --no-browser" i
+0001cea0: 6620 6973 5f67 6974 706f 6428 2920 656c  f is_gitpod() el
+0001ceb0: 7365 2022 220a 2020 2020 2020 2020 2020  se "".          
+0001cec0: 2020 636d 6420 3d20 280a 2020 2020 2020    cmd = (.      
+0001ced0: 2020 2020 2020 2020 2020 7665 6e76 5f64            venv_d
+0001cee0: 6972 0a20 2020 2020 2020 2020 2020 2020  ir.             
+0001cef0: 2020 202b 206f 732e 7365 700a 2020 2020     + os.sep.    
+0001cf00: 2020 2020 2020 2020 2020 2020 2b20 6f73              + os
+0001cf10: 5f62 696e 5f70 6174 680a 2020 2020 2020  _bin_path.      
+0001cf20: 2020 2020 2020 2020 2020 2b20 6f73 2e73            + os.s
+0001cf30: 6570 0a20 2020 2020 2020 2020 2020 2020  ep.             
+0001cf40: 2020 202b 2066 227b 6a75 7079 7465 725f     + f"{jupyter_
+0001cf50: 6269 6e61 7279 7d20 6c61 627b 616c 6c6f  binary} lab{allo
+0001cf60: 775f 6272 6f77 7365 727d 202d 2d69 7020  w_browser} --ip 
+0001cf70: 302e 302e 302e 3020 2d2d 6e6f 7465 626f  0.0.0.0 --notebo
+0001cf80: 6f6b 2d64 6972 3d7b 6469 7265 6374 6f72  ok-dir={director
+0001cf90: 797d 207b 6669 6c65 5f70 6174 687d 220a  y} {file_path}".
+0001cfa0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001cfb0: 2020 2020 2020 2020 2020 6966 2074 6573            if tes
+0001cfc0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001cfd0: 2020 206a 7570 7974 6572 5f70 6174 6820     jupyter_path 
+0001cfe0: 3d20 7665 6e76 5f64 6972 202b 206f 732e  = venv_dir + os.
+0001cff0: 7365 7020 2b20 6f73 5f62 696e 5f70 6174  sep + os_bin_pat
+0001d000: 6820 2b20 6f73 2e73 6570 202b 206a 7570  h + os.sep + jup
+0001d010: 7974 6572 5f62 696e 6172 790a 2020 2020  yter_binary.    
+0001d020: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001d030: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+0001d040: 7328 6a75 7079 7465 725f 7061 7468 293a  s(jupyter_path):
+0001d050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d060: 2020 2020 2070 7269 6e74 2866 2246 6169       print(f"Fai
+0001d070: 6c65 6420 746f 2069 6e73 7461 6c6c 204a  led to install J
+0001d080: 7570 7974 6572 2069 6e20 7061 7468 3a20  upyter in path: 
+0001d090: 7b6a 7570 7974 6572 5f70 6174 687d 2229  {jupyter_path}")
+0001d0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d0b0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0001d0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d0d0: 2070 7269 6e74 2866 224a 7570 7974 6572   print(f"Jupyter
+0001d0e0: 2065 7869 7374 7320 6174 3a20 7b6a 7570   exists at: {jup
+0001d0f0: 7974 6572 5f70 6174 687d 2e20 4349 2054  yter_path}. CI T
+0001d100: 6573 7420 6d6f 6465 2065 7869 7469 6e67  est mode exiting
+0001d110: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001d120: 2020 2020 7379 732e 6578 6974 2830 290a      sys.exit(0).
+0001d130: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+0001d140: 6162 6c65 5f74 6f6f 6c62 6172 5f65 7874  able_toolbar_ext
+0001d150: 656e 7369 6f6e 203d 2028 0a20 2020 2020  ension = (.     
+0001d160: 2020 2020 2020 2020 2020 2076 656e 765f             venv_
+0001d170: 6469 720a 2020 2020 2020 2020 2020 2020  dir.            
+0001d180: 2020 2020 2b20 6f73 2e73 6570 0a20 2020      + os.sep.   
+0001d190: 2020 2020 2020 2020 2020 2020 202b 206f               + o
+0001d1a0: 735f 6269 6e5f 7061 7468 0a20 2020 2020  s_bin_path.     
+0001d1b0: 2020 2020 2020 2020 2020 202b 206f 732e             + os.
+0001d1c0: 7365 700a 2020 2020 2020 2020 2020 2020  sep.            
+0001d1d0: 2020 2020 2b20 6622 7b6a 7570 7974 6572      + f"{jupyter
+0001d1e0: 5f62 696e 6172 797d 206c 6162 6578 7465  _binary} labexte
+0001d1f0: 6e73 696f 6e20 6469 7361 626c 6520 406a  nsion disable @j
+0001d200: 7570 7974 6572 6c61 622f 6365 6c6c 2d74  upyterlab/cell-t
+0001d210: 6f6f 6c62 6172 2d65 7874 656e 7369 6f6e  oolbar-extension
+0001d220: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+0001d230: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0001d240: 7072 6f63 6573 732e 7275 6e28 2020 2320  process.run(  # 
+0001d250: 6e6f 7365 630a 2020 2020 2020 2020 2020  nosec.          
+0001d260: 2020 2020 2020 6469 7361 626c 655f 746f        disable_to
+0001d270: 6f6c 6261 725f 6578 7465 6e73 696f 6e2e  olbar_extension.
+0001d280: 7370 6c69 7428 2220 2229 2c20 6377 643d  split(" "), cwd=
+0001d290: 6469 7265 6374 6f72 792c 2065 6e76 3d65  directory, env=e
+0001d2a0: 6e76 6972 6f6e 0a20 2020 2020 2020 2020  nviron.         
+0001d2b0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001d2c0: 2020 4f4e 5f50 4f53 4958 203d 2022 706f    ON_POSIX = "po
+0001d2d0: 7369 7822 2069 6e20 7379 732e 6275 696c  six" in sys.buil
+0001d2e0: 7469 6e5f 6d6f 6475 6c65 5f6e 616d 6573  tin_module_names
+0001d2f0: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0001d300: 6620 656e 7175 6575 655f 6f75 7470 7574  f enqueue_output
+0001d310: 286f 7574 3a20 416e 792c 2071 7565 7565  (out: Any, queue
+0001d320: 3a20 5175 6575 6529 202d 3e20 4e6f 6e65  : Queue) -> None
+0001d330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d340: 2020 666f 7220 6c69 6e65 2069 6e20 6974    for line in it
+0001d350: 6572 286f 7574 2e72 6561 646c 696e 652c  er(out.readline,
+0001d360: 2062 2222 293a 0a20 2020 2020 2020 2020   b""):.         
+0001d370: 2020 2020 2020 2020 2020 2071 7565 7565             queue
+0001d380: 2e70 7574 286c 696e 6529 0a20 2020 2020  .put(line).     
+0001d390: 2020 2020 2020 2020 2020 206f 7574 2e63             out.c
+0001d3a0: 6c6f 7365 2829 0a0a 2020 2020 2020 2020  lose()..        
+0001d3b0: 2020 2020 7072 6f63 203d 2073 7562 7072      proc = subpr
+0001d3c0: 6f63 6573 732e 506f 7065 6e28 2020 2320  ocess.Popen(  # 
+0001d3d0: 6e6f 7365 630a 2020 2020 2020 2020 2020  nosec.          
+0001d3e0: 2020 2020 2020 636d 642e 7370 6c69 7428        cmd.split(
+0001d3f0: 2220 2229 2c0a 2020 2020 2020 2020 2020  " "),.          
+0001d400: 2020 2020 2020 6377 643d 6469 7265 6374        cwd=direct
+0001d410: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+0001d420: 2020 2020 2065 6e76 3d65 6e76 6972 6f6e       env=environ
+0001d430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d440: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
+0001d450: 6573 732e 5049 5045 2c0a 2020 2020 2020  ess.PIPE,.      
+0001d460: 2020 2020 2020 2020 2020 7374 6465 7272            stderr
+0001d470: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
+0001d480: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d490: 2020 636c 6f73 655f 6664 733d 4f4e 5f50    close_fds=ON_P
+0001d4a0: 4f53 4958 2c0a 2020 2020 2020 2020 2020  OSIX,.          
+0001d4b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001d4c0: 7175 6575 653a 2051 7565 7565 203d 2051  queue: Queue = Q
+0001d4d0: 7565 7565 2829 0a20 2020 2020 2020 2020  ueue().         
+0001d4e0: 2020 2074 6872 6561 645f 3120 3d20 5468     thread_1 = Th
+0001d4f0: 7265 6164 2874 6172 6765 743d 656e 7175  read(target=enqu
+0001d500: 6575 655f 6f75 7470 7574 2c20 6172 6773  eue_output, args
+0001d510: 3d28 7072 6f63 2e73 7464 6f75 742c 2071  =(proc.stdout, q
+0001d520: 7565 7565 2929 0a20 2020 2020 2020 2020  ueue)).         
+0001d530: 2020 2074 6872 6561 645f 3220 3d20 5468     thread_2 = Th
+0001d540: 7265 6164 2874 6172 6765 743d 656e 7175  read(target=enqu
+0001d550: 6575 655f 6f75 7470 7574 2c20 6172 6773  eue_output, args
+0001d560: 3d28 7072 6f63 2e73 7464 6572 722c 2071  =(proc.stderr, q
+0001d570: 7565 7565 2929 0a20 2020 2020 2020 2020  ueue)).         
+0001d580: 2020 2074 6872 6561 645f 312e 6461 656d     thread_1.daem
+0001d590: 6f6e 203d 2054 7275 6520 2023 2074 6872  on = True  # thr
+0001d5a0: 6561 6420 6469 6573 2077 6974 6820 7468  ead dies with th
+0001d5b0: 6520 7072 6f67 7261 6d0a 2020 2020 2020  e program.      
+0001d5c0: 2020 2020 2020 7468 7265 6164 5f31 2e73        thread_1.s
+0001d5d0: 7461 7274 2829 0a20 2020 2020 2020 2020  tart().         
+0001d5e0: 2020 2074 6872 6561 645f 322e 6461 656d     thread_2.daem
+0001d5f0: 6f6e 203d 2054 7275 6520 2023 2074 6872  on = True  # thr
+0001d600: 6561 6420 6469 6573 2077 6974 6820 7468  ead dies with th
+0001d610: 6520 7072 6f67 7261 6d0a 2020 2020 2020  e program.      
+0001d620: 2020 2020 2020 7468 7265 6164 5f32 2e73        thread_2.s
+0001d630: 7461 7274 2829 0a0a 2020 2020 2020 2020  tart()..        
+0001d640: 2020 2020 6469 7370 6c61 795f 7572 6c20      display_url 
+0001d650: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+0001d660: 2020 2063 6f6e 736f 6c65 203d 2072 6963     console = ric
+0001d670: 682e 6765 745f 636f 6e73 6f6c 6528 290a  h.get_console().
+0001d680: 0a20 2020 2020 2020 2020 2020 2023 206b  .            # k
+0001d690: 6565 706e 2072 6561 6469 6e67 2074 6865  eepn reading the
+0001d6a0: 2071 7565 7565 206f 6620 7374 646f 7574   queue of stdout
+0001d6b0: 202b 2073 7464 6572 720a 2020 2020 2020   + stderr.      
+0001d6c0: 2020 2020 2020 7768 696c 6520 5472 7565        while True
+0001d6d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d6e0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001d6f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001d700: 7420 6469 7370 6c61 795f 7572 6c3a 0a20  t display_url:. 
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2020 2020 2020 2023 2074 7279 2074 6f20         # try to 
+0001d730: 7265 6164 2074 6865 206c 696e 6520 616e  read the line an
+0001d740: 6420 6578 7472 6163 7420 6120 6a75 7079  d extract a jupy
+0001d750: 7465 7220 7572 6c3a 0a20 2020 2020 2020  ter url:.       
+0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d770: 2077 6974 6820 636f 6e73 6f6c 652e 7374   with console.st
+0001d780: 6174 7573 280a 2020 2020 2020 2020 2020  atus(.          
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7a0: 2020 2253 7461 7274 696e 6720 4a75 7079    "Starting Jupy
+0001d7b0: 7465 7220 7365 7276 6963 6522 0a20 2020  ter service".   
+0001d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7d0: 2020 2020 2029 2061 7320 636f 6e73 6f6c       ) as consol
+0001d7e0: 655f 7374 6174 7573 3a0a 2020 2020 2020  e_status:.      
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2020 2020 6c69 6e65 203d 2071 7565        line = que
+0001d810: 7565 2e67 6574 2829 0a20 2020 2020 2020  ue.get().       
+0001d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d830: 2020 2020 2064 6973 706c 6179 5f75 726c       display_url
+0001d840: 203d 2065 7874 7261 6374 5f6a 7570 7974   = extract_jupyt
+0001d850: 6572 5f75 726c 286c 696e 652e 6465 636f  er_url(line.deco
+0001d860: 6465 2822 7574 662d 3822 2929 0a20 2020  de("utf-8")).   
+0001d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d880: 2020 2020 2020 2020 2069 6620 6469 7370           if disp
+0001d890: 6c61 795f 7572 6c3a 0a20 2020 2020 2020  lay_url:.       
+0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8b0: 2020 2020 2020 2020 2064 6973 706c 6179           display
+0001d8c0: 5f6a 7570 7974 6572 5f75 726c 2875 726c  _jupyter_url(url
+0001d8d0: 5f70 6172 7473 3d64 6973 706c 6179 5f75  _parts=display_u
+0001d8e0: 726c 290a 2020 2020 2020 2020 2020 2020  rl).            
+0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d900: 2020 2020 636f 6e73 6f6c 655f 7374 6174      console_stat
+0001d910: 7573 2e73 746f 7028 290a 2020 2020 2020  us.stop().      
+0001d920: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0001d930: 204b 6579 626f 6172 6449 6e74 6572 7275   KeyboardInterru
+0001d940: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0001d950: 2020 2020 2020 2020 7072 6f63 2e6b 696c          proc.kil
+0001d960: 6c28 2920 2023 206d 616b 6520 7375 7265  l()  # make sure
+0001d970: 206a 7570 7974 6572 2067 6574 7320 6b69   jupyter gets ki
+0001d980: 6c6c 6564 0a20 2020 2020 2020 2020 2020  lled.           
+0001d990: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+0001d9a0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+0001d9b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0001d9c0: 7074 696f 6e3a 2020 2320 6e6f 7365 630a  ption:  # nosec.
+0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9e0: 2020 2020 7061 7373 2020 2320 6e6f 7365      pass  # nose
+0001d9f0: 630a 2020 2020 2020 2020 6578 6365 7074  c.        except
+0001da00: 204b 6579 626f 6172 6449 6e74 6572 7275   KeyboardInterru
+0001da10: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0001da20: 7072 6f63 2e6b 696c 6c28 2920 2023 206d  proc.kill()  # m
+0001da30: 616b 6520 7375 7265 206a 7570 7974 6572  ake sure jupyter
+0001da40: 2067 6574 7320 6b69 6c6c 6564 0a20 2020   gets killed.   
+0001da50: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+0001da60: 7428 3129 0a20 2020 2065 7863 6570 7420  t(1).    except 
+0001da70: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0001da80: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+0001da90: 4572 726f 7220 7275 6e6e 696e 6720 7175  Error running qu
+0001daa0: 6963 6b73 7461 7274 3a20 7b65 7d22 290a  ickstart: {e}").
+0001dab0: 2020 2020 2020 2020 7261 6973 6520 650a          raise e.
+0001dac0: 0a0a 4063 6c69 636b 2e63 6f6d 6d61 6e64  ..@click.command
+0001dad0: 280a 2020 2020 6865 6c70 3d22 4c61 756e  (.    help="Laun
+0001dae0: 6368 2061 2053 7966 7420 2b20 4a75 7079  ch a Syft + Jupy
+0001daf0: 7465 7220 5365 7373 696f 6e20 7769 7468  ter Session with
+0001db00: 2061 204e 6f74 6562 6f6f 6b20 5552 4c20   a Notebook URL 
+0001db10: 2f20 5061 7468 222c 0a20 2020 2063 6f6e  / Path",.    con
+0001db20: 7465 7874 5f73 6574 7469 6e67 733d 7b22  text_settings={"
+0001db30: 7368 6f77 5f64 6566 6175 6c74 223a 2054  show_default": T
+0001db40: 7275 657d 2c0a 290a 4063 6c69 636b 2e61  rue},.).@click.a
+0001db50: 7267 756d 656e 7428 2275 726c 222c 2074  rgument("url", t
+0001db60: 7970 653d 7374 722c 2072 6571 7569 7265  ype=str, require
+0001db70: 643d 4661 6c73 6529 0a40 636c 6963 6b2e  d=False).@click.
+0001db80: 6f70 7469 6f6e 280a 2020 2020 222d 2d72  option(.    "--r
+0001db90: 6573 6574 222c 0a20 2020 2069 735f 666c  eset",.    is_fl
+0001dba0: 6167 3d54 7275 652c 0a20 2020 2064 6566  ag=True,.    def
+0001dbb0: 6175 6c74 3d46 616c 7365 2c0a 2020 2020  ault=False,.    
+0001dbc0: 6865 6c70 3d22 466f 7263 6520 6861 6772  help="Force hagr
+0001dbd0: 6964 2071 7569 636b 7374 6172 7420 746f  id quickstart to
+0001dbe0: 2073 6574 7570 2061 2066 7265 7368 2076   setup a fresh v
+0001dbf0: 6972 7475 616c 656e 7622 2c0a 290a 4063  irtualenv",.).@c
+0001dc00: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+0001dc10: 2022 2d2d 7379 6674 222c 0a20 2020 2064   "--syft",.    d
+0001dc20: 6566 6175 6c74 3d22 6c61 7465 7374 222c  efault="latest",
+0001dc30: 0a20 2020 2068 656c 703d 2243 686f 6f73  .    help="Choos
+0001dc40: 6520 6120 7379 6674 2076 6572 7369 6f6e  e a syft version
+0001dc50: 206f 7220 6a75 7374 2075 7365 206c 6174   or just use lat
+0001dc60: 6573 7422 2c0a 290a 4063 6c69 636b 2e6f  est",.).@click.o
+0001dc70: 7074 696f 6e28 0a20 2020 2022 2d2d 7175  ption(.    "--qu
+0001dc80: 6965 7422 2c0a 2020 2020 6973 5f66 6c61  iet",.    is_fla
+0001dc90: 673d 5472 7565 2c0a 2020 2020 6865 6c70  g=True,.    help
+0001dca0: 3d22 5369 6c65 6e63 6520 636f 6e66 6972  ="Silence confir
+0001dcb0: 6d61 7469 6f6e 2070 726f 6d70 7473 222c  mation prompts",
+0001dcc0: 0a29 0a40 636c 6963 6b2e 6f70 7469 6f6e  .).@click.option
+0001dcd0: 280a 2020 2020 222d 2d70 7265 222c 0a20  (.    "--pre",. 
+0001dce0: 2020 2069 735f 666c 6167 3d54 7275 652c     is_flag=True,
+0001dcf0: 0a20 2020 2068 656c 703d 2249 6e73 7461  .    help="Insta
+0001dd00: 6c6c 2070 7265 2d72 656c 6561 7365 2076  ll pre-release v
+0001dd10: 6572 7369 6f6e 7320 6f66 2073 7966 7422  ersions of syft"
+0001dd20: 2c0a 290a 4063 6c69 636b 2e6f 7074 696f  ,.).@click.optio
+0001dd30: 6e28 0a20 2020 2022 2d2d 7079 7468 6f6e  n(.    "--python
+0001dd40: 222c 0a20 2020 2064 6566 6175 6c74 3d4e  ",.    default=N
+0001dd50: 6f6e 652c 0a20 2020 2068 656c 703d 2253  one,.    help="S
+0001dd60: 7065 6369 6679 2074 6865 2070 6174 6820  pecify the path 
+0001dd70: 746f 2077 6869 6368 2070 7974 686f 6e20  to which python 
+0001dd80: 746f 2075 7365 222c 0a29 0a40 636c 6963  to use",.).@clic
+0001dd90: 6b2e 6f70 7469 6f6e 280a 2020 2020 222d  k.option(.    "-
+0001dda0: 2d74 6573 7422 2c0a 2020 2020 6973 5f66  -test",.    is_f
+0001ddb0: 6c61 673d 5472 7565 2c0a 2020 2020 6865  lag=True,.    he
+0001ddc0: 6c70 3d22 4349 2054 6573 7420 4d6f 6465  lp="CI Test Mode
+0001ddd0: 2c20 646f 6e27 7420 6861 6e67 206f 6e20  , don't hang on 
+0001dde0: 4a75 7079 7465 7222 2c0a 290a 4063 6c69  Jupyter",.).@cli
+0001ddf0: 636b 2e6f 7074 696f 6e28 0a20 2020 2022  ck.option(.    "
+0001de00: 2d2d 7265 706f 222c 0a20 2020 2064 6566  --repo",.    def
+0001de10: 6175 6c74 3d44 4546 4155 4c54 5f52 4550  ault=DEFAULT_REP
+0001de20: 4f2c 0a20 2020 2068 656c 703d 2243 686f  O,.    help="Cho
+0001de30: 6f73 6520 6120 7265 706f 2074 6f20 6665  ose a repo to fe
+0001de40: 7463 6820 7468 6520 6e6f 7465 626f 6f6b  tch the notebook
+0001de50: 2066 726f 6d20 6f72 206a 7573 7420 7573   from or just us
+0001de60: 6520 4f70 656e 4d69 6e65 642f 5079 5379  e OpenMined/PySy
+0001de70: 6674 222c 0a29 0a40 636c 6963 6b2e 6f70  ft",.).@click.op
+0001de80: 7469 6f6e 280a 2020 2020 222d 2d62 7261  tion(.    "--bra
+0001de90: 6e63 6822 2c0a 2020 2020 6465 6661 756c  nch",.    defaul
+0001dea0: 743d 4445 4641 554c 545f 4252 414e 4348  t=DEFAULT_BRANCH
+0001deb0: 2c0a 2020 2020 6865 6c70 3d22 4368 6f6f  ,.    help="Choo
+0001dec0: 7365 2061 2062 7261 6e63 6820 746f 2066  se a branch to f
+0001ded0: 6574 6368 2066 726f 6d20 6f72 206a 7573  etch from or jus
+0001dee0: 7420 7573 6520 6465 7622 2c0a 290a 4063  t use dev",.).@c
+0001def0: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+0001df00: 2022 2d2d 636f 6d6d 6974 222c 0a20 2020   "--commit",.   
+0001df10: 2068 656c 703d 2243 686f 6f73 6520 6120   help="Choose a 
+0001df20: 7370 6563 6966 6963 2063 6f6d 6d69 7420  specific commit 
+0001df30: 746f 2066 6574 6368 2074 6865 206e 6f74  to fetch the not
+0001df40: 6562 6f6f 6b20 6672 6f6d 222c 0a29 0a64  ebook from",.).d
+0001df50: 6566 2071 7569 636b 7374 6172 745f 636c  ef quickstart_cl
+0001df60: 6928 0a20 2020 2075 726c 3a20 4f70 7469  i(.    url: Opti
+0001df70: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0001df80: 2c0a 2020 2020 7379 6674 3a20 7374 7220  ,.    syft: str 
+0001df90: 3d20 226c 6174 6573 7422 2c0a 2020 2020  = "latest",.    
+0001dfa0: 7265 7365 743a 2062 6f6f 6c20 3d20 4661  reset: bool = Fa
+0001dfb0: 6c73 652c 0a20 2020 2071 7569 6574 3a20  lse,.    quiet: 
+0001dfc0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0001dfd0: 2020 7072 653a 2062 6f6f 6c20 3d20 4661    pre: bool = Fa
+0001dfe0: 6c73 652c 0a20 2020 2074 6573 743a 2062  lse,.    test: b
+0001dff0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001e000: 2072 6570 6f3a 2073 7472 203d 2044 4546   repo: str = DEF
+0001e010: 4155 4c54 5f52 4550 4f2c 0a20 2020 2062  AULT_REPO,.    b
+0001e020: 7261 6e63 683a 2073 7472 203d 2044 4546  ranch: str = DEF
+0001e030: 4155 4c54 5f42 5241 4e43 482c 0a20 2020  AULT_BRANCH,.   
+0001e040: 2063 6f6d 6d69 743a 204f 7074 696f 6e61   commit: Optiona
+0001e050: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+0001e060: 2020 2070 7974 686f 6e3a 204f 7074 696f     python: Optio
+0001e070: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+0001e080: 0a29 202d 3e20 4e6f 6e65 3a0a 2020 2020  .) -> None:.    
+0001e090: 7265 7475 726e 2072 756e 5f71 7569 636b  return run_quick
+0001e0a0: 7374 6172 7428 0a20 2020 2020 2020 2075  start(.        u
+0001e0b0: 726c 3d75 726c 2c0a 2020 2020 2020 2020  rl=url,.        
+0001e0c0: 7379 6674 3d73 7966 742c 0a20 2020 2020  syft=syft,.     
+0001e0d0: 2020 2072 6573 6574 3d72 6573 6574 2c0a     reset=reset,.
+0001e0e0: 2020 2020 2020 2020 7175 6965 743d 7175          quiet=qu
+0001e0f0: 6965 742c 0a20 2020 2020 2020 2070 7265  iet,.        pre
+0001e100: 3d70 7265 2c0a 2020 2020 2020 2020 7465  =pre,.        te
+0001e110: 7374 3d74 6573 742c 0a20 2020 2020 2020  st=test,.       
+0001e120: 2072 6570 6f3d 7265 706f 2c0a 2020 2020   repo=repo,.    
+0001e130: 2020 2020 6272 616e 6368 3d62 7261 6e63      branch=branc
+0001e140: 682c 0a20 2020 2020 2020 2063 6f6d 6d69  h,.        commi
+0001e150: 743d 636f 6d6d 6974 2c0a 2020 2020 2020  t=commit,.      
+0001e160: 2020 7079 7468 6f6e 3d70 7974 686f 6e2c    python=python,
+0001e170: 0a20 2020 2029 0a0a 0a63 6c69 2e61 6464  .    )...cli.add
+0001e180: 5f63 6f6d 6d61 6e64 2871 7569 636b 7374  _command(quickst
+0001e190: 6172 745f 636c 692c 2022 7175 6963 6b73  art_cli, "quicks
+0001e1a0: 7461 7274 2229 0a0a 0a64 6566 2064 6973  tart")...def dis
+0001e1b0: 706c 6179 5f6a 7570 7974 6572 5f75 726c  play_jupyter_url
+0001e1c0: 2875 726c 5f70 6172 7473 3a20 5475 706c  (url_parts: Tupl
+0001e1d0: 655b 7374 722c 2073 7472 2c20 696e 745d  e[str, str, int]
+0001e1e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2075  ) -> None:.    u
+0001e1f0: 726c 203d 2075 726c 5f70 6172 7473 5b30  rl = url_parts[0
+0001e200: 5d0a 2020 2020 6966 2069 735f 6769 7470  ].    if is_gitp
+0001e210: 6f64 2829 3a0a 2020 2020 2020 2020 7061  od():.        pa
+0001e220: 7274 7320 3d20 7572 6c70 6172 7365 2875  rts = urlparse(u
+0001e230: 726c 290a 2020 2020 2020 2020 7175 6572  rl).        quer
+0001e240: 7920 3d20 6765 7461 7474 7228 7061 7274  y = getattr(part
+0001e250: 732c 2022 7175 6572 7922 2c20 2222 290a  s, "query", "").
+0001e260: 2020 2020 2020 2020 7572 6c20 3d20 6769          url = gi
+0001e270: 7470 6f64 5f75 726c 2870 6f72 743d 7572  tpod_url(port=ur
+0001e280: 6c5f 7061 7274 735b 325d 2920 2b20 223f  l_parts[2]) + "?
+0001e290: 2220 2b20 7175 6572 790a 0a20 2020 2063  " + query..    c
+0001e2a0: 6f6e 736f 6c65 203d 2072 6963 682e 6765  onsole = rich.ge
+0001e2b0: 745f 636f 6e73 6f6c 6528 290a 0a20 2020  t_console()..   
+0001e2c0: 2074 6963 6b5f 656d 6f6a 6920 3d20 5269   tick_emoji = Ri
+0001e2d0: 6368 456d 6f6a 6928 2277 6869 7465 5f68  chEmoji("white_h
+0001e2e0: 6561 7679 5f63 6865 636b 5f6d 6172 6b22  eavy_check_mark"
+0001e2f0: 292e 746f 5f73 7472 2829 0a20 2020 206c  ).to_str().    l
+0001e300: 696e 6b5f 656d 6f6a 6920 3d20 5269 6368  ink_emoji = Rich
+0001e310: 456d 6f6a 6928 226c 696e 6b22 292e 746f  Emoji("link").to
+0001e320: 5f73 7472 2829 0a0a 2020 2020 636f 6e73  _str()..    cons
+0001e330: 6f6c 652e 7072 696e 7428 0a20 2020 2020  ole.print(.     
+0001e340: 2020 2066 225b 626f 6c64 2077 6869 7465     f"[bold white
+0001e350: 5d7b 7469 636b 5f65 6d6f 6a69 7d20 4a75  ]{tick_emoji} Ju
+0001e360: 7079 7465 7220 5365 7276 6572 2069 7320  pyter Server is 
+0001e370: 7275 6e6e 696e 6720 6174 3a5c 6e7b 6c69  running at:\n{li
+0001e380: 6e6b 5f65 6d6f 6a69 7d20 5b62 6f6c 6420  nk_emoji} [bold 
+0001e390: 626c 7565 5d7b 7572 6c7d 5c6e 220a 2020  blue]{url}\n".  
+0001e3a0: 2020 2020 2020 2b20 225b 626f 6c64 2077        + "[bold w
+0001e3b0: 6869 7465 5d55 7365 2043 6f6e 7472 6f6c  hite]Use Control
+0001e3c0: 2d43 2074 6f20 7374 6f70 2074 6869 7320  -C to stop this 
+0001e3d0: 7365 7276 6572 2061 6e64 2073 6875 7420  server and shut 
+0001e3e0: 646f 776e 2061 6c6c 206b 6572 6e65 6c73  down all kernels
+0001e3f0: 2e22 2c0a 2020 2020 2020 2020 6e65 775f  .",.        new_
+0001e400: 6c69 6e65 5f73 7461 7274 3d54 7275 652c  line_start=True,
+0001e410: 0a20 2020 2029 0a0a 2020 2020 2320 6966  .    )..    # if
+0001e420: 2069 735f 6769 7470 6f64 2829 3a0a 2020   is_gitpod():.  
+0001e430: 2020 2320 2020 2020 6f70 656e 5f62 726f    #     open_bro
+0001e440: 7773 6572 5f77 6974 685f 7572 6c28 7572  wser_with_url(ur
+0001e450: 6c3d 7572 6c29 0a0a 0a64 6566 206f 7065  l=url)...def ope
+0001e460: 6e5f 6272 6f77 7365 725f 7769 7468 5f75  n_browser_with_u
+0001e470: 726c 2875 726c 3a20 7374 7229 202d 3e20  rl(url: str) -> 
+0001e480: 4e6f 6e65 3a0a 2020 2020 7765 6262 726f  None:.    webbro
+0001e490: 7773 6572 2e6f 7065 6e28 7572 6c29 0a0a  wser.open(url)..
+0001e4a0: 0a64 6566 2065 7874 7261 6374 5f6a 7570  .def extract_jup
+0001e4b0: 7974 6572 5f75 726c 286c 696e 653a 2073  yter_url(line: s
+0001e4c0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
+0001e4d0: 5475 706c 655b 7374 722c 2073 7472 2c20  Tuple[str, str, 
+0001e4e0: 696e 745d 5d3a 0a20 2020 206a 7570 7974  int]]:.    jupyt
+0001e4f0: 6572 5f72 6567 6578 203d 2072 225e 2e2a  er_regex = r"^.*
+0001e500: 2868 7474 702e 2a31 3237 2e2a 2922 0a20  (http.*127.*)". 
+0001e510: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001e520: 6d61 7463 6865 7320 3d20 7265 2e6d 6174  matches = re.mat
+0001e530: 6368 286a 7570 7974 6572 5f72 6567 6578  ch(jupyter_regex
+0001e540: 2c20 6c69 6e65 290a 2020 2020 2020 2020  , line).        
+0001e550: 6966 206d 6174 6368 6573 2069 7320 6e6f  if matches is no
+0001e560: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0001e570: 2020 2020 7572 6c20 3d20 6d61 7463 6865      url = matche
+0001e580: 732e 6772 6f75 7028 3129 2e73 7472 6970  s.group(1).strip
+0001e590: 2829 0a20 2020 2020 2020 2020 2020 2070  ().            p
+0001e5a0: 6172 7473 203d 2075 726c 7061 7273 6528  arts = urlparse(
+0001e5b0: 7572 6c29 0a20 2020 2020 2020 2020 2020  url).           
+0001e5c0: 2068 6f73 745f 6f72 5f69 705f 7061 7274   host_or_ip_part
+0001e5d0: 7320 3d20 7061 7274 732e 6e65 746c 6f63  s = parts.netloc
+0001e5e0: 2e73 706c 6974 2822 3a22 290a 2020 2020  .split(":").    
+0001e5f0: 2020 2020 2020 2020 2320 6e65 746c 6f63          # netloc
+0001e600: 2069 7320 686f 7374 3a70 6f72 740a 2020   is host:port.  
+0001e610: 2020 2020 2020 2020 2020 706f 7274 203d            port =
+0001e620: 2038 3838 380a 2020 2020 2020 2020 2020   8888.          
+0001e630: 2020 6966 206c 656e 2868 6f73 745f 6f72    if len(host_or
+0001e640: 5f69 705f 7061 7274 7329 203e 2031 3a0a  _ip_parts) > 1:.
+0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e660: 706f 7274 203d 2069 6e74 2868 6f73 745f  port = int(host_
+0001e670: 6f72 5f69 705f 7061 7274 735b 315d 290a  or_ip_parts[1]).
+0001e680: 2020 2020 2020 2020 2020 2020 686f 7374              host
+0001e690: 5f6f 725f 6970 203d 2068 6f73 745f 6f72  _or_ip = host_or
+0001e6a0: 5f69 705f 7061 7274 735b 305d 0a20 2020  _ip_parts[0].   
+0001e6b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001e6c0: 2875 726c 2c20 686f 7374 5f6f 725f 6970  (url, host_or_ip
+0001e6d0: 2c20 706f 7274 290a 2020 2020 6578 6365  , port).    exce
+0001e6e0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0001e6f0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+0001e700: 2822 6661 696c 6564 2074 6f20 7061 7273  ("failed to pars
+0001e710: 6520 6a75 7079 7465 7220 7572 6c22 2c20  e jupyter url", 
+0001e720: 6529 0a20 2020 2072 6574 7572 6e20 4e6f  e).    return No
+0001e730: 6e65 0a0a 0a64 6566 2071 7569 636b 7374  ne...def quickst
+0001e740: 6172 745f 7365 7475 7028 0a20 2020 2064  art_setup(.    d
+0001e750: 6972 6563 746f 7279 3a20 7374 722c 0a20  irectory: str,. 
+0001e760: 2020 2073 7966 745f 7665 7273 696f 6e3a     syft_version:
+0001e770: 2073 7472 2c0a 2020 2020 7265 7365 743a   str,.    reset:
+0001e780: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0001e790: 2020 2070 7265 3a20 626f 6f6c 203d 2046     pre: bool = F
+0001e7a0: 616c 7365 2c0a 2020 2020 7079 7468 6f6e  alse,.    python
+0001e7b0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0001e7c0: 3d20 4e6f 6e65 2c0a 2920 2d3e 204e 6f6e  = None,.) -> Non
+0001e7d0: 653a 0a20 2020 2063 6f6e 736f 6c65 203d  e:.    console =
+0001e7e0: 2072 6963 682e 6765 745f 636f 6e73 6f6c   rich.get_consol
+0001e7f0: 6528 290a 2020 2020 4f4b 5f45 4d4f 4a49  e().    OK_EMOJI
+0001e800: 203d 2052 6963 6845 6d6f 6a69 2822 7768   = RichEmoji("wh
+0001e810: 6974 655f 6865 6176 795f 6368 6563 6b5f  ite_heavy_check_
+0001e820: 6d61 726b 2229 2e74 6f5f 7374 7228 290a  mark").to_str().
+0001e830: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0001e840: 2020 7769 7468 2063 6f6e 736f 6c65 2e73    with console.s
+0001e850: 7461 7475 7328 0a20 2020 2020 2020 2020  tatus(.         
+0001e860: 2020 2022 5b62 6f6c 6420 626c 7565 5d53     "[bold blue]S
+0001e870: 6574 7469 6e67 2075 7020 5175 6963 6b73  etting up Quicks
+0001e880: 7461 7274 2045 6e76 6972 6f6e 6d65 6e74  tart Environment
+0001e890: 220a 2020 2020 2020 2020 2920 6173 2063  ".        ) as c
+0001e8a0: 6f6e 736f 6c65 5f73 7461 7475 733a 0a20  onsole_status:. 
+0001e8b0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+0001e8c0: 6b65 6469 7273 2864 6972 6563 746f 7279  kedirs(directory
+0001e8d0: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
+0001e8e0: 0a20 2020 2020 2020 2020 2020 2076 6972  .            vir
+0001e8f0: 7475 616c 5f65 6e76 5f64 6972 203d 206f  tual_env_dir = o
+0001e900: 732e 7061 7468 2e61 6273 7061 7468 2864  s.path.abspath(d
+0001e910: 6972 6563 746f 7279 202b 2022 2e76 656e  irectory + ".ven
+0001e920: 762f 2229 0a20 2020 2020 2020 2020 2020  v/").           
+0001e930: 2069 6620 7265 7365 7420 616e 6420 6f73   if reset and os
+0001e940: 2e70 6174 682e 6578 6973 7473 2876 6972  .path.exists(vir
+0001e950: 7475 616c 5f65 6e76 5f64 6972 293a 0a20  tual_env_dir):. 
+0001e960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001e970: 6875 7469 6c2e 726d 7472 6565 2876 6972  hutil.rmtree(vir
+0001e980: 7475 616c 5f65 6e76 5f64 6972 290a 2020  tual_env_dir).  
+0001e990: 2020 2020 2020 2020 2020 656e 7620 3d20            env = 
+0001e9a0: 5669 7274 7561 6c45 6e76 6972 6f6e 6d65  VirtualEnvironme
+0001e9b0: 6e74 2876 6972 7475 616c 5f65 6e76 5f64  nt(virtual_env_d
+0001e9c0: 6972 2c20 7079 7468 6f6e 3d70 7974 686f  ir, python=pytho
+0001e9d0: 6e29 0a20 2020 2020 2020 2020 2020 2063  n).            c
+0001e9e0: 6f6e 736f 6c65 2e70 7269 6e74 280a 2020  onsole.print(.  
+0001e9f0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001ea00: 7b4f 4b5f 454d 4f4a 497d 2043 7265 6174  {OK_EMOJI} Creat
+0001ea10: 6564 2056 6972 7475 616c 2045 6e76 6972  ed Virtual Envir
+0001ea20: 6f6e 6d65 6e74 207b 5269 6368 456d 6f6a  onment {RichEmoj
+0001ea30: 6928 2765 7665 7267 7265 656e 5f74 7265  i('evergreen_tre
+0001ea40: 6527 292e 746f 5f73 7472 2829 7d22 0a20  e').to_str()}". 
+0001ea50: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0001ea60: 2020 2020 2020 2020 2020 2320 7570 6772            # upgr
+0001ea70: 6164 6520 7069 700a 2020 2020 2020 2020  ade pip.        
+0001ea80: 2020 2020 636f 6e73 6f6c 655f 7374 6174      console_stat
+0001ea90: 7573 2e75 7064 6174 6528 225b 626f 6c64  us.update("[bold
+0001eaa0: 2062 6c75 655d 496e 7374 616c 6c69 6e67   blue]Installing
+0001eab0: 2070 6970 2229 0a20 2020 2020 2020 2020   pip").         
+0001eac0: 2020 2065 6e76 2e69 6e73 7461 6c6c 2822     env.install("
+0001ead0: 7069 7022 2c20 6f70 7469 6f6e 733d 5b22  pip", options=["
+0001eae0: 2d55 225d 290a 2020 2020 2020 2020 2020  -U"]).          
+0001eaf0: 2020 636f 6e73 6f6c 652e 7072 696e 7428    console.print(
+0001eb00: 6622 7b4f 4b5f 454d 4f4a 497d 2070 6970  f"{OK_EMOJI} pip
+0001eb10: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0001eb20: 2320 7570 6772 6164 6520 7061 636b 6167  # upgrade packag
+0001eb30: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0001eb40: 636f 6e73 6f6c 655f 7374 6174 7573 2e75  console_status.u
+0001eb50: 7064 6174 6528 225b 626f 6c64 2062 6c75  pdate("[bold blu
+0001eb60: 655d 496e 7374 616c 6c69 6e67 2070 6163  e]Installing pac
+0001eb70: 6b61 6769 6e67 2229 0a20 2020 2020 2020  kaging").       
+0001eb80: 2020 2020 2065 6e76 2e69 6e73 7461 6c6c       env.install
+0001eb90: 2822 7061 636b 6167 696e 6722 2c20 6f70  ("packaging", op
+0001eba0: 7469 6f6e 733d 5b22 2d55 225d 290a 2020  tions=["-U"]).  
+0001ebb0: 2020 2020 2020 2020 2020 636f 6e73 6f6c            consol
+0001ebc0: 652e 7072 696e 7428 6622 7b4f 4b5f 454d  e.print(f"{OK_EM
+0001ebd0: 4f4a 497d 2070 6163 6b61 6769 6e67 2229  OJI} packaging")
+0001ebe0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0001ebf0: 496e 7374 616c 6c20 6a75 7079 7465 7220  Install jupyter 
+0001ec00: 6c61 620a 2020 2020 2020 2020 2020 2020  lab.            
+0001ec10: 636f 6e73 6f6c 655f 7374 6174 7573 2e75  console_status.u
+0001ec20: 7064 6174 6528 225b 626f 6c64 2062 6c75  pdate("[bold blu
+0001ec30: 655d 496e 7374 616c 6c69 6e67 204a 7570  e]Installing Jup
+0001ec40: 7974 6572 204c 6162 2229 0a20 2020 2020  yter Lab").     
+0001ec50: 2020 2020 2020 2065 6e76 2e69 6e73 7461         env.insta
+0001ec60: 6c6c 2822 6a75 7079 7465 726c 6162 2229  ll("jupyterlab")
+0001ec70: 0a20 2020 2020 2020 2020 2020 2065 6e76  .            env
+0001ec80: 2e69 6e73 7461 6c6c 2822 6970 7977 6964  .install("ipywid
+0001ec90: 6765 7473 2229 0a20 2020 2020 2020 2020  gets").         
+0001eca0: 2020 2063 6f6e 736f 6c65 2e70 7269 6e74     console.print
+0001ecb0: 2866 227b 4f4b 5f45 4d4f 4a49 7d20 4a75  (f"{OK_EMOJI} Ju
+0001ecc0: 7079 7465 7220 4c61 6222 290a 0a20 2020  pyter Lab")..   
+0001ecd0: 2020 2020 2020 2020 2023 2049 6e73 7461           # Insta
+0001ece0: 6c6c 2068 6167 7269 640a 2020 2020 2020  ll hagrid.      
+0001ecf0: 2020 2020 2020 6966 2045 4449 5441 424c        if EDITABL
+0001ed00: 455f 4d4f 4445 3a0a 2020 2020 2020 2020  E_MODE:.        
+0001ed10: 2020 2020 2020 2020 6c6f 6361 6c5f 6861          local_ha
+0001ed20: 6772 6964 5f64 6972 203d 2050 6174 6828  grid_dir = Path(
+0001ed30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ed40: 2020 2020 206f 732e 7061 7468 2e61 6273       os.path.abs
+0001ed50: 7061 7468 2850 6174 6828 6861 6772 6964  path(Path(hagrid
+0001ed60: 5f72 6f6f 7428 2929 202f 2022 2e2e 2f68  _root()) / "../h
+0001ed70: 6167 7269 6422 290a 2020 2020 2020 2020  agrid").        
+0001ed80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001ed90: 2020 2020 2020 2020 2020 636f 6e73 6f6c            consol
+0001eda0: 655f 7374 6174 7573 2e75 7064 6174 6528  e_status.update(
+0001edb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001edc0: 2020 2020 2066 225b 626f 6c64 2062 6c75       f"[bold blu
+0001edd0: 655d 496e 7374 616c 6c69 6e67 2048 4147  e]Installing HAG
+0001ede0: 7269 6420 696e 2045 6469 7461 626c 6520  rid in Editable 
+0001edf0: 4d6f 6465 3a20 7b73 7472 286c 6f63 616c  Mode: {str(local
+0001ee00: 5f68 6167 7269 645f 6469 7229 7d22 0a20  _hagrid_dir)}". 
+0001ee10: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001ee20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ee30: 2065 6e76 2e69 6e73 7461 6c6c 2822 2d65   env.install("-e
+0001ee40: 2022 202b 2073 7472 286c 6f63 616c 5f68   " + str(local_h
+0001ee50: 6167 7269 645f 6469 7229 290a 2020 2020  agrid_dir)).    
+0001ee60: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+0001ee70: 6f6c 652e 7072 696e 7428 0a20 2020 2020  ole.print(.     
+0001ee80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ee90: 227b 4f4b 5f45 4d4f 4a49 7d20 4841 4772  "{OK_EMOJI} HAGr
+0001eea0: 6964 2069 6e20 4564 6974 6162 6c65 204d  id in Editable M
+0001eeb0: 6f64 653a 207b 7374 7228 6c6f 6361 6c5f  ode: {str(local_
+0001eec0: 6861 6772 6964 5f64 6972 297d 220a 2020  hagrid_dir)}".  
+0001eed0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001eee0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001eef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ef00: 2020 636f 6e73 6f6c 655f 7374 6174 7573    console_status
+0001ef10: 2e75 7064 6174 6528 225b 626f 6c64 2062  .update("[bold b
+0001ef20: 6c75 655d 496e 7374 616c 6c69 6e67 2068  lue]Installing h
+0001ef30: 6167 7269 6422 290a 2020 2020 2020 2020  agrid").        
+0001ef40: 2020 2020 2020 2020 656e 762e 696e 7374          env.inst
+0001ef50: 616c 6c28 2268 6167 7269 6422 2c20 6f70  all("hagrid", op
+0001ef60: 7469 6f6e 733d 5b22 2d55 225d 290a 2020  tions=["-U"]).  
+0001ef70: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001ef80: 6e73 6f6c 652e 7072 696e 7428 6622 7b4f  nsole.print(f"{O
+0001ef90: 4b5f 454d 4f4a 497d 2048 4147 7269 6422  K_EMOJI} HAGrid"
+0001efa0: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
+0001efb0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0001efc0: 2020 2020 2070 7269 6e74 2865 290a 2020       print(e).  
+0001efd0: 2020 2020 2020 7261 6973 6520 650a 0a0a        raise e...
+0001efe0: 6465 6620 6164 645f 696e 7472 6f5f 6e6f  def add_intro_no
+0001eff0: 7465 626f 6f6b 2864 6972 6563 746f 7279  tebook(directory
+0001f000: 3a20 7374 722c 2072 6573 6574 3a20 626f  : str, reset: bo
+0001f010: 6f6c 203d 2046 616c 7365 2920 2d3e 2073  ol = False) -> s
+0001f020: 7472 3a0a 2020 2020 6669 6c65 6e61 6d65  tr:.    filename
+0001f030: 7320 3d20 5b22 3030 2d71 7569 636b 7374  s = ["00-quickst
+0001f040: 6172 742e 6970 796e 6222 2c20 2230 312d  art.ipynb", "01-
+0001f050: 696e 7374 616c 6c2d 7769 7a61 7264 2e69  install-wizard.i
+0001f060: 7079 6e62 225d 0a0a 2020 2020 6669 6c65  pynb"]..    file
+0001f070: 7320 3d20 6f73 2e6c 6973 7464 6972 2864  s = os.listdir(d
+0001f080: 6972 6563 746f 7279 290a 2020 2020 7472  irectory).    tr
+0001f090: 793a 0a20 2020 2020 2020 2066 696c 6573  y:.        files
+0001f0a0: 2e72 656d 6f76 6528 222e 7665 6e76 2229  .remove(".venv")
+0001f0b0: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+0001f0c0: 7074 696f 6e3a 2020 2320 6e6f 7365 630a  ption:  # nosec.
+0001f0d0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+0001f0e0: 2020 6578 6973 7469 6e67 203d 2030 0a20    existing = 0. 
+0001f0f0: 2020 2066 6f72 2066 696c 6520 696e 2066     for file in f
+0001f100: 696c 6573 3a0a 2020 2020 2020 2020 6966  iles:.        if
+0001f110: 2066 696c 6520 696e 2066 696c 656e 616d   file in filenam
+0001f120: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001f130: 6578 6973 7469 6e67 202b 3d20 310a 0a20  existing += 1.. 
+0001f140: 2020 2069 6620 6578 6973 7469 6e67 2021     if existing !
+0001f150: 3d20 6c65 6e28 6669 6c65 6e61 6d65 7329  = len(filenames)
+0001f160: 206f 7220 7265 7365 743a 0a20 2020 2020   or reset:.     
+0001f170: 2020 2069 6620 4544 4954 4142 4c45 5f4d     if EDITABLE_M
+0001f180: 4f44 453a 0a20 2020 2020 2020 2020 2020  ODE:.           
+0001f190: 206c 6f63 616c 5f73 7263 5f64 6972 203d   local_src_dir =
+0001f1a0: 2050 6174 6828 6f73 2e70 6174 682e 6162   Path(os.path.ab
+0001f1b0: 7370 6174 6828 5061 7468 2868 6167 7269  spath(Path(hagri
+0001f1c0: 645f 726f 6f74 2829 2920 2f20 222e 2e2f  d_root()) / "../
+0001f1d0: 2e2e 2f22 2929 0a20 2020 2020 2020 2020  ../")).         
+0001f1e0: 2020 2066 6f72 2066 696c 656e 616d 6520     for filename 
+0001f1f0: 696e 2066 696c 656e 616d 6573 3a0a 2020  in filenames:.  
+0001f200: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001f210: 6c65 5f70 6174 6820 3d20 6f73 2e70 6174  le_path = os.pat
+0001f220: 682e 6162 7370 6174 6828 6622 7b64 6972  h.abspath(f"{dir
+0001f230: 6563 746f 7279 7d2f 7b66 696c 656e 616d  ectory}/{filenam
+0001f240: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0001f250: 2020 2020 2073 6875 7469 6c2e 636f 7079       shutil.copy
+0001f260: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
+0001f270: 2020 2020 2020 2020 2020 6c6f 6361 6c5f            local_
+0001f280: 7372 635f 6469 7220 2f20 6622 6e6f 7465  src_dir / f"note
+0001f290: 626f 6f6b 732f 7175 6963 6b73 7461 7274  books/quickstart
+0001f2a0: 2f7b 6669 6c65 6e61 6d65 7d22 2c0a 2020  /{filename}",.  
+0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2c0: 2020 6669 6c65 5f70 6174 682c 0a20 2020    file_path,.   
+0001f2d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001f2e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f2f0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+0001f300: 656e 616d 6520 696e 2066 696c 656e 616d  ename in filenam
+0001f310: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001f320: 2020 2020 7572 6c20 3d20 280a 2020 2020      url = (.    
+0001f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f340: 2268 7474 7073 3a2f 2f72 6177 2e67 6974  "https://raw.git
+0001f350: 6875 6275 7365 7263 6f6e 7465 6e74 2e63  hubusercontent.c
+0001f360: 6f6d 2f4f 7065 6e4d 696e 6564 2f50 7953  om/OpenMined/PyS
+0001f370: 7966 742f 6465 762f 220a 2020 2020 2020  yft/dev/".      
+0001f380: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001f390: 6622 6e6f 7465 626f 6f6b 732f 7175 6963  f"notebooks/quic
+0001f3a0: 6b73 7461 7274 2f7b 6669 6c65 6e61 6d65  kstart/{filename
+0001f3b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0001f3c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001f3d0: 2020 2020 2066 696c 655f 7061 7468 2c20       file_path, 
+0001f3e0: 5f2c 205f 203d 2071 7569 636b 7374 6172  _, _ = quickstar
+0001f3f0: 745f 646f 776e 6c6f 6164 5f6e 6f74 6562  t_download_noteb
+0001f400: 6f6f 6b28 0a20 2020 2020 2020 2020 2020  ook(.           
+0001f410: 2020 2020 2020 2020 2075 726c 3d75 726c           url=url
+0001f420: 2c20 6469 7265 6374 6f72 793d 6469 7265  , directory=dire
+0001f430: 6374 6f72 792c 2072 6573 6574 3d72 6573  ctory, reset=res
+0001f440: 6574 0a20 2020 2020 2020 2020 2020 2020  et.             
+0001f450: 2020 2029 0a20 2020 2069 6620 6172 675f     ).    if arg_
+0001f460: 6361 6368 655b 2269 6e73 7461 6c6c 5f77  cache["install_w
+0001f470: 697a 6172 645f 636f 6d70 6c65 7465 225d  izard_complete"]
+0001f480: 3a0a 2020 2020 2020 2020 6669 6c65 6e61  :.        filena
+0001f490: 6d65 203d 2066 696c 656e 616d 6573 5b30  me = filenames[0
+0001f4a0: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
+0001f4b0: 2020 2020 6669 6c65 6e61 6d65 203d 2066      filename = f
+0001f4c0: 696c 656e 616d 6573 5b31 5d0a 2020 2020  ilenames[1].    
+0001f4d0: 7265 7475 726e 206f 732e 7061 7468 2e61  return os.path.a
+0001f4e0: 6273 7061 7468 2866 227b 6469 7265 6374  bspath(f"{direct
+0001f4f0: 6f72 797d 2f7b 6669 6c65 6e61 6d65 7d22  ory}/{filename}"
+0001f500: 290a 0a0a 4063 6c69 636b 2e63 6f6d 6d61  )...@click.comma
+0001f510: 6e64 2868 656c 703d 2257 616c 6b20 7468  nd(help="Walk th
+0001f520: 6520 5061 7468 222c 2063 6f6e 7465 7874  e Path", context
+0001f530: 5f73 6574 7469 6e67 733d 7b22 7368 6f77  _settings={"show
+0001f540: 5f64 6566 6175 6c74 223a 2054 7275 657d  _default": True}
+0001f550: 290a 4063 6c69 636b 2e61 7267 756d 656e  ).@click.argumen
+0001f560: 7428 227a 6970 5f66 696c 6522 2c20 7479  t("zip_file", ty
+0001f570: 7065 3d73 7472 2c20 6465 6661 756c 743d  pe=str, default=
+0001f580: 2270 6164 6177 616e 2e7a 6970 222c 206d  "padawan.zip", m
+0001f590: 6574 6176 6172 3d22 5a49 5046 494c 4522  etavar="ZIPFILE"
+0001f5a0: 290a 6465 6620 6461 676f 6261 6828 7a69  ).def dagobah(zi
+0001f5b0: 705f 6669 6c65 3a20 7374 7229 202d 3e20  p_file: str) -> 
+0001f5c0: 4e6f 6e65 3a0a 2020 2020 6966 206e 6f74  None:.    if not
+0001f5d0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001f5e0: 7a69 705f 6669 6c65 293a 0a20 2020 2020  zip_file):.     
+0001f5f0: 2020 2066 6f72 2074 6578 7420 696e 2028     for text in (
+0001f600: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
+0001f610: 7a69 705f 6669 6c65 7d20 646f 6573 206e  zip_file} does n
+0001f620: 6f74 2065 7869 7374 732e 222c 0a20 2020  ot exists.",.   
+0001f630: 2020 2020 2020 2020 2022 506c 6561 7365           "Please
+0001f640: 2073 7065 6369 6679 2074 6865 2070 6174   specify the pat
+0001f650: 6820 746f 2074 6865 207a 6970 2066 696c  h to the zip fil
+0001f660: 6520 636f 6e74 6169 6e69 6e67 2074 6865  e containing the
+0001f670: 206e 6f74 6562 6f6f 6b73 2e22 2c0a 2020   notebooks.",.  
+0001f680: 2020 2020 2020 2020 2020 2268 6167 7269            "hagri
+0001f690: 6420 6461 676f 6261 6820 5b5a 4950 4649  d dagobah [ZIPFI
+0001f6a0: 4c45 5d22 2c0a 2020 2020 2020 2020 293a  LE]",.        ):
+0001f6b0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001f6c0: 6e74 2874 6578 742c 2066 696c 653d 7379  nt(text, file=sy
+0001f6d0: 732e 7374 6465 7272 290a 2020 2020 2020  s.stderr).      
+0001f6e0: 2020 7379 732e 6578 6974 2831 290a 0a20    sys.exit(1).. 
+0001f6f0: 2020 2072 6574 7572 6e20 7275 6e5f 7175     return run_qu
+0001f700: 6963 6b73 7461 7274 287a 6970 5f66 696c  ickstart(zip_fil
+0001f710: 653d 7a69 705f 6669 6c65 290a 0a0a 636c  e=zip_file)...cl
+0001f720: 692e 6164 645f 636f 6d6d 616e 6428 6461  i.add_command(da
+0001f730: 676f 6261 6829 0a0a 0a64 6566 2073 7368  gobah)...def ssh
+0001f740: 5f69 6e74 6f5f 7265 6d6f 7465 5f6d 6163  _into_remote_mac
+0001f750: 6869 6e65 280a 2020 2020 686f 7374 5f69  hine(.    host_i
+0001f760: 703a 2073 7472 2c0a 2020 2020 7573 6572  p: str,.    user
+0001f770: 6e61 6d65 3a20 7374 722c 0a20 2020 2061  name: str,.    a
+0001f780: 7574 685f 7479 7065 3a20 7374 722c 0a20  uth_type: str,. 
+0001f790: 2020 2070 7269 7661 7465 5f6b 6579 5f70     private_key_p
+0001f7a0: 6174 683a 204f 7074 696f 6e61 6c5b 7374  ath: Optional[st
+0001f7b0: 725d 2c0a 2020 2020 636d 643a 2073 7472  r],.    cmd: str
+0001f7c0: 203d 2022 222c 0a29 202d 3e20 4e6f 6e65   = "",.) -> None
+0001f7d0: 3a0a 2020 2020 2222 2241 6363 6573 7320  :.    """Access 
+0001f7e0: 6f72 2065 7865 6375 7465 2063 6f6d 6d61  or execute comma
+0001f7f0: 6e64 206f 6e20 7468 6520 7265 6d6f 7465  nd on the remote
+0001f800: 206d 6163 6869 6e65 2e0a 0a20 2020 2041   machine...    A
+0001f810: 7267 733a 0a20 2020 2020 2020 2068 6f73  rgs:.        hos
+0001f820: 745f 6970 2028 7374 7229 3a20 6970 2061  t_ip (str): ip a
+0001f830: 6464 7265 7373 206f 6620 7468 6520 564d  ddress of the VM
+0001f840: 0a20 2020 2020 2020 2070 7269 7661 7465  .        private
+0001f850: 5f6b 6579 5f70 6174 6820 2873 7472 293a  _key_path (str):
+0001f860: 2070 7269 7661 7465 206b 6579 206f 6620   private key of 
+0001f870: 7468 6520 564d 0a20 2020 2020 2020 2075  the VM.        u
+0001f880: 7365 726e 616d 6520 2873 7472 293a 2075  sername (str): u
+0001f890: 7365 726e 616d 6520 6f6e 2074 6865 2056  sername on the V
+0001f8a0: 4d0a 2020 2020 2020 2020 636d 6420 2873  M.        cmd (s
+0001f8b0: 7472 2c20 6f70 7469 6f6e 616c 293a 2043  tr, optional): C
+0001f8c0: 6f6d 6d61 6e64 2074 6f20 6578 6563 7574  ommand to execut
+0001f8d0: 6520 6f6e 2074 6865 2072 656d 6f74 6520  e on the remote 
+0001f8e0: 6d61 6368 696e 652e 2044 6566 6175 6c74  machine. Default
+0001f8f0: 7320 746f 2022 222e 0a20 2020 2022 2222  s to ""..    """
+0001f900: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0001f910: 2020 6966 2061 7574 685f 7479 7065 203d    if auth_type =
+0001f920: 3d20 226b 6579 223a 0a20 2020 2020 2020  = "key":.       
+0001f930: 2020 2020 2073 7562 7072 6f63 6573 732e       subprocess.
+0001f940: 6361 6c6c 2820 2023 206e 6f73 6563 0a20  call(  # nosec. 
+0001f950: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0001f960: 2273 7368 222c 2022 2d69 222c 2066 227b  "ssh", "-i", f"{
+0001f970: 7072 6976 6174 655f 6b65 795f 7061 7468  private_key_path
+0001f980: 7d22 2c20 6622 7b75 7365 726e 616d 657d  }", f"{username}
+0001f990: 407b 686f 7374 5f69 707d 222c 2063 6d64  @{host_ip}", cmd
+0001f9a0: 5d0a 2020 2020 2020 2020 2020 2020 290a  ].            ).
+0001f9b0: 2020 2020 2020 2020 656c 6966 2061 7574          elif aut
+0001f9c0: 685f 7479 7065 203d 3d20 2270 6173 7377  h_type == "passw
+0001f9d0: 6f72 6422 3a0a 2020 2020 2020 2020 2020  ord":.          
+0001f9e0: 2020 7375 6270 726f 6365 7373 2e63 616c    subprocess.cal
+0001f9f0: 6c28 5b22 7373 6822 2c20 6622 7b75 7365  l(["ssh", f"{use
+0001fa00: 726e 616d 657d 407b 686f 7374 5f69 707d  rname}@{host_ip}
+0001fa10: 222c 2063 6d64 5d29 2020 2320 6e6f 7365  ", cmd])  # nose
+0001fa20: 630a 2020 2020 6578 6365 7074 2045 7863  c.    except Exc
+0001fa30: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0001fa40: 2020 2020 2072 6169 7365 2065 0a0a 0a40       raise e...@
+0001fa50: 636c 6963 6b2e 636f 6d6d 616e 6428 0a20  click.command(. 
+0001fa60: 2020 2068 656c 703d 2253 5348 2069 6e74     help="SSH int
+0001fa70: 6f20 7468 6520 4950 2061 6464 7265 7373  o the IP address
+0001fa80: 206f 7220 6120 7265 736f 7572 6365 2067   or a resource g
+0001fa90: 726f 7570 222c 0a20 2020 2063 6f6e 7465  roup",.    conte
+0001faa0: 7874 5f73 6574 7469 6e67 733d 7b22 7368  xt_settings={"sh
+0001fab0: 6f77 5f64 6566 6175 6c74 223a 2054 7275  ow_default": Tru
+0001fac0: 657d 2c0a 290a 4063 6c69 636b 2e61 7267  e},.).@click.arg
+0001fad0: 756d 656e 7428 2269 705f 6164 6472 6573  ument("ip_addres
+0001fae0: 7322 2c20 7479 7065 3d73 7472 290a 4063  s", type=str).@c
+0001faf0: 6c69 636b 2e6f 7074 696f 6e28 0a20 2020  lick.option(.   
+0001fb00: 2022 2d2d 636d 6422 2c0a 2020 2020 7479   "--cmd",.    ty
+0001fb10: 7065 3d73 7472 2c0a 2020 2020 7265 7175  pe=str,.    requ
+0001fb20: 6972 6564 3d46 616c 7365 2c0a 2020 2020  ired=False,.    
+0001fb30: 6465 6661 756c 743d 2222 2c0a 2020 2020  default="",.    
+0001fb40: 6865 6c70 3d22 4f70 7469 6f6e 616c 3a20  help="Optional: 
+0001fb50: 636f 6d6d 616e 6420 746f 2065 7865 6375  command to execu
+0001fb60: 7465 206f 6e20 7468 6520 7265 6d6f 7465  te on the remote
+0001fb70: 206d 6163 6869 6e65 2e22 2c0a 290a 6465   machine.",.).de
+0001fb80: 6620 7373 6828 6970 5f61 6464 7265 7373  f ssh(ip_address
+0001fb90: 3a20 7374 722c 2063 6d64 3a20 7374 7229  : str, cmd: str)
+0001fba0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 6b77   -> None:.    kw
+0001fbb0: 6172 6773 3a20 5479 7065 4469 6374 203d  args: TypeDict =
+0001fbc0: 207b 7d0a 2020 2020 6b65 795f 7061 7468   {}.    key_path
+0001fbd0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0001fbe0: 3d20 4e6f 6e65 0a0a 2020 2020 6966 2063  = None..    if c
+0001fbf0: 6865 636b 5f69 705f 666f 725f 7373 6828  heck_ip_for_ssh(
+0001fc00: 6970 5f61 6464 7265 7373 2c20 7469 6d65  ip_address, time
+0001fc10: 6f75 743d 3130 2c20 7369 6c65 6e74 3d46  out=10, silent=F
+0001fc20: 616c 7365 293a 0a20 2020 2020 2020 2075  alse):.        u
+0001fc30: 7365 726e 616d 6520 3d20 6173 6b28 0a20  sername = ask(. 
+0001fc40: 2020 2020 2020 2020 2020 2071 7565 7374             quest
+0001fc50: 696f 6e3d 5175 6573 7469 6f6e 280a 2020  ion=Question(.  
+0001fc60: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0001fc70: 725f 6e61 6d65 3d22 617a 7572 655f 7573  r_name="azure_us
+0001fc80: 6572 6e61 6d65 222c 0a20 2020 2020 2020  ername",.       
+0001fc90: 2020 2020 2020 2020 2071 7565 7374 696f           questio
+0001fca0: 6e3d 2257 6861 7420 6973 2074 6865 2075  n="What is the u
+0001fcb0: 7365 726e 616d 6520 666f 7220 7468 6520  sername for the 
+0001fcc0: 564d 3f22 2c0a 2020 2020 2020 2020 2020  VM?",.          
+0001fcd0: 2020 2020 2020 6465 6661 756c 743d 6172        default=ar
+0001fce0: 675f 6361 6368 655b 2261 7a75 7265 5f75  g_cache["azure_u
+0001fcf0: 7365 726e 616d 6522 5d2c 0a20 2020 2020  sername"],.     
+0001fd00: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
+0001fd10: 2273 7472 696e 6722 2c0a 2020 2020 2020  "string",.      
+0001fd20: 2020 2020 2020 2020 2020 6361 6368 653d            cache=
+0001fd30: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0001fd40: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0001fd50: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
+0001fd60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001fd70: 2020 6175 7468 5f74 7970 6520 3d20 6173    auth_type = as
+0001fd80: 6b28 0a20 2020 2020 2020 2020 2020 2071  k(.            q
+0001fd90: 7565 7374 696f 6e3d 5175 6573 7469 6f6e  uestion=Question
+0001fda0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001fdb0: 2020 7661 725f 6e61 6d65 3d22 6175 7468    var_name="auth
+0001fdc0: 5f74 7970 6522 2c0a 2020 2020 2020 2020  _type",.        
+0001fdd0: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
+0001fde0: 3d22 446f 2079 6f75 2077 616e 7420 746f  ="Do you want to
+0001fdf0: 206c 6f67 696e 2077 6974 6820 6120 6b65   login with a ke
+0001fe00: 7920 6f72 2070 6173 7377 6f72 6422 2c0a  y or password",.
+0001fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe20: 6465 6661 756c 743d 6172 675f 6361 6368  default=arg_cach
+0001fe30: 655b 2261 7574 685f 7479 7065 225d 2c0a  e["auth_type"],.
+0001fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe50: 6b69 6e64 3d22 6f70 7469 6f6e 222c 0a20  kind="option",. 
+0001fe60: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001fe70: 7074 696f 6e73 3d5b 226b 6579 222c 2022  ptions=["key", "
+0001fe80: 7061 7373 776f 7264 225d 2c0a 2020 2020  password"],.    
+0001fe90: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+0001fea0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0001feb0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0001fec0: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
+0001fed0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0001fee0: 2020 2020 2069 6620 6175 7468 5f74 7970       if auth_typ
+0001fef0: 6520 3d3d 2022 6b65 7922 3a0a 2020 2020  e == "key":.    
+0001ff00: 2020 2020 2020 2020 6b65 795f 7061 7468          key_path
+0001ff10: 203d 2061 736b 280a 2020 2020 2020 2020   = ask(.        
+0001ff20: 2020 2020 2020 2020 7175 6573 7469 6f6e          question
+0001ff30: 3d51 7565 7374 696f 6e28 0a20 2020 2020  =Question(.     
+0001ff40: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001ff50: 6172 5f6e 616d 653d 2261 7a75 7265 5f6b  ar_name="azure_k
+0001ff60: 6579 5f70 6174 6822 2c0a 2020 2020 2020  ey_path",.      
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0001ff80: 6573 7469 6f6e 3d22 4162 736f 6c75 7465  estion="Absolute
+0001ff90: 2070 6174 6820 746f 2074 6865 2070 7269   path to the pri
+0001ffa0: 7661 7465 206b 6579 206f 6620 7468 6520  vate key of the 
+0001ffb0: 564d 3f22 2c0a 2020 2020 2020 2020 2020  VM?",.          
+0001ffc0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+0001ffd0: 743d 6172 675f 6361 6368 655b 2261 7a75  t=arg_cache["azu
+0001ffe0: 7265 5f6b 6579 5f70 6174 6822 5d2c 0a20  re_key_path"],. 
+0001fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020000: 2020 206b 696e 643d 2273 7472 696e 6722     kind="string"
+00020010: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020020: 2020 2020 2020 6361 6368 653d 5472 7565        cache=True
+00020030: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020040: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00020050: 2020 2020 206b 7761 7267 733d 6b77 6172       kwargs=kwar
+00020060: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+00020070: 290a 0a20 2020 2020 2020 2023 2053 5348  )..        # SSH
+00020080: 2069 6e74 6f20 7468 6520 7265 6d6f 7465   into the remote
+00020090: 2061 6e64 2065 7865 6375 7465 2074 6865   and execute the
+000200a0: 2063 6f6d 6d61 6e64 0a20 2020 2020 2020   command.       
+000200b0: 2073 7368 5f69 6e74 6f5f 7265 6d6f 7465   ssh_into_remote
+000200c0: 5f6d 6163 6869 6e65 280a 2020 2020 2020  _machine(.      
+000200d0: 2020 2020 2020 686f 7374 5f69 703d 6970        host_ip=ip
+000200e0: 5f61 6464 7265 7373 2c0a 2020 2020 2020  _address,.      
+000200f0: 2020 2020 2020 7573 6572 6e61 6d65 3d75        username=u
+00020100: 7365 726e 616d 652c 0a20 2020 2020 2020  sername,.       
+00020110: 2020 2020 2061 7574 685f 7479 7065 3d61       auth_type=a
+00020120: 7574 685f 7479 7065 2c0a 2020 2020 2020  uth_type,.      
+00020130: 2020 2020 2020 7072 6976 6174 655f 6b65        private_ke
+00020140: 795f 7061 7468 3d6b 6579 5f70 6174 682c  y_path=key_path,
+00020150: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00020160: 3d63 6d64 2c0a 2020 2020 2020 2020 290a  =cmd,.        ).
+00020170: 0a0a 636c 692e 6164 645f 636f 6d6d 616e  ..cli.add_comman
+00020180: 6428 7373 6829 0a0a 0a23 2041 6464 2068  d(ssh)...# Add h
+00020190: 6167 7269 6420 6c6f 6773 2063 6f6d 6d61  agrid logs comma
+000201a0: 6e64 2074 6f20 7468 6520 434c 490a 4063  nd to the CLI.@c
+000201b0: 6c69 636b 2e63 6f6d 6d61 6e64 280a 2020  lick.command(.  
+000201c0: 2020 6865 6c70 3d22 4765 7420 7468 6520    help="Get the 
+000201d0: 6c6f 6773 206f 6620 7468 6520 4841 4772  logs of the HAGr
+000201e0: 6964 206e 6f64 6522 2c20 636f 6e74 6578  id node", contex
+000201f0: 745f 7365 7474 696e 6773 3d7b 2273 686f  t_settings={"sho
+00020200: 775f 6465 6661 756c 7422 3a20 5472 7565  w_default": True
+00020210: 7d0a 290a 4063 6c69 636b 2e61 7267 756d  }.).@click.argum
+00020220: 656e 7428 2264 6f6d 6169 6e5f 6e61 6d65  ent("domain_name
+00020230: 222c 2074 7970 653d 7374 7229 0a64 6566  ", type=str).def
+00020240: 206c 6f67 7328 646f 6d61 696e 5f6e 616d   logs(domain_nam
+00020250: 653a 2073 7472 2920 2d3e 204e 6f6e 653a  e: str) -> None:
+00020260: 2020 2320 6e6f 7365 630a 2020 2020 636f    # nosec.    co
+00020270: 6e74 6169 6e65 725f 6964 7320 3d20 280a  ntainer_ids = (.
+00020280: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
+00020290: 7373 2e63 6865 636b 5f6f 7574 7075 7428  ss.check_output(
+000202a0: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
+000202b0: 2020 2020 2020 6622 646f 636b 6572 2070        f"docker p
+000202c0: 7320 2d71 6620 6e61 6d65 3d5e 7b64 6f6d  s -qf name=^{dom
+000202d0: 6169 6e5f 6e61 6d65 7d2d 2a22 2c20 7368  ain_name}-*", sh
+000202e0: 656c 6c3d 5472 7565 0a20 2020 2020 2020  ell=True.       
+000202f0: 2029 0a20 2020 2020 2020 202e 6465 636f   ).        .deco
+00020300: 6465 2822 7574 662d 3822 290a 2020 2020  de("utf-8").    
+00020310: 2020 2020 2e73 706c 6974 2829 0a20 2020      .split().   
+00020320: 2029 0a20 2020 2043 6f6e 7461 696e 6572   ).    Container
+00020330: 203d 206e 616d 6564 7475 706c 6528 2243   = namedtuple("C
+00020340: 6f6e 7461 696e 6572 222c 2022 6964 206e  ontainer", "id n
+00020350: 616d 6520 6c6f 6773 2229 0a20 2020 2063  ame logs").    c
+00020360: 6f6e 7461 696e 6572 5f6e 616d 6573 203d  ontainer_names =
+00020370: 205b 5d0a 2020 2020 666f 7220 636f 6e74   [].    for cont
+00020380: 6169 6e65 7220 696e 2063 6f6e 7461 696e  ainer in contain
+00020390: 6572 5f69 6473 3a0a 2020 2020 2020 2020  er_ids:.        
+000203a0: 636f 6e74 6169 6e65 725f 6e61 6d65 203d  container_name =
+000203b0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+000203c0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
+000203d0: 6f75 7470 7574 2820 2023 206e 6f73 6563  output(  # nosec
+000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000203f0: 2022 646f 636b 6572 2069 6e73 7065 6374   "docker inspect
+00020400: 202d 2d66 6f72 6d61 7420 277b 7b2e 4e61   --format '{{.Na
+00020410: 6d65 7d7d 2720 2220 2b20 636f 6e74 6169  me}}' " + contai
+00020420: 6e65 722c 2073 6865 6c6c 3d54 7275 650a  ner, shell=True.
+00020430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00020440: 2020 2020 2020 2020 2020 2e64 6563 6f64            .decod
+00020450: 6528 2275 7466 2d38 2229 0a20 2020 2020  e("utf-8").     
+00020460: 2020 2020 2020 202e 7374 7269 7028 290a         .strip().
+00020470: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
+00020480: 6c61 6365 2822 2f22 2c20 2222 290a 2020  lace("/", "").  
+00020490: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000204a0: 6c6f 675f 636f 6d6d 616e 6420 3d20 2264  log_command = "d
+000204b0: 6f63 6b65 7220 6c6f 6773 202d 6620 2220  ocker logs -f " 
+000204c0: 2b20 636f 6e74 6169 6e65 725f 6e61 6d65  + container_name
+000204d0: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
+000204e0: 6572 5f6e 616d 6573 2e61 7070 656e 6428  er_names.append(
+000204f0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
+00020500: 7461 696e 6572 2869 643d 636f 6e74 6169  tainer(id=contai
+00020510: 6e65 722c 206e 616d 653d 636f 6e74 6169  ner, name=contai
+00020520: 6e65 725f 6e61 6d65 2c20 6c6f 6773 3d6c  ner_name, logs=l
+00020530: 6f67 5f63 6f6d 6d61 6e64 290a 2020 2020  og_command).    
+00020540: 2020 2020 290a 2020 2020 2320 4765 6e65      ).    # Gene
+00020550: 7261 7465 2061 2074 6162 6c65 206f 6620  rate a table of 
+00020560: 7468 6520 636f 6e74 6169 6e65 7273 2061  the containers a
+00020570: 6e64 2074 6865 6972 206c 6f67 7320 7769  nd their logs wi
+00020580: 7468 2052 6963 680a 2020 2020 7461 626c  th Rich.    tabl
+00020590: 6520 3d20 7269 6368 2e74 6162 6c65 2e54  e = rich.table.T
+000205a0: 6162 6c65 2874 6974 6c65 3d22 436f 6e74  able(title="Cont
+000205b0: 6169 6e65 7220 4c6f 6773 2229 0a20 2020  ainer Logs").   
+000205c0: 2074 6162 6c65 2e61 6464 5f63 6f6c 756d   table.add_colum
+000205d0: 6e28 2243 6f6e 7461 696e 6572 2049 4422  n("Container ID"
+000205e0: 2c20 6a75 7374 6966 793d 2263 656e 7465  , justify="cente
+000205f0: 7222 2c20 7374 796c 653d 2263 7961 6e22  r", style="cyan"
+00020600: 2c20 6e6f 5f77 7261 703d 5472 7565 290a  , no_wrap=True).
+00020610: 2020 2020 7461 626c 652e 6164 645f 636f      table.add_co
+00020620: 6c75 6d6e 2822 436f 6e74 6169 6e65 7220  lumn("Container 
+00020630: 4e61 6d65 222c 206a 7573 7469 6679 3d22  Name", justify="
+00020640: 7269 6768 7422 2c20 7374 796c 653d 2263  right", style="c
+00020650: 7961 6e22 2c20 6e6f 5f77 7261 703d 5472  yan", no_wrap=Tr
+00020660: 7565 290a 2020 2020 7461 626c 652e 6164  ue).    table.ad
+00020670: 645f 636f 6c75 6d6e 2822 4c6f 6720 436f  d_column("Log Co
+00020680: 6d6d 616e 6422 2c20 6a75 7374 6966 793d  mmand", justify=
+00020690: 2272 6967 6874 222c 2073 7479 6c65 3d22  "right", style="
+000206a0: 6379 616e 222c 206e 6f5f 7772 6170 3d54  cyan", no_wrap=T
+000206b0: 7275 6529 0a20 2020 2066 6f72 2063 6f6e  rue).    for con
+000206c0: 7461 696e 6572 2069 6e20 636f 6e74 6169  tainer in contai
+000206d0: 6e65 725f 6e61 6d65 733a 2020 2320 7479  ner_names:  # ty
+000206e0: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
+000206f0: 2020 2074 6162 6c65 2e61 6464 5f72 6f77     table.add_row
+00020700: 2863 6f6e 7461 696e 6572 2e69 642c 2063  (container.id, c
+00020710: 6f6e 7461 696e 6572 2e6e 616d 652c 2063  ontainer.name, c
+00020720: 6f6e 7461 696e 6572 2e6c 6f67 7329 2020  ontainer.logs)  
+00020730: 2320 7479 7065 3a20 6967 6e6f 7265 0a20  # type: ignore. 
+00020740: 2020 2063 6f6e 736f 6c65 203d 2072 6963     console = ric
+00020750: 682e 636f 6e73 6f6c 652e 436f 6e73 6f6c  h.console.Consol
+00020760: 6528 290a 2020 2020 636f 6e73 6f6c 652e  e().    console.
+00020770: 7072 696e 7428 7461 626c 6529 0a20 2020  print(table).   
+00020780: 2023 2050 7269 6e74 2069 6e73 7472 7563   # Print instruc
+00020790: 7469 6f6e 7320 6f6e 2068 6f77 2074 6f20  tions on how to 
+000207a0: 7669 6577 2074 6865 206c 6f67 730a 2020  view the logs.  
+000207b0: 2020 636f 6e73 6f6c 652e 7072 696e 7428    console.print(
+000207c0: 0a20 2020 2020 2020 2072 6963 682e 7061  .        rich.pa
+000207d0: 6e65 6c2e 5061 6e65 6c28 0a20 2020 2020  nel.Panel(.     
+000207e0: 2020 2020 2020 206c 6f6e 675f 7374 7269         long_stri
+000207f0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
+00020800: 7469 746c 653d 2248 6f77 2074 6f20 7669  title="How to vi
+00020810: 6577 206c 6f67 7322 2c0a 2020 2020 2020  ew logs",.      
+00020820: 2020 2020 2020 626f 7264 6572 5f73 7479        border_sty
+00020830: 6c65 3d22 7768 6974 6522 2c0a 2020 2020  le="white",.    
+00020840: 2020 2020 2020 2020 6578 7061 6e64 3d46          expand=F
+00020850: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00020860: 2020 7061 6464 696e 673d 312c 0a20 2020    padding=1,.   
+00020870: 2020 2020 2020 2020 2068 6967 686c 6967           highlig
+00020880: 6874 3d54 7275 652c 0a20 2020 2020 2020  ht=True,.       
+00020890: 2029 0a20 2020 2029 0a0a 0a6c 6f6e 675f   ).    )...long_
+000208a0: 7374 7269 6e67 203d 2028 0a20 2020 2022  string = (.    "
+000208b0: e284 b920 5b62 6f6c 6420 6772 6565 6e5d  ... [bold green]
+000208c0: 546f 2076 6965 7720 7468 6520 6c69 7665  To view the live
+000208d0: 206c 6f67 7320 6f66 2061 2063 6f6e 7461   logs of a conta
+000208e0: 696e 6572 2c63 6f70 7920 7468 6520 6c6f  iner,copy the lo
+000208f0: 6720 636f 6d6d 616e 6420 616e 6420 7061  g command and pa
+00020900: 7374 6520 6974 2069 6e74 6f20 796f 7572  ste it into your
+00020910: 2074 6572 6d69 6e61 6c2e 5b2f 626f 6c64   terminal.[/bold
+00020920: 2067 7265 656e 5d5c 6e22 2020 2320 6e6f   green]\n"  # no
+00020930: 7161 3a20 4535 3031 0a20 2020 202b 2022  qa: E501.    + "
+00020940: 5c6e 220a 2020 2020 2b20 22e2 84b9 205b  \n".    + "... [
+00020950: 626f 6c64 2067 7265 656e 5d54 6865 206c  bold green]The l
+00020960: 6f67 7320 7769 6c6c 2062 6520 7374 7265  ogs will be stre
+00020970: 616d 6564 2074 6f20 796f 7572 2074 6572  amed to your ter
+00020980: 6d69 6e61 6c20 756e 7469 6c20 796f 7520  minal until you 
+00020990: 6578 6974 2074 6865 2063 6f6d 6d61 6e64  exit the command
+000209a0: 2e5b 2f62 6f6c 6420 6772 6565 6e5d 5c6e  .[/bold green]\n
+000209b0: 220a 2020 2020 2b20 225c 6e22 0a20 2020  ".    + "\n".   
+000209c0: 202b 2022 e284 b920 5b62 6f6c 6420 6772   + "... [bold gr
+000209d0: 6565 6e5d 546f 2065 7869 7420 7468 6520  een]To exit the 
+000209e0: 6c6f 6773 2c20 7072 6573 7320 4354 524c  logs, press CTRL
+000209f0: 2b43 2e5b 2f62 6f6c 6420 6772 6565 6e5d  +C.[/bold green]
+00020a00: 5c6e 220a 2020 2020 2b20 225c 6e22 0a20  \n".    + "\n". 
+00020a10: 2020 202b 2022 f09f 9aa8 2054 6865 205b     + ".... The [
+00020a20: 626f 6c64 2077 6869 7465 5d62 6163 6b65  bold white]backe
+00020a30: 6e64 2c62 6163 6b65 6e64 5f73 7472 6561  nd,backend_strea
+00020a40: 6d20 2620 6365 6c65 7279 5b2f 626f 6c64  m & celery[/bold
+00020a50: 2077 6869 7465 5d20 5b62 6f6c 6420 6772   white] [bold gr
+00020a60: 6565 6e5d 636f 6e74 6169 6e65 7273 2061  een]containers a
+00020a70: 7265 2074 6865 206d 6f73 7420 696d 706f  re the most impo
+00020a80: 7274 616e 7420 746f 206d 6f6e 6974 6f72  rtant to monitor
+00020a90: 2066 6f72 2064 6562 7567 6769 6e67 2e5b   for debugging.[
+00020aa0: 2f62 6f6c 6420 6772 6565 6e5d 5c6e 2220  /bold green]\n" 
+00020ab0: 2023 206e 6f71 613a 2045 3530 310a 2020   # noqa: E501.  
+00020ac0: 2020 2b20 225c 6e22 0a20 2020 202b 2022    + "\n".    + "
+00020ad0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00020ae0: 626f 6c64 2077 6869 7465 5d2d 2d2d 2d2d  bold white]-----
+00020af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2043 746f 7020  ---------- Ctop 
+00020b00: f09f a6be 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .... -----------
+00020b10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 5b2f  --------------[/
+00020b20: 626f 6c64 2077 6869 7465 5d5c 6e22 0a20  bold white]\n". 
+00020b30: 2020 202b 2022 5c6e 220a 2020 2020 2b20     + "\n".    + 
+00020b40: 22f0 9fa7 a020 546f 206c 6561 726e 2061  ".... To learn a
+00020b50: 626f 7574 2075 7369 6e67 205b 626f 6c64  bout using [bold
+00020b60: 2077 6869 7465 5d63 746f 705b 2f62 6f6c   white]ctop[/bol
+00020b70: 6420 7768 6974 655d 2074 6f20 6d6f 6e69  d white] to moni
+00020b80: 746f 7220 796f 7572 2063 6f6e 7461 696e  tor your contain
+00020b90: 6572 732c 7669 7369 7420 6874 7470 733a  ers,visit https:
+00020ba0: 2f2f 7777 772e 796f 7574 7562 652e 636f  //www.youtube.co
+00020bb0: 6d2f 7761 7463 683f 763d 424a 686c 4378  m/watch?v=BJhlCx
+00020bc0: 6572 5150 346e 205c 6e22 2020 2320 6e6f  erQP4n \n"  # no
+00020bd0: 7161 3a20 4535 3031 0a20 2020 202b 2022  qa: E501.    + "
+00020be0: 5c6e 220a 2020 2020 2b20 2220 2020 2020  \n".    + "     
+00020bf0: 2020 2020 2020 2020 2020 5b62 6f6c 6420            [bold 
+00020c00: 7768 6974 655d 2d2d 2d2d 2d2d 2d2d 2d2d  white]----------
+00020c10: 2d2d 2d2d 2d2d 2d20 486f 7720 746f 2076  ------- How to v
+00020c20: 6965 7720 7468 6973 2e20 f09f 9982 202d  iew this. .... -
+00020c30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 5b2f  --------------[/
+00020c40: 626f 6c64 2077 6869 7465 5d5c 6e22 0a20  bold white]\n". 
+00020c50: 2020 202b 2022 5c6e 220a 2020 2020 2b20     + "\n".    + 
+00020c60: 2222 22e2 84b9 205b 626f 6c64 2067 7265  """... [bold gre
+00020c70: 656e 5d54 6f20 7669 6577 2074 6869 7320  en]To view this 
+00020c80: 7061 6e65 6c20 6167 6169 6e2c 2072 756e  panel again, run
+00020c90: 2074 6865 2063 6f6d 6d61 6e64 205b 626f   the command [bo
+00020ca0: 6c64 2077 6869 7465 5d68 6167 7269 6420  ld white]hagrid 
+00020cb0: 6c6f 6773 207b 7b4e 4f44 455f 4e41 4d45  logs {{NODE_NAME
+00020cc0: 7d7d 5b2f 626f 6c64 2077 6869 7465 5d20  }}[/bold white] 
+00020cd0: 5b2f 626f 6c64 2067 7265 656e 5d5c 6e22  [/bold green]\n"
+00020ce0: 2222 2020 2320 6e6f 7161 3a20 4535 3031  ""  # noqa: E501
+00020cf0: 0a20 2020 202b 2022 5c6e 220a 2020 2020  .    + "\n".    
+00020d00: 2b20 2222 22f0 9f9a a820 4e4f 4445 5f4e  + """.... NODE_N
+00020d10: 414d 4520 6162 6f76 6520 6973 2074 6865  AME above is the
+00020d20: 206e 616d 6520 6f66 2079 6f75 7220 4861   name of your Ha
+00020d30: 6772 6964 2064 6570 6c6f 796d 656e 742c  grid deployment,
+00020d40: 7769 7468 6f75 7420 7468 6520 6375 726c  without the curl
+00020d50: 7920 6272 6163 6573 2e20 452e 6720 6861  y braces. E.g ha
+00020d60: 6772 6964 206c 6f67 7320 6361 6e61 6461  grid logs canada
+00020d70: 205b 626f 6c64 2067 7265 656e 5d5c 6e22   [bold green]\n"
+00020d80: 2222 2020 2320 6e6f 7161 3a20 4535 3031  ""  # noqa: E501
+00020d90: 0a20 2020 202b 2022 5c6e 220a 2020 2020  .    + "\n".    
+00020da0: 2b20 2220 2020 2020 2020 2020 2020 2020  + "             
+00020db0: 2020 5b62 6f6c 6420 6772 6565 6e5d 4841    [bold green]HA
+00020dc0: 5050 5920 4445 4255 4747 494e 4721 20f0  PPY DEBUGGING! .
+00020dd0: 9f90 9bf0 9f90 9ef0 9fa6 97f0 9fa6 9ff0  ................
+00020de0: 9fa6 a0f0 9fa6 a0f0 9fa6 a05b 2f62 6f6c  ...........[/bol
+00020df0: 6420 6772 6565 6e5d 5c6e 2020 2020 2020  d green]\n      
+00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e10: 220a 290a 0a63 6c69 2e61 6464 5f63 6f6d  ".)..cli.add_com
+00020e20: 6d61 6e64 286c 6f67 7329 0a              mand(logs).
```

### Comparing `hagrid-0.2.99/hagrid/deps.py` & `hagrid-0.3.1/hagrid/deps.py`

 * *Files 16% similar despite different names*

```diff
@@ -7,14 +7,15 @@
 # future
 from __future__ import annotations
 
 # stdlib
 from dataclasses import dataclass
 from dataclasses import field
 from datetime import datetime
+import getpass
 import json
 import os
 import platform
 import re
 import shutil
 import subprocess  # nosec
 import sys
@@ -27,28 +28,30 @@
 from typing import Tuple
 from typing import Union
 
 # third party
 from packaging import version
 from packaging.version import Version
 import requests
+from rich.console import Console
 
 # relative
 from .exceptions import MissingDependency
+from .lib import is_gitpod
 from .mode import EDITABLE_MODE
 from .nb_output import NBOutput
 from .version import __version__
 
-LATEST_STABLE_SYFT = "0.6"
+LATEST_STABLE_SYFT = "0.7"
 
 DOCKER_ERROR = """
 You are running an old version of docker, possibly on Linux. You need to install v2.
 At the time of writing this, if you are on linux you need to run the following:
 
-DOCKER_COMPOSE_VERSION=v2.7.0
+DOCKER_COMPOSE_VERSION=v2.16.0
 curl -sSL https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-linux-x86_64 \
      -o ~/.docker/cli-plugins/docker-compose
 chmod +x ~/.docker/cli-plugins/docker-compose
 
 ALERT: you may need to run the following command to make sure you can run without sudo.
 
 echo $USER              //(should return your username)
@@ -61,14 +64,27 @@
 docker compose version
 """
 
 SYFT_MINIMUM_PYTHON_VERSION = (3, 7)
 SYFT_MINIMUM_PYTHON_VERSION_STRING = "3.7"
 SYFT_MAXIMUM_PYTHON_VERSION = (3, 10, 999)
 SYFT_MAXIMUM_PYTHON_VERSION_STRING = "3.10"
+WHITE = "\033[0;37m"
+GREEN = "\033[0;32m"
+YELLOW = "\033[0;33m"
+BOLD = "\033[1m"
+NO_COLOR = "\033[0;0m"
+WARNING_MSG = f"\033[0;33mWARNING:{NO_COLOR}"
+
+
+def get_version_string() -> str:
+    version = str(__version__)
+    if EDITABLE_MODE:
+        version += "-dev"
+    return version
 
 
 @dataclass
 class SetupIssue:
     issue_name: str
     description: str
     command: Optional[str] = None
@@ -77,15 +93,15 @@
 
 @dataclass
 class Dependency:
     of: str = ""
     name: str = ""
     display: str = ""
     only_os: str = ""
-    version: Optional[Version] = None
+    version: Optional[Version] = version.parse("0.0")
     valid: bool = False
     issues: List[SetupIssue] = field(default_factory=list)
     output_in_text: bool = False
 
     def check(self) -> None:
         pass
 
@@ -93,15 +109,16 @@
 @dataclass
 class DependencySyftOS(Dependency):
     of: str = "syft"
 
     def check(self) -> None:
         self.display = " " + ENVIRONMENT["os"]
         if is_windows():
-            self.issues.append(windows_jaxlib())
+            if not get_pip_package("jaxlib"):
+                self.issues.append(windows_jaxlib())
         elif is_apple_silicon():
             pass
 
 
 @dataclass
 class DependencySyftPython(Dependency):
     of: str = "syft"
@@ -160,31 +177,34 @@
 class DependencyGridDockerCompose(Dependency):
     of: str = "grid"
 
     def check(self) -> None:
         binary_info = BinaryInfo(
             binary="docker", version_cmd="docker compose version"
         ).get_binary_info()
-        if binary_info.path and binary_info.version > version.parse(
-            MINIMUM_DOCKER_COMPOSE_VERSION
+
+        if (
+            binary_info.path
+            and binary_info.version
+            and binary_info.version > version.parse(MINIMUM_DOCKER_COMPOSE_VERSION)
         ):
             self.display = " Docker Compose " + str(binary_info.version)
         else:
             self.issues.append(docker_compose_install())
             self.display = " Docker Compose v2 not installed"
 
 
 @dataclass
 class DependencyPyPI(Dependency):
     of: str = "none"
     package_name: str = ""
     package_display_name: str = ""
     pre: bool = False
-    install_issue: Callable = lambda: None
-    update_available_issue: Callable = lambda: None
+    install_issue: Callable = lambda: None  # noqa: E731
+    update_available_issue: Callable = lambda: None  # noqa: E731
 
     def check(self) -> None:
         package_dict = get_pip_package(self.package_name)
 
         if package_dict is None:
             self.display = " " + f"{self.package_display_name} not installed"
             self.issues.append(self.install_issue(pre=self.pre))
@@ -249,15 +269,15 @@
         else:
             return (False, latest_release)
 
 
 def get_pypi_versions(package_name: str) -> Dict[str, Any]:
     try:
         pypi_url = f"https://pypi.org/pypi/{package_name}/json"
-        req = requests.get(pypi_url)
+        req = requests.get(pypi_url)  # nosec
         # TODO: Fix JSON parsing of version keys
         # this is broken on my machine for some reason, the version keys are wrong
         pypi_info = json.loads(req.text)
         # print(pypi_info["releases"].keys())
         return pypi_info
 
     except Exception as e:
@@ -289,15 +309,15 @@
 
 @dataclass
 class BinaryInfo:
     binary: str
     version_cmd: str
     error: Optional[str] = None
     path: Optional[str] = None
-    version: Optional[Union[str, Version]] = None
+    version: Optional[Union[str, Version]] = version.parse("0.0")
     version_regex = (
         r"[^\d]*("
         + r"(0|[1-9][0-9]*)\.*(0|[1-9][0-9]*)\.*(0|[1-9][0-9]*)"
         + r"(-((0|[1-9][0-9]*|[0-9]*[a-zA-Z-][0-9a-zA-Z-]*)"
         + r"(\.(0|[1-9][0-9]*|[0-9]*[a-zA-Z-][0-9a-zA-Z-]*))*))?"
         + r"(\+([0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*))?)"
         + r"[^\d].*"
@@ -320,29 +340,36 @@
     def get_binary_info(self) -> BinaryInfo:
         self.path = get_location(self.binary)
         if self.path:
             returncode, lines = get_cli_output(self.version_cmd)
             if returncode == 0:
                 self.extract_version(lines=lines)
             else:
-                self.error = lines[0]
+                if len(lines) > 0:
+                    self.error = lines[0]
+                else:
+                    self.error = f"Error, no output from {self.binary}"
         return self
 
 
-def get_cli_output(cmd: str) -> Tuple[int, List[str]]:
+def get_cli_output(cmd: str, timeout: Optional[float] = None) -> Tuple[int, List[str]]:
     try:
         proc = subprocess.Popen(  # nosec
             cmd.split(" "),
             stdout=subprocess.PIPE,
             stderr=subprocess.PIPE,
         )
         lines = []
         if proc.stdout and hasattr(proc.stdout, "readlines"):
             lines = [line.decode("utf-8") for line in proc.stdout.readlines()]
-        proc.communicate()
+
+        if proc.stderr and hasattr(proc.stderr, "readlines"):
+            lines.extend([line.decode("utf-8") for line in proc.stderr.readlines()])
+
+        proc.communicate(timeout=timeout)
         return (int(proc.returncode), lines)
     except Exception as e:
         return (-1, [str(e)])
 
 
 def gather_debug() -> Dict[str, Any]:
     # relative
@@ -352,15 +379,15 @@
     now = datetime.now().astimezone()
     dt_string = now.strftime("%d/%m/%Y %H:%M:%S %Z")
     debug_info: Dict[str, Any] = {}
     debug_info["datetime"] = dt_string
     debug_info["python_binary"] = sys.executable
     debug_info["dependencies"] = DEPENDENCIES
     debug_info["environment"] = ENVIRONMENT
-    debug_info["hagrid"] = __version__
+    debug_info["hagrid"] = get_version_string()
     debug_info["hagrid_dev"] = EDITABLE_MODE
     debug_info["hagrid_path"] = hagrid_root()
     debug_info["hagrid_repo_sha"] = commit_hash()
     debug_info["docker"] = docker_info()
     if is_windows():
         debug_info["wsl"] = wsl_info()
         debug_info["wsl_linux"] = wsl_linux_info()
@@ -405,15 +432,15 @@
 
 def is_windows() -> bool:
     if "platform" in ENVIRONMENT and ENVIRONMENT["platform"].lower() == "windows":
         return True
     return False
 
 
-allowed_hosts = ["docker", "vm", "azure", "aws", "gcp"]
+allowed_hosts = ["docker", "azure", "aws", "gcp"]
 commands = ["docker", "git", "ansible-playbook"]
 
 if is_windows():
     commands.append("wsl")
 
 
 def check_deps_old() -> Dict[str, Optional[str]]:
@@ -471,14 +498,107 @@
         )
         if "'compose' is not a docker command" in out.stderr:
             raise MissingDependency(DOCKER_ERROR)
 
     return version
 
 
+def docker_running(timeout: Optional[float] = None) -> Tuple[bool, str]:
+    status, error_msg = False, ""
+
+    try:
+        cmd = "docker info"
+        returncode, msg = get_cli_output(cmd, timeout=timeout)
+        if returncode == 0:
+            status, error_msg = True, " Docker service is running"
+        else:
+            error_msg = f""" Docker service is either not installed or running.\n\n
+To install docker, execute the following steps:\n
+1 - Install docker on your machine by using the proper steps according to your OS.\n
+{WHITE}MacOS: {GREEN}brew install --cask docker
+{WHITE}Linux: {GREEN}curl -fsSL https://get.docker.com -o get-docker.sh && chmod +777 get-docker.sh && ./get-docker.sh
+{WHITE}Windows: {GREEN}choco install docker-desktop -y{NO_COLOR} \n
+2 - Run \'{GREEN}sudo usermod -a -G docker $USER\'{WHITE} to enable this user to execute docker.
+3 - log out and log back in so that your group membership is re-evaluated {NO_COLOR}.
+-------------------------------------------------------------------------------------------------------\n
+To start your docker service:\n
+1 - {WHITE}MacOS/Windows: One can start docker by clicking on the "Docker" icon in your Applications folder.{NO_COLOR}
+2 - {WHITE}Ubuntu: {GREEN}sudo service docker start {NO_COLOR}
+-------------------------------------------------------------------------------------------------------\n
+"""
+        error_msg += f"""{YELLOW}{BOLD}Std Output Logs{NO_COLOR}
+=================\n\n""" + "\n".join(
+            msg
+        )
+
+    except Exception as e:  # nosec
+        error_msg = str(e)
+
+    return status, error_msg
+
+
+def allowed_to_run_docker() -> Tuple[bool, str]:
+    bool_result, msg = True, ""
+    if platform.system().lower() == "linux":
+        _, line = get_cli_output("getent group docker")
+
+        # get user
+        user = getpass.getuser()
+
+        # Check if current user is root.
+        if os.geteuid() == 0:
+            bool_result = True
+
+        # Check if current user is member of docker group.
+        elif not is_gitpod() and user not in "".join(line):
+            msg = f"""  User is not a member of docker group.
+{WHITE}You're currently not allowed to run docker, perform the following steps:\n
+    1 - Run \'{GREEN}sudo usermod -a -G docker $USER\'{WHITE} to add docker permissions.
+    2 - log out and log back in so that your group membership is re-evaluated {NO_COLOR}."""
+            # NOTE: For some reason, inside of CI pipeline the user (runner) isn't a member of
+            # docker group and doesn't have sudo priviledges, but can execute docker without
+            # permission issues. This is just a workaround to avoid raising an exeception
+            # in this scenario without reason.
+            if user == "runner":
+                bool_result = True
+            else:
+                bool_result = False
+
+    return bool_result, msg
+
+
+def check_docker_service_status(animated: bool = True) -> None:
+    """Check the status of the docker service.
+
+    Raises:
+        MissingDependency: If docker service is not running.
+    """
+
+    if not animated:
+        docker_installed, msg = docker_running(timeout=60)
+        user_allowed, permission_msg = allowed_to_run_docker()
+    else:
+        console = Console()
+        # putting \t at the end seems to prevent weird chars getting outputted
+        # during animations in the juypter notebook
+        with console.status("[bold blue]Checking for Docker Service[/bold blue]\t"):
+            docker_installed, msg = docker_running(timeout=60)
+            user_allowed, permission_msg = allowed_to_run_docker()
+
+    # Check if user is allowed to execute docker
+    if not user_allowed:
+        raise MissingDependency(permission_msg)
+
+    # If docker bin was not found.
+    if not docker_installed:
+        raise MissingDependency(msg)
+
+    print(" Docker service is running")
+
+
 def check_deps(
     deps: Dict[str, Dependency],
     of: str = "",
     display: bool = True,
     output_in_text: bool = False,
 ) -> Union[Dict[str, Dependency], NBOutput]:
     output = ""
@@ -513,28 +633,33 @@
                 output += f"\nIssue: {issue.description}\n"
                 if issue.solution != "":
                     output += f"\nSolution:\n{issue.solution}\n"
                 if issue.command != "":
                     output += "\nCommand:\n" + f"{issue.command} "
                 output += "\n"
 
-        print(output)
+        if len(output) > 0:
+            print(output)
         return None  # type: ignore
 
 
-def check_grid_docker(display: bool = True) -> Union[Dict[str, Dependency], NBOutput]:
+def check_grid_docker(
+    display: bool = True, output_in_text: bool = False
+) -> Union[Dict[str, Dependency], NBOutput]:
     try:
         deps: Dict[str, Dependency] = {}
         deps["git"] = DependencyGridGit(name="git")
         deps["docker"] = DependencyGridDocker(name="docker")
         deps["docker_compose"] = DependencyGridDockerCompose(name="docker compose")
-        return check_deps(of="Grid", deps=deps, display=display)
+        return check_deps(
+            of="Grid", deps=deps, display=display, output_in_text=output_in_text
+        )
     except Exception as e:
         try:
-            if display:
+            if display and not output_in_text:
                 return NBOutput(debug_exception(e=e)).to_html()
         except Exception:  # nosec
             pass
 
         print(e)
         raise e
 
@@ -630,23 +755,23 @@
         "windows": 'choco install git.install --params "/GitAndUnixToolsOnPath /WindowsTerminal /NoAutoCrlf" -y',
         "linux": "sudo apt update && sudo apt install git",
         "backup_url": "https://git-scm.com/downloads",
     },
     "docker": {
         "macos": "brew install --cask docker",
         "windows": "choco install docker-desktop -y",
-        "linux": "curl -fsSL https://get.docker.com -o get-docker.sh",
+        "linux": "curl -fsSL https://get.docker.com -o get-docker.sh && chmod +777 get-docker.sh && ./get-docker.sh",
         "backup_url": "https://www.docker.com/products/docker-desktop/",
     },
     "docker_compose": {
         "macos": "brew install --cask docker",
         "windows": "choco install docker-desktop -y",
         "linux": (
             "mkdir -p ~/.docker/cli-plugins\n"
-            + "DOCKER_COMPOSE_VERSION=v2.7.0\n"
+            + "DOCKER_COMPOSE_VERSION=v2.16.0\n"
             + "curl -sSL https://github.com/docker/compose/releases/download/"
             + "${DOCKER_COMPOSE_VERSION}/docker-compose-linux-x86_64 "
             + "-o ~/.docker/cli-plugins/docker-compose\n"
             + "chmod +x ~/.docker/cli-plugins/docker-compose"
         ),
         "backup_url": "https://github.com/docker/compose",
     },
@@ -737,15 +862,15 @@
         description="You do not have Git installed.",
         command=command,
         solution=solution,
     )
 
 
 def syft_install(pre: bool = False) -> SetupIssue:
-    command = "pip install -U syft --pre"
+    command = "pip install -U syft"
     if pre:
         # command += " --pre"
         pass
     return SetupIssue(
         issue_name="syft_install",
         description="You have not installed Syft.",
         command=command,
@@ -794,10 +919,10 @@
 WINDOWS_JAXLIB_REPO = "https://whls.blob.core.windows.net/unstable/index.html"
 
 
 def windows_jaxlib() -> SetupIssue:
     return SetupIssue(
         issue_name="windows_jaxlib",
         description="Windows Python Wheels for Jax are not available on PyPI yet",
-        command=f"pip install jaxlib==0.3.7 -f {WINDOWS_JAXLIB_REPO}",
+        command=f"pip install jaxlib==0.3.14 -f {WINDOWS_JAXLIB_REPO}",
         solution="Windows users must install jaxlib before syft",
     )
```

### Comparing `hagrid-0.2.99/hagrid/grammar.py` & `hagrid-0.3.1/hagrid/grammar.py`

 * *Files 3% similar despite different names*

```diff
@@ -8,29 +8,34 @@
 from typing import Dict as TypeDict
 from typing import List as TypeList
 from typing import Optional
 from typing import Tuple as TypeTuple
 from typing import Union
 
 # relative
+from .deps import allowed_hosts
 from .lib import find_available_port
 
+ALLOWED_NODE_TYPES = ["domain", "network", "enclave"]
+
 
 class BadGrammar(Exception):
     pass
 
 
 class GrammarVerb:
     def __init__(
         self,
         command: str,
         full_sentence: TypeList[TypeDict[str, Any]],
         abbreviations: TypeDict[int, TypeList[Optional[str]]],
     ) -> None:
-        self.grammar: TypeList[Union[GrammarTerm, HostGrammarTerm]] = []
+        self.grammar: TypeList[
+            Union[GrammarTerm, HostGrammarTerm, SourceGrammarTerm]
+        ] = []
         self.command = command
         self.full_sentence = full_sentence
         self.abbreviations = abbreviations
 
     def get_named_term_grammar(self, name: str) -> GrammarTerm:
         for term in self.grammar:
             if term.name == name and isinstance(term, GrammarTerm):
@@ -64,28 +69,28 @@
             if not found:
                 new_grammar.append(term)
             else:
                 new_grammar.append(new_term)
         self.grammar = new_grammar
 
     def load_grammar(
-        self, grammar: TypeList[Union[GrammarTerm, HostGrammarTerm]]
+        self, grammar: TypeList[Union[GrammarTerm, HostGrammarTerm, SourceGrammarTerm]]
     ) -> None:
         self.grammar = grammar
 
 
 class GrammarTerm:
     def __init__(
         self,
         type: str,
         name: str,
         default: Optional[Union[str, Callable]] = None,
         options: Optional[TypeList] = None,
         example: Optional[str] = None,
-        **kwargs: TypeDict[str, Any],
+        **kwargs: Any,
     ) -> None:
         self.raw_input: Optional[str] = None
         self.input: Optional[str] = None
         self.type = type
         self.name = name
         self.default = default
         self.options = options if options is not None else []
@@ -225,15 +230,15 @@
 
         if port is None:
             if host == "docker":
                 port = "8081+"  # default
             else:
                 port = "80"  # default
 
-        if host not in ["docker", "vm", "aws", "azure", "gcp"]:
+        if host not in allowed_hosts:
             _ = self.validate_host(host_or_ip=host)
 
         _ = self.validate_port(port=port)
 
         return f"{host}:{port}"
 
 
@@ -287,52 +292,43 @@
     hagrid launch United Nations -> hagrid launch "United Nations" domain
     hagrid launch United Nations domain -> hagrid launch "United Nations" domain
     hagrid launch on docker -> hagrid launch domain on docker
 
     """
 
     # Some mild analysis
-    found_domain_or_network = False
+    found_node_type = False
     preposition_position = 10000
     for i, arg in enumerate(args):
-        if "domain" in arg:
-            found_domain_or_network = True
-        elif "network" in arg:
-            found_domain_or_network = True
+        if arg in ALLOWED_NODE_TYPES:
+            found_node_type = True
 
         if arg.strip() in ["to", "from"]:
             if i < preposition_position:
                 preposition_position = i
 
     _args = list(args)
 
     # Default to domain if it's not provided
-    if not found_domain_or_network:
+    if not found_node_type:
         if preposition_position != 10000:
             _args.insert(preposition_position, "domain")
             preposition_position += 1
         else:
             _args = _args + ["domain"]
 
     # if there are no prepositions and the domain/network is the last word
-    if preposition_position == 10000 and _args[-1] in ["domain", "network"]:
-        name = ""
-        for arg in _args[:-1]:
-            name += arg + " "
-        name = name[:-1]
-        _args = [name] + _args[-1:]
+    if preposition_position == 10000 and _args[-1] in ALLOWED_NODE_TYPES:
+        _args = [" ".join(_args[:-1])] + _args[-1:]
 
     # if there are prepositions then combine the words in the name if there are multiple
     elif preposition_position != 10000:
-        name = ""
-        for i in range(preposition_position - 1):
-            name += _args[i] + " "
-        name = name[:-1]
-        pmin1 = preposition_position - 1
-        _args = [name] + _args[pmin1:]
+        _args = [" ".join(_args[: preposition_position - 1])] + _args[
+            preposition_position - 1 :
+        ]
 
     # if there wasn't a name provided - make sure we don't have an empty place in the list
     # so that later logic will generate a name
     if _args[0] == "":
         _args = _args[1:]
 
     args = tuple(_args)
@@ -348,15 +344,14 @@
     arg_list = list(args)
     arg_count = len(arg_list)
     errors = []
     if validate_arg_count(arg_count=arg_count, verb=verb):
         terms = []
         abbreviation = verb.abbreviations[arg_count]
         for i, term_type in enumerate(abbreviation):
-
             if term_type is None:
                 arg = None  # use None so we get the default
             else:
                 arg = arg_list.pop(0)  # use a real arg
 
             term_settings = verb.full_sentence[i]
```

### Comparing `hagrid-0.2.99/hagrid/land.py` & `hagrid-0.3.1/hagrid/land.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/launch.py` & `hagrid-0.3.1/hagrid/launch.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,36 +1,37 @@
 # stdlib
 from typing import Dict as TypeDict
 from typing import List as TypeList
 from typing import Optional
 
 # relative
 from .cache import DEFAULT_BRANCH
+from .grammar import ALLOWED_NODE_TYPES
 from .grammar import GrammarTerm
 from .grammar import GrammarVerb
 from .grammar import HostGrammarTerm
 from .grammar import SourceGrammarTerm
 from .names import random_name
 
 
 def get_launch_verb() -> GrammarVerb:
     full_sentence = [
         {
             "name": "node_name",
-            "type": "adjective",
+            "type": "propernoun",
             "klass": GrammarTerm,
             "default": random_name,
             "example": "'my_domain'",
         },
         {
             "name": "node_type",
             "type": "object",
             "klass": GrammarTerm,
             "default": "domain",
-            "options": ["domain", "network"],
+            "options": ALLOWED_NODE_TYPES,
         },
         {
             "name": "preposition",
             "type": "preposition",
             "klass": GrammarTerm,
             "default": "to",
             "options": ["to"],
@@ -55,15 +56,15 @@
             "klass": SourceGrammarTerm,
             "default": f"github.com/OpenMined/PySyft/tree/{DEFAULT_BRANCH}",
         },
     ]
 
     abbreviations: TypeDict[int, TypeList[Optional[str]]] = {
         6: [
-            "adjective",  # name
+            "propernoun",  # name
             "object",  # node_type
             "preposition",  # to
             "propernoun",  # host
             "preposition",  # from
             "propernoun",  # source
         ],
         5: [
@@ -71,15 +72,15 @@
             "object",  # node_type
             "preposition",  # to
             "propernoun",  # host
             "preposition",  # from
             "propernoun",  # source
         ],
         4: [
-            "adjective",  # name
+            "propernoun",  # name
             "object",  # node_type
             "preposition",  # to
             "propernoun",  # host
             None,  # ignore
             None,  # ignore
         ],
         3: [
@@ -87,15 +88,15 @@
             "object",  # node_type
             "preposition",  # to
             "propernoun",  # host
             None,  # ignore
             None,  # ignore
         ],
         2: [
-            "adjective",  # name
+            "propernoun",  # name
             "object",  # node_type
             None,  # ignore
             None,  # ignore
             None,  # ignore
             None,  # ignore
         ],
         1: [
```

### Comparing `hagrid-0.2.99/hagrid/manifest_template.yml` & `hagrid-0.3.1/hagrid/manifest_template.yml`

 * *Files 13% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 manifestVersion: 0.1
-hagrid_version: 0.2.99
-syft_version: 0.7.0-beta.47
-dockerTag: 0.7.0-beta.47
+hagrid_version: 0.3.1
+syft_version: 0.8.0-beta.8
+dockerTag: 0.8.0-beta.8
 baseUrl: https://raw.githubusercontent.com/OpenMined/PySyft/
-hash: 38cc2d495c66ef7ad817305499a31559b1ca1861
+hash: 18b42582d723ff812ea9afe3d542b93ffb648c98
 target_dir: ~/.hagrid/PySyft/
 files:
   grid:
     path: packages/grid/
     common:
     - rabbitmq/rabbitmq.conf
     - redis/redis.conf
```

### Comparing `hagrid-0.2.99/hagrid/mode.py` & `hagrid-0.3.1/hagrid/mode.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/names.py` & `hagrid-0.3.1/hagrid/names.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/parse_template.py` & `hagrid-0.3.1/hagrid/parse_template.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,15 +19,14 @@
 from .lib import repo_src_path
 from .mode import EDITABLE_MODE
 
 HAGRID_TEMPLATE_PATH = str(manifest_template_path())
 
 
 def read_yml_file(filename: str) -> Optional[Dict]:
-
     template = None
 
     with open(filename) as fp:
         try:
             template = yaml.safe_load(fp)
         except yaml.YAMLError as exc:
             raise exc
@@ -57,15 +56,14 @@
     git_base_url = template["baseUrl"]
     target_dir = template["target_dir"]
     all_template_files = template["files"]
     docker_tag = template["dockerTag"]
     files_to_download = []
 
     for package_name in all_template_files:
-
         # Get all files w.r.t that package e.g. grid, syft, hagrid
         template_files = all_template_files[package_name]
         package_path = template_files["path"]
         to_absolute_file_path = lambda x: os.path.join(package_path, x)  # noqa: E731
 
         # common files
         files_to_download += list(map(to_absolute_file_path, template_files["common"]))
@@ -97,21 +95,19 @@
 
 def download_files(
     files_to_download: List[str],
     git_hash: str,
     git_base_url: str,
     target_dir: str,
 ) -> None:
-
     if EDITABLE_MODE:
         print("Skipping copying files when running in editable mode.")
         return
 
     for src_file_path in tqdm(files_to_download, desc="Copying files... "):
-
         # For now target file path is same as source file path
         trg_file_path = src_file_path
         local_destination = get_local_abs_path(target_dir, trg_file_path)
         link_to_file = git_url_for_file(src_file_path, git_base_url, git_hash)
         download_file(link_to_file=link_to_file, local_destination=local_destination)
 
 
@@ -160,15 +156,14 @@
 
     def read_template_from_path(self, filepath: str) -> Template:
         return self.environ.get_template(name=filepath)
 
     def substitute_vars(
         self, template_path: str, vars_to_substitute: dict, target_path: str
     ) -> None:
-
         template = self.read_template_from_path(template_path)
         rendered_template = template.render(vars_to_substitute)
         self.save_to(rendered_template, target_path)
 
     def save_to(self, message: str, filename: str) -> None:
         base_dir = self.directory
         filepath = os.path.abspath(os.path.join(base_dir, filename))
@@ -178,21 +173,20 @@
 
         # Save template to filepath
         with open(filepath, "w") as fp:
             fp.write(message)
 
 
 def download_file(link_to_file: str, local_destination: str) -> None:
-
     file_dir = os.path.dirname(local_destination)
     os.makedirs(file_dir, exist_ok=True)
 
     try:
         # download file
-        response = requests.get(link_to_file)
+        response = requests.get(link_to_file)  # nosec
         if response.status_code != 200:
             raise Exception(f"Failed to download: {link_to_file}")
 
         # Save file to the local destination
         open(local_destination, "wb").write(response.content)
 
     except Exception as e:
```

### Comparing `hagrid-0.2.99/hagrid/quickstart_ui.py` & `hagrid-0.3.1/hagrid/quickstart_ui.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,35 +1,38 @@
 # stdlib
 from dataclasses import dataclass
 import os
+from pathlib import Path
 import sys
 from typing import Dict
 from typing import List
 from typing import Optional
 from typing import Tuple
 from urllib.parse import urlparse
+import zipfile
 
 # third party
 import click
 import requests
+from tqdm import tqdm
 
 # relative
 from .cache import DEFAULT_BRANCH
 from .cache import DEFAULT_REPO
 from .cache import arg_cache
 from .nb_output import NBOutput
 
 directory = os.path.expanduser("~/.hagrid/quickstart/")
 
 
 def quickstart_download_notebook(
     url: str, directory: str, reset: bool = False, overwrite_all: bool = False
 ) -> Tuple[str, bool, bool]:
     os.makedirs(directory, exist_ok=True)
-    file_name = os.path.basename(url).replace("%20", "_")
+    file_name = os.path.basename(url).replace("%20", "_").replace(" ", "_")
     file_path = os.path.abspath(directory + file_name)
 
     file_exists = os.path.isfile(file_path)
     if overwrite_all:
         reset = True
 
     if file_exists and not reset:
@@ -47,15 +50,15 @@
         else:
             print(f"Skipping {file_name}")
             reset = False
 
     downloaded = False
     if not file_exists or file_exists and reset:
         print(f"Downloading notebook: {file_name}")
-        r = requests.get(url, allow_redirects=True)
+        r = requests.get(url, allow_redirects=True)  # nosec
         with open(os.path.expanduser(file_path), "wb") as f:
             f.write(r.content)
         downloaded = True
     return file_path, downloaded, overwrite_all
 
 
 def fetch_notebooks_for_url(
@@ -92,15 +95,15 @@
             print(
                 f"You have {existing_count} existing notebook{plural} matching: {url}"
             )
             for nb in notebook_files:
                 print(nb)
 
         overwrite_all = False
-        for notebook_url in notebooks:
+        for notebook_url in tqdm(notebooks):
             file_path, _, overwrite_all = quickstart_download_notebook(
                 url=notebook_url,
                 directory=directory + os.sep + url_dir + os.sep,
                 reset=reset,
                 overwrite_all=overwrite_all,
             )
             downloaded_files.append(file_path)
@@ -109,14 +112,90 @@
         file_path, _, _ = quickstart_download_notebook(
             url=url, directory=directory, reset=reset
         )
         downloaded_files.append(file_path)
     return downloaded_files
 
 
+def quickstart_extract_notebook(
+    zip_file: str,
+    name: str,
+    directory: Path,
+    reset: bool = False,
+    overwrite_all: bool = False,
+) -> Tuple[str, bool, bool]:
+    directory.mkdir(exist_ok=True)
+    reset = overwrite_all
+
+    base_name = os.path.basename(name)
+    file_path = directory / base_name
+    file_name = file_path.name
+    file_exists = file_path.exists()
+
+    if file_exists and not reset:
+        response = click.prompt(
+            f"\nOverwrite {file_name}?",
+            prompt_suffix="(a/y/N)",
+            default="n",
+            show_default=False,
+        )
+        if response.lower() == "a":
+            reset = True
+            overwrite_all = True
+        elif response.lower() == "y":
+            reset = True
+        else:
+            print(f"Skipping {file_name}")
+            reset = False
+
+    extracted = False
+    if not file_exists or file_exists and reset:
+        print(f"Extracting notebook: {file_name}")
+        with zipfile.ZipFile(zip_file, "r") as zf:
+            zip_info = zf.getinfo(name)
+            zip_info.filename = base_name
+            zf.extract(zip_info, directory)
+        extracted = True
+    return str(file_path.absolute()), extracted, overwrite_all
+
+
+def fetch_notebooks_from_zipfile(
+    path: str, directory: str, reset: bool = False
+) -> List[str]:
+    dir_path = Path(directory)
+
+    with zipfile.ZipFile(path, "r") as zf:
+        notebooks = [f for f in zf.namelist() if f.endswith(".ipynb")]
+
+    notebook_files = [dir_path / os.path.basename(nb) for nb in notebooks]
+    existing_files = [nb for nb in notebook_files if nb.exists()]
+
+    existing_count = len(existing_files)
+
+    if existing_count > 0:
+        plural = "s" if existing_count > 1 else ""
+        print(f"You have {existing_count} existing notebook{plural}")
+        for nb in existing_files:
+            print(nb)
+
+    extracted_files = []
+    overwrite_all = False
+    for notebook in tqdm(notebooks):
+        file_path, _, overwrite_all = quickstart_extract_notebook(
+            zip_file=path,
+            name=notebook,
+            directory=dir_path,
+            reset=reset,
+            overwrite_all=overwrite_all,
+        )
+        extracted_files.append(file_path)
+
+    return extracted_files
+
+
 @dataclass
 class Tutorial:
     filename: str
     description: str
     url: str
 
 
@@ -158,25 +237,25 @@
                 html += (
                     f'<br /> <a href="{jupyter_path}">Click to Open Tutorial</a></div>'
                 )
             return NBOutput(html)
 
     def _repr_html_(self) -> str:
         html = ""
-        if not arg_cache.install_wizard_complete:
+        if not arg_cache["install_wizard_complete"]:
             html += "<h3>Step 1b: Install  Wizard (Recommended)</h3>"
             html += (
                 "It looks like this might be your first time running Quickstart.<br />"
             )
             html += (
                 "<blockquote>Please go through the Install Wizard notebook to "
                 + "install Syft and optionally start a Grid server."
             )
             html += (
-                '<br /> <a href="/files/01-install-wizard.ipynb">Click to start'
+                '<br /> <a href="./01-install-wizard.ipynb">Click to start '
                 + "Install  Wizard</a></div></blockquote>"
             )
             html += "<br />"
 
         html += "<h3>Download Tutorials</h3>"
         html += "Below is a list of tutorials to download using quickstart.<br />"
         html += "<ul>"
@@ -203,15 +282,15 @@
 ) -> List[str]:
     notebooks = []
     slug = commit if commit else branch
 
     gh_api_call = (
         "https://api.github.com/repos/" + repo + "/git/trees/" + slug + "?recursive=1"
     )
-    r = requests.get(gh_api_call)
+    r = requests.get(gh_api_call)  # nosec
     if r.status_code != 200:
         print(
             f"Failed to fetch notebook from: {gh_api_call}.\n"
             + "Please try again with the correct parameters!"
         )
         sys.exit(1)
```

### Comparing `hagrid-0.2.99/hagrid/rand_sec.py` & `hagrid-0.3.1/hagrid/rand_sec.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/style.py` & `hagrid-0.3.1/hagrid/style.py`

 * *Files identical despite different names*

### Comparing `hagrid-0.2.99/hagrid/win_bootstrap.py` & `hagrid-0.3.1/hagrid/win_bootstrap.py`

 * *Files 0% similar despite different names*

```diff
@@ -256,15 +256,14 @@
     if len(still_missing) > 0:
         print("We were still unable to find the following dependencies:")
         print("-----------------------------------")
         for dep in still_missing:
             print(f"{dep.full_name}")
         print("Please try again.")
     else:
-
         print("\nCongratulations. All done.")
         print("===================================\n")
         print("Now you can run HAGrid on Windows!")
 
 
 if __name__ == "__main__":
     main()
```

### Comparing `hagrid-0.2.99/hagrid/wizard_ui.py` & `hagrid-0.3.1/hagrid/wizard_ui.py`

 * *Files 14% similar despite different names*

```diff
@@ -16,21 +16,23 @@
 steps["check_syft"] = False
 steps["check_grid"] = False
 
 
 def complete_install_wizard(
     output: Union[Dict[str, Dependency], NBOutput]
 ) -> Union[Dict[str, Dependency], NBOutput]:
-    if not arg_cache.install_wizard_complete:
+    flipped = arg_cache["install_wizard_complete"]
+    if not flipped:
         for _, v in steps.items():
             if v is False:
                 return output
-    arg_cache.install_wizard_complete = True
+    arg_cache["install_wizard_complete"] = True
     if isinstance(output, NBOutput):
-        output.raw_output += "\n\n You have completed the Install Wizard"
+        if flipped != arg_cache["install_wizard_complete"]:
+            output.raw_output += "\n\n You have completed the Install Wizard"
     return output
 
 
 class WizardUI:
     @property
     def check_hagrid(self) -> Union[Dict[str, Dependency], NBOutput]:
         steps["check_hagrid"] = True
@@ -49,9 +51,14 @@
     @property
     def check_syft_pre(self) -> Union[Dict[str, Dependency], NBOutput]:
         steps["check_syft"] = True
         return complete_install_wizard(check_syft(pre=True))
 
     @property
     def check_grid_docker(self) -> Union[Dict[str, Dependency], NBOutput]:
+        print("Deprecated. Please use .check_docker")
+        return self.check_docker
+
+    @property
+    def check_docker(self) -> Union[Dict[str, Dependency], NBOutput]:
         steps["check_grid"] = True
         return complete_install_wizard(check_grid_docker())
```

### Comparing `hagrid-0.2.99/hagrid.egg-info/SOURCES.txt` & `hagrid-0.3.1/hagrid.egg-info/SOURCES.txt`

 * *Files 13% similar despite different names*

```diff
@@ -5,22 +5,24 @@
 hagrid/auth.py
 hagrid/azure.py
 hagrid/cache.py
 hagrid/cli.py
 hagrid/deps.py
 hagrid/exceptions.py
 hagrid/file.py
+hagrid/git_check.py
 hagrid/grammar.py
 hagrid/land.py
 hagrid/launch.py
 hagrid/lib.py
 hagrid/manifest_template.yml
 hagrid/mode.py
 hagrid/names.py
 hagrid/nb_output.py
+hagrid/orchestra.py
 hagrid/parse_template.py
 hagrid/quickstart_ui.py
 hagrid/rand_sec.py
 hagrid/style.py
 hagrid/util.py
 hagrid/version.py
 hagrid/win_bootstrap.py
```

### Comparing `hagrid-0.2.99/setup.py` & `hagrid-0.3.1/setup.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,35 +1,36 @@
 # stdlib
 import platform
 
 # third party
 from setuptools import find_packages
 from setuptools import setup
 
-__version__ = "0.2.99"
+__version__ = "0.3.1"
 
 DATA_FILES = {"img": ["hagrid/img/*.png"], "hagrid": ["*.yml"]}
 
 packages = [
     "ascii_magic",
-    "click",
+    "click>=7.1",
     "cryptography>=37.0.2",
     "gitpython",
     "jinja2",
     "names",
     "packaging>=21.3",
     "paramiko",
     "pyOpenSSL>=22.0.0",
     "requests",
     "rich",
     "setuptools",
     "virtualenv-api",
     "virtualenv",
     "PyYAML",
     "tqdm",
+    "gevent==22.10.2",
 ]
 
 if platform.system().lower() != "windows":
     packages.extend(["ansible", "ansible-core"])
 
 # Pillow binary wheels for Apple Silicon on Python 3.8 don't seem to work well
 # try using Python 3.9+ for HAGrid on Apple Silicon
```

### Comparing `hagrid-0.2.99/tests/hagrid/cli_test.py` & `hagrid-0.3.1/tests/hagrid/cli_test.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,8 +1,9 @@
 # stdlib
+from collections import defaultdict
 from typing import List
 from typing import Tuple
 
 # third party
 from hagrid import cli
 from hagrid import grammar
 
@@ -14,21 +15,25 @@
 
     # COMMAND: "hagrid launch"
     args: List[str] = []
 
     verb = cli.get_launch_verb()
     grammar = cli.parse_grammar(args=tuple(args), verb=verb)
     verb.load_grammar(grammar=grammar)
-    cmd = cli.create_launch_cmd(verb=verb, kwargs={}, ignore_docker_version_check=True)
+    cmd = cli.create_launch_cmd(
+        verb=verb, kwargs=defaultdict(lambda: None), ignore_docker_version_check=True
+    )
+
+    cmd = cmd["Launching"][0]  # type: ignore
 
     # check that it's a domain by default
     assert "NODE_TYPE=domain" in cmd or "NODE_TYPE='domain'" in cmd
 
     # check that the node has a name
-    assert "DOMAIN_NAME=" in cmd
+    assert "NODE_NAME=" in cmd
 
     # check that tail is on by default
     assert " -d " not in cmd
 
 
 def test_shortand_parse() -> None:
     """This test is important because we want to make it convenient
@@ -50,21 +55,24 @@
 
     # COMMAND: "hagrid launch on docker"
     args: List[str] = ["to", "docker"]
 
     verb = cli.get_launch_verb()
     grammar = cli.parse_grammar(args=tuple(args), verb=verb)
     verb.load_grammar(grammar=grammar)
-    cmd = cli.create_launch_cmd(verb=verb, kwargs={}, ignore_docker_version_check=True)
+    cmd = cli.create_launch_cmd(
+        verb=verb, kwargs=defaultdict(lambda: None), ignore_docker_version_check=True
+    )
 
+    cmd = cmd["Launching"][0]  # type: ignore
     # check that it's a domain by default
     assert "NODE_TYPE=domain" in cmd or "NODE_TYPE='domain'" in cmd
 
     # check that the node has a name
-    assert "DOMAIN_NAME=" in cmd
+    assert "NODE_NAME=" in cmd
 
     # check that tail is on by default
     assert " -d " not in cmd
 
 
 def test_shortand_parse_without_name_with_preposition() -> None:
     """This test is important because we want to make it convenient
@@ -86,23 +94,25 @@
 
     # COMMAND: "hagrid launch United Nations"
     args: List[str] = ["United", "Nations"]
 
     verb = cli.get_launch_verb()
     grammar = cli.parse_grammar(args=tuple(args), verb=verb)
     verb.load_grammar(grammar=grammar)
-    cmd = cli.create_launch_cmd(verb=verb, kwargs={}, ignore_docker_version_check=True)
+    cmd = cli.create_launch_cmd(
+        verb=verb, kwargs=defaultdict(lambda: None), ignore_docker_version_check=True
+    )
 
-    print(cmd)
+    cmd = cmd["Launching"][0]  # type: ignore
 
     # check that it's a domain by default
     assert "NODE_TYPE=domain" in cmd or "NODE_TYPE='domain'" in cmd
 
     # check that the node has a name
-    assert "DOMAIN_NAME=united_nations" in cmd or "DOMAIN_NAME='united_nations'" in cmd
+    assert "NODE_NAME=united_nations" in cmd or "NODE_NAME='united_nations'" in cmd
 
     # check that tail is on by default
     assert " -d " not in cmd
 
 
 def test_launch_with_longer_multiword_domain_name() -> None:
     """This test is important because we want to make it convenient for users to launch nodes with
@@ -110,25 +120,27 @@
 
     # COMMAND: "hagrid launch United Nations"
     args: List[str] = ["United", "States", "of", "America"]
 
     verb = cli.get_launch_verb()
     grammar = cli.parse_grammar(args=tuple(args), verb=verb)
     verb.load_grammar(grammar=grammar)
-    cmd = cli.create_launch_cmd(verb=verb, kwargs={}, ignore_docker_version_check=True)
+    cmd = cli.create_launch_cmd(
+        verb=verb, kwargs=defaultdict(lambda: None), ignore_docker_version_check=True
+    )
 
-    print(cmd)
+    cmd = cmd["Launching"][0]  # type: ignore
 
     # check that it's a domain by default
     assert "NODE_TYPE=domain" in cmd or "NODE_TYPE='domain'" in cmd
 
     # check that the node has a name
     assert (
-        "DOMAIN_NAME=united_states_of_america" in cmd
-        or "DOMAIN_NAME='united_states_of_america'" in cmd
+        "NODE_NAME=united_states_of_america" in cmd
+        or "NODE_NAME='united_states_of_america'" in cmd
     )
 
     # check that tail is on by default
     assert " -d " not in cmd
 
 
 def test_launch_with_longer_multiword_domain_name_with_preposition() -> None:
@@ -137,23 +149,25 @@
 
     # COMMAND: "hagrid launch United Nations on docker"
     args: List[str] = ["United", "Nations", "to", "docker"]
 
     verb = cli.get_launch_verb()
     grammar = cli.parse_grammar(args=tuple(args), verb=verb)
     verb.load_grammar(grammar=grammar)
-    cmd = cli.create_launch_cmd(verb=verb, kwargs={}, ignore_docker_version_check=True)
+    cmd = cli.create_launch_cmd(
+        verb=verb, kwargs=defaultdict(lambda: None), ignore_docker_version_check=True
+    )
 
-    print(cmd)
+    cmd = cmd["Launching"][0]  # type: ignore
 
     # check that it's a domain by default
     assert "NODE_TYPE=domain" in cmd or "NODE_TYPE='domain'" in cmd
 
     # check that the node has a name
-    assert "DOMAIN_NAME=united_nations" in cmd or "DOMAIN_NAME='united_nations'" in cmd
+    assert "NODE_NAME=united_nations" in cmd or "NODE_NAME='united_nations'" in cmd
 
     # check that tail is on by default
     assert " -d " not in cmd
 
 
 def test_shortand_parse_of_multiword_name() -> None:
     """This test is important because we want to make it convenient
```

